/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.22 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

// Copyright 2013 Basarat Ali Syed. All Rights Reserved.
//
// Licensed under MIT open source license http://opensource.org/licenses/MIT
//
// Orginal javascript code was by Mauricio Santos

/**
 *  Tone.js
 *  @author Yotam Mann
 *  @license http://opensource.org/licenses/MIT MIT License
 *  @copyright 2014-2015 Yotam Mann
 */

/*!
 * jQuery JavaScript Library v2.1.4
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2015-04-28T16:01Z
 */

/*!
 * Sizzle CSS Selector Engine v2.2.0-pre
 * http://sizzlejs.com/
 *
 * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-12-16
 */

/*****
 *
 *   Intersection.js
 *
 *   copyright 2002, Kevin Lindsey
 *
 *****/

//	MIT License, copyright (c) 2014 Jordan Santell

/**
	 *  @class Tone.Emitter gives classes which extend it
	 *         the ability to listen for and trigger events. 
	 *         Inspiration and reference from Jerome Etienne's [MicroEvent](https://github.com/jeromeetienne/microevent.js).
	 *         MIT (c) 2011 Jerome Etienne.
	 *         
	 *  @extends {Tone}
	 */

/**
	 *  @class Evaluate an expression at audio rate. <br><br>
	 *         Parsing code modified from https://code.google.com/p/tapdigit/
	 *         Copyright 2011 2012 Ariya Hidayat, New BSD License
	 *
	 *  @extends {Tone.SignalBase}
	 *  @constructor
	 *  @param {string} expr the expression to generate
	 *  @example
	 * //adds the signals from input[0] and input[1].
	 * var expr = new Tone.Expr("$0 + $1");
	 */

/**
 * Tween.js - Licensed under the MIT license
 * https://github.com/tweenjs/tween.js
 * ----------------------------------------------
 *
 * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.
 * Thank you all, you're awesome!
 */

var requirejs,require,define;(function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=typeof window!="undefined"&&typeof navigator!="undefined"&&!!window.document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;function isFunction(it){return ostring.call(it)==="[object Function]"}function isArray(it){return ostring.call(it)==="[object Array]"}function each(ary,func){if(ary){var i;for(i=0;i<ary.length;i+=1)if(ary[i]&&func(ary[i],i,ary))break}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;i>-1;i-=1)if(ary[i]&&func(ary[i],i,ary))break}}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop]}function eachProp(obj,func){var prop;for(prop in obj)if(hasProp(obj,prop)&&func(obj[prop],prop))break}function mixin(target,source,force,deepStringMixin){return source&&eachProp(source,function(value,prop){if(force||!hasProp(target,prop))deepStringMixin&&typeof value=="object"&&value&&!isArray(value)&&!isFunction(value)&&!(value instanceof RegExp)?(target[prop]||(target[prop]={}),mixin(target[prop],value,force,deepStringMixin)):target[prop]=value}),target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(err){throw err}function getGlobal(value){if(!value)return value;var g=global;return each(value.split("."),function(part){g=g[part]}),g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);return e.requireType=id,e.requireModules=requireModules,err&&(e.originalError=err),e}if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined);function newContext(contextName){var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},registry={},enabledRegistry={},undefEvents={},defQueue=[],defined={},urlFetched={},bundlesMap={},requireCounter=1,unnormalizedCounter=1;function trimDots(ary){var i,part;for(i=0;i<ary.length;i++){part=ary[i];if(part===".")ary.splice(i,1),i-=1;else if(part===".."){if(i===0||i===1&&ary[2]===".."||ary[i-1]==="..")continue;i>0&&(ary.splice(i-1,2),i-=2)}}}function normalize(name,baseName,applyMap){var pkgMain,mapValue,nameParts,i,j,nameSegment,lastIndex,foundMap,foundI,foundStarMap,starI,normalizedBaseParts,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"];name&&(name=name.split("/"),lastIndex=name.length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),name[0].charAt(0)==="."&&baseParts&&(normalizedBaseParts=baseParts.slice(0,baseParts.length-1),name=normalizedBaseParts.concat(name)),trimDots(name),name=name.join("/"));if(applyMap&&map&&(baseParts||starMap)){nameParts=name.split("/");outerLoop:for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts)for(j=baseParts.length;j>0;j-=1){mapValue=getOwn(map,baseParts.slice(0,j).join("/"));if(mapValue){mapValue=getOwn(mapValue,nameSegment);if(mapValue){foundMap=mapValue,foundI=i;break outerLoop}}}!foundStarMap&&starMap&&getOwn(starMap,nameSegment)&&(foundStarMap=getOwn(starMap,nameSegment),starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return pkgMain=getOwn(config.pkgs,name),pkgMain?pkgMain:name}function removeScript(name){isBrowser&&each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName)return scriptNode.parentNode.removeChild(scriptNode),!0})}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1)return pathConfig.shift(),context.require.undef(id),context.makeRequire(null,{skipMap:!0})([id]),!0}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=!0,normalizedName="";return name||(isDefine=!1,name="_@r"+(requireCounter+=1)),nameParts=splitPrefix(name),prefix=nameParts[0],name=nameParts[1],prefix&&(prefix=normalize(prefix,parentName,applyMap),pluginModule=getOwn(defined,prefix)),name&&(prefix?pluginModule&&pluginModule.normalize?normalizedName=pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap)}):normalizedName=name.indexOf("!")===-1?normalize(name,parentName,applyMap):name:(normalizedName=normalize(name,parentName,applyMap),nameParts=splitPrefix(normalizedName),prefix=nameParts[0],normalizedName=nameParts[1],isNormalized=!0,url=context.nameToUrl(normalizedName))),suffix=prefix&&!pluginModule&&!isNormalized?"_unnormalized"+(unnormalizedCounter+=1):"",{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);return mod||(mod=registry[id]=new context.Module(depMap)),mod}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);hasProp(defined,id)&&(!mod||mod.defineEmitComplete)?name==="defined"&&fn(defined[id]):(mod=getModule(depMap),mod.error&&name==="error"?fn(mod.error):mod.on(name,fn))}function onError(err,errback){var ids=err.requireModules,notified=!1;errback?errback(err):(each(ids,function(id){var mod=getOwn(registry,id);mod&&(mod.error=err,mod.events.error&&(notified=!0,mod.emit("error",err)))}),notified||req.onError(err))}function takeGlobalQueue(){globalDefQueue.length&&(each(globalDefQueue,function(queueItem){var id=queueItem[0];typeof id=="string"&&(context.defQueueMap[id]=!0),defQueue.push(queueItem)}),globalDefQueue=[])}handlers={require:function(mod){return mod.require?mod.require:mod.require=context.makeRequire(mod.map)},exports:function(mod){mod.usingExports=!0;if(mod.map.isDefine)return mod.exports?defined[mod.map.id]=mod.exports:mod.exports=defined[mod.map.id]={}},module:function(mod){return mod.module?mod.module:mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return getOwn(config.config,mod.map.id)||{}},exports:mod.exports||(mod.exports={})}}};function cleanRegistry(id){delete registry[id],delete enabledRegistry[id]}function breakCycle(mod,traced,processed){var id=mod.map.id;mod.error?mod.emit("error",mod.error):(traced[id]=!0,each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);dep&&!mod.depMatched[i]&&!processed[depId]&&(getOwn(traced,depId)?(mod.defineDep(i,defined[depId]),mod.check()):breakCycle(dep,traced,processed))}),processed[id]=!0)}function checkLoaded(){var err,usingPathFallback,waitInterval=config.waitSeconds*1e3,expired=waitInterval&&context.startTime+waitInterval<(new Date).getTime(),noLoads=[],reqCalls=[],stillLoading=!1,needCycleCheck=!0;if(inCheckLoaded)return;inCheckLoaded=!0,eachProp(enabledRegistry,function(mod){var map=mod.map,modId=map.id;if(!mod.enabled)return;map.isDefine||reqCalls.push(mod);if(!mod.error)if(!mod.inited&&expired)hasPathFallback(modId)?(usingPathFallback=!0,stillLoading=!0):(noLoads.push(modId),removeScript(modId));else if(!mod.inited&&mod.fetched&&map.isDefine){stillLoading=!0;if(!map.prefix)return needCycleCheck=!1}});if(expired&&noLoads.length)return err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads),err.contextName=context.contextName,onError(err);needCycleCheck&&each(reqCalls,function(mod){breakCycle(mod,{},{})}),(!expired||usingPathFallback)&&stillLoading&&(isBrowser||isWebWorker)&&!checkLoadedTimeoutId&&(checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0,checkLoaded()},50)),inCheckLoaded=!1}Module=function(map){this.events=getOwn(undefEvents,map.id)||{},this.map=map,this.shim=getOwn(config.shim,map.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},Module.prototype={init:function(depMaps,factory,errback,options){options=options||{};if(this.inited)return;this.factory=factory,errback?this.on("error",errback):this.events.error&&(errback=bind(this,function(err){this.emit("error",err)})),this.depMaps=depMaps&&depMaps.slice(0),this.errback=errback,this.inited=!0,this.ignore=options.ignore,options.enabled||this.enabled?this.enable():this.check()},defineDep:function(i,depExports){this.depMatched[i]||(this.depMatched[i]=!0,this.depCount-=1,this.depExports[i]=depExports)},fetch:function(){if(this.fetched)return;this.fetched=!0,context.startTime=(new Date).getTime();var map=this.map;if(!this.shim)return map.prefix?this.callPlugin():this.load();context.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load()}))},load:function(){var url=this.map.url;urlFetched[url]||(urlFetched[url]=!0,context.load(this.map.id,url))},check:function(){if(!this.enabled||this.enabling)return;var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(!this.inited)hasProp(context.defQueueMap,id)||this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(factory)){try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}this.map.isDefine&&exports===undefined&&(cjsModule=this.module,cjsModule?exports=cjsModule.exports:this.usingExports&&(exports=this.exports));if(err){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return err.requireMap=this.map,err.requireModules=this.map.isDefine?[this.map.id]:null,err.requireType=this.map.isDefine?"define":"require",onError(this.error=err);typeof console!="undefined"&&console.error?console.error(err):req.onError(err)}}else exports=factory;this.exports=exports;if(this.map.isDefine&&!this.ignore){defined[id]=exports;if(req.onResourceLoad){var resLoadMaps=[];each(this.depMaps,function(depMap){resLoadMaps.push(depMap.normalizedMap||depMap)}),req.onResourceLoad(context,this.map,resLoadMaps)}}cleanRegistry(id),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap),on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,bundleId=getOwn(bundlesMap,this.map.id),name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){plugin.normalize&&(name=plugin.normalize(name,function(name){return normalize(name,parentName,!0)})||""),normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap),on(normalizedMap,"defined",bind(this,function(value){this.map.normalizedMap=normalizedMap,this.init([],function(){return value},null,{enabled:!0,ignore:!0})})),normalizedMod=getOwn(registry,normalizedMap.id),normalizedMod&&(this.depMaps.push(normalizedMap),this.events.error&&normalizedMod.on("error",bind(this,function(err){this.emit("error",err)})),normalizedMod.enable());return}if(bundleId){this.map.url=context.nameToUrl(bundleId),this.load();return}load=bind(this,function(value){this.init([],function(){return value},null,{enabled:!0})}),load.error=bind(this,function(err){this.inited=!0,this.error=err,err.requireModules=[id],eachProp(registry,function(mod){mod.map.id.indexOf(id+"_unnormalized")===0&&cleanRegistry(mod.map.id)}),onError(err)}),load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;textAlt&&(text=textAlt),hasInteractive&&(useInteractive=!1),getModule(moduleMap),hasProp(config.config,id)&&(config.config[moduleName]=config.config[id]);try{req.exec(text)}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]))}hasInteractive&&(useInteractive=!0),this.depMaps.push(moduleMap),context.completeLoad(moduleName),localRequire([moduleName],load)}),plugin.load(map.name,localRequire,load,config)})),context.enable(pluginMap,this),this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){enabledRegistry[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if(typeof depMap=="string"){depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=depMap,handler=getOwn(handlers,depMap.id);if(handler){this.depExports[i]=handler(this);return}this.depCount+=1,on(depMap,"defined",bind(this,function(depExports){if(this.undefed)return;this.defineDep(i,depExports),this.check()})),this.errback?on(depMap,"error",bind(this,this.errback)):this.events.error&&on(depMap,"error",bind(this,function(err){this.emit("error",err)}))}id=depMap.id,mod=registry[id],!hasProp(handlers,id)&&mod&&!mod.enabled&&context.enable(depMap,this)})),eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=getOwn(registry,pluginMap.id);mod&&!mod.enabled&&context.enable(pluginMap,this)})),this.enabling=!1,this.check()},on:function(name,cb){var cbs=this.events[name];cbs||(cbs=this.events[name]=[]),cbs.push(cb)},emit:function(name,evt){each(this.events[name],function(cb){cb(evt)}),name==="error"&&delete this.events[name]}};function callGetModule(args){hasProp(defined,args[0])||getModule(makeModuleMap(args[0],null,!0)).init(args[1],args[2])}function removeListener(node,func,name,ieName){node.detachEvent&&!isOpera?ieName&&node.detachEvent(ieName,func):node.removeEventListener(name,func,!1)}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;return removeListener(node,context.onScriptLoad,"load","onreadystatechange"),removeListener(node,context.onScriptError,"error"),{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null)return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]));callGetModule(args)}context.defQueueMap={}}return context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,defQueueMap:{},Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,onError:onError,configure:function(cfg){cfg.baseUrl&&cfg.baseUrl.charAt(cfg.baseUrl.length-1)!=="/"&&(cfg.baseUrl+="/");var shim=config.shim,objs={paths:!0,bundles:!0,config:!0,map:!0};eachProp(cfg,function(value,prop){objs[prop]?(config[prop]||(config[prop]={}),mixin(config[prop],value,!0,!0)):config[prop]=value}),cfg.bundles&&eachProp(cfg.bundles,function(value,prop){each(value,function(v){v!==prop&&(bundlesMap[v]=prop)})}),cfg.shim&&(eachProp(cfg.shim,function(value,id){isArray(value)&&(value={deps:value}),(value.exports||value.init)&&!value.exportsFn&&(value.exportsFn=context.makeShimExports(value)),shim[id]=value}),config.shim=shim),cfg.packages&&each(cfg.packages,function(pkgObj){var location,name;pkgObj=typeof pkgObj=="string"?{name:pkgObj}:pkgObj,name=pkgObj.name,location=pkgObj.location,location&&(config.paths[name]=pkgObj.location),config.pkgs[name]=pkgObj.name+"/"+(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(registry,function(mod,id){!mod.inited&&!mod.map.unnormalized&&(mod.map=makeModuleMap(id,null,!0))}),(cfg.deps||cfg.callback)&&context.require(cfg.deps||[],cfg.callback)},makeShimExports:function(value){function fn(){var ret;return value.init&&(ret=value.init.apply(global,arguments)),ret||value.exports&&getGlobal(value.exports)}return fn},makeRequire:function(relMap,options){options=options||{};function localRequire(deps,callback,errback){var id,map,requireMod;return options.enableBuildCallback&&callback&&isFunction(callback)&&(callback.__requireJsBuild=!0),typeof deps=="string"?isFunction(callback)?onError(makeError("requireargs","Invalid require call"),errback):relMap&&hasProp(handlers,deps)?handlers[deps](registry[relMap.id]):req.get?req.get(context,deps,relMap,localRequire):(map=makeModuleMap(deps,relMap,!1,!0),id=map.id,hasProp(defined,id)?defined[id]:onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")))):(intakeDefines(),context.nextTick(function(){intakeDefines(),requireMod=getModule(makeModuleMap(null,relMap)),requireMod.skipMap=options.skipMap,requireMod.init(deps,callback,errback,{enabled:!0}),checkLoaded()}),localRequire)}return mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0],isRelative=segment==="."||segment==="..";return index!==-1&&(!isRelative||index>1)&&(ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length),moduleNamePlusExt=moduleNamePlusExt.substring(0,index)),context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,!0),ext,!0)},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,!1,!0).id)},specified:function(id){return id=makeModuleMap(id,relMap,!1,!0).id,hasProp(defined,id)||hasProp(registry,id)}}),relMap||(localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,!0),mod=getOwn(registry,id);mod.undefed=!0,removeScript(id),delete defined[id],delete urlFetched[map.url],delete undefEvents[id],eachReverse(defQueue,function(args,i){args[0]===id&&defQueue.splice(i,1)}),delete context.defQueueMap[id],mod&&(mod.events.defined&&(undefEvents[id]=mod.events),cleanRegistry(id))}),localRequire},enable:function(depMap){var mod=getOwn(registry,depMap.id);mod&&getModule(depMap).enable()},completeLoad:function(moduleName){var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){args[0]=moduleName;if(found)break;found=!0}else args[0]===moduleName&&(found=!0);callGetModule(args)}context.defQueueMap={},mod=getOwn(registry,moduleName);if(!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(config.enforceDefine&&(!shExports||!getGlobal(shExports))){if(hasPathFallback(moduleName))return;return onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]))}callGetModule([moduleName,shim.deps||[],shim.exportsFn])}checkLoaded()},nameToUrl:function(moduleName,ext,skipExt){var paths,syms,i,parentModule,url,parentPath,bundleId,pkgMain=getOwn(config.pkgs,moduleName);pkgMain&&(moduleName=pkgMain),bundleId=getOwn(bundlesMap,moduleName);if(bundleId)return context.nameToUrl(bundleId,ext,skipExt);if(req.jsExtRegExp.test(moduleName))url=moduleName+(ext||"");else{paths=config.paths,syms=moduleName.split("/");for(i=syms.length;i>0;i-=1){parentModule=syms.slice(0,i).join("/"),parentPath=getOwn(paths,parentModule);if(parentPath){isArray(parentPath)&&(parentPath=parentPath[0]),syms.splice(0,i,parentPath);break}}url=syms.join("/"),url+=ext||(/^data\:|\?/.test(url)||skipExt?"":".js"),url=(url.charAt(0)==="/"||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs?url+((url.indexOf("?")===-1?"?":"&")+config.urlArgs):url},load:function(id,url){req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if(evt.type==="load"||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){var parents=[];return eachProp(registry,function(value,key){key.indexOf("_@r")!==0&&each(value.depMaps,function(depMap){return depMap.id===data.id&&parents.push(key),!0})}),onError(makeError("scripterror",'Script error for "'+data.id+(parents.length?'", needed by: '+parents.join(", "):'"'),evt,[data.id]))}}},context.require=context.makeRequire(),context}req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;return!isArray(deps)&&typeof deps!="string"&&(config=deps,isArray(callback)?(deps=callback,callback=errback,errback=optional):deps=[]),config&&config.context&&(contextName=config.context),context=getOwn(contexts,contextName),context||(context=contexts[contextName]=req.s.newContext(contextName)),config&&context.configure(config),context.require(deps,callback,errback)},req.config=function(config){return req(config)},req.nextTick=typeof setTimeout!="undefined"?function(fn){setTimeout(fn,4)}:function(fn){fn()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(config,moduleName,url){var node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return node.type=config.scriptType||"text/javascript",node.charset="utf-8",node.async=!0,node},req.load=function(context,moduleName,url){var config=context&&context.config||{},node;if(isBrowser)return node=req.createNode(config,moduleName,url),config.onNodeCreated&&config.onNodeCreated(node,config,moduleName,url),node.setAttribute("data-requirecontext",context.contextName),node.setAttribute("data-requiremodule",moduleName),node.attachEvent&&!(node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,node.attachEvent("onreadystatechange",context.onScriptLoad)):(node.addEventListener("load",context.onScriptLoad,!1),node.addEventListener("error",context.onScriptError,!1)),node.src=url,currentlyAddingScript=node,baseElement?head.insertBefore(node,baseElement):head.appendChild(node),currentlyAddingScript=null,node;if(isWebWorker)try{importScripts(url),context.completeLoad(moduleName)}catch(e){context.onError(makeError("importscripts","importScripts failed for "+moduleName+" at "+url,e,[moduleName]))}};function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(script){if(script.readyState==="interactive")return interactiveScript=script}),interactiveScript)}isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(script){head||(head=script.parentNode),dataMain=script.getAttribute("data-main");if(dataMain)return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(name,deps,callback){var node,context;typeof name!="string"&&(callback=deps,deps=name,name=null),isArray(deps)||(callback=deps,deps=null),!deps&&isFunction(callback)&&(deps=[],callback.length&&(callback.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(match,dep){deps.push(dep)}),deps=(callback.length===1?["require"]:["require","exports","module"]).concat(deps))),useInteractive&&(node=currentlyAddingScript||getInteractiveScript(),node&&(name||(name=node.getAttribute("data-requiremodule")),context=contexts[node.getAttribute("data-requirecontext")])),context?(context.defQueue.push([name,deps,callback]),context.defQueueMap[name]=!0):globalDefQueue.push([name,deps,callback])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),define("requireLib",function(){}),define("text",["module"],function(module){"use strict";var text,fs,Cc,Ci,xpcIsWindows,progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation=typeof location!="undefined"&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||undefined),buildMap={},masterConfig=module.config&&module.config()||{};text={version:"2.0.14",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:masterConfig.createXhr||function(){var xhr,i,progId;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var modName,ext,temp,strip=!1,index=name.lastIndexOf("."),isRelative=name.indexOf("./")===0||name.indexOf("../")===0;return index!==-1&&(!isRelative||index>1)?(modName=name.substring(0,index),ext=name.substring(index+1)):modName=name,temp=ext||modName,index=temp.indexOf("!"),index!==-1&&(strip=temp.substring(index+1)==="strip",temp=temp.substring(0,index),ext?ext=temp:modName=temp),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);return match?(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName.toLowerCase()===hostname.toLowerCase())&&(!uPort&&!uHostName||uPort===port)):!0},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content,masterConfig.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config&&config.isBuild&&!config.inlineText){onLoad();return}masterConfig.isBuild=config&&config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+(parsed.ext?"."+parsed.ext:""),url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;if(url.indexOf("empty:")===0){onLoad();return}!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){onLoad.error&&onLoad.error(err)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),extPart=parsed.ext?"."+parsed.ext:"",nonStripName=parsed.moduleName+extPart,fileName=req.toUrl(parsed.moduleName+extPart)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}};if(masterConfig.env==="node"||!masterConfig.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])fs=require.nodeRequire("fs"),text.get=function(url,callback,errback){try{var file=fs.readFileSync(url,"utf8");file[0]==="﻿"&&(file=file.substring(1)),callback(file)}catch(e){errback&&errback(e)}};else if(masterConfig.env==="xhr"||!masterConfig.env&&text.createXhr())text.get=function(url,callback,errback,headers){var xhr=text.createXhr(),header;xhr.open("GET",url,!0);if(headers)for(header in headers)headers.hasOwnProperty(header)&&xhr.setRequestHeader(header.toLowerCase(),headers[header]);masterConfig.onXhr&&masterConfig.onXhr(xhr,url),xhr.onreadystatechange=function(evt){var status,err;xhr.readyState===4&&(status=xhr.status||0,status>399&&status<600?(err=new Error(url+" HTTP status: "+status),err.xhr=xhr,errback&&errback(err)):callback(xhr.responseText),masterConfig.onXhrComplete&&masterConfig.onXhrComplete(xhr,url))},xhr.send(null)};else if(masterConfig.env==="rhino"||!masterConfig.env&&typeof Packages!="undefined"&&typeof java!="undefined")text.get=function(url,callback){var stringBuffer,line,encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),content="";try{stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&line.charAt(0)===65279&&(line=line.substring(1)),line!==null&&stringBuffer.append(line);while((line=input.readLine())!==null)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)};else if(masterConfig.env==="xpconnect"||!masterConfig.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)Cc=Components.classes,Ci=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),xpcIsWindows="@mozilla.org/windows-registry-key;1"in Cc,text.get=function(url,callback){var inStream,convertStream,fileObj,readData={};xpcIsWindows&&(url=url.replace(/\//g,"\\")),fileObj=new FileUtils.File(url);try{inStream=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream),inStream.init(fileObj,1,0,!1),convertStream=Cc["@mozilla.org/intl/converter-input-stream;1"].createInstance(Ci.nsIConverterInputStream),convertStream.init(inStream,"utf-8",inStream.available(),Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),convertStream.readString(inStream.available(),readData),convertStream.close(),inStream.close(),callback(readData.value)}catch(e){throw new Error((fileObj&&fileObj.path||"")+": "+e)}};return text}),define("Core/Audio/Connections/AudioChain",["require","exports"],function(require,exports){var AudioChain=function(){function AudioChain(){this.Connections=[],this.Sources=[],this.PostEffects=[],this.PowerSources=[],this.PreEffects=[],this.PowerEffects=[]}return AudioChain}();exports.AudioChain=AudioChain});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Block",["require","exports","../Core/Audio/Connections/AudioChain"],function(require,exports,AudioChain_1){var DisplayObject=etch.drawing.DisplayObject,ObservableCollection=etch.collections.ObservableCollection,Point=etch.primitives.Point,RoutedEvent=etch.events.RoutedEvent,RoutedEventArgs=etch.events.RoutedEventArgs,Block=function(_super){__extends(Block,_super);function Block(){_super.apply(this,arguments),this.Click=new RoutedEvent,this.IsChained=!1,this.IsPressed=!1,this.IsSelected=!1,this.Connections=new ObservableCollection,this.Outline=[],this.Duplicable=!1}return Block.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Chain=new AudioChain_1.AudioChain,this.Update()},Block.prototype.PopulateParams=function(){var paramsCopy={};if(this.Params){this.BackwardsCompatibilityPatch();for(var key in this.Params)paramsCopy[""+key]=this.Params[""+key]}var params=this.Params={},defaults=this.Defaults;for(var key in defaults)paramsCopy[""+key]||paramsCopy[""+key]==0?params[""+key]=paramsCopy[""+key]:params[""+key]=defaults[""+key]},Block.prototype.BackwardsCompatibilityPatch=function(){},Block.prototype.Update=function(){},Block.prototype.Draw=function(){_super.prototype.Draw.call(this),this.Ctx.globalAlpha=this.IsPressed&&this.IsSelected?.5:1},Block.prototype.DrawSprite=function(type,option){App.BlockSprites.DrawSprite(this.DrawTo.BlocksContainer,this.Position,!0,type.toLowerCase(),option)},Block.prototype.MouseDown=function(){this.IsPressed=!0,this.LastPosition=this.Position.Clone(),this.Click.raise(this,new RoutedEventArgs)},Block.prototype.TouchDown=function(){this.IsPressed=!0},Block.prototype.MouseUp=function(){this.IsPressed=!1,this.Duplicable=!0},Block.prototype.MouseMove=function(point){this.IsPressed&&(App.CommandsInputManager.IsKeyCodeDown(KeyCodes.KeyDown.Alt)&&this.Duplicable?(this.DrawTo.CreateBlockFromType(this.Type,this.Params),this.MouseUp()):this.Position=App.Metrics.CursorToGrid(point))},Block.prototype.HitTest=function(point){this.Ctx.beginPath(),this.DrawMoveTo(this.Outline[0].x,this.Outline[0].y);for(var i=1;i<this.Outline.length;i++)this.DrawLineTo(this.Outline[i].x,this.Outline[i].y);return this.Ctx.closePath(),this.Ctx.isPointInPath(point.x,point.y)},Block.prototype.DrawMoveTo=function(x,y){var p=App.Metrics.GetRelativePoint(this.Position,new Point(x,y));p=App.Metrics.PointOnGrid(p),this.Ctx.moveTo(p.x,p.y)},Block.prototype.DrawLineTo=function(x,y){var p=App.Metrics.GetRelativePoint(this.Position,new Point(x,y));p=App.Metrics.PointOnGrid(p),this.Ctx.lineTo(p.x,p.y)},Block.prototype.ParticleCollision=function(particle){},Block.prototype.UpdateOptionsForm=function(){},Block.prototype.SetParam=function(param,value){},Block.prototype.RefreshOptionsPanel=function(cmd){App.MainScene.OptionsPanel.Scale>0&&App.MainScene.OptionsPanel.SelectedBlock==this&&(this.UpdateOptionsForm(),App.MainScene.OptionsPanel.Populate(this.OptionsForm,!1)),cmd?cmd==="animate"&&(App.MainScene.OptionsPanel.Animating=!0):App.MainScene.OptionsPanel.Animating=!1},Block.prototype.UpdateConnections=function(chain){this.Chain=chain},Block.prototype.DistanceFrom=function(point){var p=App.Metrics.ConvertGridUnitsToAbsolute(this.Position);return Math.distanceBetween(p.x,p.y,point.x,point.y)},Block.prototype.Refresh=function(){},Block.prototype.Stop=function(){},Block.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},Block}(DisplayObject);exports.Block=Block});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effect",["require","exports","./Block"],function(require,exports,Block_1){var ObservableCollection=etch.collections.ObservableCollection,Effect=function(_super){__extends(Effect,_super);function Effect(){_super.apply(this,arguments),this.CatchmentArea=6,this.Connections=new ObservableCollection}return Effect.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.UpdateOptionsForm()},Effect.prototype.Update=function(){_super.prototype.Update.call(this)},Effect.prototype.AddSource=function(source){this.Connections.Add(source)},Effect.prototype.RemoveSource=function(source){this.Connections.Remove(source)},Effect.prototype.ValidateSources=function(){for(var i=0;i<this.Connections.Count;i++){var src=this.Connections.GetValueAt(i);App.Sources.contains(src)||this.RemoveSource(src)}},Effect.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},Effect}(Block_1.Block);exports.Effect=Effect});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/PowerEffect",["require","exports","../Effect"],function(require,exports,Effect_1){var PowerEffect=function(_super){__extends(PowerEffect,_super);function PowerEffect(){_super.apply(this,arguments),this.OldConnections=[]}return PowerEffect.prototype.Init=function(sketch){_super.prototype.Init.call(this,sketch)},PowerEffect.prototype.UpdateConnections=function(){},PowerEffect}(Effect_1.Effect);exports.PowerEffect=PowerEffect});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/Logic/Logic",["require","exports","./../PowerEffect"],function(require,exports,PowerEffect_1){var Logic=function(_super){__extends(Logic,_super);function Logic(){_super.apply(this,arguments),this.ScheduledLogic=!1}return Logic.prototype.Init=function(drawTo){this.Defaults={logic:!1},this.PopulateParams(),_super.prototype.Init.call(this,drawTo)},Logic.prototype.Update=function(){_super.prototype.Update.call(this),this.ScheduledLogic&&(this.ScheduledLogic=!1,this.PerformLogic())},Logic.prototype.ParticleCollision=function(particle){this.PerformLogic(),particle.Dispose()},Logic.prototype.PerformLogic=function(){},Logic.prototype.ScheduleLogic=function(){this.ScheduledLogic=!0},Logic}(PowerEffect_1.PowerEffect);exports.Logic=Logic});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/Power",["require","exports","./PowerEffect"],function(require,exports,PowerEffect_1){var Point=etch.primitives.Point,Power=function(_super){__extends(Power,_super);function Power(){_super.apply(this,arguments)}return Power.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Power.Blocks.Power.name,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(1,-2),new Point(2,-1),new Point(2,0),new Point(0,2),new Point(-1,1))},Power.prototype.UpdateConnections=function(){var _this=this,newConnections=this.Connections.ToArray();this.OldConnections.forEach(function(source){newConnections.indexOf(source)===-1&&source.RemovePower()}),newConnections.forEach(function(source){_this.OldConnections.indexOf(source)===-1&&source.AddPower()}),this.OldConnections=newConnections},Power.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Power.prototype.Stop=function(){var connections=this.Connections.ToArray();connections.forEach(function(source){source.RemovePower()})},Power}(PowerEffect_1.PowerEffect);exports.Power=Power});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Source",["require","exports","./Block","./Power/Logic/Logic","./Power/Power"],function(require,exports,Block_1,Logic_1,Power_1){var ObservableCollection=etch.collections.ObservableCollection,Source=function(_super){__extends(Source,_super);function Source(){_super.apply(this,arguments),this.Connections=new ObservableCollection,this.Settings={envelope:{attack:.01,decay:.5,sustain:.5,release:.01},output:{volume:.5}},this.PowerAmount=0}return Source.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Sources=[],this.Envelopes=[],this.ActiveVoices=[],this.FreeVoices=[],this.ParticlePowered=!1,this.LaserPowered=!1,this.PowerConnections=0,this instanceof Power_1.Power||(this.AudioInput=new Tone.Mono,this.AudioInput.connect(App.Audio.Master)),this.UpdateOptionsForm()},Source.prototype.AddEffect=function(effect){this.Connections.Add(effect)},Source.prototype.RemoveEffect=function(effect){this.Connections.Remove(effect)},Source.prototype.ValidateEffects=function(){for(var i=0;i<this.Connections.Count;i++){var effect=this.Connections.GetValueAt(i);App.Effects.contains(effect)||this.RemoveEffect(effect)}},Source.prototype.UpdateConnections=function(chain){_super.prototype.UpdateConnections.call(this,chain),this._EnvelopeReset(),this.IsPowered()||this.TriggerRelease("all",!0),this.ResetPitch()},Source.prototype._EnvelopeReset=function(){var _this=this;this.Envelopes.length?this.Envelopes.forEach(function(e){e.attack=_this.Settings.envelope.attack,e.decay=_this.Settings.envelope.decay,e.sustain=_this.Settings.envelope.sustain,e.release=_this.Settings.envelope.release}):this.Sources[0]instanceof Tone.Simpler&&this.Sources.forEach(function(s){var e=s.envelope;e.attack=_this.Settings.envelope.attack,e.decay=_this.Settings.envelope.decay,e.sustain=_this.Settings.envelope.sustain,e.release=_this.Settings.envelope.release})},Source.prototype.CreateSource=function(){if(this.Sources[this.Sources.length-1])return this.Sources[this.Sources.length-1]},Source.prototype.CreateEnvelope=function(){if(this.Envelopes[this.Envelopes.length-1])return this.Envelopes[this.Envelopes.length-1]},Source.prototype.Stop=function(){this.TriggerRelease("all",!0)},Source.prototype.TriggerAttack=function(index){index===void 0&&(index=0),this.Envelopes.length?index==="all"?this.Envelopes.forEach(function(e){e.triggerAttack("+0.01")}):this.Envelopes[index].triggerAttack("+0.01"):this.Sources[0]&&this.Sources[0].envelope?index==="all"?this.Sources.forEach(function(s){s.triggerAttack("+0.01")}):this.Sources[index].triggerAttack("+0.01"):this.UpdateCollision!==undefined&&(this.UpdateCollision=!0)},Source.prototype.TriggerRelease=function(index,forceRelease){index===void 0&&(index=0),forceRelease=forceRelease===!0?forceRelease:!1;if(!this.IsPowered()||forceRelease)this.Envelopes.length?index==="all"?this.Envelopes.forEach(function(e){e.triggerRelease()}):this.Envelopes[index].triggerRelease():this.Sources[0]&&this.Sources[0].envelope?index==="all"?this.Sources.forEach(function(s){s.triggerRelease()}):this.Sources[index].triggerRelease():this.UpdateCollision!==undefined&&(this.UpdateCollision=!0)},Source.prototype.TriggerAttackRelease=function(duration,time,velocity){duration===void 0&&(duration=App.Config.PulseLength),time===void 0&&(time="+0.01");if(this.Envelopes.length)this.Envelopes[0].triggerAttackRelease(duration,time);else if(this.Sources[0]&&this.Sources[0].envelope)this.Sources[0].triggerAttackRelease(!1,duration,time);else if(this.PowerAmount!==undefined){this.AddPower(),this.UpdateCollision!==undefined&&(this.UpdateCollision=!0);var block=this,seconds=App.Audio.Tone.toSeconds(duration)*1e3;setTimeout(function(){block.RemovePower(),block.UpdateCollision!==undefined&&(block.UpdateCollision=!0)},seconds)}},Source.prototype.IsPowered=function(){return this.IsPressed||this.PowerConnections>0||this.PowerAmount>0?!0:(this.Chain.Connections.forEach(function(block){var blockConnections=block.Connections.ToArray();for(var i=0;i<blockConnections.length;i++)if(blockConnections[i]instanceof Power_1.Power||blockConnections[i]instanceof Logic_1.Logic&&blockConnections[i].Params.logic)return!0}),!1)},Source.prototype.ParticleCollision=function(particle){_super.prototype.ParticleCollision.call(this,particle),this.IsPowered()||this.TriggerAttackRelease(),particle.Dispose()},Source.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.AudioInput&&this.AudioInput.dispose(),this.ActiveVoices.length&&(this.ActiveVoices.forEach(function(s){s.ID=null}),this.ActiveVoices=[]),this.FreeVoices.length&&(this.FreeVoices.forEach(function(s){s.ID=null}),this.FreeVoices=[])},Source.prototype.SetPitch=function(pitch,sourceId,rampTime){var id=sourceId?sourceId:0,time=rampTime?rampTime:0;this.Sources[id].frequency?this.Sources[id].frequency.exponentialRampToValue(pitch,time):this.Sources[id].player?Tone.isSafari?this.Sources[id].player.playbackRate=pitch/App.Config.BaseNote:this.Sources[id].player.playbackRate.exponentialRampToValue(pitch/App.Config.BaseNote,time):this.Sources[0].playbackRate instanceof Tone.Signal&&(Tone.isSafari?this.Sources[id].playbackRate=pitch/App.Config.BaseNote:this.Sources[id].playbackRate.exponentialRampToValue(pitch/App.Config.BaseNote,time))},Source.prototype.GetPitch=function(id){return id===void 0&&(id=0),this.Sources[id].frequency?this.Sources[id].frequency.value:this.Sources[id].player?Tone.isSafari?this.Sources[id].player.playbackRate*App.Config.BaseNote:this.Sources[id].player.playbackRate.value*App.Config.BaseNote:this.Sources[0].playbackRate instanceof Tone.Signal?Tone.isSafari?this.Sources[id].playbackRate*App.Config.BaseNote:this.Sources[id].playbackRate.value*App.Config.BaseNote:0},Source.prototype.ResetPitch=function(){App.Config.ResetPitchesOnInteractionDisconnect&&(typeof this.Params.transpose=="number"?this.SetPitch(App.Config.BaseNote*App.Audio.Tone.intervalToFrequencyRatio(this.Params.transpose)):this.Sources[0].player?Tone.isSafari?this.Sources[0].player.playbackRate=this.Params.playbackRate:this.Sources[0].player.playbackRate.value=this.Params.playbackRate:this.Sources[0].playbackRate instanceof Tone.Signal&&(Tone.isSafari?this.Sources[0].playbackRate=this.Params.playbackRate:this.Sources[0].playbackRate.value=this.Params.playbackRate))},Source.prototype.OctaveShift=function(octaves){var _this=this;return octaves&&this.Sources.forEach(function(s,i){var oldPitch=_this.GetPitch(i),multiplier=Math.pow(2,Math.abs(octaves));octaves>0?_this.SetPitch(oldPitch*multiplier,i):_this.SetPitch(oldPitch/multiplier,i)}),this},Source.prototype.MouseDown=function(){_super.prototype.MouseDown.call(this),this.TriggerAttack()},Source.prototype.MouseUp=function(){_super.prototype.MouseUp.call(this),this.TriggerRelease("all")},Source.prototype.AddPower=function(){this.PowerAmount===0&&this.TriggerAttack(),this.PowerAmount++},Source.prototype.RemovePower=function(){if(this.PowerAmount===1)this.TriggerRelease("all",!0);else if(this.PowerAmount===0)return;this.PowerAmount--},Source}(Block_1.Block);exports.Source=Source});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/PostEffect",["require","exports","./../Effect"],function(require,exports,Effect_1){var PostEffect=function(_super){__extends(PostEffect,_super);function PostEffect(){_super.apply(this,arguments)}return PostEffect}(Effect_1.Effect);exports.PostEffect=PostEffect});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/PowerSource",["require","exports","../Source"],function(require,exports,Source_1){var PowerSource=function(_super){__extends(PowerSource,_super);function PowerSource(){_super.apply(this,arguments)}return PowerSource.prototype.Init=function(drawTo){this.PowerConnections=0,_super.prototype.Init.call(this,drawTo)},PowerSource.prototype.UpdateConnections=function(){},PowerSource}(Source_1.Source);exports.PowerSource=PowerSource});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/PreEffect",["require","exports","./../Effect"],function(require,exports,Effect_1){var PreEffect=function(_super){__extends(PreEffect,_super);function PreEffect(){_super.apply(this,arguments)}return PreEffect}(Effect_1.Effect);exports.PreEffect=PreEffect}),define("Core/Audio/Connections/ConnectionManager",["require","exports","../../../Blocks/Source","../../../Blocks/Effects/PostEffect","../../../Blocks/Power/PowerSource","../../../Blocks/Effects/PreEffect"],function(require,exports,Source_1,PostEffect_1,PowerSource_1,PreEffect_1){var ConnectionManager=function(){function ConnectionManager(){this._Debug=!1,this.Chains=[],this._MuteBufferTime=35,this.IsConnected=!0}return ConnectionManager.prototype.Update=function(){var _this=this;this._Debug&&console.clear(),this.IsConnected=!1,App.Audio.Master.mute=!0,this._Disconnect(function(){var chains=_this.CreateChains(),powerEffects=App.PowerEffects,powerSources=App.PowerSources;_this._SortChainedBlocks(chains),_this._Connect(chains,powerEffects,powerSources),_this.IsConnected=!0})},ConnectionManager.prototype._Disconnect=function(callback){var _this=this;clearTimeout(this.connectionTimeout),clearTimeout(this.unMuteTimeout),this.connectionTimeout=setTimeout(function(){App.Blocks.forEach(function(block){block instanceof Source_1.Source?block.AudioInput.disconnect():block instanceof PostEffect_1.PostEffect&&block.Effect.disconnect(),block.IsChained=!1}),_this.Chains=[],callback()},this._MuteBufferTime)},ConnectionManager.prototype._Connect=function(chains,powerEffects,powerSources){var _this=this;this._Debug&&console.log(chains),chains.forEach(function(chain){chain.Sources.forEach(function(block){block.UpdateConnections(chain),block.Chain=chain,_this._Debug&&console.log(block)}),chain.PreEffects.forEach(function(block){block.UpdateConnections(chain),block.Chain=chain,_this._Debug&&console.log(block)}),chain.PowerSources.forEach(function(block){block.Chain=chain});if(chain.Sources.length){_this._Debug&&console.warn("Connect: ",chain.Sources," to: ",chain.PostEffects);var p=chain.PostEffects;if(p.length){var currentUnit=p[0].Effect;for(var i=1;i<p.length;i++){var toUnit=p[i].Effect;currentUnit.connect(toUnit),currentUnit=toUnit}chain.Sources.forEach(function(source){source.AudioInput.connect(p[0].Effect)}),chain.PostEffects[p.length-1].Effect.toMaster()}else chain.Sources.forEach(function(source){source.AudioInput.toMaster()})}}),powerEffects.forEach(function(powerEffect){powerEffect.UpdateConnections(),_this._Debug&&console.log(powerEffect)}),powerSources.forEach(function(powerSource){powerSource.UpdateConnections(),_this._Debug&&console.log(powerSource)}),this.unMuteTimeout=setTimeout(function(){App.Audio.Master.mute=!1},this._MuteBufferTime)},ConnectionManager.prototype.CreateChains=function(){return this.Chains},ConnectionManager.prototype._SortChainedBlocks=function(chains){chains.forEach(function(chain){chain.Connections.forEach(function(block){block instanceof PowerSource_1.PowerSource?chain.PowerSources.push(block):block instanceof Source_1.Source?chain.Sources.push(block):block instanceof PostEffect_1.PostEffect?chain.PostEffects.push(block):block instanceof PreEffect_1.PreEffect&&chain.PreEffects.push(block)})})},ConnectionManager.prototype.GetChainFromBlock=function(block){var _chain;return this.Chains.forEach(function(chain){chain.Connections.indexOf(block)!==-1&&(_chain=chain)}),_chain},ConnectionManager.prototype.GetChainFromPreEffect=function(block){var _chain;return this.Chains.forEach(function(chain){chain.PreEffects.indexOf(block)!==-1&&(_chain=chain)}),_chain},ConnectionManager}();exports.ConnectionManager=ConnectionManager});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Core/Audio/Connections/ConnectionMethods/AccumulativeConnectionMethod",["require","exports","../AudioChain","../ConnectionManager","../../../../Blocks/Power/PowerEffect"],function(require,exports,AudioChain_1,ConnectionManager_1,PowerEffect_1){var AccumulativeConnectionMethod=function(_super){__extends(AccumulativeConnectionMethod,_super);function AccumulativeConnectionMethod(){_super.call(this)}return AccumulativeConnectionMethod.prototype.CreateChains=function(){var _this=this;return App.Blocks.forEach(function(block){if(!block.IsChained&&!(block instanceof PowerEffect_1.PowerEffect)){var chain=new AudioChain_1.AudioChain;_this.Chains.push(chain),_this._ParseConnections(chain,block)}}),this.Chains},AccumulativeConnectionMethod.prototype._ParseConnections=function(chain,parentBlock){var _this=this;if(chain.Connections.indexOf(parentBlock)===-1&&!(parentBlock instanceof PowerEffect_1.PowerEffect)){chain.Connections.push(parentBlock),parentBlock.IsChained=!0;var parentConnections=parentBlock.Connections.ToArray();parentConnections.forEach(function(childBlock){_this._ParseConnections(chain,childBlock)})}},AccumulativeConnectionMethod}(ConnectionManager_1.ConnectionManager);exports.AccumulativeConnectionMethod=AccumulativeConnectionMethod}),define("Core/Audio/AudioFileManager",["require","exports"],function(require,exports){var AudioFileManager=function(){function AudioFileManager(){}return AudioFileManager.prototype.DecodeFileData=function(files,callback){if(!files[0].type.match("audio.*")){App.Message("This is not an audio file, please try again with a .wav, .mp3 or .ogg");return}files[0].size>1e8&&App.Message("The audio file is too large. The maximum size is 100mb");var reader=new FileReader;reader.onerror=AudioFileManager.ErrorHandler,reader.onprogress=AudioFileManager.UpdateProgress,reader.onabort=function(e){App.Message("File read cancelled")},reader.onload=function(ev){App.Audio.ctx.decodeAudioData(ev.target.result,function(theBuffer){callback(files[0],theBuffer)},function(){App.Message("Sorry, we could not process this audio file."),console.error("Sorry, we could not process this audio file."),callback(files[0],undefined)})},reader.readAsArrayBuffer(files[0])},AudioFileManager.ErrorHandler=function(event){switch(event.target.error.code){case event.target.error.NOT_FOUND_ERR:App.Message("File Not Found!");break;case event.target.error.NOT_READABLE_ERR:App.Message("File is not readable");break;case event.target.error.ABORT_ERR:break;default:App.Message("An error occurred reading this file.")}},AudioFileManager.UpdateProgress=function(event){if(event.lengthComputable){var percentLoaded=Math.round(event.loaded/event.total*100);percentLoaded<100&&console.log(percentLoaded+"%"),console.log(percentLoaded+"%")}},AudioFileManager}();exports.AudioFileManager=AudioFileManager}),define("Core/Audio/AudioNodeConnectionManager",["require","exports","../../Blocks/Effects/PostEffect"],function(require,exports,PostEffect_1){var AudioNodeConnectionManager=function(){function AudioNodeConnectionManager(){this.ExtendToneConnectionMethods()}return AudioNodeConnectionManager.prototype.ExtendToneConnectionMethods=function(){AudioNode.prototype._toneConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(destination,outNum,inNum){destination instanceof PostEffect_1.PostEffect&&(destination=destination.Effect),this._toneConnect(destination,outNum,inNum)}},AudioNodeConnectionManager.Debug=!1,AudioNodeConnectionManager}();exports.AudioNodeConnectionManager=AudioNodeConnectionManager}),define("Core/Audio/MIDIMessageArgs",["require","exports"],function(require,exports){var MIDIMessageArgs=function(){function MIDIMessageArgs(MIDI){Object.defineProperty(this,"MIDI",{value:MIDI,writable:!1})}return MIDIMessageArgs}();exports.MIDIMessageArgs=MIDIMessageArgs}),define("Core/Audio/MIDIManager",["require","exports","./MIDIMessageArgs"],function(require,exports,MIDIMessageArgs_1){var MIDIManager=function(){function MIDIManager(){this.HasMIDICapability=!1,this.MIDIMessage=new nullstone.Event}return MIDIManager.prototype.Init=function(){navigator.requestMIDIAccess!==undefined?(this.HasMIDICapability=!0,App.Audio.MIDIManager.HasMIDICapability?(navigator.requestMIDIAccess({sysex:!1}).then(this._OnMIDIInit.bind(this),this._OnMIDIFailure.bind(this)),console.log("MIDI ready")):console.log("No access to MIDI devices or your browser doesn't support WebMIDI API")):this.HasMIDICapability=!1},MIDIManager.prototype._OnMIDIInit=function(midi){this.MIDI=midi,console.log("MIDI success",this.MIDI),this.HookUpMIDIInput(),this.MIDI.onstatechange=this.HookUpMIDIInput.bind(this)},MIDIManager.prototype.HookUpMIDIInput=function(){var i=0,inputs=this.MIDI.inputs.values();for(var input=inputs.next();input&&!input.done;input=inputs.next())input.value.onmidimessage=this._OnMIDIMessage.bind(this),console.log(input),i===0&&MIDIManager.DisplayInput(input.value),i++},MIDIManager.prototype._OnMIDIFailure=function(error){this.HasMIDICapability=!1,console.log(error)},MIDIManager.prototype._OnMIDIMessage=function(e){var args={cmd:e.data[0]>>4,channel:e.data[0]&15,type:e.data[0]&240,note:App.Audio.Tone.midiToNote(e.data[1]),velocity:e.data[2]};this.MIDIMessage.raise(this,new MIDIMessageArgs_1.MIDIMessageArgs(args))},MIDIManager.DisplayInput=function(i){return typeof App.Message=="function"&&setTimeout(function(){App.Message("MIDI Controller: "+i.name+" "+i.state),console.log("Input port: [\n                    type: + "+i.type+"\n                    id: "+i.id+"\n                    manufacturer: "+i.manufacturer+"\n                    name: "+i.name+"\n                    version: "+i.version+"\n                    state: "+i.state+"\n                ]")},250),i},MIDIManager}();exports.MIDIManager=MIDIManager});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Core/Audio/Connections/ConnectionMethods/SimpleConnectionMethod",["require","exports","../AudioChain","../ConnectionManager"],function(require,exports,AudioChain_1,ConnectionManager_1){var SimpleConnectionMethod=function(_super){__extends(SimpleConnectionMethod,_super);function SimpleConnectionMethod(){_super.call(this)}return SimpleConnectionMethod.prototype.CreateChains=function(){var _this=this;return App.Sources.forEach(function(source){var chain=new AudioChain_1.AudioChain;_this.Chains.push(chain);var effects=source.Connections.ToArray();(_a=chain.Connections).push.apply(_a,[source].concat(effects)),chain.Connections.forEach(function(block){block.IsChained=!0});var _a}),this.Chains},SimpleConnectionMethod}(ConnectionManager_1.ConnectionManager);exports.SimpleConnectionMethod=SimpleConnectionMethod}),define("Core/Audio/Waveform",["require","exports"],function(require,exports){var Waveform=function(){function Waveform(){}return Waveform.prototype.GetWaveformFromBuffer=function(buffer,points,stepsPerPoint,normal){console.log(buffer),console.log("minutes: "+buffer.duration/60),stepsPerPoint=10;var leftOnly=!1,newWaveform=[],peak=0,normThreshold=.01,left=buffer.getChannelData(0);if(buffer.numberOfChannels>1&&!leftOnly)var right=buffer.getChannelData(1);var slice=Math.ceil(left.length/points),step=Math.ceil(slice/stepsPerPoint);for(var i=0;i<points;i++){var max1=0,max2=0;for(var j=0;j<slice;j+=step){var datum=left[i*slice+j];datum<0&&(datum=-datum),datum>max1&&(max1=datum);if(right){var datum2=right[i*slice+j];datum2<0&&(datum2=-datum2),datum2>max2&&(max2=datum2),max2>max1&&(max1=max2)}}max1>peak&&(peak=max1),newWaveform.push(max1)}if(peak>normThreshold){var percent=normal/100,mult=(1/peak-1)*percent+1;for(var i=0;i<newWaveform.length;i++)newWaveform[i]=newWaveform[i]*mult}return newWaveform},Waveform}();exports.Waveform=Waveform}),define("Core/Audio/Audio",["require","exports","./Connections/ConnectionMethods/AccumulativeConnectionMethod","./AudioFileManager","./AudioNodeConnectionManager","./MIDIManager","./Connections/ConnectionMethods/SimpleConnectionMethod","./Waveform"],function(require,exports,AccumulativeConnectionMethod_1,AudioFileManager_1,AudioNodeConnectionManager_1,MIDIManager_1,SimpleConnectionMethod_1,Waveform_1){var Audio=function(){function Audio(){this.MasterVolume=-10,this.NoteIndex=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this.WaveformTypeIndex=["sine","square","triangle","sawtooth"],this.WaveformTypeIndexNoise=["white","pink","brown"]}return Audio.prototype.Init=function(){this.Tone=new Tone,this.ctx=this.Tone.context,this.sampleRate=this.ctx.sampleRate,this.Master=Tone.Master,this.Meter=new Tone.Meter,this.Master.connect(this.Meter),this.Level=0,this.Peak=0,this.Clip=!1,this.Master.volume.value=this.MasterVolume,this.AudioNodeConnectionManager=new AudioNodeConnectionManager_1.AudioNodeConnectionManager,this.ConnectionMethodType=1;switch(this.ConnectionMethodType){case 0:this.ConnectionManager=new SimpleConnectionMethod_1.SimpleConnectionMethod;break;case 1:this.ConnectionManager=new AccumulativeConnectionMethod_1.AccumulativeConnectionMethod;break;default:console.error("No connection method set")}this.AudioFileManager=new AudioFileManager_1.AudioFileManager,this.MIDIManager=new MIDIManager_1.MIDIManager,this.MIDIManager.Init(),this.Waveform=new Waveform_1.Waveform},Object.defineProperty(Audio.prototype,"MeterVolumeDb",{get:function(){return this.Meter.getDb()},enumerable:!0,configurable:!0}),Object.defineProperty(Audio.prototype,"MeterVolume",{get:function(){return this.Meter.getLevel()},enumerable:!0,configurable:!0}),Object.defineProperty(Audio.prototype,"HasClipped",{get:function(){return this.Meter.isClipped()},enumerable:!0,configurable:!0}),Audio.prototype.Monitor=function(){this.Level=this.MeterVolumeDb,this.Level>this.Peak&&(this.Peak=this.Level),this.Peak>0&&(this.Clip=!0)},Audio.prototype.MonitorReset=function(){this.Peak=0,this.Clip=!1},Audio}();exports.Audio=Audio}),define("Blocks/BlockSprites",["require","exports"],function(require,exports){var Point=etch.primitives.Point,BlockSprites=function(){function BlockSprites(){}return BlockSprites.prototype.DrawSprite=function(ctx,pos,scaled,blockType,pos2){this.Ctx=ctx.Ctx,this._Scaled=scaled,this._Position=pos,this._XOffset=0,this._YOffset=0;var grd=App.GridSize;switch(blockType){case App.L10n.Blocks.Effect.Blocks.AutoWah.name.toLowerCase():this._Scaled||(this._XOffset=grd*.5,this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(-2,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.BitCrusher.name.toLowerCase():this._Scaled||(this._YOffset=grd),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,0),this.DrawLineTo(1,-2),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(1,-2),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Chomp.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(0,1),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Chopper.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Chorus.name.toLowerCase():this._Scaled||(this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[10]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,0),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Convolution.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5)),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(0,0),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Delay.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.DrawLineTo(0,1),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,1),this.DrawLineTo(0,0),this.DrawLineTo(1,1),this.DrawLineTo(1,2),this.DrawLineTo(0,1),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Distortion.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,0),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawLineTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(0,0),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Envelope.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Eq.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5),this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawLineTo(0,0),this.DrawLineTo(1,1),this.DrawLineTo(2,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Filter.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,-2),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.DrawLineTo(-1,0),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Volume.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5),this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(2,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Vibrato.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(0,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Phaser.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawMoveTo(-1,0),this.DrawLineTo(-1,-2),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(-1,-1),this.DrawLineTo(1,1),this.DrawLineTo(1,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.PitchShifter.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5),this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(2,-1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Reverb.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5)),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(0,0),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Effect.Blocks.Scuzz.name.toLowerCase():this._Scaled||(this._YOffset=grd),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[10]),this.DrawMoveTo(-1,-1),this.DrawLineTo(2,-1),this.DrawLineTo(0,1),this.DrawLineTo(-1,0),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Tone.name.toLowerCase():this._Scaled||(this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(-2,0),this.DrawLineTo(0,-2),this.DrawLineTo(2,0),this.DrawLineTo(1,1),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-2,0),this.DrawLineTo(0,-2),this.DrawLineTo(0,0),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(0,-2),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Noise.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,0),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Microphone.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawMoveTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Soundcloud.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5),this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[10]),this.DrawMoveTo(1,0),this.DrawLineTo(2,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Sampler.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5),this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawMoveTo(1,0),this.DrawLineTo(2,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Granular.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5)),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(2,1),this.DrawLineTo(1,2),this.DrawLineTo(1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.Recorder.name.toLowerCase():this._Scaled||(this._XOffset=-(grd*.5)),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(2,1),this.DrawLineTo(1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Source.Blocks.WaveGen.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[10]),this.DrawMoveTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.DrawLineTo(0,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Interaction.Blocks.ComputerKeyboard.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(2,1),this.DrawLineTo(1,2),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawLineTo(0,-1),this.DrawLineTo(0,1),this.DrawLineTo(1,1),this.DrawLineTo(1,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Interaction.Blocks.MIDIController.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(2,1),this.DrawLineTo(1,2),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawLineTo(0,-1),this.DrawLineTo(-1,1),this.DrawLineTo(1,1),this.DrawLineTo(1,0),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawLineTo(-1,-1),this.DrawLineTo(-1,1),this.DrawLineTo(0,1),this.DrawLineTo(0,-1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Power.Blocks.ParticleEmitter.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(-2,0),this.DrawLineTo(2,0),this.DrawLineTo(0,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Power.Blocks.Power.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(1,-2),this.DrawLineTo(2,-1),this.DrawLineTo(2,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(0,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(1,-2),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Power.Blocks.TogglePower.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(1,2),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,0),this.DrawLineTo(0,1),this.DrawLineTo(1,2),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Power.Blocks.MomentaryPower.name.toLowerCase():this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(0,1),this.DrawLineTo(0,0),this.DrawLineTo(1,-1),this.DrawLineTo(1,1),this.DrawLineTo(0,2),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Power.Blocks.Laser.name.toLowerCase():this._Scaled||(this._YOffset=grd*.5),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(0,1),this.DrawLineTo(-1,0),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill();break;case App.L10n.Blocks.Power.Blocks.Void.name.toLowerCase():App.FillColor(this.Ctx,App.Palette[14]),this.Ctx.beginPath(),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),App.FillColor(this.Ctx,App.Palette[8]),this._Scaled?this.DrawPixel(pos2.x,pos2.y,2):this.DrawPixel(-1,2,2),this.DrawPixel(-3,-8,1),this.DrawPixel(1,-4,1),this.DrawPixel(8,-3,1),this.DrawPixel(-8,1,1),this.DrawPixel(1,9,1);break;default:console.log("block not found")}},BlockSprites.prototype.DrawPixel=function(x,y,size){var s=size*.5;this.Ctx.beginPath(),this.DrawFloatMoveTo(x,y),this.DrawFloatLineTo(x+s,y),this.DrawFloatLineTo(x+s,y+s),this.DrawFloatLineTo(x,y+s),this.Ctx.closePath(),this.Ctx.fill()},BlockSprites.prototype.DrawMoveTo=function(x,y){var pos=new Point(this._Position.x+this._XOffset,this._Position.y+this._YOffset),p,grd=App.GridSize;this._Scaled?(p=App.Metrics.GetRelativePoint(pos,new Point(x,y)),p=App.Metrics.PointOnGrid(p)):p=new Point(pos.x+x*grd,pos.y+y*grd),this.Ctx.moveTo(p.x,p.y)},BlockSprites.prototype.DrawLineTo=function(x,y){var pos=new Point(this._Position.x+this._XOffset,this._Position.y+this._YOffset),p,grd=App.GridSize;this._Scaled?(p=App.Metrics.GetRelativePoint(pos,new Point(x,y)),p=App.Metrics.PointOnGrid(p)):p=new Point(pos.x+x*grd,pos.y+y*grd),this.Ctx.lineTo(p.x,p.y)},BlockSprites.prototype.DrawFloatMoveTo=function(x,y){var pos=new Point(this._Position.x+this._XOffset,this._Position.y+this._YOffset),p;this._Scaled?p=App.Metrics.PointOnGrid(new Point(pos.x+x/App.GridSize*App.Unit,pos.y+y/App.GridSize*App.Unit)):p=new Point(pos.x+x*App.Unit,pos.y+y*App.Unit),this.Ctx.moveTo(p.x,p.y)},BlockSprites.prototype.DrawFloatLineTo=function(x,y){var pos=new Point(this._Position.x+this._XOffset,this._Position.y+this._YOffset),p;this._Scaled?p=App.Metrics.PointOnGrid(new Point(pos.x+x/App.GridSize*App.Unit,pos.y+y/App.GridSize*App.Unit)):p=new Point(pos.x+x*App.Unit,pos.y+y*App.Unit),this.Ctx.lineTo(p.x,p.y)},BlockSprites}();exports.BlockSprites=BlockSprites}),define("Core/Visual/RGBA",["require","exports"],function(require,exports){var RGBA=function(){function RGBA(r,g,b,a){this.R=r,this.G=g,this.B=b,this.A=a}return RGBA.prototype.toString=function(){return"rgba("+this.R+","+this.G+","+this.B+","+this.A+")"},RGBA.prototype.clone=function(){return new RGBA(this.R,this.G,this.B,this.A)},RGBA}();exports.RGBA=RGBA}),define("Core/Visual/ColorManager",["require","exports","./RGBA"],function(require,exports,RGBA_1){var ColorManager=function(){function ColorManager(){this.Master=new RGBA_1.RGBA(0,0,0,0),this.HighPass=new RGBA_1.RGBA(0,-100,0,0),this.LowPass=new RGBA_1.RGBA(-100,0,0,0),this.Passes=!1}return ColorManager.prototype.FillColor=function(ctx,col){this.SetRGBA(ctx,col.R,col.G,col.B,col.A,"fill")},ColorManager.prototype.StrokeColor=function(ctx,col){this.SetRGBA(ctx,col.R,col.G,col.B,col.A,"stroke")},ColorManager.prototype.FillRGBA=function(ctx,r,g,b,a){this.SetRGBA(ctx,r,g,b,a,"fill")},ColorManager.prototype.StrokeRGBA=function(ctx,r,g,b,a){this.SetRGBA(ctx,r,g,b,a,"stroke")},ColorManager.prototype.ColorString=function(col){return this.BuildColour(col.R,col.G,col.B,col.A)},ColorManager.prototype.DarkerColor=function(col,darkness){var r=this.ValueInRange(col.R-darkness,0,255),g=this.ValueInRange(col.G-darkness,0,255),b=this.ValueInRange(col.B-darkness,0,255);return new RGBA_1.RGBA(r,g,b,col.A)},ColorManager.prototype.LighterColor=function(col,lightness){var r=this.ValueInRange(col.R+lightness,0,255),g=this.ValueInRange(col.G+lightness,0,255),b=this.ValueInRange(col.B+lightness,0,255);return new RGBA_1.RGBA(r,g,b,col.A)},ColorManager.prototype.SetRGBA=function(ctx,r,g,b,a,mode){var red=Math.round(r+this.Master.R),green=Math.round(g+this.Master.G),blue=Math.round(b+this.Master.B),alpha=a+this.Master.A;if(this.Passes){var av=(red+green+blue)/3,hp=av/255,lp=1-av/255;red+=Math.round(this.HighPass.R*hp+this.LowPass.R*lp),green+=Math.round(this.HighPass.G*hp+this.LowPass.G*lp),blue+=Math.round(this.HighPass.B*hp+this.LowPass.B*lp)}mode==="stroke"?ctx.strokeStyle=this.BuildColour(red,green,blue,alpha):ctx.fillStyle=this.BuildColour(red,green,blue,alpha)},ColorManager.prototype.BuildColour=function(red,green,blue,alpha){return red=this.ValueInRange(red,0,255),green=this.ValueInRange(green,0,255),blue=this.ValueInRange(blue,0,255),alpha=this.ValueInRange(alpha,0,1),"rgba("+red+","+green+","+blue+","+alpha+")"},ColorManager.prototype.ValueInRange=function(value,floor,ceiling){return value<floor&&(value=floor),value>ceiling&&(value=ceiling),value},ColorManager}();exports.ColorManager=ColorManager}),define("Core/Resources/CommandHandlerFactory",["require","exports"],function(require,exports){var CommandHandlerFactory=function(){function CommandHandlerFactory(command,type){this.Command=command,this._Type=type}return CommandHandlerFactory.prototype.GetInstance=function(){return Object.create(this._Type)},CommandHandlerFactory.prototype.GetType=function(){return this._Type},CommandHandlerFactory}();exports.CommandHandlerFactory=CommandHandlerFactory}),define("Core/Commands/CommandManager",["require","exports","../Resources/CommandHandlerFactory"],function(require,exports,CommandHandlerFactory_1){var CommandManager=function(){function CommandManager(resourceManager){var _this=this;this._CommandHandlerFactories=[],this._ResourceManager=resourceManager,this._ResourceManager.ResourceAdded.on(function(resource){_this._OnResourceAdded(resource)},this)}return CommandManager.prototype._OnResourceAdded=function(resource){CommandHandlerFactory_1.CommandHandlerFactory.prototype.isPrototypeOf(resource)&&this._CommandHandlerFactories.push(resource)},CommandManager.prototype.ExecuteCommand=function(command,parameters){var commandHandlerFactories=this._GetCommandHandlerFactories(command);if(!commandHandlerFactories.length)return;var commandHandler=commandHandlerFactories[0].GetInstance();return commandHandler.Execute(parameters)},CommandManager.prototype._GetCommandHandlerFactories=function(command){return this._CommandHandlerFactories.filter(function(item){return item.Command==command},this)},CommandManager}();exports.CommandManager=CommandManager}),define("StringValue",["require","exports"],function(require,exports){var StringValue=function(){function StringValue(value){this.value="",value&&(this.value=value.toLowerCase())}return StringValue.prototype.toString=function(){return this.value},StringValue}();exports.StringValue=StringValue});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Commands",["require","exports","./StringValue"],function(require,exports,StringValue_1){var Command=function(_super){__extends(Command,_super);function Command(){_super.apply(this,arguments)}return Command}(StringValue_1.StringValue),Commands=function(){function Commands(){}return Commands.CHANGE_THEME=new Command("changeTheme"),Commands.CREATE_BLOCK=new Command("createBlock"),Commands.DELETE_BLOCK=new Command("deleteBlock"),Commands.LOAD=new Command("load"),Commands.MOVE_BLOCK=new Command("moveBlock"),Commands.REDO=new Command("redo"),Commands.SAVE=new Command("save"),Commands.SAVE_AS=new Command("saveAs"),Commands.UNDO=new Command("undo"),Commands}();exports.Commands=Commands}),define("Core/Inputs/KeyboardInputManager",["require","exports"],function(require,exports){var KeyboardInputManager=function(){function KeyboardInputManager(){var _this=this;this.IsEnabled=!0,this.KeyDownChange=new nullstone.Event,this.KeyUpChange=new nullstone.Event,this.ClearKeysDown(),document.addEventListener("keydown",function(e){if(!_this.IsEnabled)return;_this.KeyboardDown(e)}),document.addEventListener("keyup",function(e){if(!_this.IsEnabled)return;_this.KeyboardUp(e)})}return KeyboardInputManager.prototype.ClearKeysDown=function(){this.KeysDown={}},KeyboardInputManager.prototype.KeyboardDown=function(e){var k=e.keyCode;if(typeof k=="undefined")return;k===KeyCodes.KeyDown.Backspace&&e.preventDefault(),this.KeysDown[k]=!0},KeyboardInputManager.prototype.KeyboardUp=function(e){var k=e.keyCode;if(typeof k=="undefined")return;delete this.KeysDown[k]},KeyboardInputManager.prototype.IsKeyCodeDown=function(keycode){return!!this.KeysDown[keycode]},KeyboardInputManager.prototype.IsModifierDown=function(){return this.KeysDown[KeyCodes.KeyDown.Ctrl]||this.KeysDown[KeyCodes.KeyDown.CommandFF]||this.KeysDown[KeyCodes.KeyDown.LeftWindowKey]||this.KeysDown[KeyCodes.KeyDown.RightWindowKey]},KeyboardInputManager}();exports.KeyboardInputManager=KeyboardInputManager});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Core/Inputs/CommandsInputManager",["require","exports","../../Commands","./KeyboardInputManager"],function(require,exports,Commands_1,KeyboardInputManager_1){var CommandsInputManager=function(_super){__extends(CommandsInputManager,_super);function CommandsInputManager(commandManager){_super.call(this),this._CommandManager=commandManager}return CommandsInputManager.prototype.KeyboardDown=function(e){_super.prototype.KeyboardDown.call(this,e);if(!this.IsEnabled)return;this.CreateCommand(e)},CommandsInputManager.prototype.KeyboardUp=function(e){_super.prototype.KeyboardUp.call(this,e);if(!this.IsEnabled)return;this.CreateCommand(e)},CommandsInputManager.prototype.CreateCommand=function(e){if(!App.TypingManager.IsEnabled){if((this.IsKeyCodeDown(KeyCodes.KeyDown.Ctrl)||this.IsKeyCodeDown(KeyCodes.KeyDown.LeftWindowKey)||this.IsKeyCodeDown(KeyCodes.KeyDown.CommandFF))&&this.IsKeyCodeDown(KeyCodes.KeyDown.s)){e.preventDefault(),App.MainScene.SharePanel.OpenPanel();return}if((this.IsKeyCodeDown(KeyCodes.KeyDown.Ctrl)||this.IsKeyCodeDown(KeyCodes.KeyDown.LeftWindowKey)||this.IsKeyCodeDown(KeyCodes.KeyDown.CommandFF))&&this.IsKeyCodeDown(KeyCodes.KeyDown.Shift)&&this.IsKeyCodeDown(KeyCodes.KeyDown.z)){e.preventDefault(),this._CommandManager.ExecuteCommand(Commands_1.Commands.REDO);return}if((this.IsKeyCodeDown(KeyCodes.KeyDown.Ctrl)||this.IsKeyCodeDown(KeyCodes.KeyDown.LeftWindowKey)||this.IsKeyCodeDown(KeyCodes.KeyDown.CommandFF))&&this.IsKeyCodeDown(KeyCodes.KeyDown.z)){e.preventDefault(),this._CommandManager.ExecuteCommand(Commands_1.Commands.UNDO);return}}},CommandsInputManager}(KeyboardInputManager_1.KeyboardInputManager);exports.CommandsInputManager=CommandsInputManager}),define("CompositionLoadedEventArgs",["require","exports"],function(require,exports){var CompositionLoadedEventArgs=function(){function CompositionLoadedEventArgs(saveFile){Object.defineProperty(this,"SaveFile",{value:saveFile,writable:!1})}return CompositionLoadedEventArgs}();exports.CompositionLoadedEventArgs=CompositionLoadedEventArgs}),define("Core/Operations/AddItemToArrayOperation",["require","exports"],function(require,exports){var AddItemToArrayOperation=function(){function AddItemToArrayOperation(item,array,index){this._Item=item,this._Array=array,this._Index=index||-1}return AddItemToArrayOperation.prototype.Do=function(){var that=this;return new Promise(function(resolve,reject){that._Index==-1||that._Index>=that._Array.length?that._Array.push(that._Item):that._Array.insert(that._Item,that._Index),resolve(that._Array)})},AddItemToArrayOperation.prototype.Undo=function(){var that=this;return new Promise(function(resolve){that._Array.remove(that._Item),resolve(that._Array)})},AddItemToArrayOperation.prototype.Dispose=function(){this._Item=null,this._Array=null},AddItemToArrayOperation}();exports.AddItemToArrayOperation=AddItemToArrayOperation});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("CommandCategories",["require","exports","./StringValue"],function(require,exports,StringValue_1){var Category=function(_super){__extends(Category,_super);function Category(){_super.apply(this,arguments)}return Category}(StringValue_1.StringValue),CommandCategories=function(){function CommandCategories(){}return CommandCategories.COMPOSITIONS=new Category("compositions"),CommandCategories.SETTINGS=new Category("settings"),CommandCategories}();exports.CommandCategories=CommandCategories}),define("CommandHandlers/CreateBlockCommandHandler",["require","exports","../Core/Operations/AddItemToArrayOperation","../Commands","../CommandCategories"],function(require,exports,AddItemToArrayOperation_1,Commands_1,CommandCategories_1){var CreateBlockCommandHandler=function(){function CreateBlockCommandHandler(){}return CreateBlockCommandHandler.prototype.Execute=function(block){App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.CREATE_BLOCK.toString(),block.BlockName);var op=new AddItemToArrayOperation_1.AddItemToArrayOperation(block,App.Blocks);return App.OperationManager.Do(op)},CreateBlockCommandHandler}();exports.CreateBlockCommandHandler=CreateBlockCommandHandler}),define("Core/Operations/CompoundOperation",["require","exports"],function(require,exports){var CompoundOperation=function(){function CompoundOperation(){this.Operations=[]}return CompoundOperation.prototype.AddOperation=function(operation){this.Operations.push(operation)},CompoundOperation.prototype.RemoveOperation=function(operation){this.Operations.remove(operation)},CompoundOperation.prototype.Do=function(){var sequence=Promise.resolve();return this.Operations.forEach(function(op){sequence=sequence.then(function(){return op.Do()})}),sequence},CompoundOperation.prototype.Undo=function(){var ops=this.Operations.clone().reverse(),sequence=Promise.resolve();return ops.forEach(function(op){sequence=sequence.then(function(){return op.Undo()})}),sequence},CompoundOperation.prototype.Dispose=function(){this.Operations.forEach(function(op){op.Dispose()})},CompoundOperation}();exports.CompoundOperation=CompoundOperation}),define("Core/Operations/ChangePropertyOperation",["require","exports"],function(require,exports){var ChangePropertyOperation=function(){function ChangePropertyOperation(obj,propertyName,oldValue,newValue){this._Object=obj,this._PropertyName=propertyName,this._NewValue=newValue,oldValue?this._OldValue=oldValue:this._OldValue=this._Object[this._PropertyName]}return ChangePropertyOperation.prototype.Do=function(){var that=this;return new Promise(function(resolve){that._Object[that._PropertyName]=that._NewValue,resolve(that._Object)})},ChangePropertyOperation.prototype.Undo=function(){var that=this;return new Promise(function(resolve){that._Object[that._PropertyName]=that._OldValue,resolve(that._Object)})},ChangePropertyOperation.prototype.Dispose=function(){this._Object=null},ChangePropertyOperation}();exports.ChangePropertyOperation=ChangePropertyOperation});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Operations/MoveBlockOperation",["require","exports","../Core/Operations/ChangePropertyOperation","../Core/Operations/CompoundOperation"],function(require,exports,ChangePropertyOperation_1,CompoundOperation_1){var MoveBlockOperation=function(_super){__extends(MoveBlockOperation,_super);function MoveBlockOperation(block){_super.call(this),this._Block=block,this.Operations.push(new ChangePropertyOperation_1.ChangePropertyOperation(block,"Position",this._Block.LastPosition.Clone(),this._Block.Position.Clone()))}return MoveBlockOperation.prototype.Do=function(){return _super.prototype.Do.call(this)},MoveBlockOperation.prototype.Undo=function(){return _super.prototype.Undo.call(this)},MoveBlockOperation.prototype.Dispose=function(){this._Block=null},MoveBlockOperation}(CompoundOperation_1.CompoundOperation);exports.MoveBlockOperation=MoveBlockOperation}),define("Operations/RemoveDisplayObjectOperation",["require","exports"],function(require,exports){var RemoveDisplayObjectOperation=function(){function RemoveDisplayObjectOperation(displayObject,displayList){this._DisplayObject=displayObject,this._DisplayList=displayList}return RemoveDisplayObjectOperation.prototype.Do=function(){this._Index=this._DisplayList.IndexOf(this._DisplayObject);var that=this;return new Promise(function(resolve){that._DisplayList.Remove(that._DisplayObject),resolve(that._DisplayList)})},RemoveDisplayObjectOperation.prototype.Undo=function(){var that=this;return new Promise(function(resolve){that._DisplayList.Insert(that._Index,that._DisplayObject),resolve(that._DisplayList)})},RemoveDisplayObjectOperation.prototype.Dispose=function(){this._DisplayList=null,this._DisplayObject=null},RemoveDisplayObjectOperation}();exports.RemoveDisplayObjectOperation=RemoveDisplayObjectOperation}),define("Core/Operations/RemoveItemFromArrayOperation",["require","exports"],function(require,exports){var RemoveItemFromArrayOperation=function(){function RemoveItemFromArrayOperation(item,array){this._Item=item,this._Array=array}return RemoveItemFromArrayOperation.prototype.Do=function(){this._Index=this._Array.indexOf(this._Item);var that=this;return new Promise(function(resolve){that._Array.remove(that._Item),resolve(that._Array)})},RemoveItemFromArrayOperation.prototype.Undo=function(){var that=this;return new Promise(function(resolve){that._Array.insert(that._Item,that._Index),resolve(that._Array)})},RemoveItemFromArrayOperation.prototype.Dispose=function(){this._Item=null,this._Array=null},RemoveItemFromArrayOperation}();exports.RemoveItemFromArrayOperation=RemoveItemFromArrayOperation});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Operations/DeleteBlockOperation",["require","exports","../Core/Operations/CompoundOperation","./MoveBlockOperation","./RemoveDisplayObjectOperation","../Core/Operations/RemoveItemFromArrayOperation"],function(require,exports,CompoundOperation_1,MoveBlockOperation_1,RemoveDisplayObjectOperation_1,RemoveItemFromArrayOperation_1){var DeleteBlockOperation=function(_super){__extends(DeleteBlockOperation,_super);function DeleteBlockOperation(block){_super.call(this),this._Block=block,this.Operations.push(new MoveBlockOperation_1.MoveBlockOperation(block)),this.Operations.push(new RemoveDisplayObjectOperation_1.RemoveDisplayObjectOperation(block,App.MainScene.BlocksContainer.DisplayList)),this.Operations.push(new RemoveItemFromArrayOperation_1.RemoveItemFromArrayOperation(block,App.Blocks)),this._Block.Stop(),console.log(App.Blocks),setTimeout(function(){console.log(App.Blocks)},1e3)}return DeleteBlockOperation.prototype.Do=function(){return _super.prototype.Do.call(this)},DeleteBlockOperation.prototype.Undo=function(){return _super.prototype.Undo.call(this)},DeleteBlockOperation.prototype.Dispose=function(){this._Block.Dispose(),this._Block=null},DeleteBlockOperation}(CompoundOperation_1.CompoundOperation);exports.DeleteBlockOperation=DeleteBlockOperation}),define("CommandHandlers/DeleteBlockCommandHandler",["require","exports","../Operations/DeleteBlockOperation","../Commands","../CommandCategories"],function(require,exports,DeleteBlockOperation_1,Commands_1,CommandCategories_1){var DeleteBlockCommandHandler=function(){function DeleteBlockCommandHandler(){}return DeleteBlockCommandHandler.prototype.Execute=function(block){App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.DELETE_BLOCK.toString(),block.BlockName);var op=new DeleteBlockOperation_1.DeleteBlockOperation(block);return App.OperationManager.Do(op)},DeleteBlockCommandHandler}();exports.DeleteBlockCommandHandler=DeleteBlockCommandHandler}),define("Core/Inputs/DragFileInputManager",["require","exports"],function(require,exports){var DragFileInputManager=function(){function DragFileInputManager(){this.DragEnter=new nullstone.Event,this.DragMove=new nullstone.Event,this.DragLeave=new nullstone.Event,this.Dropped=new nullstone.Event;var dropZone=document.getElementsByTagName("canvas")[0];dropZone.addEventListener("dragenter",this.OnDragEnter.bind(this)),dropZone.addEventListener("dragover",this.OnDragMove.bind(this)),dropZone.addEventListener("dragleave",this.OnDragLeave.bind(this)),dropZone.addEventListener("drop",this.OnFileDropped.bind(this))}return DragFileInputManager.prototype.OnFileDropped=function(e){this.Dropped.raise(this,e)},DragFileInputManager.prototype.OnDragEnter=function(e){this.DragEnter.raise(this,e)},DragFileInputManager.prototype.OnDragMove=function(e){this.DragMove.raise(this,e)},DragFileInputManager.prototype.OnDragLeave=function(e){this.DragLeave.raise(this,e)},DragFileInputManager}();exports.DragFileInputManager=DragFileInputManager}),define("Core/Inputs/FocusManagerEventArgs",["require","exports"],function(require,exports){var FocusManagerEventArgs=function(){function FocusManagerEventArgs(hasFocus){Object.defineProperty(this,"HasFocus",{value:hasFocus,writable:!1})}return FocusManagerEventArgs}();exports.FocusManagerEventArgs=FocusManagerEventArgs}),define("Core/Inputs/FocusManager",["require","exports","./FocusManagerEventArgs"],function(require,exports,FocusManagerEventArgs_1){var FocusManager=function(){function FocusManager(){var _this=this;this.HasFocus=!0,this.FocusChanged=new nullstone.Event,window.onfocus=function(){_this.HasFocus=!0,_this.FocusChanged.raise(_this,new FocusManagerEventArgs_1.FocusManagerEventArgs(_this.HasFocus))},window.onblur=function(){_this.HasFocus=!1,_this.FocusChanged.raise(_this,new FocusManagerEventArgs_1.FocusManagerEventArgs(_this.HasFocus))},document.addEventListener("visibilitychange",function(){_this.HasFocus=!document.hidden,_this.FocusChanged.raise(_this,new FocusManagerEventArgs_1.FocusManagerEventArgs(_this.HasFocus))},!1)}return FocusManager}();exports.FocusManager=FocusManager}),define("Operations/LoadOperation",["require","exports"],function(require,exports){var LoadOperation=function(){function LoadOperation(id){this._Id=id,this._LZMA=new LZMA("/lib/lzma/src/lzma_worker.js")}return LoadOperation.prototype.Decompress=function(data){var _this=this;return new Promise(function(resolve){data=JSON.parse("["+data+"]"),_this._LZMA.decompress(data,function(result){resolve(result.toString())},function(percent){})})},LoadOperation.prototype.Do=function(){var _this=this,that=this;return new Promise(function(resolve,reject){var url="http://files.blokdust.com/compositions/"+_this._Id+"?t="+Utils.Dates.GetTimeStamp();$.ajax({url:url,type:"GET",crossDomain:!0,dataType:"text"}).done(function(data){that.Decompress(data).then(function(decompressed){resolve(decompressed)})}).fail(function(jqXHR,textStatus){reject(textStatus)})})},LoadOperation.prototype.Dispose=function(){},LoadOperation}();exports.LoadOperation=LoadOperation}),define("CommandHandlers/LoadCommandHandler",["require","exports","../Operations/LoadOperation","../Commands","../CommandCategories"],function(require,exports,LoadOperation_1,Commands_1,CommandCategories_1){var LoadCommandHandler=function(){function LoadCommandHandler(){}return LoadCommandHandler.prototype.Execute=function(id){App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.LOAD.toString(),id);var op=new LoadOperation_1.LoadOperation(id);return App.OperationManager.Do(op)},LoadCommandHandler}();exports.LoadCommandHandler=LoadCommandHandler}),define("Device",["require","exports"],function(require,exports){(function(Device){Device[Device.mobile=0]="mobile",Device[Device.tablet=1]="tablet",Device[Device.desktop=2]="desktop"})(exports.Device||(exports.Device={}));var Device=exports.Device}),define("Metrics",["require","exports","./Device"],function(require,exports,Device_1){var Point=etch.primitives.Point,Metrics=function(){function Metrics(){App.ZoomLevel=1,App.DragOffset=new Point(0,0),App.ScaledDragOffset=new Point(0,0),this.C=new Point(0,0),this.OptionsX=.3,this.OptionsPoint=new Point(.3,.6),this.ItemsPerPage=6,this.Device=Device_1.Device.desktop,this._DeviceZoom=1}return Metrics.prototype.Compute=function(){this._ScreenDivision=850;var gridSize=15,canvas=App.Canvas,width=window.innerWidth,height=window.innerHeight;this.DeviceCheck(),App.Unit=width/this._ScreenDivision*this.PixelRatio,App.GridSize=gridSize*App.Unit,this.UpdateGridScale(),canvas.Width=width*this.PixelRatio,canvas.Height=height*this.PixelRatio,canvas.Style.width=width+"px",canvas.Style.height=height+"px";for(var i=0;i<App.SubCanvas.length;i++){var c=App.SubCanvas[i];c.width=width*this.PixelRatio,c.height=height*this.PixelRatio,c.style.width=width+"px",c.style.height=height+"px"}App.Width=width*this.PixelRatio,App.Height=height*this.PixelRatio,App.MainScene.Width=App.Width,App.MainScene.Height=App.Height,this.C.x=App.Width*.5,this.C.y=App.Height*.5;var headerType=Math.round(App.Unit*28),sliderType=Math.round(App.Unit*33),urlType=Math.round(App.Unit*(24/this.PixelRatio)),urlType2=Math.round(App.Unit*24),largeType=Math.round(App.Unit*11),midType=Math.round(App.Unit*10),bodyType=Math.round(App.Unit*8),italicType=Math.round(App.Unit*7.5),italicType2=Math.round(App.Unit*8),dataType=Math.round(App.Unit*5);this.TxtHeader="200 "+headerType+"px Dosis",this.TxtSlider="200 "+sliderType+"px Dosis",this.TxtUrl="200 "+urlType+"px Dosis",this.TxtUrl2="200 "+urlType2+"px Dosis",this.TxtMid="400 "+midType+"px Dosis",this.TxtLarge="400 "+largeType+"px Dosis",this.TxtBody="200 "+bodyType+"px Dosis",this.TxtItalic="300 italic "+italicType+"px Merriweather Sans",this.TxtItalic2="300 italic "+italicType2+"px Merriweather Sans",this.TxtData="400 "+dataType+"px PT Sans"},Metrics.prototype.UpdateGridScale=function(){App.ScaledUnit=App.Unit*App.ZoomLevel*this._DeviceZoom,App.ScaledGridSize=App.GridSize*App.ZoomLevel*this._DeviceZoom,App.ScaledDragOffset.x=App.DragOffset.x*App.ZoomLevel,App.ScaledDragOffset.y=App.DragOffset.y*App.ZoomLevel},Object.defineProperty(Metrics.prototype,"PixelRatio",{get:function(){return Utils.Device.GetPixelRatio(App.Canvas.Ctx)},enumerable:!0,configurable:!0}),Metrics.prototype.DeviceCheck=function(){var width=window.innerWidth,height=window.innerHeight;height>width*1.3?(this._ScreenDivision=475,this.OptionsPoint=new Point(.5,.4),this.ItemsPerPage=3,this._DeviceZoom=1,this.Device=Device_1.Device.mobile,console.log("MOBILE")):height>width*1.1?(this._ScreenDivision=600,this.OptionsPoint=new Point(.2,.5),this.ItemsPerPage=4,this._DeviceZoom=1,this.Device=Device_1.Device.tablet,console.log("TABLET")):(this.OptionsPoint=new Point(.3,.6),this.ItemsPerPage=6,this._DeviceZoom=1,this.Device=Device_1.Device.desktop,console.log("DESKTOP"))},Metrics.prototype.CursorToGrid=function(point){var x=Math.round((point.x-App.ScaledDragOffset.x*App.Unit-this.C.x)/App.ScaledGridSize),y=Math.round((point.y-App.ScaledDragOffset.y*App.Unit-this.C.y)/App.ScaledGridSize);return new Point(x,y)},Metrics.prototype.PointOnGrid=function(point){var x=this.C.x+App.ScaledDragOffset.x*App.Unit+point.x*App.ScaledGridSize,y=this.C.y+App.ScaledDragOffset.y*App.Unit+point.y*App.ScaledGridSize;return new Point(x,y)},Metrics.prototype.UnscaledPointOnGrid=function(point){var x=this.C.x+App.DragOffset.x*App.Unit+point.x*App.GridSize,y=this.C.y+App.DragOffset.y*App.Unit+point.y*App.GridSize;return new Point(x,y)},Metrics.prototype.FloatOnGrid=function(point){var x=this.C.x+App.ScaledDragOffset.x*App.Unit+point.x*App.ZoomLevel,y=this.C.y+App.ScaledDragOffset.y*App.Unit+point.y*App.ZoomLevel;return new Point(x,y)},Metrics.prototype.GetRelativePoint=function(point,offset){return new Point(point.x+offset.x,point.y+offset.y)},Metrics.prototype.ConvertGridUnitsToAbsolute=function(point){return new Point(App.GridSize*point.x,App.GridSize*point.y)},Metrics.prototype.ConvertToPixelRatioPoint=function(point){point.x*=this.PixelRatio,point.y*=this.PixelRatio},Metrics.prototype.VectorFromAngle=function(angle){return new Point(Math.cos(angle),Math.sin(angle))},Metrics}();exports.Metrics=Metrics}),define("CommandHandlers/MoveBlockCommandHandler",["require","exports","../Operations/MoveBlockOperation","../Commands","../CommandCategories"],function(require,exports,MoveBlockOperation_1,Commands_1,CommandCategories_1){var MoveBlockCommandHandler=function(){function MoveBlockCommandHandler(){}return MoveBlockCommandHandler.prototype.Execute=function(block){App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.MOVE_BLOCK.toString(),block.BlockName);var op=new MoveBlockOperation_1.MoveBlockOperation(block);return App.OperationManager.Do(op)},MoveBlockCommandHandler}();exports.MoveBlockCommandHandler=MoveBlockCommandHandler}),define("Core/Operations/OperationManager",["require","exports"],function(require,exports){var Exception=etch.exceptions.Exception,ObservableCollection=etch.collections.ObservableCollection,RoutedEvent=etch.events.RoutedEvent,RoutedEventArgs=etch.events.RoutedEventArgs,OperationManager=function(){function OperationManager(){this._DebugEnabled=!0,this._Operations=new ObservableCollection,this._Head=-1,this._MaxOperations=100,this.OperationBegin=new RoutedEvent,this.OperationComplete=new RoutedEvent}return Object.defineProperty(OperationManager.prototype,"Head",{get:function(){return this._Head},set:function(value){this._Head=value},enumerable:!0,configurable:!0}),Object.defineProperty(OperationManager.prototype,"MaxOperations",{get:function(){return this._MaxOperations},set:function(value){if(!(value>0&&value<Number.MAX_VALUE))throw new Exception("Invalid range");this._MaxOperations=value},enumerable:!0,configurable:!0}),OperationManager.prototype.Do=function(operation){var _this=this;if(this._CurrentOperation)return Promise.reject(Error(OperationManager.OPERATION_IN_PROGRESS));if(this._Operations.Count===this.MaxOperations){var firstOp=this._Operations.GetValueAt(0);firstOp.Dispose();var trimmed=this._Operations.ToArray().splice(1,this._Operations.Count-1);this._Operations.Clear(),this._Operations.AddRange(trimmed),this.Head--}if(!operation.Undo)this._Operations.Clear();else if(this.Head!=this._Operations.Count-1){var trimmed=this._Operations.ToArray().splice(0,this.Head+1);this._Operations.Clear(),this._Operations.AddRange(trimmed)}this._Operations.Add(operation),this.OperationBegin.raise(operation,new RoutedEventArgs);var that=this;return this._CurrentOperation=operation.Do().then(function(result){return that._CurrentOperation=null,that.Head=_this._Operations.Count-1,that.OperationComplete.raise(operation,new RoutedEventArgs),that._Debug(),result}).catch(function(error){that._CurrentOperation=null})},OperationManager.prototype.Undo=function(){if(!this.CanUndo())return Promise.reject(Error(OperationManager.CANNOT_UNDO));if(this._CurrentOperation)return Promise.reject(Error(OperationManager.OPERATION_IN_PROGRESS));var operation=this._Operations.GetValueAt(this.Head);this.OperationBegin.raise(operation,new RoutedEventArgs);var that=this;return this._CurrentOperation=operation.Undo().then(function(result){return that._CurrentOperation=null,that.Head--,that.OperationComplete.raise(operation,new RoutedEventArgs),that._Debug(),result}).catch(function(error){that._CurrentOperation=null})},OperationManager.prototype.Redo=function(){if(!this.CanRedo())return Promise.reject(Error(OperationManager.CANNOT_REDO));if(this._CurrentOperation)return Promise.reject(Error(OperationManager.OPERATION_IN_PROGRESS));var operation=this._Operations.GetValueAt(this.Head+1),that=this;return this._CurrentOperation=operation.Do().then(function(result){return that._CurrentOperation=null,that.Head++,that.OperationComplete.raise(operation,new RoutedEventArgs),that._Debug(),result}).catch(function(error){that._CurrentOperation=null})},OperationManager.prototype._Debug=function(){if(!this._DebugEnabled)return;var str="";for(var i=0;i<this._Operations.Count;i++)this.Head===i?str+="[]":str+="#"},OperationManager.prototype.CanUndo=function(){return this.Head>0},OperationManager.prototype.CanRedo=function(){return this.Head<this._Operations.Count-1},OperationManager.CANNOT_UNDO="Cannot undo",OperationManager.CANNOT_REDO="Cannot redo",OperationManager.OPERATION_IN_PROGRESS="Operation in progress",OperationManager}();exports.OperationManager=OperationManager});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/ParticleEmitter",["require","exports","./PowerSource"],function(require,exports,PowerSource_1){var Vector=Utils.Maths.Vector,Point=etch.primitives.Point,ParticleEmitter=function(_super){__extends(ParticleEmitter,_super);function ParticleEmitter(){_super.apply(this,arguments)}return ParticleEmitter.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Power.Blocks.ParticleEmitter.name,this.Defaults={angle:-90,speed:5,rate:40,range:600,selfPoweredMode:!1},this.PopulateParams(),this._rateCounter=0,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-2,0),new Point(-1,0),new Point(0,-1),new Point(1,0),new Point(2,0),new Point(0,2))},ParticleEmitter.prototype.EmitParticle=function(){var position=App.Metrics.ConvertGridUnitsToAbsolute(this.Position),vector=Vector.FromAngle(Math.degreesToRadians(this.Params.angle));vector.Mult(this.Params.speed);var size=2+Math.random(),life=Math.round(this.Params.range/this.Params.speed),p=App.ParticlesPool.GetObject();p.Position=position,p.Vector=vector,p.Life=life,p.Size=size,App.Particles.push(p)},ParticleEmitter.prototype.Update=function(){_super.prototype.Update.call(this),this.Params.selfPoweredMode||this.IsPowered()?this._rateCounter!==undefined&&(this._rateCounter+=1,this._rateCounter>=this.Params.rate&&(this.EmitParticle(),this._rateCounter=0),this.Params.angle>360&&(this.Params.angle=1)):this._rateCounter=this.Params.rate},ParticleEmitter.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},ParticleEmitter.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Particle Emitter",parameters:[{type:"slider",name:"Angle",setting:"angle",props:{value:this.Params.angle+90,min:-180,max:180,quantised:!0,centered:!0}},{type:"slider",name:"Fire Rate",setting:"rate",props:{value:510-this.Params.rate,min:1,max:500,quantised:!0,centered:!1}},{type:"slider",name:"P. Speed",setting:"speed",props:{value:this.Params.speed,min:1,max:12,quantised:!1,centered:!1}},{type:"slider",name:"Range",setting:"range",props:{value:this.Params.range,min:50,max:2e3,quantised:!0,centered:!1}}]}},ParticleEmitter.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="angle"?val=value-90:param=="rate"&&(val=510-value),this.Params[""+param]=val},ParticleEmitter}(PowerSource_1.PowerSource);exports.ParticleEmitter=ParticleEmitter});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/Void",["require","exports","../Block"],function(require,exports,Block_1){var Point=etch.primitives.Point,Void=function(_super){__extends(Void,_super);function Void(){_super.apply(this,arguments)}return Void.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.BlockName=App.L10n.Blocks.Power.Blocks.Void.name,this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,0),new Point(0,1)),this.StarPos=this.RandomStarPos()},Void.prototype.RandomStarPos=function(){var x=Math.round(Math.random()*10),y=Math.round(Math.random()*(10-x)),dice=Math.floor(Math.random()*2);return dice==0&&(x=-x),dice=Math.floor(Math.random()*2),dice==0&&(y=-y),new Point(x,y)},Void.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName,this.StarPos)},Void.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},Void}(Block_1.Block);exports.Void=Void}),define("Particle",["require","exports","./Blocks/Power/Logic/Logic","./Blocks/Power/ParticleEmitter","./Blocks/Source","./Blocks/Power/Void"],function(require,exports,Logic_1,ParticleEmitter_1,Source_1,Void_1){var Particle=function(){function Particle(position,vector,size,life){this.Disposed=!1,this.Position=position,this.Vector=vector,this.Size=size,this.Life=life}return Particle.prototype.Move=function(){this.Position.x+=this.Vector.X*App.Unit,this.Position.y+=this.Vector.Y*App.Unit},Particle.prototype.Reset=function(){return this.Position=null,this.Vector=null,this.Size=null,this.Life=null,!0},Particle.prototype.Dispose=function(){this.Life=-1,this.Disposed=!0},Particle.prototype.ReturnToPool=function(){},Particle.prototype.ParticleCollision=function(point,particle){for(var i=App.Blocks.length-1;i>=0;i--){var block=App.Blocks[i];if(block instanceof Void_1.Void&&block.HitTest(point)){this.Dispose();return}if(block instanceof Logic_1.Logic||block instanceof Source_1.Source&&!(block instanceof ParticleEmitter_1.ParticleEmitter))if(block.HitTest(point)){block.ParticleCollision(particle);return}}},Particle}();exports.Particle=Particle}),define("Core/Inputs/KeyDownEventArgs",["require","exports"],function(require,exports){var KeyDownEventArgs=function(){function KeyDownEventArgs(keyDown){Object.defineProperty(this,"KeyDown",{value:keyDown,writable:!1})}return KeyDownEventArgs}();exports.KeyDownEventArgs=KeyDownEventArgs}),define("Core/Inputs/KeyUpEventArgs",["require","exports"],function(require,exports){var KeyUpEventArgs=function(){function KeyUpEventArgs(keyUp){Object.defineProperty(this,"KeyUp",{value:keyUp,writable:!1})}return KeyUpEventArgs}();exports.KeyUpEventArgs=KeyUpEventArgs});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Core/Inputs/PianoKeyboardManager",["require","exports","./KeyboardInputManager","./KeyDownEventArgs","./KeyUpEventArgs"],function(require,exports,KeyboardInputManager_1,KeyDownEventArgs_1,KeyUpEventArgs_1){var PianoKeyboardManager=function(_super){__extends(PianoKeyboardManager,_super);function PianoKeyboardManager(){_super.call(this),this.KeyDownChange=new nullstone.Event,this.KeyUpChange=new nullstone.Event,this.PianoKeyboardMap={ArrowUp:"octave-up",ArrowDown:"octave-down",Digit0:"note_G#_b",Digit2:"note_F#_a",Digit3:"note_G#_a",Digit4:"note_A#_a",Digit6:"note_C#_b",Digit7:"note_D#_b",Digit9:"note_F#_b",KeyB:"note_G_c",KeyC:"note_E_c",KeyD:"note_D#_c",KeyE:"note_A_a",KeyG:"note_F#_c",KeyH:"note_G#_c",KeyI:"note_F_b",KeyJ:"note_A#_c",KeyL:"note_C#_d",KeyM:"note_B_c",KeyN:"note_A_c",KeyO:"note_G_b",KeyP:"note_A_b",KeyQ:"note_F_a",KeyR:"note_B_a",KeyS:"note_C#_c",KeyT:"note_C_b",KeyU:"note_E_b",KeyV:"note_F_c",KeyW:"note_G_a",KeyX:"note_D_c",KeyY:"note_D_b",KeyZ:"note_C_c",NumpadAdd:"octave-up",NumpadSubtract:"octave-down",Semicolon:"note_D#_d",Comma:"note_C_d",Minus:"note_A#_b",Period:"note_D_d",Slash:"note_E_d",BracketLeft:"note_B_b",BracketRight:"note_C_c",OSLeft:"blank",OSRight:"blank"},this.PianoKeyboardMapFallBack={38:this.PianoKeyboardMap.ArrowUp,40:this.PianoKeyboardMap.ArrowDown,48:this.PianoKeyboardMap.Digit0,50:this.PianoKeyboardMap.Digit2,51:this.PianoKeyboardMap.Digit3,52:this.PianoKeyboardMap.Digit4,54:this.PianoKeyboardMap.Digit6,55:this.PianoKeyboardMap.Digit7,57:this.PianoKeyboardMap.Digit9,66:this.PianoKeyboardMap.KeyB,67:this.PianoKeyboardMap.KeyC,68:this.PianoKeyboardMap.KeyD,69:this.PianoKeyboardMap.KeyE,71:this.PianoKeyboardMap.KeyG,72:this.PianoKeyboardMap.KeyH,73:this.PianoKeyboardMap.KeyI,74:this.PianoKeyboardMap.KeyJ,76:this.PianoKeyboardMap.KeyL,77:this.PianoKeyboardMap.KeyM,78:this.PianoKeyboardMap.KeyN,79:this.PianoKeyboardMap.KeyO,80:this.PianoKeyboardMap.KeyP,81:this.PianoKeyboardMap.KeyQ,82:this.PianoKeyboardMap.KeyR,83:this.PianoKeyboardMap.KeyS,84:this.PianoKeyboardMap.KeyT,85:this.PianoKeyboardMap.KeyU,86:this.PianoKeyboardMap.KeyV,87:this.PianoKeyboardMap.KeyW,88:this.PianoKeyboardMap.KeyX,89:this.PianoKeyboardMap.KeyY,90:this.PianoKeyboardMap.KeyZ,91:this.PianoKeyboardMap.OSLeft,93:this.PianoKeyboardMap.OSRight,107:this.PianoKeyboardMap.NumpadAdd,109:this.PianoKeyboardMap.NumpadSubtract,186:this.PianoKeyboardMap.Semicolon,188:this.PianoKeyboardMap.Comma,189:this.PianoKeyboardMap.Minus,190:this.PianoKeyboardMap.Period,191:this.PianoKeyboardMap.Slash,219:this.PianoKeyboardMap.BracketLeft,221:this.PianoKeyboardMap.BracketRight}}return PianoKeyboardManager.prototype.KeyboardDown=function(e){if(!this.IsEnabled)return;var k;e.code?k=this.PianoKeyboardMap[e.code]:k=this.PianoKeyboardMapFallBack[e.keyCode];if(typeof k!="undefined"&&k!==""){if(k in this.KeysDown)return;this.KeysDown[k]=!0,this.KeyDown=k,this.KeyDownChange.raise(this,new KeyDownEventArgs_1.KeyDownEventArgs(this.KeyDown))}},PianoKeyboardManager.prototype.KeyboardUp=function(e){if(!this.IsEnabled)return;var k;e.code?k=this.PianoKeyboardMap[e.code]:k=this.PianoKeyboardMapFallBack[e.keyCode],typeof k!="undefined"&&k!==""&&(k==="blank"?this.KeysDown={}:delete this.KeysDown[k],this.KeyUp=k,this.KeyUpChange.raise(this,new KeyUpEventArgs_1.KeyUpEventArgs(this.KeyUp)))},PianoKeyboardManager}(KeyboardInputManager_1.KeyboardInputManager);exports.PianoKeyboardManager=PianoKeyboardManager}),define("Core/Inputs/PointerInputManager",["require","exports"],function(require,exports){var PointerInputManager=function(){function PointerInputManager(){this.MouseDown=new nullstone.Event,this.MouseUp=new nullstone.Event,this.MouseMove=new nullstone.Event,this.MouseWheel=new nullstone.Event,this.TouchStart=new nullstone.Event,this.TouchEnd=new nullstone.Event,this.TouchMove=new nullstone.Event,this.OnMouseDown=this.OnMouseDown.bind(this),document.addEventListener("mousedown",this.OnMouseDown),this.OnMouseUp=this.OnMouseUp.bind(this),document.addEventListener("mouseup",this.OnMouseUp),this.OnMouseMove=this.OnMouseMove.bind(this),document.addEventListener("mousemove",this.OnMouseMove),this.OnMouseWheel=this.OnMouseWheel.bind(this),document.addEventListener("mousewheel",this.OnMouseWheel),document.addEventListener("DOMMouseScroll",this.OnMouseWheel),this.OnTouchStart=this.OnTouchStart.bind(this),document.addEventListener("touchstart",this.OnTouchStart),this.OnTouchEnd=this.OnTouchEnd.bind(this),document.addEventListener("touchend",this.OnTouchEnd),this.OnTouchMove=this.OnTouchMove.bind(this),document.addEventListener("touchmove",this.OnTouchMove)}return PointerInputManager.prototype.OnMouseDown=function(e){this.MouseDown.raise(this,e)},PointerInputManager.prototype.OnMouseUp=function(e){this.MouseUp.raise(this,e)},PointerInputManager.prototype.OnMouseMove=function(e){this.MouseMove.raise(this,e)},PointerInputManager.prototype.OnTouchStart=function(e){e.preventDefault(),this.TouchStart.raise(this,e)},PointerInputManager.prototype.OnTouchEnd=function(e){e.preventDefault(),this.TouchEnd.raise(this,e)},PointerInputManager.prototype.OnTouchMove=function(e){e.preventDefault(),this.TouchMove.raise(this,e)},PointerInputManager.prototype.OnMouseWheel=function(e){e.preventDefault(),e.stopPropagation(),this.MouseWheel.raise(this,e)},PointerInputManager}();exports.PointerInputManager=PointerInputManager});var Utils;(function(Utils){var Async=function(){function Async(){}return Async.WaitFor=function(test,successCallback,failureCallback,interval,maxTries,numTries){interval||(interval=200),maxTries||(maxTries=100),numTries||(numTries=0),numTries+=1,numTries>maxTries?failureCallback&&failureCallback():test()?successCallback():setTimeout(function(){Async.WaitFor(test,successCallback,failureCallback,interval,maxTries,numTries)},interval)},Async}();Utils.Async=Async})(Utils||(Utils={}));var Utils;(function(Utils){var Bools=function(){function Bools(){}return Bools.GetBool=function(val,defaultVal){return val===null||typeof val=="undefined"?defaultVal:val},Bools}();Utils.Bools=Bools})(Utils||(Utils={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},Utils;(function(Utils){var Collections;(function(Collections){var collections=Collections,_hasOwnProperty=Object.prototype.hasOwnProperty,has=function(obj,prop){return _hasOwnProperty.call(obj,prop)};function defaultCompare(a,b){return a<b?-1:a===b?0:1}Collections.defaultCompare=defaultCompare;function defaultEquals(a,b){return a===b}Collections.defaultEquals=defaultEquals;function defaultToString(item){return item===null?"COLLECTION_NULL":collections.isUndefined(item)?"COLLECTION_UNDEFINED":collections.isString(item)?"$s"+item:"$o"+item.toString()}Collections.defaultToString=defaultToString;function makeString(item,join){join===void 0&&(join=",");if(item===null)return"COLLECTION_NULL";if(collections.isUndefined(item))return"COLLECTION_UNDEFINED";if(collections.isString(item))return item.toString();var toret="{",first=!0;for(var prop in item)has(item,prop)&&(first?first=!1:toret+=join,toret=toret+prop+":"+item[prop]);return toret+"}"}Collections.makeString=makeString;function isFunction(func){return typeof func=="function"}Collections.isFunction=isFunction;function isUndefined(obj){return typeof obj=="undefined"}Collections.isUndefined=isUndefined;function isString(obj){return Object.prototype.toString.call(obj)==="[object String]"}Collections.isString=isString;function reverseCompareFunction(compareFunction){return collections.isFunction(compareFunction)?function(d,v){return compareFunction(d,v)*-1}:function(a,b){return a<b?1:a===b?0:-1}}Collections.reverseCompareFunction=reverseCompareFunction;function compareToEquals(compareFunction){return function(a,b){return compareFunction(a,b)===0}}Collections.compareToEquals=compareToEquals;var arrays;(function(arrays){function indexOf(array,item,equalsFunction){var equals=equalsFunction||collections.defaultEquals,length=array.length;for(var i=0;i<length;i++)if(equals(array[i],item))return i;return-1}arrays.indexOf=indexOf;function lastIndexOf(array,item,equalsFunction){var equals=equalsFunction||collections.defaultEquals,length=array.length;for(var i=length-1;i>=0;i--)if(equals(array[i],item))return i;return-1}arrays.lastIndexOf=lastIndexOf;function contains(array,item,equalsFunction){return arrays.indexOf(array,item,equalsFunction)>=0}arrays.contains=contains;function remove(array,item,equalsFunction){var index=arrays.indexOf(array,item,equalsFunction);return index<0?!1:(array.splice(index,1),!0)}arrays.remove=remove;function frequency(array,item,equalsFunction){var equals=equalsFunction||collections.defaultEquals,length=array.length,freq=0;for(var i=0;i<length;i++)equals(array[i],item)&&freq++;return freq}arrays.frequency=frequency;function equals(array1,array2,equalsFunction){var equals=equalsFunction||collections.defaultEquals;if(array1.length!==array2.length)return!1;var length=array1.length;for(var i=0;i<length;i++)if(!equals(array1[i],array2[i]))return!1;return!0}arrays.equals=equals;function copy(array){return array.concat()}arrays.copy=copy;function swap(array,i,j){if(i<0||i>=array.length||j<0||j>=array.length)return!1;var temp=array[i];return array[i]=array[j],array[j]=temp,!0}arrays.swap=swap;function toString(array){return"["+array.toString()+"]"}arrays.toString=toString;function forEach(array,callback){var lenght=array.length;for(var i=0;i<lenght;i++)if(callback(array[i])===!1)return}arrays.forEach=forEach})(arrays=Collections.arrays||(Collections.arrays={}));var LinkedList=function(){function LinkedList(){this.firstNode=null,this.lastNode=null,this.nElements=0}return LinkedList.prototype.add=function(item,index){collections.isUndefined(index)&&(index=this.nElements);if(index<0||index>this.nElements||collections.isUndefined(item))return!1;var newNode=this.createNode(item);if(this.nElements===0)this.firstNode=newNode,this.lastNode=newNode;else if(index===this.nElements)this.lastNode.next=newNode,this.lastNode=newNode;else if(index===0)newNode.next=this.firstNode,this.firstNode=newNode;else{var prev=this.nodeAtIndex(index-1);newNode.next=prev.next,prev.next=newNode}return this.nElements++,!0},LinkedList.prototype.first=function(){return this.firstNode!==null?this.firstNode.element:undefined},LinkedList.prototype.last=function(){return this.lastNode!==null?this.lastNode.element:undefined},LinkedList.prototype.elementAtIndex=function(index){var node=this.nodeAtIndex(index);return node===null?undefined:node.element},LinkedList.prototype.indexOf=function(item,equalsFunction){var equalsF=equalsFunction||collections.defaultEquals;if(collections.isUndefined(item))return-1;var currentNode=this.firstNode,index=0;while(currentNode!==null){if(equalsF(currentNode.element,item))return index;index++,currentNode=currentNode.next}return-1},LinkedList.prototype.contains=function(item,equalsFunction){return this.indexOf(item,equalsFunction)>=0},LinkedList.prototype.remove=function(item,equalsFunction){var equalsF=equalsFunction||collections.defaultEquals;if(this.nElements<1||collections.isUndefined(item))return!1;var previous=null,currentNode=this.firstNode;while(currentNode!==null){if(equalsF(currentNode.element,item))return currentNode===this.firstNode?(this.firstNode=this.firstNode.next,currentNode===this.lastNode&&(this.lastNode=null)):currentNode===this.lastNode?(this.lastNode=previous,previous.next=currentNode.next,currentNode.next=null):(previous.next=currentNode.next,currentNode.next=null),this.nElements--,!0;previous=currentNode,currentNode=currentNode.next}return!1},LinkedList.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},LinkedList.prototype.equals=function(other,equalsFunction){var eqF=equalsFunction||collections.defaultEquals;return other instanceof collections.LinkedList?this.size()!==other.size()?!1:this.equalsAux(this.firstNode,other.firstNode,eqF):!1},LinkedList.prototype.equalsAux=function(n1,n2,eqF){while(n1!==null){if(!eqF(n1.element,n2.element))return!1;n1=n1.next,n2=n2.next}return!0},LinkedList.prototype.removeElementAtIndex=function(index){if(index<0||index>=this.nElements)return undefined;var element;if(this.nElements===1)element=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var previous=this.nodeAtIndex(index-1);previous===null?(element=this.firstNode.element,this.firstNode=this.firstNode.next):previous.next===this.lastNode&&(element=this.lastNode.element,this.lastNode=previous),previous!==null&&(element=previous.next.element,previous.next=previous.next.next)}return this.nElements--,element},LinkedList.prototype.forEach=function(callback){var currentNode=this.firstNode;while(currentNode!==null){if(callback(currentNode.element)===!1)break;currentNode=currentNode.next}},LinkedList.prototype.reverse=function(){var previous=null,current=this.firstNode,temp=null;while(current!==null)temp=current.next,current.next=previous,previous=current,current=temp;temp=this.firstNode,this.firstNode=this.lastNode,this.lastNode=temp},LinkedList.prototype.toArray=function(){var array=[],currentNode=this.firstNode;while(currentNode!==null)array.push(currentNode.element),currentNode=currentNode.next;return array},LinkedList.prototype.size=function(){return this.nElements},LinkedList.prototype.isEmpty=function(){return this.nElements<=0},LinkedList.prototype.toString=function(){return collections.arrays.toString(this.toArray())},LinkedList.prototype.nodeAtIndex=function(index){if(index<0||index>=this.nElements)return null;if(index===this.nElements-1)return this.lastNode;var node=this.firstNode;for(var i=0;i<index;i++)node=node.next;return node},LinkedList.prototype.createNode=function(item){return{element:item,next:null}},LinkedList}();Collections.LinkedList=LinkedList;var Dictionary=function(){function Dictionary(toStrFunction){this.table={},this.nElements=0,this.toStr=toStrFunction||collections.defaultToString}return Dictionary.prototype.getValue=function(key){var pair=this.table["$"+this.toStr(key)];return collections.isUndefined(pair)?undefined:pair.value},Dictionary.prototype.setValue=function(key,value){if(collections.isUndefined(key)||collections.isUndefined(value))return undefined;var ret,k="$"+this.toStr(key),previousElement=this.table[k];return collections.isUndefined(previousElement)?(this.nElements++,ret=undefined):ret=previousElement.value,this.table[k]={key:key,value:value},ret},Dictionary.prototype.remove=function(key){var k="$"+this.toStr(key),previousElement=this.table[k];return collections.isUndefined(previousElement)?undefined:(delete this.table[k],this.nElements--,previousElement.value)},Dictionary.prototype.keys=function(){var array=[];for(var name in this.table)if(has(this.table,name)){var pair=this.table[name];array.push(pair.key)}return array},Dictionary.prototype.values=function(){var array=[];for(var name in this.table)if(has(this.table,name)){var pair=this.table[name];array.push(pair.value)}return array},Dictionary.prototype.forEach=function(callback){for(var name in this.table)if(has(this.table,name)){var pair=this.table[name],ret=callback(pair.key,pair.value);if(ret===!1)return}},Dictionary.prototype.containsKey=function(key){return!collections.isUndefined(this.getValue(key))},Dictionary.prototype.clear=function(){this.table={},this.nElements=0},Dictionary.prototype.size=function(){return this.nElements},Dictionary.prototype.isEmpty=function(){return this.nElements<=0},Dictionary.prototype.toString=function(){var toret="{";return this.forEach(function(k,v){toret=toret+"\n	"+k.toString()+" : "+v.toString()}),toret+"\n}"},Dictionary}();Collections.Dictionary=Dictionary;var LinkedDictionaryPair=function(){function LinkedDictionaryPair(key,value){this.key=key,this.value=value}return LinkedDictionaryPair.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},LinkedDictionaryPair}(),LinkedDictionary=function(_super){__extends(LinkedDictionary,_super);function LinkedDictionary(toStrFunction){_super.call(this,toStrFunction),this.head=new LinkedDictionaryPair(null,null),this.tail=new LinkedDictionaryPair(null,null),this.head.next=this.tail,this.tail.prev=this.head}return LinkedDictionary.prototype.appendToTail=function(entry){var lastNode=this.tail.prev;lastNode.next=entry,entry.prev=lastNode,entry.next=this.tail,this.tail.prev=entry},LinkedDictionary.prototype.getLinkedDictionaryPair=function(key){if(collections.isUndefined(key))return undefined;var k="$"+this.toStr(key),pair=this.table[k];return pair},LinkedDictionary.prototype.getValue=function(key){var pair=this.getLinkedDictionaryPair(key);return collections.isUndefined(pair)?undefined:pair.value},LinkedDictionary.prototype.remove=function(key){var pair=this.getLinkedDictionaryPair(key);return collections.isUndefined(pair)?undefined:(_super.prototype.remove.call(this,key),pair.unlink(),pair.value)},LinkedDictionary.prototype.clear=function(){_super.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},LinkedDictionary.prototype.replace=function(oldPair,newPair){var k="$"+this.toStr(newPair.key);newPair.next=oldPair.next,newPair.prev=oldPair.prev,this.remove(oldPair.key),newPair.prev.next=newPair,newPair.next.prev=newPair,this.table[k]=newPair,++this.nElements},LinkedDictionary.prototype.setValue=function(key,value){if(collections.isUndefined(key)||collections.isUndefined(value))return undefined;var existingPair=this.getLinkedDictionaryPair(key),newPair=new LinkedDictionaryPair(key,value),k="$"+this.toStr(key);return collections.isUndefined(existingPair)?(this.appendToTail(newPair),this.table[k]=newPair,++this.nElements,undefined):(this.replace(existingPair,newPair),existingPair.value)},LinkedDictionary.prototype.keys=function(){var array=[];return this.forEach(function(key,value){array.push(key)}),array},LinkedDictionary.prototype.values=function(){var array=[];return this.forEach(function(key,value){array.push(value)}),array},LinkedDictionary.prototype.forEach=function(callback){var crawlNode=this.head.next;while(crawlNode.next!=null){var ret=callback(crawlNode.key,crawlNode.value);if(ret===!1)return;crawlNode=crawlNode.next}},LinkedDictionary}(Dictionary);Collections.LinkedDictionary=LinkedDictionary;var MultiDictionary=function(){function MultiDictionary(toStrFunction,valuesEqualsFunction,allowDuplicateValues){allowDuplicateValues===void 0&&(allowDuplicateValues=!1),this.dict=new Dictionary(toStrFunction),this.equalsF=valuesEqualsFunction||collections.defaultEquals,this.allowDuplicate=allowDuplicateValues}return MultiDictionary.prototype.getValue=function(key){var values=this.dict.getValue(key);return collections.isUndefined(values)?[]:collections.arrays.copy(values)},MultiDictionary.prototype.setValue=function(key,value){if(collections.isUndefined(key)||collections.isUndefined(value))return!1;if(!this.containsKey(key))return this.dict.setValue(key,[value]),!0;var array=this.dict.getValue(key);return!this.allowDuplicate&&collections.arrays.contains(array,value,this.equalsF)?!1:(array.push(value),!0)},MultiDictionary.prototype.remove=function(key,value){if(collections.isUndefined(value)){var v=this.dict.remove(key);return!collections.isUndefined(v)}var array=this.dict.getValue(key);return collections.arrays.remove(array,value,this.equalsF)?(array.length===0&&this.dict.remove(key),!0):!1},MultiDictionary.prototype.keys=function(){return this.dict.keys()},MultiDictionary.prototype.values=function(){var values=this.dict.values(),array=[];for(var i=0;i<values.length;i++){var v=values[i];for(var j=0;j<v.length;j++)array.push(v[j])}return array},MultiDictionary.prototype.containsKey=function(key){return this.dict.containsKey(key)},MultiDictionary.prototype.clear=function(){this.dict.clear()},MultiDictionary.prototype.size=function(){return this.dict.size()},MultiDictionary.prototype.isEmpty=function(){return this.dict.isEmpty()},MultiDictionary}();Collections.MultiDictionary=MultiDictionary;var Heap=function(){function Heap(compareFunction){this.data=[],this.compare=compareFunction||collections.defaultCompare}return Heap.prototype.leftChildIndex=function(nodeIndex){return 2*nodeIndex+1},Heap.prototype.rightChildIndex=function(nodeIndex){return 2*nodeIndex+2},Heap.prototype.parentIndex=function(nodeIndex){return Math.floor((nodeIndex-1)/2)},Heap.prototype.minIndex=function(leftChild,rightChild){return rightChild>=this.data.length?leftChild>=this.data.length?-1:leftChild:this.compare(this.data[leftChild],this.data[rightChild])<=0?leftChild:rightChild},Heap.prototype.siftUp=function(index){var parent=this.parentIndex(index);while(index>0&&this.compare(this.data[parent],this.data[index])>0)collections.arrays.swap(this.data,parent,index),index=parent,parent=this.parentIndex(index)},Heap.prototype.siftDown=function(nodeIndex){var min=this.minIndex(this.leftChildIndex(nodeIndex),this.rightChildIndex(nodeIndex));while(min>=0&&this.compare(this.data[nodeIndex],this.data[min])>0)collections.arrays.swap(this.data,min,nodeIndex),nodeIndex=min,min=this.minIndex(this.leftChildIndex(nodeIndex),this.rightChildIndex(nodeIndex))},Heap.prototype.peek=function(){return this.data.length>0?this.data[0]:undefined},Heap.prototype.add=function(element){return collections.isUndefined(element)?undefined:(this.data.push(element),this.siftUp(this.data.length-1),!0)},Heap.prototype.removeRoot=function(){if(this.data.length>0){var obj=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),obj}return undefined},Heap.prototype.contains=function(element){var equF=collections.compareToEquals(this.compare);return collections.arrays.contains(this.data,element,equF)},Heap.prototype.size=function(){return this.data.length},Heap.prototype.isEmpty=function(){return this.data.length<=0},Heap.prototype.clear=function(){this.data.length=0},Heap.prototype.forEach=function(callback){collections.arrays.forEach(this.data,callback)},Heap}();Collections.Heap=Heap;var Stack=function(){function Stack(){this.list=new LinkedList}return Stack.prototype.push=function(elem){return this.list.add(elem,0)},Stack.prototype.add=function(elem){return this.list.add(elem,0)},Stack.prototype.pop=function(){return this.list.removeElementAtIndex(0)},Stack.prototype.peek=function(){return this.list.first()},Stack.prototype.size=function(){return this.list.size()},Stack.prototype.contains=function(elem,equalsFunction){return this.list.contains(elem,equalsFunction)},Stack.prototype.isEmpty=function(){return this.list.isEmpty()},Stack.prototype.clear=function(){this.list.clear()},Stack.prototype.forEach=function(callback){this.list.forEach(callback)},Stack}();Collections.Stack=Stack;var Queue=function(){function Queue(){this.list=new LinkedList}return Queue.prototype.enqueue=function(elem){return this.list.add(elem)},Queue.prototype.add=function(elem){return this.list.add(elem)},Queue.prototype.dequeue=function(){if(this.list.size()!==0){var el=this.list.first();return this.list.removeElementAtIndex(0),el}return undefined},Queue.prototype.peek=function(){return this.list.size()!==0?this.list.first():undefined},Queue.prototype.size=function(){return this.list.size()},Queue.prototype.contains=function(elem,equalsFunction){return this.list.contains(elem,equalsFunction)},Queue.prototype.isEmpty=function(){return this.list.size()<=0},Queue.prototype.clear=function(){this.list.clear()},Queue.prototype.forEach=function(callback){this.list.forEach(callback)},Queue}();Collections.Queue=Queue;var PriorityQueue=function(){function PriorityQueue(compareFunction){this.heap=new Heap(collections.reverseCompareFunction(compareFunction))}return PriorityQueue.prototype.enqueue=function(element){return this.heap.add(element)},PriorityQueue.prototype.add=function(element){return this.heap.add(element)},PriorityQueue.prototype.dequeue=function(){if(this.heap.size()!==0){var el=this.heap.peek();return this.heap.removeRoot(),el}return undefined},PriorityQueue.prototype.peek=function(){return this.heap.peek()},PriorityQueue.prototype.contains=function(element){return this.heap.contains(element)},PriorityQueue.prototype.isEmpty=function(){return this.heap.isEmpty()},PriorityQueue.prototype.size=function(){return this.heap.size()},PriorityQueue.prototype.clear=function(){this.heap.clear()},PriorityQueue.prototype.forEach=function(callback){this.heap.forEach(callback)},PriorityQueue}();Collections.PriorityQueue=PriorityQueue;var Set=function(){function Set(toStringFunction){this.dictionary=new Dictionary(toStringFunction)}return Set.prototype.contains=function(element){return this.dictionary.containsKey(element)},Set.prototype.add=function(element){return this.contains(element)||collections.isUndefined(element)?!1:(this.dictionary.setValue(element,element),!0)},Set.prototype.intersection=function(otherSet){var set=this;this.forEach(function(element){return otherSet.contains(element)||set.remove(element),!0})},Set.prototype.union=function(otherSet){var set=this;otherSet.forEach(function(element){return set.add(element),!0})},Set.prototype.difference=function(otherSet){var set=this;otherSet.forEach(function(element){return set.remove(element),!0})},Set.prototype.isSubsetOf=function(otherSet){if(this.size()>otherSet.size())return!1;var isSub=!0;return this.forEach(function(element){return otherSet.contains(element)?!0:(isSub=!1,!1)}),isSub},Set.prototype.remove=function(element){return this.contains(element)?(this.dictionary.remove(element),!0):!1},Set.prototype.forEach=function(callback){this.dictionary.forEach(function(k,v){return callback(v)})},Set.prototype.toArray=function(){return this.dictionary.values()},Set.prototype.isEmpty=function(){return this.dictionary.isEmpty()},Set.prototype.size=function(){return this.dictionary.size()},Set.prototype.clear=function(){this.dictionary.clear()},Set.prototype.toString=function(){return collections.arrays.toString(this.toArray())},Set}();Collections.Set=Set;var Bag=function(){function Bag(toStrFunction){this.toStrF=toStrFunction||collections.defaultToString,this.dictionary=new Dictionary(this.toStrF),this.nElements=0}return Bag.prototype.add=function(element,nCopies){nCopies===void 0&&(nCopies=1);if(collections.isUndefined(element)||nCopies<=0)return!1;if(!this.contains(element)){var node={value:element,copies:nCopies};this.dictionary.setValue(element,node)}else this.dictionary.getValue(element).copies+=nCopies;return this.nElements+=nCopies,!0},Bag.prototype.count=function(element){return this.contains(element)?this.dictionary.getValue(element).copies:0},Bag.prototype.contains=function(element){return this.dictionary.containsKey(element)},Bag.prototype.remove=function(element,nCopies){nCopies===void 0&&(nCopies=1);if(collections.isUndefined(element)||nCopies<=0)return!1;if(!this.contains(element))return!1;var node=this.dictionary.getValue(element);return nCopies>node.copies?this.nElements-=node.copies:this.nElements-=nCopies,node.copies-=nCopies,node.copies<=0&&this.dictionary.remove(element),!0},Bag.prototype.toArray=function(){var a=[],values=this.dictionary.values(),vl=values.length;for(var i=0;i<vl;i++){var node=values[i],element=node.value,copies=node.copies;for(var j=0;j<copies;j++)a.push(element)}return a},Bag.prototype.toSet=function(){var toret=new Set(this.toStrF),elements=this.dictionary.values(),l=elements.length;for(var i=0;i<l;i++){var value=elements[i].value;toret.add(value)}return toret},Bag.prototype.forEach=function(callback){this.dictionary.forEach(function(k,v){var value=v.value,copies=v.copies;for(var i=0;i<copies;i++)if(callback(value)===!1)return!1;return!0})},Bag.prototype.size=function(){return this.nElements},Bag.prototype.isEmpty=function(){return this.nElements===0},Bag.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},Bag}();Collections.Bag=Bag;var BSTree=function(){function BSTree(compareFunction){this.root=null,this.compare=compareFunction||collections.defaultCompare,this.nElements=0}return BSTree.prototype.add=function(element){return collections.isUndefined(element)?!1:this.insertNode(this.createNode(element))!==null?(this.nElements++,!0):!1},BSTree.prototype.clear=function(){this.root=null,this.nElements=0},BSTree.prototype.isEmpty=function(){return this.nElements===0},BSTree.prototype.size=function(){return this.nElements},BSTree.prototype.contains=function(element){return collections.isUndefined(element)?!1:this.searchNode(this.root,element)!==null},BSTree.prototype.remove=function(element){var node=this.searchNode(this.root,element);return node===null?!1:(this.removeNode(node),this.nElements--,!0)},BSTree.prototype.inorderTraversal=function(callback){this.inorderTraversalAux(this.root,callback,{stop:!1})},BSTree.prototype.preorderTraversal=function(callback){this.preorderTraversalAux(this.root,callback,{stop:!1})},BSTree.prototype.postorderTraversal=function(callback){this.postorderTraversalAux(this.root,callback,{stop:!1})},BSTree.prototype.levelTraversal=function(callback){this.levelTraversalAux(this.root,callback)},BSTree.prototype.minimum=function(){return this.isEmpty()?undefined:this.minimumAux(this.root).element},BSTree.prototype.maximum=function(){return this.isEmpty()?undefined:this.maximumAux(this.root).element},BSTree.prototype.forEach=function(callback){this.inorderTraversal(callback)},BSTree.prototype.toArray=function(){var array=[];return this.inorderTraversal(function(element){return array.push(element),!0}),array},BSTree.prototype.height=function(){return this.heightAux(this.root)},BSTree.prototype.searchNode=function(node,element){var cmp=null;while(node!==null&&cmp!==0)cmp=this.compare(element,node.element),cmp<0?node=node.leftCh:cmp>0&&(node=node.rightCh);return node},BSTree.prototype.transplant=function(n1,n2){n1.parent===null?this.root=n2:n1===n1.parent.leftCh?n1.parent.leftCh=n2:n1.parent.rightCh=n2,n2!==null&&(n2.parent=n1.parent)},BSTree.prototype.removeNode=function(node){if(node.leftCh===null)this.transplant(node,node.rightCh);else if(node.rightCh===null)this.transplant(node,node.leftCh);else{var y=this.minimumAux(node.rightCh);y.parent!==node&&(this.transplant(y,y.rightCh),y.rightCh=node.rightCh,y.rightCh.parent=y),this.transplant(node,y),y.leftCh=node.leftCh,y.leftCh.parent=y}},BSTree.prototype.inorderTraversalAux=function(node,callback,signal){if(node===null||signal.stop)return;this.inorderTraversalAux(node.leftCh,callback,signal);if(signal.stop)return;signal.stop=callback(node.element)===!1;if(signal.stop)return;this.inorderTraversalAux(node.rightCh,callback,signal)},BSTree.prototype.levelTraversalAux=function(node,callback){var queue=new Queue;node!==null&&queue.enqueue(node);while(!queue.isEmpty()){node=queue.dequeue();if(callback(node.element)===!1)return;node.leftCh!==null&&queue.enqueue(node.leftCh),node.rightCh!==null&&queue.enqueue(node.rightCh)}},BSTree.prototype.preorderTraversalAux=function(node,callback,signal){if(node===null||signal.stop)return;signal.stop=callback(node.element)===!1;if(signal.stop)return;this.preorderTraversalAux(node.leftCh,callback,signal);if(signal.stop)return;this.preorderTraversalAux(node.rightCh,callback,signal)},BSTree.prototype.postorderTraversalAux=function(node,callback,signal){if(node===null||signal.stop)return;this.postorderTraversalAux(node.leftCh,callback,signal);if(signal.stop)return;this.postorderTraversalAux(node.rightCh,callback,signal);if(signal.stop)return;signal.stop=callback(node.element)===!1},BSTree.prototype.minimumAux=function(node){while(node.leftCh!==null)node=node.leftCh;return node},BSTree.prototype.maximumAux=function(node){while(node.rightCh!==null)node=node.rightCh;return node},BSTree.prototype.heightAux=function(node){return node===null?-1:Math.max(this.heightAux(node.leftCh),this.heightAux(node.rightCh))+1},BSTree.prototype.insertNode=function(node){var parent=null,position=this.root,cmp=null;while(position!==null){cmp=this.compare(node.element,position.element);if(cmp===0)return null;cmp<0?(parent=position,position=position.leftCh):(parent=position,position=position.rightCh)}return node.parent=parent,parent===null?this.root=node:this.compare(node.element,parent.element)<0?parent.leftCh=node:parent.rightCh=node,node},BSTree.prototype.createNode=function(element){return{element:element,leftCh:null,rightCh:null,parent:null}},BSTree}();Collections.BSTree=BSTree})(Collections=Utils.Collections||(Utils.Collections={}))})(Utils||(Utils={}));var Utils;(function(Utils){var Colors=function(){function Colors(){}return Colors.Float32ColorToARGB=function(float32Color){var a=(float32Color&4278190080)>>>24,r=(float32Color&16711680)>>>16,g=(float32Color&65280)>>>8,b=float32Color&255,result=[a,r,g,b];return result},Colors._ComponentToHex=function(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex},Colors.RGBToHexString=function(rgb){return Colors.Coalesce(rgb),"#"+Colors._ComponentToHex(rgb[0])+Colors._ComponentToHex(rgb[1])+Colors._ComponentToHex(rgb[2])},Colors.ARGBToHexString=function(argb){return"#"+Colors._ComponentToHex(argb[0])+Colors._ComponentToHex(argb[1])+Colors._ComponentToHex(argb[2])+Colors._ComponentToHex(argb[3])},Colors.Coalesce=function(arr){for(var i=1;i<arr.length;i++)typeof arr[i]=="undefined"&&(arr[i]=arr[i-1])},Colors}();Utils.Colors=Colors})(Utils||(Utils={}));var Utils;(function(Utils){var Dates=function(){function Dates(){}return Dates.GetTimeStamp=function(){return(new Date).getTime()},Dates}();Utils.Dates=Dates})(Utils||(Utils={}));var Utils;(function(Utils){var Device=function(){function Device(){}return Device.GetPixelRatio=function(ctx){var dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;return dpr/bsr},Device}();Utils.Device=Device})(Utils||(Utils={}));var Utils;(function(Utils){var Documents=function(){function Documents(){}return Documents.IsInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},Documents.SupportsFullscreen=function(){var doc=document.documentElement,support=doc.requestFullscreen||doc.mozRequestFullScreen||doc.webkitRequestFullScreen||doc.msRequestFullscreen;return support!=undefined},Documents}();Utils.Documents=Documents})(Utils||(Utils={}));var Utils;(function(Utils){var Events=function(){function Events(){}return Events.Debounce=function(fn,debounceDuration){return debounceDuration=debounceDuration||100,function(){if(!fn.debouncing){var args=Array.prototype.slice.apply(arguments);fn.lastReturnVal=fn.apply(window,args),fn.debouncing=!0}return clearTimeout(fn.debounceTimeout),fn.debounceTimeout=setTimeout(function(){fn.debouncing=!1},debounceDuration),fn.lastReturnVal}},Events}();Utils.Events=Events})(Utils||(Utils={}));var Utils;(function(Utils){var Keyboard=function(){function Keyboard(){}return Keyboard.GetCharCode=function(e){var charCode=typeof e.which=="number"?e.which:e.keyCode;return charCode},Keyboard}();Utils.Keyboard=Keyboard})(Utils||(Utils={}));var Utils;(function(Utils){var Maths;(function(Maths){var Vector=function(){function Vector(x,y){this.X=x,this.Y=y}return Vector.prototype.Get=function(){return new Vector(this.X,this.Y)},Vector.prototype.Set=function(x,y){this.X=x,this.Y=y},Vector.prototype.Add=function(v){this.X+=v.X,this.Y+=v.Y},Vector.Add=function(v1,v2){return new Vector(v1.X+v2.X,v1.Y+v2.Y)},Vector.prototype.Sub=function(v){this.X-=v.X,this.Y-=v.Y},Vector.Sub=function(v1,v2){return new Vector(v1.X-v2.X,v1.Y-v2.Y)},Vector.prototype.Mult=function(n){this.X=this.X*n,this.Y=this.Y*n},Vector.Mult=function(v1,v2){return new Vector(v1.X*v2.X,v1.Y*v2.Y)},Vector.MultN=function(v1,n){return new Vector(v1.X*n,v1.Y*n)},Vector.prototype.Div=function(n){this.X=this.X/n,this.Y=this.Y/n},Vector.Div=function(v1,v2){return new Vector(v1.X/v2.X,v1.Y/v2.Y)},Vector.DivN=function(v1,n){return new Vector(v1.X/n,v1.Y/n)},Vector.prototype.Mag=function(){return Math.sqrt(this.X*this.X+this.Y*this.Y)},Vector.prototype.MagSq=function(){return this.X*this.X+this.Y*this.Y},Vector.prototype.Normalise=function(){var m=this.Mag();m!=0&&m!=1&&this.Div(m)},Vector.prototype.Limit=function(max){this.MagSq()>max*max&&(this.Normalise(),this.Mult(max))},Vector.prototype.Equals=function(v){return this.X==v.X&&this.Y==v.Y},Vector.prototype.Heading=function(){var angle=Math.atan2(-this.Y,this.X);return-1*angle},Vector.Random2D=function(){return Vector.FromAngle(Math.random()*Math.TAU)},Vector.FromAngle=function(angle){return new Vector(Math.cos(angle),Math.sin(angle))},Vector}();Maths.Vector=Vector})(Maths=Utils.Maths||(Utils.Maths={}))})(Utils||(Utils={}));var Utils;(function(Utils){var Measurements;(function(Measurements){var Size=function(){function Size(width,height){this.width=width,this.height=height}return Size}();Measurements.Size=Size;var Dimensions=function(){function Dimensions(){}return Dimensions.FitRect=function(width1,height1,width2,height2){var ratio1=height1/width1,ratio2=height2/width2,width,height,scale;return ratio1<ratio2&&(scale=width2/width1,width=width1*scale,height=height1*scale),ratio2<ratio1&&(scale=height2/height1,width=width1*scale,height=height1*scale),new Size(Math.floor(width),Math.floor(height))},Dimensions.HitRect=function(x,y,w,h,mx,my){return mx>x&&mx<x+w&&my>y&&my<y+h?!0:!1},Dimensions}();Measurements.Dimensions=Dimensions})(Measurements=Utils.Measurements||(Utils.Measurements={}))})(Utils||(Utils={}));var Utils;(function(Utils){var Numbers=function(){function Numbers(){}return Numbers.NumericalInput=function(event){return event.keyCode==46||event.keyCode==8||event.keyCode==9||event.keyCode==27||event.keyCode==65&&event.ctrlKey===!0||event.keyCode>=35&&event.keyCode<=39?!0:event.shiftKey||(event.keyCode<48||event.keyCode>57)&&(event.keyCode<96||event.keyCode>105)?(event.preventDefault(),!1):!0},Numbers}();Utils.Numbers=Numbers})(Utils||(Utils={}));var Utils;(function(Utils){var Storage=function(){function Storage(){}return Storage.clear=function(storageType){storageType===void 0&&(storageType=Utils.StorageType.memory);switch(storageType.value){case Utils.StorageType.memory.value:this._memoryStorage={};break;case Utils.StorageType.session.value:sessionStorage.clear();break;case Utils.StorageType.local.value:localStorage.clear()}},Storage.clearExpired=function(storageType){storageType===void 0&&(storageType=Utils.StorageType.memory);var items=this.getItems(storageType);for(var i=0;i<items.length;i++){var item=items[i];this._isExpired(item)&&this.remove(item.key)}},Storage.get=function(key,storageType){storageType===void 0&&(storageType=Utils.StorageType.memory);var data;switch(storageType.value){case Utils.StorageType.memory.value:data=this._memoryStorage[key];break;case Utils.StorageType.session.value:data=sessionStorage.getItem(key);break;case Utils.StorageType.local.value:data=localStorage.getItem(key)}if(!data)return null;var item=JSON.parse(data);return this._isExpired(item)?null:(item.key=key,item)},Storage._isExpired=function(item){return(new Date).getTime()<item.expiresAt?!1:!0},Storage.getItems=function(storageType){storageType===void 0&&(storageType=Utils.StorageType.memory);var items=[];switch(storageType.value){case Utils.StorageType.memory.value:var keys=Object.keys(this._memoryStorage);for(var i=0;i<keys.length;i++){var item=this.get(keys[i],Utils.StorageType.memory);item&&items.push(item)}break;case Utils.StorageType.session.value:for(var i=0;i<sessionStorage.length;i++){var key=sessionStorage.key(i),item=this.get(key,Utils.StorageType.session);item&&items.push(item)}break;case Utils.StorageType.local.value:for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i),item=this.get(key,Utils.StorageType.local);item&&items.push(item)}}return items},Storage.remove=function(key,storageType){storageType===void 0&&(storageType=Utils.StorageType.memory);switch(storageType.value){case Utils.StorageType.memory.value:delete this._memoryStorage[key];break;case Utils.StorageType.session.value:sessionStorage.removeItem(key);break;case Utils.StorageType.local.value:localStorage.removeItem(key)}},Storage.set=function(key,value,expirationSecs,storageType){storageType===void 0&&(storageType=Utils.StorageType.memory);var expirationMS=expirationSecs*1e3,record=new Utils.StorageItem;record.value=value,record.expiresAt=(new Date).getTime()+expirationMS;switch(storageType.value){case Utils.StorageType.memory.value:this._memoryStorage[key]=JSON.stringify(record);break;case Utils.StorageType.session.value:sessionStorage.setItem(key,JSON.stringify(record));break;case Utils.StorageType.local.value:localStorage.setItem(key,JSON.stringify(record))}return record},Storage._memoryStorage={},Storage}();Utils.Storage=Storage})(Utils||(Utils={}));var Utils;(function(Utils){var StorageItem=function(){function StorageItem(){}return StorageItem}();Utils.StorageItem=StorageItem})(Utils||(Utils={}));var Utils;(function(Utils){var StorageType=function(){function StorageType(value){this.value=value}return StorageType.prototype.toString=function(){return this.value},StorageType.memory=new StorageType("memory"),StorageType.session=new StorageType("session"),StorageType.local=new StorageType("local"),StorageType}();Utils.StorageType=StorageType})(Utils||(Utils={}));var Utils;(function(Utils){var Strings=function(){function Strings(){}return Strings.Ellipsis=function(text,chars){if(text.length<=chars)return text;var trimmedText=text.substr(0,chars),lastSpaceIndex=trimmedText.lastIndexOf(" ");return lastSpaceIndex!=-1&&(trimmedText=trimmedText.substr(0,Math.min(trimmedText.length,lastSpaceIndex))),trimmedText+"&hellip;"},Strings.HtmlDecode=function(encoded){var div=document.createElement("div");return div.innerHTML=encoded,div.firstChild.nodeValue},Strings}();Utils.Strings=Strings})(Utils||(Utils={}));var Utils;(function(Utils){var Urls=function(){function Urls(){}return Urls.GetHashParameter=function(key,doc){doc||(doc=window.document);var regex=new RegExp("#.*[?&]"+key+"=([^&]+)(&|$)"),match=regex.exec(doc.location.hash);return match?decodeURIComponent(match[1].replace(/\+/g," ")):null},Urls.SetHashParameter=function(key,value,doc){doc||(doc=window.document);var kvp=this.UpdateURIKeyValuePair(doc.location.hash.replace("#?",""),key,value),newHash="#?"+kvp,url=doc.URL,index=url.indexOf("#");index!=-1&&(url=url.substr(0,url.indexOf("#"))),doc.location.replace(url+newHash)},Urls.GetQuerystringParameter=function(key,w){return w||(w=window),this.GetQuerystringParameterFromString(key,w.location.search)},Urls.GetQuerystringParameterFromString=function(key,querystring){key=key.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+key+"=([^&#]*)"),match=regex.exec(querystring);return match?decodeURIComponent(match[1].replace(/\+/g," ")):null},Urls.SetQuerystringParameter=function(key,value,doc){doc||(doc=window.document);var kvp=this.UpdateURIKeyValuePair(doc.location.hash.replace("#?",""),key,value);window.location.search=kvp},Urls.UpdateURIKeyValuePair=function(uriSegment,key,value){key=encodeURIComponent(key),value=encodeURIComponent(value);var kvp=uriSegment.split("&");kvp[0]==""&&kvp.shift();var i=kvp.length,x;while(i--){x=kvp[i].split("=");if(x[0]==key){x[1]=value,kvp[i]=x.join("=");break}}return i<0&&(kvp[kvp.length]=[key,value].join("=")),kvp.join("&")},Urls.GetUrlParts=function(url){var a=document.createElement("a");return a.href=url,a},Urls.ConvertToRelativeUrl=function(url){var parts=this.GetUrlParts(url),relUri=parts.pathname+parts.searchWithin;return relUri.startsWith("/")||(relUri="/"+relUri),relUri},Urls}();Utils.Urls=Urls})(Utils||(Utils={})),define("utils",function(global){return function(){var ret,fn;return ret||global.Utils}}(this)),define("Core/Resources/PooledFactoryResource",["require","exports","utils"],function(require,exports){var ArgumentException=etch.exceptions.ArgumentException,Queue=Utils.Collections.Queue,PooledFactoryResource=function(){function PooledFactoryResource(minimumPoolSize,maximumPoolSize,type,propertyDescriptor){this._ValidatePoolLimits(minimumPoolSize,maximumPoolSize),this._PooledObjects=new Queue,this._Type=type,this._PropertyDescriptor=propertyDescriptor,this.MinimumPoolSize=minimumPoolSize,this.MaximumPoolSize=maximumPoolSize,this._PooledObjects=new Queue,this._AdjustPoolSizeToBounds()}return Object.defineProperty(PooledFactoryResource.prototype,"ObjectsInPoolCount",{get:function(){return this._PooledObjects.size()},enumerable:!0,configurable:!0}),Object.defineProperty(PooledFactoryResource.prototype,"MinimumPoolSize",{get:function(){return this._MinimumPoolSize},set:function(value){this._ValidatePoolLimits(value,this.MaximumPoolSize),this._MinimumPoolSize=value,this._AdjustPoolSizeToBounds()},enumerable:!0,configurable:!0}),Object.defineProperty(PooledFactoryResource.prototype,"MaximumPoolSize",{get:function(){return this._MaximumPoolSize},set:function(value){this._ValidatePoolLimits(this.MinimumPoolSize,value),this._MaximumPoolSize=value,this._AdjustPoolSizeToBounds()},enumerable:!0,configurable:!0}),PooledFactoryResource.prototype._ValidatePoolLimits=function(minimumPoolSize,maximumPoolSize){if(minimumPoolSize<0)throw new ArgumentException("Minimum pool size must be greater or equals to zero.");if(maximumPoolSize<1)throw new ArgumentException("Maximum pool size must be greater than zero.");if(minimumPoolSize>maximumPoolSize)throw new ArgumentException("Maximum pool size must be greater than the maximum pool size.")},PooledFactoryResource.prototype._AdjustPoolSizeToBounds=function(){while(this.ObjectsInPoolCount<this._MinimumPoolSize)this._PooledObjects.enqueue(this._CreatePooledObject());while(this.ObjectsInPoolCount>this._MaximumPoolSize)this._PooledObjects.dequeue()},PooledFactoryResource.prototype._CreatePooledObject=function(){var _this=this,obj=Object.create(this._Type,this._PropertyDescriptor);return obj.ReturnToPool=function(){_this._ReturnObjectToPool(obj)},obj},PooledFactoryResource.prototype.GetObject=function(){return this.ObjectsInPoolCount||this._AdjustPoolSizeToBounds(),this._PooledObjects.dequeue()},PooledFactoryResource.prototype._ReturnObjectToPool=function(objectToReturnToPool){if(this.ObjectsInPoolCount<this.MaximumPoolSize){if(!objectToReturnToPool.Reset()){this._DestroyPooledObject(objectToReturnToPool);return}this._PooledObjects.enqueue(objectToReturnToPool)}else this._DestroyPooledObject(objectToReturnToPool)},PooledFactoryResource.prototype._DestroyPooledObject=function(objectToDestroy){objectToDestroy.Disposed||objectToDestroy.Dispose()},PooledFactoryResource}();exports.PooledFactoryResource=PooledFactoryResource}),define("CommandHandlers/RedoCommandHandler",["require","exports","../Commands","../CommandCategories"],function(require,exports,Commands_1,CommandCategories_1){var RedoCommandHandler=function(){function RedoCommandHandler(){}return RedoCommandHandler.prototype.Execute=function(){if(App.OperationManager.CanRedo())return App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.REDO.toString()),App.OperationManager.Redo()},RedoCommandHandler}();exports.RedoCommandHandler=RedoCommandHandler}),define("Core/Resources/ResourceManager",["require","exports"],function(require,exports){var ObservableCollection=etch.collections.ObservableCollection,RoutedEvent=etch.events.RoutedEvent,RoutedEventArgs=etch.events.RoutedEventArgs,ResourceManager=function(){function ResourceManager(){this._Resources=new ObservableCollection,this.ResourceAdded=new RoutedEvent}return ResourceManager.prototype.AddResource=function(resource){this._Resources.Add(resource),this.ResourceAdded.raise(resource,new RoutedEventArgs)},ResourceManager}();exports.ResourceManager=ResourceManager}),define("Operations/SaveOperation",["require","exports"],function(require,exports){var SaveOperation=function(){function SaveOperation(json,compositionId,sessionId){this._JSON=new PostData(compositionId?compositionId:"",json,sessionId),this._LZMA=new LZMA("/lib/lzma/src/lzma_worker.js")}return SaveOperation.prototype.Compress=function(data){var _this=this;return new Promise(function(resolve){var compressionLevel=5;_this._LZMA.compress(data,compressionLevel,function(result){resolve(result.toString())},function(percent){})})},SaveOperation.prototype.Do=function(){var that=this;return new Promise(function(resolve,reject){that.Compress(that._JSON.Data).then(function(compressed){that._JSON.Data=compressed;var data=JSON.stringify(that._JSON),url=App.IsLocalhost()?"http://95.85.7.107/api/save":"http://95.85.7.107/api/save";$.ajax({url:url,type:"POST",crossDomain:!0,dataType:"json",contentType:"application/json",data:data}).done(function(saved){resolve(saved)}).fail(function(jqXHR,textStatus){reject(textStatus)})})})},SaveOperation.prototype.Dispose=function(){},SaveOperation}();exports.SaveOperation=SaveOperation;var PostData=function(){function PostData(Id,Data,SessionId){this.Id=Id,this.Data=Data,this.SessionId=SessionId}return PostData}();exports.PostData=PostData});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Errors",["require","exports","./StringValue"],function(require,exports,StringValue_1){var Error=function(_super){__extends(Error,_super);function Error(){_super.apply(this,arguments)}return Error}(StringValue_1.StringValue),Errors=function(){function Errors(){}return Errors.LOAD_FAILED=new Error("loadFailed"),Errors.SAVE_FAILED=new Error("saveFailed"),Errors.SAVE_AS_FAILED=new Error("saveAsFailed"),Errors}();exports.Errors=Errors}),define("CommandHandlers/SaveAsCommandHandler",["require","exports","../Operations/SaveOperation","../Commands","../CommandCategories","../Errors"],function(require,exports,SaveOperation_1,Commands_1,CommandCategories_1,Errors_1){var SaveAsCommandHandler=function(){function SaveAsCommandHandler(){}return SaveAsCommandHandler.prototype.Execute=function(){var op=new SaveOperation_1.SaveOperation(App.Serialize(),null,null);return App.OperationManager.Do(op).then(function(result){result?(App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.SAVE_AS.toString(),App.CompositionId),App.CompositionId=result.Id,App.MainScene.SharePanel.ReturnLink(result.Id),App.SessionId=result.SessionId):(App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Errors_1.Errors.SAVE_AS_FAILED.toString(),App.CompositionId),App.MainScene.SharePanel.ClosePanel(),App.Message(App.L10n.Errors.SaveError))})},SaveAsCommandHandler}();exports.SaveAsCommandHandler=SaveAsCommandHandler}),define("CommandHandlers/SaveCommandHandler",["require","exports","../Commands","../Operations/SaveOperation","../CommandCategories","../Errors"],function(require,exports,Commands_1,SaveOperation_1,CommandCategories_1,Errors_1){var SaveCommandHandler=function(){function SaveCommandHandler(){}return SaveCommandHandler.prototype.Execute=function(){var op=new SaveOperation_1.SaveOperation(App.Serialize(),App.CompositionId,App.SessionId);return App.OperationManager.Do(op).then(function(result){result?(App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.SAVE.toString(),App.CompositionId),App.CompositionId=result.Id,App.MainScene.SharePanel.ReturnLink(result.Id),App.SessionId=result.SessionId):(App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Errors_1.Errors.SAVE_FAILED.toString(),App.CompositionId),App.MainScene.SharePanel.ClosePanel(),App.Message(App.L10n.Errors.SaveError))})},SaveCommandHandler}();exports.SaveCommandHandler=SaveCommandHandler}),define("SaveFile",["require","exports"],function(require,exports){var SaveFile=function(){function SaveFile(){}return SaveFile}();exports.SaveFile=SaveFile}),define("_Version",["require","exports"],function(require,exports){exports.Version="0.2.0"}),define("Serializer",["require","exports","./Blocks/Effect","./SaveFile","./Blocks/Source","./_Version"],function(require,exports,Effect_1,SaveFile_1,Source_1,_Version_1){var Point=etch.primitives.Point,Serializer=function(){function Serializer(){}return Serializer.Serialize=function(){this._Debug&&console.log("START SERIALIZATION");var blocks=App.Blocks;this._Debug&&console.log("BLOCKS",blocks),this._SerializationDictionary={};for(var i=0;i<blocks.length;i++){var b=blocks[i];this._SerializationDictionary[b.Id]=!1}this._Debug&&console.log("DICTIONARY",this._SerializationDictionary);var json={ColorThemeNo:App.ThemeManager.CurrentThemeNo,Composition:[],DragOffset:App.DragOffset,Parent:App.CompositionId?App.CompositionId:"",Version:_Version_1.Version,ZoomLevel:App.ZoomLevel};this._SerializeBlocks(json.Composition,blocks);var result=JSON.stringify(json);return this._Debug&&console.log("END SERIALIZATION",result),result},Serializer._SerializeBlocks=function(list,blocks,parentBlock){for(var i=0;i<blocks.length;i++){var b=this._SerializeBlock(blocks[i],parentBlock);b&&list.push(b),this._Debug&&(console.log("DICTIONARY",this._SerializationDictionary),console.log("SERIALIZED LIST",list))}},Serializer._GetBlockSerializationType=function(block){return block.constructor.name},Serializer._SerializeBlock=function(block,parentBlock){this._Debug&&console.log("SERIALIZING",block);var d=this._SerializationDictionary[block.Id];if(d){this._Debug&&console.log("ALREADY SERIALIZED");return}this._SerializationDictionary[block.Id]=!0;var b={};return b.Id=block.Id,b.Type=this._GetBlockSerializationType(block),b.Position=block.Position,b.ZIndex=block.ZIndex,block.Params&&(b.Params=block.Params),block instanceof Source_1.Source&&block.Connections.Count&&(b.Effects=[],parentBlock&&b.Effects.push(parentBlock.Id),this._SerializeBlocks(b.Effects,block.Connections.ToArray(),b)),block instanceof Effect_1.Effect&&block.Connections.Count&&(b.Sources=[],parentBlock&&b.Sources.push(parentBlock.Id),this._SerializeBlocks(b.Sources,block.Connections.ToArray(),b)),b},Serializer.Deserialize=function(json){this._DeserializationDictionary={};var parsed=JSON.parse(json),saveFile=new SaveFile_1.SaveFile;return saveFile.ZoomLevel=parsed.ZoomLevel,parsed.DragOffset?saveFile.DragOffset=new Point(parsed.DragOffset.x,parsed.DragOffset.y):(saveFile.DragOffset=new Point(0,0),saveFile.ZoomLevel=1),saveFile.Composition=this._DeserializeBlocks(parsed.Composition),saveFile.ColorThemeNo=parsed.ColorThemeNo,saveFile},Serializer._DeserializeBlocks=function(blocks){var deserializedBlocks=[];for(var i=0;i<blocks.length;i++){var b=blocks[i],block=this._DeserializeBlock(b);deserializedBlocks.push(block)}return deserializedBlocks},Serializer._DeserializeBlock=function(b){var block;(b.Id==null||!b.Id.isInteger())&&Serializer._DeserializationDictionary[b]?block=Serializer._DeserializationDictionary[b]:(block=this._GetBlockDeserializationType(b),block.Id=b.Id,block.Position=new Point(b.Position.x,b.Position.y),block.LastPosition=new Point(b.Position.x,b.Position.y),block.Params=b.Params,block.ZIndex=b.ZIndex,Serializer._DeserializationDictionary[b.Id]=block);if(b.Effects){var effects=Serializer._DeserializeBlocks(b.Effects);block.Connections.AddRange(effects)}if(b.Sources){var sources=Serializer._DeserializeBlocks(b.Sources);block.Connections.AddRange(sources)}return block},Serializer._GetBlockDeserializationType=function(b){return App.BlockCreator.GetBlock(b.Type)},Serializer._Debug=!1,Serializer}();exports.Serializer=Serializer}),define("Core/Audio/SoundCloud/SoundCloudAPI",["require","exports"],function(require,exports){var SoundCloudAPI=function(){function SoundCloudAPI(){}return SoundCloudAPI.Initialize=function(){typeof SC!="undefined"&&SC.initialize({client_id:App.Config.SoundCloudClientId})},SoundCloudAPI.PickRandomTrack=function(t){switch(t){case 0:var defaults=App.Config.SoundCloudDefaultTracks;break;case 1:var defaults=App.Config.GranularDefaultTracks;break;case 2:var defaults=App.Config.ConvolverDefaultTracks;break;default:var defaults=App.Config.SoundCloudDefaultTracks}var track=defaults[Math.floor(Math.random()*defaults.length)];return"https://api.soundcloud.com/tracks/"+track+"/stream?client_id="+App.Config.SoundCloudClientId},SoundCloudAPI.PickTrack=function(t,n){switch(t){case 0:var defaults=App.Config.SoundCloudDefaultTracks;break;case 1:var defaults=App.Config.GranularDefaultTracks;break;case 2:var defaults=App.Config.ConvolverDefaultTracks;break;default:var defaults=App.Config.SoundCloudDefaultTracks}var track=defaults[n];return"https://api.soundcloud.com/tracks/"+track+"/stream?client_id="+App.Config.SoundCloudClientId},SoundCloudAPI.LoadTrack=function(track){var trackUrl=track.URI;return""+trackUrl+"/stream?client_id="+App.Config.SoundCloudClientId},SoundCloudAPI.Search=function(query,seconds,successResponse,failedResponse){window.SC?SC.get("/tracks",{q:query,duration:{to:seconds*1e3},limit:200,offset:0}).then(function(tracks){if(tracks){var tracksRemainAfterElimination=!1;tracks.forEach(function(track){track.streamable&&track.sharing==="public"&&(track.license.indexOf("all-rights-reserved")===-1||track.tag_list.toLowerCase().indexOf("blokdust")!==-1)&&(tracksRemainAfterElimination=!0,successResponse(track))});if(!tracksRemainAfterElimination){var err={status:452,message:App.L10n.Errors.SoundCloud.FailedTrackFiltering};console.error(err),failedResponse(err)}}},function(error){switch(error.status){case 429:App.Message(App.L10n.Errors.SoundCloud.TooManyRequests);break;case 500:App.Message(App.L10n.Errors.SoundCloud.InternalServerError);break;case 503:App.Message(App.L10n.Errors.SoundCloud.ServiceUnavailable);break;default:error.message?App.Message("SoundCloud error: "+error.message):App.Message("SoundCloud error, check console")}console.error(error),failedResponse(error)}):(App.Message(App.L10n.Errors.SoundCloud.Uninitialized),console.error(App.L10n.Errors.SoundCloud.Uninitialized))},SoundCloudAPI.Connect=function(){SC.connect().then(function(){return SC.get("/me")}).then(function(me){alert("Hello, "+me.username)},function(error){App.Message("SoundCloud couldn't connect: "+error.message),console.log(error.message,error.status)})},SoundCloudAPI.Upload=function(blob,title){SC.upload({file:blob,title:title,tag_list:"blokdust",license:"cc-by-nc",sharing:"public",progress:function(e){var percentCompleted=e.loaded/e.total*100;console.log(percentCompleted+"% completed")}}).then(function(track){alert("Upload is done! Check your sound at "+track.permalink_url)},function(error){console.error(error)})},SoundCloudAPI}();exports.SoundCloudAPI=SoundCloudAPI});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/AnimationsLayer",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,AnimationsLayer=function(_super){__extends(AnimationsLayer,_super);function AnimationsLayer(){_super.apply(this,arguments),this.ActiveBlocks=[],this.Loop=0,this.Spinning=!1}return AnimationsLayer.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo)},AnimationsLayer.prototype.Update=function(){_super.prototype.Update.call(this),this.Spinning&&(this.Loop+=1),this.Loop===60&&(this.Loop=0)},AnimationsLayer.prototype.Spin=function(){this.ActiveBlocks.length<1&&(this.Loop+=1),this.Loop===60&&(this.Loop=0)},AnimationsLayer.prototype.AddToList=function(block){this.RemoveFromList(block),this.ActiveBlocks.push(block)},AnimationsLayer.prototype.RemoveFromList=function(block){var b=this.ActiveBlocks.indexOf(block);b!=-1&&this.ActiveBlocks.splice(b,1)},AnimationsLayer.prototype.Draw=function(){if(this.ActiveBlocks.length>0){for(var i=0;i<this.ActiveBlocks.length;i++){var block=this.ActiveBlocks[i],blockPos=App.Metrics.PointOnGrid(block.Position);this.DrawBubble(blockPos.x,blockPos.y),this.DrawSprite(this.Ctx,"loading",blockPos.x,blockPos.y,6,!1)}this.Spinning=!0}},AnimationsLayer.prototype.DrawBubble=function(x,y){var grd=App.GridSize;App.FillColor(this.Ctx,App.Palette[2]),this.Ctx.globalAlpha=.95,this.Ctx.beginPath(),this.Ctx.moveTo(x-grd,y-2*grd),this.Ctx.lineTo(x,y-2*grd),this.Ctx.lineTo(x,y),this.Ctx.lineTo(x-grd,y-grd),this.Ctx.fill(),this.Ctx.globalAlpha=1},AnimationsLayer.prototype.DrawSprite=function(ctx,index,x,y,w,c){var units=App.Unit,grd=App.GridSize;c&&(grd=0),this.Spinning=!0,ctx.globalAlpha=1,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]);switch(index){case"loading":var angle=this.Loop/60*2*Math.PI,v1=App.Metrics.VectorFromAngle(angle+Math.PI*.25),v2=App.Metrics.VectorFromAngle(angle+Math.PI*.75),vx=x-.5*grd,vy=y-1.5*grd,r=w*.75*units;ctx.beginPath(),ctx.moveTo(vx+v1.x*r,vy+v1.y*r),ctx.lineTo(vx+v2.x*r,vy+v2.y*r),ctx.lineTo(vx-v1.x*r,vy-v1.y*r),ctx.lineTo(vx-v2.x*r,vy-v2.y*r),ctx.closePath(),ctx.fill()}},AnimationsLayer}(DisplayObject);exports.AnimationsLayer=AnimationsLayer});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/CreateNew",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,CreateNew=function(_super){__extends(CreateNew,_super);function CreateNew(){_super.apply(this,arguments)}return CreateNew.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo)},CreateNew.prototype.Draw=function(){var ctx=this.Ctx,units=App.Unit,midType=App.Metrics.TxtMid},CreateNew.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x}),offsetTween.onComplete(function(){v=="OffsetY"&&destination!==0&&(panel.Open=!1)}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick)},CreateNew.prototype.OpenPanel=function(){},CreateNew.prototype.ClosePanel=function(){},CreateNew.prototype.MouseDown=function(point){this.HitTests(point)},CreateNew.prototype.MouseUp=function(point){},CreateNew.prototype.MouseMove=function(point){this.HitTests(point)},CreateNew.prototype.HitTests=function(point){var ctx=this.Ctx,units=App.Unit},CreateNew}(DisplayObject);exports.CreateNew=CreateNew}),define("MathObjects/Line",["require","exports"],function(require,exports){var Line=function(){function Line(){this.Points=[]}return Line}();exports.Line=Line});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/ConnectionLines",["require","exports","../MathObjects/Line"],function(require,exports,Line_1){var DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,ConnectionLines=function(_super){__extends(ConnectionLines,_super);function ConnectionLines(){_super.apply(this,arguments)}return ConnectionLines.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.UpdateList()},ConnectionLines.prototype.Draw=function(){this.UpdateList();var grd=App.ScaledGridSize;App.StrokeColor(this.Ctx,App.Palette[15]),this.Ctx.lineWidth=1,this.Ctx.beginPath();for(var j=0;j<this._Unpowered.length;j++){var myPos=App.Metrics.PointOnGrid(this._Unpowered[j].Points[0]);this.Ctx.moveTo(myPos.x,myPos.y);for(var i=1;i<this._Unpowered[j].Points.length;i++){var myPos=App.Metrics.PointOnGrid(this._Unpowered[j].Points[i]);this.Ctx.lineTo(myPos.x,myPos.y)}}this.Ctx.stroke(),this.Ctx.lineWidth=2,this.Ctx.beginPath();for(var j=0;j<this._Powered.length;j++){var myPos=App.Metrics.PointOnGrid(this._Powered[j].Points[0]);this.Ctx.moveTo(myPos.x,myPos.y);for(var i=1;i<this._Powered[j].Points.length;i++){var myPos=App.Metrics.PointOnGrid(this._Powered[j].Points[i]);this.Ctx.lineTo(myPos.x,myPos.y)}}this.Ctx.stroke()},ConnectionLines.prototype.UpdateList=function(){this._Powered=[],this._Unpowered=[];for(var j=0;j<App.Sources.length;j++){var block=App.Sources[j];if(block.Connections.Count){var modifiers=block.Connections.ToArray(),grd=App.ScaledGridSize;for(var i=0;i<modifiers.length;i++){var target=modifiers[i],myPos=block.Position,targetPos=target.Position,myLine=new Line_1.Line,xDif=targetPos.x-myPos.x,yDif=targetPos.y-myPos.y;myLine.Points.push(new Point(myPos.x,myPos.y)),xDif>0&&(yDif<0&&(-yDif<xDif&&myLine.Points.push(new Point(Math.round(myPos.x+(xDif- -yDif)),Math.round(myPos.y))),-yDif>xDif&&myLine.Points.push(new Point(Math.round(myPos.x),Math.round(myPos.y-(-yDif-xDif))))),yDif>0&&(yDif<xDif&&myLine.Points.push(new Point(Math.round(myPos.x+(xDif-yDif)),Math.round(myPos.y))),yDif>xDif&&myLine.Points.push(new Point(Math.round(myPos.x),Math.round(myPos.y+(yDif-xDif)))))),xDif<0&&(yDif<0&&(yDif>xDif&&myLine.Points.push(new Point(Math.round(myPos.x-(yDif-xDif)),Math.round(myPos.y))),yDif<xDif&&myLine.Points.push(new Point(Math.round(myPos.x),Math.round(myPos.y-(xDif-yDif))))),yDif>0&&(yDif<-xDif&&myLine.Points.push(new Point(Math.round(myPos.x-(-xDif-yDif)),Math.round(myPos.y))),yDif>-xDif&&myLine.Points.push(new Point(Math.round(myPos.x),Math.round(myPos.y+(yDif- -xDif)))))),myLine.Points.push(new Point(targetPos.x,targetPos.y)),block.IsPowered()?this._Powered.push(myLine):this._Unpowered.push(myLine)}}}},ConnectionLines}(DisplayObject);exports.ConnectionLines=ConnectionLines}),define("UI/MenuCategory",["require","exports"],function(require,exports){var MenuCategory=function(){function MenuCategory(position,size,name,offset){this.Items=[],this.Position=position,this.Size=size,this.Name=name,this.Selected=0,this.Hover=!1,this.XOffset=0,this.YOffset=offset,this.CurrentPage=0}return MenuCategory.prototype.Draw=function(ctx,units,header,offset){ctx.globalAlpha=1;var dataType=units*10,thisHeight=Math.round(header.Height*units),dropDown=Math.round(header.DropDown*units),x=this.Position.x,width=this.Size.width*.5;ctx.beginPath(),ctx.moveTo(x-width,offset),ctx.lineTo(x+width,offset),ctx.lineTo(x+width,offset+thisHeight*this.Selected),ctx.lineTo(x+10*units,offset+thisHeight*this.Selected),ctx.lineTo(x,offset+(thisHeight+10*units)*this.Selected),ctx.lineTo(x-10*units,offset+thisHeight*this.Selected),ctx.lineTo(x-width,offset+thisHeight*this.Selected),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillText(this.Name,x,offset+thisHeight*.5+dataType*.38),this.Hover&&dropDown<1&&(App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=.9,ctx.beginPath(),ctx.moveTo(x-10*units,offset+thisHeight),ctx.lineTo(x,offset+thisHeight+10*units),ctx.lineTo(x+10*units,offset+thisHeight),ctx.closePath(),ctx.fill())},MenuCategory}();exports.MenuCategory=MenuCategory}),define("UI/MenuItem",["require","exports"],function(require,exports){var Point=etch.primitives.Point,MenuItem=function(){function MenuItem(position,size,name,id,description,sketch){this.Position=position,this.Size=size,this.Name=name,this.ID=id,this.Description=description,this.Selected=0,this.Hover=!1,this.InfoHover=!1,this.BackHover=!1,this.InfoOffset=0,this._MainScene=sketch,this.MouseIsDown=!1}return MenuItem.prototype.Draw=function(displayContext,units,x,y){this.Ctx=displayContext.Ctx,this.Ctx.globalAlpha=1;var y=this.Position.y-y*units-this.InfoOffset*units;App.FillColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(this.Ctx,App.Palette[App.ThemeManager.Txt]);var dataType=units*10;this.Ctx.textAlign="center",this.Ctx.font=App.Metrics.TxtMid,this.Ctx.fillText(this.Name,x,y+40*units),this.Ctx.lineWidth=1;var ix=x-40*units,iy=y-30*units,diamond=11;this.Ctx.beginPath(),this.Ctx.moveTo(ix-diamond*units,iy),this.Ctx.lineTo(ix,iy-diamond*units),this.Ctx.lineTo(ix+diamond*units,iy),this.Ctx.lineTo(ix,iy+diamond*units),this.Ctx.closePath(),this.Ctx.stroke(),this.Ctx.fillText("?",ix,iy+dataType*.38);if(this.InfoOffset!==0){this.Ctx.lineWidth=2;var ay=y+this.Size.height*1.5-30*units;this.Ctx.beginPath(),this.Ctx.moveTo(x-diamond*units,ay),this.Ctx.lineTo(x,ay+diamond*units),this.Ctx.lineTo(x+diamond*units,ay),this.Ctx.stroke(),this.Ctx.textAlign="left";var bodyType=units*7.5;this.Ctx.font=App.Metrics.TxtItalic,this.PrintAtWordWrap(this.Ctx,this.Description,x-this.Size.width*.5+10*units,y+this.Size.height-30*units,bodyType*1.5,this.Size.width-20*units),App.StrokeColor(this.Ctx,App.Palette[1]),this.Ctx.beginPath(),this.Ctx.moveTo(Math.round(x-this.Size.width*.5)+1,y+this.Size.height*.5+20*units),this.Ctx.lineTo(Math.round(x-this.Size.width*.5)+1,y+this.Size.height*1.5-20*units),this.Ctx.moveTo(Math.round(x+this.Size.width*.5)-1,y+this.Size.height*.5+20*units),this.Ctx.lineTo(Math.round(x+this.Size.width*.5)-1,y+this.Size.height*1.5-20*units),this.Ctx.stroke()}App.BlockSprites.DrawSprite(displayContext,new Point(x,y-7.5*units),!1,this.Name.toLowerCase())},MenuItem.prototype.PrintAtWordWrap=function(context,text,x,y,lineHeight,fitWidth){fitWidth=fitWidth||0;if(fitWidth<=0){context.fillText(text,x,y);return}var words=text.split(" "),currentLine=0,idx=1;while(words.length>0&&idx<=words.length){var str=words.slice(0,idx).join(" "),w=context.measureText(str).width;w>fitWidth?(idx==1&&(idx=2),context.fillText(words.slice(0,idx-1).join(" "),x,y+lineHeight*currentLine),currentLine++,words=words.splice(idx-1),idx=1):idx++}idx>0&&context.fillText(words.join(" "),x,y+lineHeight*currentLine)},MenuItem.prototype.MouseDown=function(point){this.MouseIsDown=!0,this.MousePoint=new Point(point.x,point.y)},MenuItem.prototype.MouseMove=function(point,header,cutoff){this.MouseIsDown&&this.InfoOffset==0&&(this.MousePoint=new Point(point.x,point.y),point.y>cutoff&&(header.ClosePanel(),this.MouseIsDown=!1,this._MainScene.CreateBlockFromType(this.ID)))},MenuItem.prototype.MouseUp=function(){this.MouseIsDown=!1},MenuItem}();exports.MenuItem=MenuItem});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Header",["require","exports","../Device","./MenuCategory","./MenuItem"],function(require,exports,Device_1,MenuCategory_1,MenuItem_1){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,Size=minerva.Size,Header=function(_super){__extends(Header,_super);function Header(){_super.apply(this,arguments),this.MenuItems=[]}return Header.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this._Units=1.7,this.Height=60,this._Rows=1,this.MenuItems=[],this.ItemsPerPage=App.Metrics.ItemsPerPage,this.DropDownHeight=App.Width/(this.ItemsPerPage+1)/App.Unit,this.DropDown=0,this._SelectedCategory=0,this._MenuCols=App.ThemeManager.MenuOrder,this.Margin=0,this._LeftOver=!1,this._RightOver=!1,this.MenuOver=!1,this.Tweens=[],this.MenuJson=App.BlockCreator.MenuJson,this.Populate(this.MenuJson)},Header.prototype.Populate=function(json){var units=App.Unit,dataType=units*10,gutter=60,menuCats=[];this._Rows=1,App.Metrics.Device===Device_1.Device.tablet&&(gutter=40),App.Metrics.Device===Device_1.Device.mobile&&(this._Rows=2),this.ItemsPerPage=App.Metrics.ItemsPerPage,this.DropDownHeight=this.DrawTo.Width/(this.ItemsPerPage+1)/units;var n=json.categories.length;this.Ctx.font="400 "+dataType+"px Dosis",this.Ctx.textAlign="left";var catWidth=[],menuWidth=0;for(var i=0;i<n;i++)catWidth[i]=this.Ctx.measureText(json.categories[i].name.toUpperCase()).width+gutter*units,menuWidth+=catWidth[i];var catX=this.DrawTo.Width*.5-menuWidth*.5,rowOffset=(this._Rows-1)*this.Height*units;for(var i=0;i<n;i++){var name=json.categories[i].name.toUpperCase(),point=new Point(catX+catWidth[i]*.5,rowOffset),size=new Size(catWidth[i],16);menuCats[i]=new MenuCategory_1.MenuCategory(point,size,name,this.DropDownHeight),catX+=catWidth[i];var itemN=json.categories[i].items.length;menuCats[i].Pages=Math.floor((itemN-1)/this.ItemsPerPage);for(var j=0;j<itemN;j++){var name=json.categories[i].items[j].name.toUpperCase(),id=json.categories[i].items[j].id,description="";json.categories[i].items[j].description&&(description=json.categories[i].items[j].description);var point=new Point(0,(this.Height+this.DropDownHeight*.5)*units+rowOffset),size=new Size(this.DropDownHeight*units,this.DropDownHeight*units);menuCats[i].Items.push(new MenuItem_1.MenuItem(point,size,name,id,description,this.DrawTo))}}this.MenuItems=menuCats,this.DelayTo(this,0,300,0,"DropDown")},Header.prototype.Draw=function(){_super.prototype.Draw.call(this);var units=App.Unit,dataType=units*10,headerType=Math.round(units*28),thisHeight=Math.round(this.Height*units),dropDown=Math.round(this.DropDown*units),rowOffset=(this._Rows-1)*this.Height*units;App.FillColor(this.Ctx,App.Palette[2]),this.Ctx.globalAlpha=.16,this.Ctx.fillRect(0,0,this.DrawTo.Width,thisHeight+5*units+dropDown+rowOffset),this.Ctx.globalAlpha=.9,this.Ctx.fillRect(0,0,this.DrawTo.Width,thisHeight+dropDown+rowOffset),this.Ctx.globalAlpha=1,App.FillColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),this.Ctx.font="200 "+headerType+"px Dosis",App.Metrics.Device===Device_1.Device.mobile?(this.Ctx.textAlign="center",this.Ctx.fillText("BLOKDUST",App.Width*.5,thisHeight*.5+headerType*.38)):(this.Ctx.textAlign="left",this.Ctx.fillText("BLOKDUST",20*units,thisHeight*.5+headerType*.38)),App.StrokeColor(this.Ctx,App.Palette[1]),this.Ctx.globalAlpha=1,dropDown>0&&(this.Ctx.beginPath(),this.Ctx.moveTo(20*units,thisHeight+rowOffset),this.Ctx.lineTo(this.DrawTo.Width-20*units,thisHeight+rowOffset),this.Ctx.stroke()),App.Metrics.Device===Device_1.Device.mobile&&(this.Ctx.beginPath(),this.Ctx.moveTo(20*units,thisHeight),this.Ctx.lineTo(this.DrawTo.Width-20*units,thisHeight),this.Ctx.stroke());var margin=this.DropDownHeight*.5;this.Ctx.beginPath();for(var i=0;i<this.MenuItems.length;i++){var cat=this.MenuItems[i],menuX=cat.Position.x;i>0&&(this.Ctx.moveTo(Math.round(menuX-cat.Size.width*.5),rowOffset+thisHeight*.5-16*units),this.Ctx.lineTo(Math.round(menuX-cat.Size.width*.5),rowOffset+thisHeight*.5+16*units))}this.Ctx.moveTo(Math.round(this.DrawTo.Width-margin*units),thisHeight*.5-16*units),this.Ctx.lineTo(Math.round(this.DrawTo.Width-margin*units),thisHeight*.5+16*units),this.Ctx.stroke(),this.Ctx.textAlign="center",this.Ctx.font="400 "+dataType+"px Dosis";for(var i=0;i<this.MenuItems.length;i++){this.Ctx.globalAlpha=1,cat=this.MenuItems[i];var col=this._MenuCols[i-Math.floor(i/this._MenuCols.length)*this._MenuCols.length];App.FillColor(this.Ctx,App.Palette[col]),cat.Draw(this.Ctx,units,this,rowOffset);if(this.DropDown>0&&cat.YOffset<this.DropDownHeight){var itemN=cat.Items.length;margin=20+this.Margin*.666,this.Ctx.lineWidth=1;var clipHeight=this.DropDown-cat.YOffset;clipHeight<0&&(clipHeight=0),this.Ctx.save(),this.Ctx.beginPath(),this.Ctx.moveTo(Math.floor(margin*units),this.Height*units+rowOffset),this.Ctx.lineTo(Math.ceil(this.DrawTo.Width-margin*units),this.Height*units+rowOffset),this.Ctx.lineTo(Math.ceil(this.DrawTo.Width-margin*units),(this.Height+clipHeight)*units+rowOffset),this.Ctx.lineTo(Math.floor(margin*units),(this.Height+clipHeight)*units+rowOffset),this.Ctx.closePath(),this.Ctx.clip();for(var j=0;j<itemN;j++){var xPos=(margin+this.DropDownHeight*.5+this.DropDownHeight*j+cat.XOffset)*units,yPos=cat.YOffset;cat.Items[j].Position.x=xPos,xPos>0&&xPos<this.DrawTo.Width&&cat.Items[j].Draw(this,units,xPos,yPos)}this.Ctx.restore();for(var j=0;j<itemN;j++)cat.Items[j].MouseIsDown&&cat.Items[j].InfoOffset==0&&(this.Ctx.globalAlpha=.5,App.BlockSprites.DrawSprite(this,cat.Items[j].MousePoint,!1,cat.Items[j].Name.toLowerCase()))}}if(this.DropDown>0){var cat=this.MenuItems[this._SelectedCategory];margin=this.Margin,App.StrokeColor(this.Ctx,App.Palette[1]),this.Ctx.lineWidth=2,this.Ctx.save(),this.Ctx.beginPath(),this.Ctx.moveTo(0,this.Height*units+rowOffset),this.Ctx.lineTo(this.DrawTo.Width,this.Height*units+rowOffset),this.Ctx.lineTo(this.DrawTo.Width,(this.Height+this.DropDown)*units+rowOffset),this.Ctx.lineTo(0,(this.Height+this.DropDown)*units+rowOffset),this.Ctx.closePath(),this.Ctx.clip(),App.StrokeColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),cat.CurrentPage==0&&App.StrokeColor(this.Ctx,App.Palette[1]),this.Ctx.beginPath(),this.Ctx.moveTo(margin*units-20*units,(this.Height+this.DropDown*.5-20)*units+rowOffset),this.Ctx.lineTo(margin*units-40*units,(this.Height+this.DropDown*.5)*units+rowOffset),this.Ctx.lineTo(margin*units-20*units,(this.Height+this.DropDown*.5+20)*units+rowOffset),this.Ctx.stroke(),App.StrokeColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),cat.CurrentPage==cat.Pages&&App.StrokeColor(this.Ctx,App.Palette[1]),this.Ctx.beginPath(),this.Ctx.moveTo(this.DrawTo.Width-margin*units+20*units,(this.Height+this.DropDown*.5-20)*units+rowOffset),this.Ctx.lineTo(this.DrawTo.Width-margin*units+40*units,(this.Height+this.DropDown*.5)*units+rowOffset),this.Ctx.lineTo(this.DrawTo.Width-margin*units+20*units,(this.Height+this.DropDown*.5+20)*units+rowOffset),this.Ctx.stroke(),this.Ctx.restore()}var btnWidth=this.Ctx.measureText("SHARE").width+40*units;App.FillColor(this.Ctx,App.Palette[2]),this.Ctx.globalAlpha=.9;if(this._ShareOver){var shx=this.DrawTo.Width-margin*units-btnWidth*.5;this.Ctx.beginPath(),this.Ctx.moveTo(shx-10*units,this.Height*units),this.Ctx.lineTo(shx,(this.Height+10)*units),this.Ctx.lineTo(shx+10*units,this.Height*units),this.Ctx.closePath(),this.Ctx.fill()}if(this._SettingsOver){var shx=this.DrawTo.Width-margin*units+30*units;this.Ctx.beginPath(),this.Ctx.moveTo(shx-10*units,this.Height*units),this.Ctx.lineTo(shx,(this.Height+10)*units),this.Ctx.lineTo(shx+10*units,this.Height*units),this.Ctx.closePath(),this.Ctx.fill()}this.Ctx.globalAlpha=1,margin=this.DropDownHeight*.5,App.FillColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),this.Ctx.lineWidth=2,this.Ctx.beginPath(),this.Ctx.moveTo(this.DrawTo.Width-margin*units+20*units,(this.Height*.5-1)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units+26.6*units,(this.Height*.5-7)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units+33.2*units,(this.Height*.5-1)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units+40*units,(this.Height*.5-7)*units),this.Ctx.moveTo(this.DrawTo.Width-margin*units+20*units,(this.Height*.5+7)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units+26.6*units,(this.Height*.5+1)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units+33.2*units,(this.Height*.5+7)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units+40*units,(this.Height*.5+1)*units),this.Ctx.moveTo(this.DrawTo.Width-margin*units-btnWidth*.5-5*units,(this.Height*.75-6)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units-btnWidth*.5,(this.Height*.75-1)*units),this.Ctx.lineTo(this.DrawTo.Width-margin*units-btnWidth*.5+5*units,(this.Height*.75-6)*units),this.Ctx.stroke(),this.Ctx.textAlign="right",this.Ctx.fillText("SHARE",this.DrawTo.Width-margin*units-20*units,this.Height*.5*units+dataType*.38),this.Ctx.textAlign="center"},Header.prototype.IsPaginated=function(cat,units){var itemN=cat.Items.length;return itemN>this.ItemsPerPage},Header.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick),this.Tweens.push(offsetTween)},Header.prototype.StopAllTweens=function(){if(this.Tweens.length){for(var j=0;j<this.Tweens.length;j++)this.Tweens[j].stop();this.Tweens=[]}},Header.prototype.MouseDown=function(point){this.HitTests(point);var units=App.Unit;for(var i=0;i<this.MenuItems.length;i++)if(this.MenuItems[i].Hover&&!(this._SelectedCategory==i&&this.DropDown>0)){this.StopAllTweens(),this.CloseOptions();var cat=this.MenuItems[i];for(var j=0;j<cat.Items.length;j++)cat.Items[j].InfoOffset=0;this.DelayTo(this,this.DropDownHeight,500,0,"DropDown"),this.DelayTo(cat,1,400,0,"Selected"),this.DelayTo(cat,0,600,250,"YOffset"),this.IsPaginated(cat,units)?this.DelayTo(this,this.DropDownHeight*.5,600,50,"Margin"):this.DelayTo(this,0,600,50,"Margin"),this._SelectedCategory=i;for(var j=0;j<this.MenuItems.length;j++)if(j!==i){var cat=this.MenuItems[j];this.DelayTo(cat,0,250,0,"Selected"),this.DelayTo(cat,this.DropDownHeight,250,0,"YOffset")}}if(this.DropDown>0&&!this._LeftOver&&!this._RightOver){var cat=this.MenuItems[this._SelectedCategory];for(var i=0;i<cat.Items.length;i++){var item=cat.Items[i];if(item.InfoOffset==0)if(item.InfoHover){this.DelayTo(item,this.DropDownHeight,350,0,"InfoOffset");for(var j=0;j<cat.Items.length;j++)i!==j&&this.DelayTo(cat.Items[j],0,350,0,"InfoOffset")}else cat.Items[i].Hover&&item.MouseDown(point);else cat.Items[i].BackHover&&this.DelayTo(item,0,350,0,"InfoOffset")}}if(this._LeftOver){var cat=this.MenuItems[this._SelectedCategory];cat.CurrentPage>0&&(cat.CurrentPage-=1,this.DelayTo(cat,-(this.ItemsPerPage*cat.CurrentPage*this.DropDownHeight),500,0,"XOffset"))}if(this._RightOver){var cat=this.MenuItems[this._SelectedCategory];cat.CurrentPage<cat.Pages&&(cat.CurrentPage+=1,this.DelayTo(cat,-(this.ItemsPerPage*cat.CurrentPage*this.DropDownHeight),500,0,"XOffset"))}this._ShareOver&&(this.CloseOptions(),App.MainScene.SharePanel.OpenPanel()),this._SettingsOver&&(this.CloseOptions(),App.MainScene.SettingsPanel.OpenPanel()),!this.MenuOver&&this.DropDown>0&&this.ClosePanel()},Header.prototype.ClosePanel=function(){this.StopAllTweens(),this.DelayTo(this,0,300,0,"DropDown"),this.DelayTo(this,0,600,50,"Margin");for(var i=0;i<this.MenuItems.length;i++)this.DelayTo(this.MenuItems[i],0,250,0,"Selected"),this.DelayTo(this.MenuItems[i],this.DropDownHeight,250,0,"YOffset")},Header.prototype.CloseOptions=function(){App.MainScene.OptionsPanel.Scale>0&&App.MainScene.OptionsPanel.Close()},Header.prototype.MouseMove=function(point){this.HitTests(point)},Header.prototype.HitTests=function(point){var units=App.Unit,grd=App.GridSize,rowOffset=(this._Rows-1)*this.Height*units;for(var i=0;i<this.MenuItems.length;i++){var cat=this.MenuItems[i];cat.Hover=Dimensions.HitRect(cat.Position.x-cat.Size.width*.5+2*units,rowOffset+5*units,cat.Size.width-4*units,this.Height*units-10*units,point.x,point.y);if(this._SelectedCategory==i)for(var j=0;j<cat.Items.length;j++){var item=cat.Items[j];item.Hover=Dimensions.HitRect(item.Position.x-2*grd,item.Position.y-2*grd,4*grd,4*grd,point.x,point.y),item.InfoHover=Dimensions.HitRect(item.Position.x-52*units,item.Position.y-42*units,24*units,24*units,point.x,point.y),item.BackHover=Dimensions.HitRect(item.Position.x-this.DropDownHeight*.5*units,item.Position.y-this.DropDownHeight*.5*units,this.DropDownHeight*units,this.DropDownHeight*units,point.x,point.y),item.MouseMove(point,this,(this.Height+this.DropDown-20)*units)}}this._LeftOver=Dimensions.HitRect(0,(this.Height+20)*units+rowOffset,this.Margin*units,(this.DropDown-40)*units,point.x,point.y),this._RightOver=Dimensions.HitRect(this.DrawTo.Width-this.Margin*units,(this.Height+20)*units+rowOffset,this.Margin*units,(this.DropDown-40)*units,point.x,point.y),this.Ctx.font="400 "+units*10+"px Dosis";var btnWidth=this.Ctx.measureText("SHARE").width+40*units;this._ShareOver=Dimensions.HitRect(this.DrawTo.Width-this.DropDownHeight*.5*units-btnWidth,5*units,btnWidth,this.Height*units-10*units,point.x,point.y),this._SettingsOver=Dimensions.HitRect(this.DrawTo.Width-this.DropDownHeight*.5*units,5*units,this.DropDownHeight*.5*units,this.Height*units-10*units,point.x,point.y),this.MenuOver=point.y<(this.Height+this.DropDown)*units+rowOffset},Header.prototype.MouseUp=function(){var cat=this.MenuItems[this._SelectedCategory];for(var i=0;i<cat.Items.length;i++)cat.Items[i].MouseUp()},Header}(DisplayObject);exports.Header=Header});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/Laser",["require","exports","./PowerSource"],function(require,exports,PowerSource_1){var Point=etch.primitives.Point,Laser=function(_super){__extends(Laser,_super);function Laser(){_super.apply(this,arguments)}return Laser.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Power.Blocks.Laser.name,this.Defaults={angle:-90,range:400,rotate:0,selfPoweredMode:!1},this.PopulateParams(),this.UpdateCollision=!0,this.Collisions=[],this.CheckRange=this.Params.range,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(1,-1),new Point(1,0),new Point(0,1),new Point(-1,0))},Laser.prototype.UpdateConnections=function(){this.UpdateCollision=!0},Laser.prototype.Update=function(){_super.prototype.Update.call(this),this.IsPowered()&&Math.round(this.Params.rotate)!==0&&(this.UpdateCollision=!0,this.Params.angle+=this.Params.rotate/100,this.Params.angle>90&&(this.Params.angle-=360),this.Params.angle<-270&&(this.Params.angle+=360))},Laser.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Laser.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Laser",updateeveryframe:!0,parameters:[{type:"slider",name:"Angle",setting:"angle",props:{value:this.Params.angle+90,min:-180,max:180,quantised:!0,centered:!0}},{type:"slider",name:"Rotate",setting:"rotate",props:{value:this.Params.rotate,min:-500,max:500,quantised:!0,centered:!0,snap:!0}},{type:"slider",name:"Range",setting:"range",props:{value:this.Params.range,min:50,max:1200,quantised:!0,centered:!1}}]}},Laser.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="angle"&&(val=value-90);if(param=="angle"||param=="range")this.UpdateCollision=!0;this.Params[""+param]=val,this.CheckRange=this.Params.range},Laser}(PowerSource_1.PowerSource);exports.Laser=Laser});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("LaserBeams",["require","exports","./Blocks/Power/Laser","./Blocks/Power/Logic/Logic","./Blocks/Source","./Blocks/Power/Void"],function(require,exports,Laser_1,Logic_1,Source_1,Void_1){var Vector=Utils.Maths.Vector,DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,LaserBeams=function(_super){__extends(LaserBeams,_super);function LaserBeams(){_super.apply(this,arguments)}return LaserBeams.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.UpdateAllLasers=!1},LaserBeams.prototype.Update=function(){this.UpdateCollisions()},LaserBeams.prototype.QuadPartition=function(p1,p2,angle){var margin=App.ScaledGridSize*1.7,laser=p1,target=p2;return angle<0&&angle>-180&&target.y>laser.y+margin?!1:(angle>0||angle<-180)&&target.y<laser.y-margin?!1:angle<=-90&&target.x>laser.x+margin?!1:angle>-90&&target.x<laser.x-margin?!1:!0},LaserBeams.prototype.PointFromLine=function(x,y,x0,y0,x1,y1,o){function lineLength(x,y,x0,y0){return Math.sqrt((x-=x0)*x+(y-=y0)*y)}if(o&&!(o=function(x,y,x0,y0,x1,y1){if(!(x1-x0))return{x:x0,y:y};if(!(y1-y0))return{x:x,y:y0};var left,tg=-1/((y1-y0)/(x1-x0));return{x:left=(x1*(x*tg-y+y0)+x0*(x*-tg+y-y1))/(tg*(x1-x0)+y0-y1),y:tg*left-tg*x+y}}(x,y,x0,y0,x1,y1),o.x>=Math.min(x0,x1)&&o.x<=Math.max(x0,x1)&&o.y>=Math.min(y0,y1)&&o.y<=Math.max(y0,y1))){var l1=lineLength(x,y,x0,y0),l2=lineLength(x,y,x1,y1);return l1>l2?l2:l1}var a=y0-y1,b=x1-x0,c=x0*y1-y0*x1;return Math.abs(a*x+b*y+c)/Math.sqrt(a*a+b*b)},LaserBeams.prototype.PointFromPoint=function(x,y,x0,y0){return Math.sqrt((x-=x0)*x+(y-=y0)*y)},LaserBeams.prototype.UpdateCollisions=function(){if(App.Audio.ConnectionManager.IsConnected){var p1,p2,vector,line,outline,rectSize=1.7,grd=App.ScaledGridSize*rectSize,voidlist=[],sourcelist=[],laserlist=[],checklist=[];for(var i=0;i<App.Blocks.length;i++){var block=App.Blocks[i];block instanceof Void_1.Void&&voidlist.push(block),(block instanceof Source_1.Source||block instanceof Logic_1.Logic)&&sourcelist.push(block),block instanceof Laser_1.Laser&&laserlist.push(block),checklist=voidlist.concat(sourcelist)}for(var i=0;i<laserlist.length;i++){var laser=laserlist[i];this.UpdateAllLasers&&(laser.UpdateCollision=!0);if(laser.UpdateCollision){laser.UpdateCollision=!1,laser.CheckRange=laser.Params.range;var collisions=[];if(laser.Params.selfPoweredMode||laser.IsPowered()){vector=Vector.MultN(Vector.FromAngle(Math.degreesToRadians(laser.Params.angle)),App.ScaledUnit),line=Vector.MultN(vector,laser.CheckRange);for(var j=0;j<checklist.length;j++){var block=checklist[j];if(block!==laser){outline=[],p1=App.Metrics.PointOnGrid(laser.Position),p2=App.Metrics.PointOnGrid(block.Position);if(this.PointFromPoint(p1.x,p1.y,p2.x,p2.y)<laser.CheckRange*App.ScaledUnit+grd&&this.QuadPartition(p1,p2,laser.Params.angle)&&this.PointFromLine(p2.x,p2.y,p1.x,p1.y,p1.x+line.X,p1.y+line.Y,!1)<grd){for(var k=0;k<block.Outline.length;k++)outline.push(App.Metrics.PointOnGrid(App.Metrics.GetRelativePoint(block.Outline[k],block.Position)));p2=new Point(p1.x+line.X,p1.y+line.Y);var intersection=Intersection.intersectLinePolygon(p1,p2,outline);if(intersection.status=="Intersection")if(block instanceof Void_1.Void){var intersect=intersection.points;for(var h=0;h<intersect.length;h++){var dist=this.PointFromPoint(p1.x,p1.y,intersect[h].x,intersect[h].y)/App.ScaledUnit;dist<laser.CheckRange&&(laser.CheckRange=dist)}}else{collisions.push(block);if(laser.Collisions.length==0||$.inArray(block,laser.Collisions)==-1)block instanceof Logic_1.Logic?block.ScheduleLogic():(block.IsPowered()||block.TriggerAttack(),block.AddPower(),this.DrawTo.ConnectionLines.UpdateList())}}}}}if(laser.Collisions&&laser.Collisions.length)for(var j=0;j<laser.Collisions.length;j++){var block=laser.Collisions[j];if(collisions.length==0||$.inArray(block,collisions)==-1)block instanceof Logic_1.Logic||(block.RemovePower(),this.DrawTo.ConnectionLines.UpdateList())}laser.Collisions=collisions}}this.UpdateAllLasers=!1}},LaserBeams.prototype.Draw=function(){var unit=App.ScaledUnit,myPos,vector;App.FillColor(this.Ctx,App.Palette[8]),App.StrokeColor(this.Ctx,App.Palette[8]),this.Ctx.globalAlpha=1,this.Ctx.lineWidth=unit*2*(.8+Math.random()*.5),this.Ctx.beginPath();for(var j=0;j<App.Sources.length;j++){var laser=App.Sources[j];laser instanceof Laser_1.Laser&&(laser.Params.selfPoweredMode||laser.IsPowered())&&(myPos=App.Metrics.PointOnGrid(laser.Position),vector=Vector.FromAngle(Math.degreesToRadians(laser.Params.angle)),vector.Mult(laser.CheckRange*unit),this.Ctx.moveTo(myPos.x,myPos.y),this.Ctx.lineTo(myPos.x+vector.X,myPos.y+vector.Y))}this.Ctx.stroke(),this.Ctx.lineWidth=1},LaserBeams}(DisplayObject);exports.LaserBeams=LaserBeams});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/MessagePanel",["require","exports"],function(require,exports){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,MessagePanel=function(_super){__extends(MessagePanel,_super);function MessagePanel(){_super.apply(this,arguments)}return MessagePanel.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this._Roll=[],this.Hover=!1,this.Open=!1,this._CloseX=0,this._Defaults={string:"Message Text Missing...",seconds:3,confirmation:!1,buttonText:"",buttonEvent:this.DefaultFunction},this._Value={string:this._Defaults.string,seconds:this._Defaults.seconds,confirmation:this._Defaults.confirmation,buttonText:this._Defaults.buttonText,buttonEvent:this._Defaults.buttonEvent}},MessagePanel.prototype.Draw=function(){var units=App.Unit,ctx=this.Ctx,midType=App.Metrics.TxtMid,y=this.DrawTo.Height*.75,cx=this.DrawTo.Width*.5,w=this.DrawTo.Width;if(this._Alpha>0){ctx.textAlign="center",ctx.font=midType;var clx=this._CloseX;App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=this._Alpha*.16,ctx.fillRect(0,y-25*units,w,60*units),ctx.globalAlpha=this._Alpha*.9,ctx.fillRect(0,y-30*units,w,60*units),ctx.globalAlpha=this._Alpha,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillText(this._Value.string.toUpperCase(),cx,y+5*units),this._Value.confirmation&&(App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=this._Alpha*.9,ctx.beginPath(),ctx.moveTo(clx-20*units,y-30*units),ctx.lineTo(clx+20*units,y-30*units),ctx.lineTo(clx,y-50*units),ctx.closePath(),ctx.fill(),ctx.globalAlpha=this._Alpha,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(clx-4*units,y-34*units),ctx.lineTo(clx+4*units,y-26*units),ctx.moveTo(clx-4*units,y-26*units),ctx.lineTo(clx+4*units,y-34*units),ctx.stroke(),ctx.lineWidth=1),this._Value.buttonText!==""&&(App.FillColor(ctx,App.Palette[4]),ctx.fillRect(clx,y-15*units,this._ButtonWidth,30*units),this._Roll[1]&&(ctx.beginPath(),ctx.moveTo(clx+this._ButtonWidth*.5-10*units,y+15*units-1),ctx.lineTo(clx+this._ButtonWidth*.5+10*units,y+15*units-1),ctx.lineTo(clx+this._ButtonWidth*.5,y+25*units-1),ctx.closePath(),ctx.fill()),ctx.textAlign="left",App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillText(this._Value.buttonText.toUpperCase(),clx+10*units,y+5*units))}},MessagePanel.prototype.NewMessage=function(string,options){options=options||{},this._Value.string=string||this._Defaults.string,this._Value.seconds=options.seconds||this._Defaults.seconds,this._Value.confirmation=options.confirmation||this._Defaults.confirmation,this._Value.buttonText=options.buttonText||this._Defaults.buttonText,this._Value.buttonEvent=options.buttonEvent||this._Defaults.buttonEvent,this._Value.buttonText!==""&&(this._Value.confirmation=!0);if(this._Value.confirmation){var units=App.Unit,ctx=this.Ctx,midType=App.Metrics.TxtMid,cx=this.DrawTo.Width*.5;ctx.font=midType,this._CloseX=cx+20*units+ctx.measureText(this._Value.string.toUpperCase()).width*.5,this._ButtonWidth=20*units+ctx.measureText(this._Value.buttonText.toUpperCase()).width}this.Open||(this.Tween(this,"_Alpha",1,0,400),this.Open=!0),clearTimeout(this._Timeout);var message=this;this._Timeout=setTimeout(function(){message._Value.confirmation||message.Close()},this._Value.seconds*1e3)},MessagePanel.prototype.Close=function(){this.Tween(this,"_Alpha",0,0,1e3),this.Hover=!1,this.Open=!1},MessagePanel.prototype.DefaultFunction=function(){console.log("default function")},MessagePanel.prototype.Tween=function(panel,value,destination,delay,time){var pTween=new window.TWEEN.Tween({x:panel[""+value]});pTween.to({x:destination},time),pTween.onUpdate(function(){panel[""+value]=this.x}),pTween.delay(delay),pTween.start(this.LastVisualTick),pTween.easing(window.TWEEN.Easing.Quintic.InOut)},MessagePanel.prototype.MouseDown=function(point){this.RolloverCheck(point),this.Open&&this._Roll[0]&&this.Close(),this.Open&&this._Roll[1]&&(this._Value.buttonEvent(),this.Close())},MessagePanel.prototype.MouseMove=function(point){this.RolloverCheck(point)},MessagePanel.prototype.RolloverCheck=function(point){this.Hover=!1;var units=App.Unit;this._Value.confirmation?this._Roll[0]=Dimensions.HitRect(this._CloseX-20*units,this.DrawTo.Height*.75-50*units,40*units,40*units,point.x,point.y):this._Roll[0]=!1,this._Value.buttonText!==""?this._Roll[1]=Dimensions.HitRect(this._CloseX,this.DrawTo.Height*.75-15*units,this._ButtonWidth,30*units,point.x,point.y):this._Roll[1]=!1;if(this._Roll[0]||this._Roll[1])this.Hover=!0},MessagePanel}(DisplayObject);exports.MessagePanel=MessagePanel}),define("UI/Options/Option",["require","exports"],function(require,exports){var Point=etch.primitives.Point,Option=function(){function Option(){}return Option.prototype.Draw=function(ctx,units,i,panel,yoveride){},Option.prototype.PlotGraph=function(){},Option.prototype.MonitorReset=function(){},Option.prototype.DiagonalFill=function(ctx,x,y,w,h,s){var pr=App.Metrics.PixelRatio;s*=pr;var lineNo=Math.round((w+h)/s),pos1=new Point(0,0),pos2=new Point(0,0);ctx.beginPath();for(var j=0;j<lineNo;j++)pos1.x=s*.5+s*j,pos1.y=0,pos2.x=pos1.x-h,pos2.y=h,pos2.x<0&&(pos2.y=h+pos2.x,pos2.x=0),pos1.x>w&&(pos1.y=pos1.x-w,pos1.x=w),ctx.moveTo(x+pos1.x,y+pos1.y),ctx.lineTo(x+pos2.x,y+pos2.y);ctx.stroke()},Option}();exports.Option=Option});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionADSR",["require","exports","./Option"],function(require,exports,Option_1){var ADSR=function(_super){__extends(ADSR,_super);function ADSR(position,size,name,handle0,handle1,handle2){_super.call(this),this.Type="ADSR",this.Position=position,this.Size=size,this.Name=name,this.Handles=[],this._Node=[],this.EValue=[],this.EMin=[],this.EMax=[],this.EPerc=[],this.HandleRoll=[],this.Handles[0]=handle0,this.Handles[1]=handle1,this.Handles[2]=handle2}return ADSR.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel);var a=this.Handles[0].Position.x,d=this.Handles[1].Position.x,s=this.Handles[1].Position.y,r=this.Handles[2].Position.x,y=this.Position.y,height=this.Size.height;ctx.globalAlpha=1;var vert=.6;App.StrokeColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height*.1),ctx.lineTo(panel.Margin-units,y+height*.9),ctx.moveTo(panel.Range*vert+panel.Margin+units,y+height*.1),ctx.lineTo(panel.Range*vert+panel.Margin+units,y+height*.9),ctx.moveTo(panel.Range+panel.Margin+units,y+height*.1),ctx.lineTo(panel.Range+panel.Margin+units,y+height*.9),ctx.stroke(),ctx.save(),ctx.beginPath(),ctx.moveTo(panel.Margin,y+height*.9),ctx.lineTo(panel.Margin+a,y+height*.1),ctx.lineTo(panel.Margin+a+d,y+height*.9-s),ctx.lineTo(panel.Margin+panel.Range*vert,y+height*.9-s),ctx.lineTo(panel.Margin+panel.Range*vert+r,y+height*.9),ctx.lineTo(panel.Range+panel.Margin+units,y+height*.9),ctx.closePath(),ctx.clip(),panel.diagonalFill(panel.Margin-units,y+units,panel.Range+2*units,height-2*units,9),ctx.restore(),ctx.lineWidth=2,ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(panel.Margin,y+height*.9),ctx.lineTo(panel.Margin+a,y+height*.1),ctx.lineTo(panel.Margin+a+d,y+height*.9-s),ctx.lineTo(panel.Margin+panel.Range*vert,y+height*.9-s),ctx.lineTo(panel.Margin+panel.Range*vert+r,y+height*.9),ctx.lineTo(panel.Range+panel.Margin+units,y+height*.9),ctx.stroke(),ctx.lineWidth=1;var dragWidth=height*.06;App.FillColor(ctx,App.Palette[3]),ctx.beginPath(),ctx.moveTo(a+panel.Margin-dragWidth,y+height*.1),ctx.lineTo(a+panel.Margin,y+height*.1-dragWidth),ctx.lineTo(a+panel.Margin+dragWidth,y+height*.1),ctx.lineTo(a+panel.Margin,y+height*.1+dragWidth),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[4]),ctx.beginPath(),ctx.moveTo(a+d+panel.Margin-dragWidth,y+height*.9-s),ctx.lineTo(a+d+panel.Margin,y+height*.9-dragWidth-s),ctx.lineTo(a+d+panel.Margin+dragWidth,y+height*.9-s),ctx.lineTo(a+d+panel.Margin,y+height*.9+dragWidth-s),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[5]),ctx.beginPath(),ctx.moveTo(panel.Range*vert+r+panel.Margin-dragWidth,y+height*.9),ctx.lineTo(panel.Range*vert+r+panel.Margin,y+height*.9-dragWidth),ctx.lineTo(panel.Range*vert+r+panel.Margin+dragWidth,y+height*.9),ctx.lineTo(panel.Range*vert+r+panel.Margin,y+height*.9+dragWidth),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[8]),ctx.beginPath(),ctx.moveTo(a+panel.Margin-dragWidth,y+height*.1),ctx.lineTo(a+panel.Margin,y+height*.1-dragWidth),ctx.lineTo(a+panel.Margin+dragWidth*.5,y+height*.1-dragWidth*.5),ctx.lineTo(a+panel.Margin-dragWidth*.5,y+height*.1+dragWidth*.5),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(a+d+panel.Margin-dragWidth,y+height*.9-s),ctx.lineTo(a+d+panel.Margin,y+height*.9-dragWidth-s),ctx.lineTo(a+d+panel.Margin+dragWidth*.5,y+height*.9-s-dragWidth*.5),ctx.lineTo(a+d+panel.Margin-dragWidth*.5,y+height*.9-s+dragWidth*.5),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(panel.Range*vert+r+panel.Margin-dragWidth,y+height*.9),ctx.lineTo(panel.Range*vert+r+panel.Margin,y+height*.9-dragWidth),ctx.lineTo(panel.Range*vert+r+panel.Margin+dragWidth*.5,y+height*.9-dragWidth*.5),ctx.lineTo(panel.Range*vert+r+panel.Margin-dragWidth*.5,y+height*.9+dragWidth*.5),ctx.closePath(),ctx.fill()},ADSR}(Option_1.Option);exports.ADSR=ADSR});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionButtonArray",["require","exports","./Option"],function(require,exports,Option_1){var ButtonArray=function(_super){__extends(ButtonArray,_super);function ButtonArray(position,size,name,setting,buttons,mode){_super.call(this),this.Type="buttons",this.Position=position,this.Size=size,this.Name=name,this.Setting=setting,this.Buttons=buttons,this.ButtonMode=mode,this.HandleRoll=[]}return ButtonArray.prototype.Draw=function(ctx,units,i,panel){var x=this.Position.x,y=this.Position.y,height=this.Size.height,midType=Math.round(units*10);App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke());for(var j=0;j<this.Buttons.length;j++){if(j>0){App.StrokeColor(ctx,App.Palette[1]);var bx=panel.Margin+this.Buttons[j].Position.x;ctx.beginPath(),ctx.moveTo(Math.round(x+bx),y+height*.15),ctx.lineTo(Math.round(x+bx),y+height*.85),ctx.closePath(),ctx.stroke()}this.Buttons[j].Draw(ctx,panel,units,panel.Margin,height,i,this.ButtonMode)}App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+midType*.4)},ButtonArray}(Option_1.Option);exports.ButtonArray=ButtonArray});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionActionButton",["require","exports","./Option"],function(require,exports,Option_1){var OptionActionButton=function(_super){__extends(OptionActionButton,_super);function OptionActionButton(position,size,name,text,setting){_super.call(this),this.Type="actionbutton",this.Position=position,this.Size=size,this.Name=name,this._Text=text,this.Setting=setting,this.HandleRoll=[]}return OptionActionButton.prototype.Draw=function(ctx,units,i,panel,yoveride){_super.prototype.Draw.call(this,ctx,units,i,panel);var x=this.Position.x,y=this.Position.y;yoveride&&(y=yoveride);var height=this.Size.height,origin=this.Origin,dataType=Math.round(units*10),headerType=Math.round(units*33);ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke());var col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length];App.FillColor(ctx,col),ctx.fillRect(panel.Margin+panel.Range*.25,y+height*.2,panel.Range*.5,height*.6),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+dataType*.4),ctx.textAlign="center",ctx.fillText(this._Text.toUpperCase(),panel.Margin+panel.Range*.5,y+height*.5+dataType*.4)},OptionActionButton}(Option_1.Option);exports.OptionActionButton=OptionActionButton}),define("UI/Options/OptionButton",["require","exports"],function(require,exports){var OptionButton=function(){function OptionButton(position,name,selected,value,size){this.Position=position,this.Name=name,this.Value=value,this.Selected=selected,this.Size=size}return OptionButton.prototype.Draw=function(ctx,panel,units,x,h,i,mode){x+=this.Position.x;var y=this.Position.y,w=this.Size.width;ctx.lineWidth=2,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]);var col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length];App.FillColor(ctx,col),this.Selected?ctx.fillRect(x+w*.4,y+h*.8,w*.2,h*.05):this.Value>0,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]);if(mode=="string")ctx.font=App.Metrics.TxtMid,ctx.textAlign="center",ctx.fillText(this.Name.toUpperCase(),x+w*.5,y+h*.5+units*4);else if(mode=="wave"){var cx=x+w*.5,cy=y+h*.5;ctx.beginPath();switch(this.Value){case 0:ctx.moveTo(cx-10*units,cy-5*units),ctx.bezierCurveTo(cx+2.5*units,cy-5*units,cx-2.5*units,cy+5*units,cx+10*units,cy+5*units);break;case 1:ctx.moveTo(cx-10*units,cy-5*units),ctx.lineTo(cx,cy-5*units),ctx.lineTo(cx,cy+5*units),ctx.lineTo(cx+10*units,cy+5*units);break;case 2:ctx.moveTo(cx-15*units,cy+5*units),ctx.lineTo(cx-5*units,cy-5*units),ctx.lineTo(cx+5*units,cy+5*units),ctx.lineTo(cx+15*units,cy-5*units);break;case 3:ctx.moveTo(cx-10*units,cy+5*units),ctx.lineTo(cx,cy-5*units),ctx.lineTo(cx,cy+5*units),ctx.lineTo(cx+10*units,cy-5*units),ctx.lineTo(cx+10*units,cy+5*units)}ctx.stroke()}ctx.lineWidth=1},OptionButton}();exports.OptionButton=OptionButton}),define("UI/Options/OptionHandle",["require","exports"],function(require,exports){var OptionHandle=function(){function OptionHandle(position,xval,xmin,xmax,xrange,yval,ymin,ymax,yrange,xsetting,ysetting){this.Position=position,this.XValue=xval,this.XMin=xmin,this.XMax=xmax,this.XRange=xrange,this.XSetting=xsetting,this.YValue=yval,this.YMin=ymin,this.YMax=ymax,this.YRange=yrange,this.YSetting=ysetting||"",this.Log=!1,this.XLog=!1,this.YLog=!1,this.Selected=!1}return OptionHandle.prototype.Draw=function(ctx,x,y,size,col){App.FillColor(ctx,col),ctx.beginPath(),ctx.moveTo(x-size,y),ctx.lineTo(x,y-size),ctx.lineTo(x+size,y),ctx.lineTo(x,y+size),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[8]),ctx.beginPath(),ctx.moveTo(x-size,y),ctx.lineTo(x,y-size),ctx.lineTo(x+size*.5,y-size*.5),ctx.lineTo(x-size*.5,y+size*.5),ctx.closePath(),ctx.fill()},OptionHandle}();exports.OptionHandle=OptionHandle});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionSample",["require","exports","./Option"],function(require,exports,Option_1){var OptionSample=function(_super){__extends(OptionSample,_super);function OptionSample(position,size,name,track,user,permalink,setting){_super.call(this),this.Type="sample",this.Position=position,this.Size=size,this.Name=name,this.Track=track,this.User=user,this.Permalink=permalink,this.Setting=setting,this.HandleRoll=[],this.Permalink||(this.Permalink="")}return OptionSample.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel);var x=this.Position.x,y=this.Position.y,height=this.Size.height,origin=this.Origin,dataType=Math.round(units*10),headerType=Math.round(units*33);ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke()),ctx.beginPath(),ctx.moveTo(panel.Margin+panel.Range*.5,y+height*.2),ctx.lineTo(panel.Margin+panel.Range*.5,y+height*.8),ctx.moveTo(panel.Margin+panel.Range*.65,y+height*.2),ctx.lineTo(panel.Margin+panel.Range*.65,y+height*.8),ctx.stroke(),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+dataType*.4),this.Permalink===""?App.StrokeColor(ctx,App.Palette[1]):App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=2,ctx.textAlign="center";var ix=panel.Margin+panel.Range*.575,iy=y+height*.5,diamond=7;ctx.beginPath(),ctx.moveTo(ix+diamond*.5*units,iy-diamond*units),ctx.lineTo(ix-diamond*units,iy-diamond*units),ctx.lineTo(ix-diamond*units,iy+diamond*units),ctx.lineTo(ix+diamond*.5*units,iy+diamond*units),ctx.moveTo(ix-diamond*.5*units,iy),ctx.lineTo(ix+diamond*units,iy),ctx.moveTo(ix+diamond*.5*units,iy-diamond*.5*units),ctx.lineTo(ix+diamond*units,iy),ctx.lineTo(ix+diamond*.5*units,iy+diamond*.5*units),ctx.stroke(),ctx.font=App.Metrics.TxtItalic,ctx.textAlign="left",ctx.fillText(this.Track,panel.Margin,y+height*.5-2*units),ctx.fillText("By "+this.User,panel.Margin,y+height*.5+dataType-2*units),ctx.textAlign="center",ctx.fillText("load new sample ",panel.Margin+panel.Range*.82,y+height*.5+dataType*.35),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=2,ix=panel.Margin+panel.Range-diamond*units,iy=y+height*.5,ctx.beginPath(),ctx.moveTo(ix,iy-diamond*units),ctx.lineTo(ix+diamond*units,iy),ctx.lineTo(ix,iy+diamond*units),ctx.stroke(),ctx.lineWidth=1},OptionSample}(Option_1.Option);exports.OptionSample=OptionSample}),define("UI/Options/OptionSubHandle",["require","exports"],function(require,exports){var OptionSubHandle=function(){function OptionSubHandle(position,val,min,max,rangemin,rangemax,setting){this.Position=position,this.Value=val,this.Min=min,this.Max=max,this.RangeMin=rangemin,this.RangeMax=rangemax,this.Setting=setting}return OptionSubHandle.prototype.SetVal=function(pos){var scale=(this.Max-this.Min)/(this.RangeMax-this.RangeMin);return(pos-this.RangeMin)*scale+this.Min},OptionSubHandle.prototype.SetPos=function(value){var scale=(this.Max-this.Min)/(this.RangeMax-this.RangeMin);return this.RangeMin+(value-this.Min)/scale},OptionSubHandle.prototype.Draw=function(ctx,x,y,size,col){var w=this.Position.x;App.FillColor(ctx,col),ctx.beginPath(),ctx.moveTo(x-w-size,y),ctx.lineTo(x-w,y-size),ctx.lineTo(x+w,y-size),ctx.lineTo(x+w+size,y),ctx.lineTo(x+w,y+size),ctx.lineTo(x-w,y+size),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[8]),ctx.beginPath(),ctx.moveTo(x-w-size,y),ctx.lineTo(x-w,y-size),ctx.lineTo(x-w+size*.5,y-size*.5),ctx.lineTo(x-w-size*.5,y+size*.5),ctx.closePath(),ctx.fill()},OptionSubHandle}();exports.OptionSubHandle=OptionSubHandle}),define("UI/Options/OptionSwitch",["require","exports"],function(require,exports){var OptionSwitch=function(){function OptionSwitch(position,name,setting,value,size,lit,mode){this.Position=position,this.Name=name,this.Setting=setting,this.Selected=value,this.Size=size,this._Lit=lit,this.Mode=mode}return OptionSwitch.prototype.Draw=function(ctx,panel,units,x,h,i){var style=1,col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length];x+=this.Position.x;var y=this.Position.y,w=this.Size.width,mode=this.Mode;if(style==0)App.FillColor(ctx,App.Palette[1]),ctx.fillRect(x,y+h*.16,w,h*.43),App.FillColor(ctx,col),this.Selected?(this._Lit&&App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillRect(x+w*.5,y+h*.16,w*.5,h*.42)):ctx.fillRect(x,y+h*.16,w*.5,h*.42);else if(style==1){App.StrokeColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(Math.round(x+w*.5),y+h*.15),ctx.lineTo(Math.round(x+w*.5),y+h*.55),ctx.closePath(),ctx.stroke(),this.Selected?(App.FillColor(ctx,col),ctx.fillRect(x+w*.5,y+h*.55,w*.5,h*.05)):(App.FillColor(ctx,col),ctx.fillRect(x,y+h*.55,w*.5,h*.05)),ctx.lineWidth=2,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]);var cx=x+w*.5,cy=y+h*.35,lx=x+w*.25,rx=x+w*.75;ctx.beginPath();switch(mode){case"fewMany":ctx.moveTo(lx-5*units,cy-5*units),ctx.lineTo(lx+5*units,cy+5*units),ctx.moveTo(rx-10*units,cy-5*units),ctx.lineTo(rx,cy+5*units),ctx.moveTo(rx-5*units,cy-5*units),ctx.lineTo(rx+5*units,cy+5*units),ctx.moveTo(rx,cy-5*units),ctx.lineTo(rx+10*units,cy+5*units);break;case"offOn":ctx.moveTo(lx-5*units,cy),ctx.lineTo(lx+5*units,cy),ctx.moveTo(rx+5*units,cy),ctx.lineTo(rx,cy-5*units),ctx.lineTo(rx-5*units,cy),ctx.lineTo(rx,cy+5*units),ctx.lineTo(rx+5*units,cy);break;case"eitherOr":}ctx.stroke(),ctx.lineWidth=1}App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="center",ctx.fillText(this.Name.toUpperCase(),x+w*.5,y+h*.84)},OptionSwitch}();exports.OptionSwitch=OptionSwitch});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionParametric",["require","exports","./Option"],function(require,exports,Option_1){var Point=etch.primitives.Point,Parametric=function(_super){__extends(Parametric,_super);function Parametric(position,size,name,handle0,handle1,handle2,handle3){_super.call(this),this.Type="parametric",this.Position=position,this.Size=size,this.Name=name,this.Handles=[],this.HandleRoll=[],this.SubHandles=[],this.SubHandleRoll=[],this.Handles[0]=handle0,this.Handles[1]=handle1,this.Handles[2]=handle2,this.Handles[3]=handle3,this.Smoothness=300,this.LineGain=[];for(var j=0;j<this.Smoothness;j++)this.LineGain[j]=0}return Parametric.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel);var p=[this.Handles[0].Position,this.Handles[1].Position,this.Handles[2].Position,this.Handles[3].Position],y=this.Position.y,height=this.Size.height;ctx.globalAlpha=1;var ly=Math.round(y+height*.45);App.StrokeColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height*.1),ctx.lineTo(panel.Margin-units,y+height*.8),ctx.moveTo(panel.Range+panel.Margin+units,y+height*.1),ctx.lineTo(panel.Range+panel.Margin+units,y+height*.8),ctx.moveTo(panel.Range+panel.Margin+units,Math.round(y+height*.45)),ctx.lineTo(panel.Margin-units,Math.round(y+height*.45)),ctx.stroke();var markers=[20,50,100,200,1e3,2e3,5e3,1e4,2e4],markerNames=["20","50","100","200","1k","2k","5k","10k","20k"];ctx.textAlign="center";var bodyType=units*5;ctx.font="400 "+bodyType+"px PT Sans",App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]);for(var j=0;j<markers.length;j++){ctx.globalAlpha=1;var xPos=this.logPosition(0,panel.Range,20,2e4,markers[j]);ctx.fillText(markerNames[j],panel.Margin+xPos,y+height);if(markers[j]==100||markers[j]==1e3)App.StrokeColor(ctx,App.Palette[1]),ctx.globalAlpha=.5,ctx.beginPath(),ctx.moveTo(Math.round(panel.Margin+xPos)+.5,y+height*.1),ctx.lineTo(Math.round(panel.Margin+xPos)+.5,y+height*.8),ctx.stroke()}ctx.save(),ctx.beginPath(),ctx.moveTo(panel.Margin,y+height*.8),ctx.lineTo(panel.Margin,ly-this.LineGain[0]);for(var j=0;j<this.Smoothness;j++)ctx.lineTo(panel.Margin+panel.Range/this.Smoothness*(j+1),ly-this.LineGain[j]);ctx.lineTo(panel.Margin+panel.Range,y+height*.8),ctx.closePath(),ctx.clip(),App.StrokeColor(ctx,App.Palette[1]),panel.diagonalFill(panel.Margin-units,y+units,panel.Range+2*units,height-2*units,9),ctx.restore(),ctx.lineWidth=2,ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(panel.Margin,ly-this.LineGain[0]);for(var j=0;j<this.Smoothness;j++)ctx.lineTo(panel.Margin+panel.Range/this.Smoothness*(j+1),ly-this.LineGain[j]);ctx.stroke(),ctx.lineWidth=1;for(var j=0;j<4;j++){var hx=panel.Margin+p[j].x,size=2*units;if(j==0||j==3)App.FillColor(ctx,App.Palette[3+j]),ctx.beginPath(),ctx.moveTo(hx-size,y+height*.9),ctx.lineTo(hx,y+height*.9-size),ctx.lineTo(hx+size,y+height*.9),ctx.lineTo(hx,y+height*.9+size),ctx.closePath(),ctx.fill()}ctx.save(),ctx.beginPath(),ctx.moveTo(panel.Margin,y+height*.8),ctx.lineTo(panel.Margin+panel.Range,y+height*.8),ctx.lineTo(panel.Margin+panel.Range,y+height),ctx.lineTo(panel.Margin,y+height),ctx.closePath(),ctx.clip();for(var j=0;j<4;j++){var hx=panel.Margin+p[j].x;j!==0&&j!==3&&this.SubHandles[j].Draw(ctx,hx,y+height*.9,height*.02,App.Palette[3+j])}ctx.restore();for(var j=0;j<4;j++){var hx=panel.Margin+p[j].x,hy=y+height*.8-p[j].y;this.Handles[j].Draw(ctx,hx,hy,height*.05,App.Palette[3+j])}},Parametric.prototype.PlotGraph=function(){_super.prototype.PlotGraph.call(this);var p=[];for(var j=0;j<4;j++){var x=Math.round(this.Smoothness/this.Size.width*this.Handles[j].Position.x)-1,y=this.Handles[j].Position.y-this.Size.height*.35;p[j]=new Point(x,y)}var q1a=this.Smoothness/26.5*(14.5-this.SubHandles[1].Value),q2a=this.Smoothness/26.5*(14.5-this.SubHandles[2].Value);q1a=this.linValue(this.SubHandles[1].RangeMin,this.SubHandles[1].RangeMax,this.Smoothness*.02,this.Smoothness*.55,this.SubHandles[1].Position.x),q2a=this.linValue(this.SubHandles[2].RangeMin,this.SubHandles[2].RangeMax,this.Smoothness*.02,this.Smoothness*.55,this.SubHandles[2].Position.x),this._Gain1=this.CurvePass("lowshelf",p[0].x,30,p[0].y),this._Gain2=this.CurvePass("peaking",p[1].x,q1a,p[1].y),this._Gain3=this.CurvePass("peaking",p[2].x,q2a,p[2].y),this._Gain4=this.CurvePass("highshelf",p[3].x,30,p[3].y);for(var j=0;j<this.Smoothness;j++)this.LineGain[j]=this._Gain1[j]+this._Gain2[j]+this._Gain3[j]+this._Gain4[j],this.LineGain[j]>this.Size.height*.35&&(this.LineGain[j]=this.Size.height*.35),this.LineGain[j]<-(this.Size.height*.35)&&(this.LineGain[j]=-(this.Size.height*.35))},Parametric.prototype.CurvePass=function(type,freq,q,gain){var tempGain=[];for(var h=0;h<this.Smoothness;h++)tempGain[h+freq]=this.Bell(h,0,gain,q);for(var h=0;h<this.Smoothness;h++)tempGain[freq-h]=this.Bell(h,0,gain,q);tempGain[freq]=gain;if(type=="lowshelf")for(var h=0;h<freq;h++)tempGain[h]=gain;if(type=="highshelf")for(var h=freq+1;h<this.Smoothness;h++)tempGain[h]=gain;return tempGain},Parametric.prototype.Bell=function(t,b,c,d){return c*Math.exp(-(t*t)/Math.pow(d*.5,2))+b},Parametric.prototype.logPosition=function(minpos,maxpos,minval,maxval,value){var minlval=Math.log(minval),maxlval=Math.log(maxval),scale=(maxlval-minlval)/(maxpos-minpos);return minpos+(Math.log(value)-minlval)/scale},Parametric.prototype.linValue=function(minpos,maxpos,minval,maxval,position){var scale=(maxval-minval)/(maxpos-minpos);return(position-minpos)*scale+minval},Parametric}(Option_1.Option);exports.Parametric=Parametric});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionSlider",["require","exports","./Option"],function(require,exports,Option_1){var Slider=function(_super){__extends(Slider,_super);function Slider(position,size,origin,value,min,max,quantised,name,setting,log){_super.call(this),this.Type="slider",this.Position=position,this.Size=size,this.Origin=origin,this.Value=value,this.Min=min,this.Max=max,this.Quantised=quantised,this.Name=name,this.Setting=setting,this.Log=log,this.Selected=!1}return Slider.prototype.Draw=function(ctx,units,i,panel,yoveride){_super.prototype.Draw.call(this,ctx,units,i,panel);var x=this.Position.x,y=this.Position.y;yoveride&&(y=yoveride);var height=this.Size.height,origin=this.Origin,dataType=Math.round(units*10),headerType=Math.round(units*33);ctx.globalAlpha=1,App.FillColor(ctx,App.Palette[1]),App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke()),ctx.beginPath(),ctx.moveTo(panel.Range*.5+panel.Margin-2*units,y+height*.5),ctx.lineTo(panel.Range*.5+panel.Margin,y+height*.5-2*units),ctx.lineTo(panel.Range*.5+panel.Margin+2*units,y+height*.5),ctx.lineTo(panel.Range*.5+panel.Margin,y+height*.5+2*units),ctx.closePath(),ctx.fill(),origin!==panel.Margin&&panel.diagonalFill(panel.Margin-units,y+units,panel.Range+2*units,height-2*units,9);var offset=0;origin==panel.Margin&&(offset=-units),ctx.globalAlpha=1;var col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length];App.FillColor(ctx,col),ctx.beginPath(),ctx.moveTo(origin+offset,y),ctx.lineTo(x+panel.Margin,y),ctx.lineTo(x+panel.Margin,y+height),ctx.lineTo(origin+offset,y+height),ctx.closePath(),ctx.fill(),ctx.fillRect(x+panel.Margin-units,y,2*units,height);var dragWidth=height*.2;ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth),ctx.lineTo(x+panel.Margin+dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5+dragWidth),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[8]),ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth),ctx.lineTo(x+panel.Margin+dragWidth*.5,y+height*.5-dragWidth*.5),ctx.lineTo(x+panel.Margin-dragWidth*.5,y+height*.5+dragWidth*.5),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+dataType*.4);if(this.Selected){ctx.textAlign="left",ctx.font=App.Metrics.TxtSlider;var string="";this.DisplayConversion?string=""+this.DisplayConversion(this.Value):string=panel.NumberWithCommas(""+Math.round(this.Value*100)/100),ctx.fillText(string,x+panel.Margin+25*units,y+height*.5+headerType*.35)}},Slider}(Option_1.Option);exports.Slider=Slider});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionSwitchArray",["require","exports","./Option"],function(require,exports,Option_1){var SwitchArray=function(_super){__extends(SwitchArray,_super);function SwitchArray(position,size,switches){_super.call(this),this.Type="switches",this.Position=position,this.Size=size,this.Switches=switches,this.HandleRoll=[]}return SwitchArray.prototype.Draw=function(ctx,units,i,panel){var x=this.Position.x,y=this.Position.y,height=this.Size.height;App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke());for(var j=0;j<this.Switches.length;j++)this.Switches[j].Draw(ctx,panel,units,panel.Margin,this.Size.height,i)},SwitchArray}(Option_1.Option);exports.SwitchArray=SwitchArray});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionWave",["require","exports","./Option"],function(require,exports,Option_1){var WaveForm=function(_super){__extends(WaveForm,_super);function WaveForm(waveform,emptystring){_super.call(this),this.Waveform=waveform,this.EmptyString=emptystring||""}return WaveForm.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel);var x=this.Position.x,y=this.Position.y,height=this.Size.height,dataType=Math.round(units*10);ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke());if(!this.Waveform.length){App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]);var ax=panel.Range*.5+panel.Margin,ay=y+height*.5;this.EmptyString.length>1?(ctx.textAlign="center",ctx.font=App.Metrics.TxtMid,ctx.fillText(this.EmptyString.toUpperCase(),ax,ay+dataType*.4)):App.AnimationsLayer.DrawSprite(ctx,"loading",ax,ay,11,!0)}this.Handles&&this.Waveform.length&&this.Mode&&(App.StrokeColor(ctx,App.Palette[1]),panel.diagonalFill(panel.Margin+this.Handles[2].Position.x,y,this.Handles[3].Position.x-this.Handles[2].Position.x,height,9)),App.FillColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(panel.Margin,y+height*.5);if(this.Waveform.length!==0){for(var j=0;j<this.Waveform.length;j++)ctx.lineTo(panel.Range/this.Waveform.length*j+panel.Margin,y+height*.5-this.Waveform[j]*height*.45);ctx.lineTo(panel.Range+panel.Margin,y+height*.5);for(var j=this.Waveform.length-1;j>-1;j--)ctx.lineTo(panel.Range/this.Waveform.length*j+panel.Margin,y+height*.5+this.Waveform[j]*height*.45)}ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+dataType*.4)},WaveForm}(Option_1.Option);exports.WaveForm=WaveForm});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionWaveImage",["require","exports","./OptionWave"],function(require,exports,OptionWave_1){var WaveImage=function(_super){__extends(WaveImage,_super);function WaveImage(position,size,origin,name,waveform,emptystring){_super.call(this,waveform,emptystring),this.Type="waveimage",this.Position=position,this.Size=size,this.Origin=origin,this.Name=name}return WaveImage.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel)},WaveImage}(OptionWave_1.WaveForm);exports.WaveImage=WaveImage});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionWaveRegion",["require","exports","./OptionWave"],function(require,exports,OptionWave_1){var WaveRegion=function(_super){__extends(WaveRegion,_super);function WaveRegion(position,size,origin,value,min,max,quantised,name,setting,log,waveform,handles,mode,emptystring){_super.call(this,waveform,emptystring),this.Type="waveregion",this.Position=position,this.Size=size,this.Origin=origin,this.Value=value,this.Min=min,this.Max=max,this.Quantised=quantised,this.Name=name,this.Setting=setting,this.Log=log,this.Selected=!1,this.Handles=handles,this.Mode=mode,this.HandleRoll=[]}return WaveRegion.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel);var y=this.Position.y,height=this.Size.height,origin=this.Origin,dataType=Math.round(units*10),xs=[this.Handles[0].Position.x,this.Handles[1].Position.x,this.Handles[2].Position.x,this.Handles[3].Position.x],col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length];if(this.Waveform.length){ctx.lineWidth=1,ctx.globalAlpha=1,ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]);var x=xs[2],sliderNo=2;this.Mode&&(ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(xs[2]+panel.Margin,y),ctx.lineTo(xs[2]+panel.Margin,y+height),ctx.moveTo(xs[3]+panel.Margin,y),ctx.lineTo(xs[3]+panel.Margin,y+height),ctx.stroke(),ctx.lineWidth=1,sliderNo=1);var offset=0;origin==panel.Margin&&(offset=-units),ctx.globalAlpha=1;for(var j=0;j<sliderNo;j++){App.FillColor(ctx,col),x=xs[j],ctx.fillRect(x+panel.Margin-units,y,2*units,height);var dragWidth=height*.16;ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth),ctx.lineTo(x+panel.Margin+dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5+dragWidth),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[8]),ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth),ctx.lineTo(x+panel.Margin+dragWidth*.5,y+height*.5-dragWidth*.5),ctx.lineTo(x+panel.Margin-dragWidth*.5,y+height*.5+dragWidth*.5),ctx.closePath(),ctx.fill()}App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]);if(this.Mode)for(var j=2;j<4;j++){x=xs[j];var dragWidth=height*.16;ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth*.5,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth*.5),ctx.lineTo(x+panel.Margin+dragWidth*.5,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5+dragWidth*.5),ctx.closePath(),ctx.fill()}ctx.font=App.Metrics.TxtItalic,ctx.textAlign="left",ctx.fillText("Start",xs[0]+panel.Margin+5*units,y+dataType*.8),this.Mode?ctx.fillText("Loop",xs[2]+panel.Margin+5*units,y+height-dataType*.4):ctx.fillText("End",xs[1]+panel.Margin+5*units,y+height-dataType*.4)}},WaveRegion}(OptionWave_1.WaveForm);exports.WaveRegion=WaveRegion});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionWaveSlider",["require","exports","./OptionWave"],function(require,exports,OptionWave_1){var WaveSlider=function(_super){__extends(WaveSlider,_super);function WaveSlider(position,size,origin,value,min,max,quantised,name,setting,log,waveform,spread,emptystring){_super.call(this,waveform,emptystring),this.Type="waveslider",this.Position=position,this.Size=size,this.Origin=origin,this.Value=value,this.Min=min,this.Max=max,this.Quantised=quantised,this.Name=name,this.Setting=setting,this.Log=log,this.Selected=!1,this.Spread=spread}return WaveSlider.prototype.Draw=function(ctx,units,i,panel){_super.prototype.Draw.call(this,ctx,units,i,panel);var x=this.Position.x,y=this.Position.y,height=this.Size.height,origin=this.Origin,headerType=Math.round(units*33);if(this.Waveform.length){ctx.lineWidth=2,ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]);var spread=panel.Range/(this.Max-this.Min)*this.Spread,leftSpread=x+panel.Margin-spread*.5;leftSpread<panel.Margin&&(leftSpread=panel.Margin);var rightSpread=x+panel.Margin+spread*.5;rightSpread>panel.Margin+panel.Range&&(rightSpread=panel.Margin+panel.Range),ctx.beginPath(),ctx.moveTo(leftSpread,y),ctx.lineTo(leftSpread,y+height),ctx.moveTo(rightSpread,y),ctx.lineTo(rightSpread,y+height),ctx.stroke(),ctx.lineWidth=1;var col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length],offset=0;origin==panel.Margin&&(offset=-units),ctx.globalAlpha=1,App.FillColor(ctx,col),ctx.fillRect(x+panel.Margin-units,y,2*units,height);var dragWidth=height*.2;ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth),ctx.lineTo(x+panel.Margin+dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5+dragWidth),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[8]),ctx.beginPath(),ctx.moveTo(x+panel.Margin-dragWidth,y+height*.5),ctx.lineTo(x+panel.Margin,y+height*.5-dragWidth),ctx.lineTo(x+panel.Margin+dragWidth*.5,y+height*.5-dragWidth*.5),ctx.lineTo(x+panel.Margin-dragWidth*.5,y+height*.5+dragWidth*.5),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]);if(this.Selected){ctx.textAlign="left",ctx.font=App.Metrics.TxtSlider;var string=panel.NumberWithCommas(""+Math.round(this.Value*100)/100);ctx.fillText(string,rightSpread+25*units,y+height*.5+headerType*.35)}}},WaveSlider}(OptionWave_1.WaveForm);exports.WaveSlider=WaveSlider});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/OptionsPanel",["require","exports","./Options/OptionADSR","./Options/OptionButtonArray","../Device","./Options/OptionActionButton","./Options/OptionButton","./Options/OptionHandle","./Options/OptionSample","./Options/OptionSubHandle","./Options/OptionSwitch","./Options/OptionParametric","./Options/OptionSlider","./Options/OptionSwitchArray","./Options/OptionWaveImage","./Options/OptionWaveRegion","./Options/OptionWaveSlider"],function(require,exports,OptionADSR_1,OptionButtonArray_1,Device_1,OptionActionButton_1,OptionButton_1,OptionHandle_1,OptionSample_1,OptionSubHandle_1,OptionSwitch_1,OptionParametric_1,OptionSlider_1,OptionSwitchArray_1,OptionWaveImage_1,OptionWaveRegion_1,OptionWaveSlider_1){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,Size=minerva.Size,OptionsPanel=function(_super){__extends(OptionsPanel,_super);function OptionsPanel(){_super.call(this),this.Outline=[]}return OptionsPanel.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this._Units=1.7,this.Position=new Point(0,0),this.Size=new Size(1,1),this.Scale=0,this.Margin=0,this.Range=100,this._Name="",this._NameWidth=0,this.Hover=!1,this.Opening=!1,this._DrawReady=!1,this.Animating=!1,this.Sketch=drawTo,this.Options=[],this.SliderColours=[],this._SliderRoll=[],this.InitJson={name:"Init",parameters:[]},this.Canvas=App.SubCanvas[0],this.Populate(this.InitJson,!1)},Object.defineProperty(OptionsPanel.prototype,"Ctx",{get:function(){return this.Canvas.getContext("2d")},enumerable:!0,configurable:!0}),OptionsPanel.prototype.Populate=function(json,open){this._JsonMemory=json;var units=App.Unit,ctx=this.Ctx,dataType=units*10;this._PanelCloseRoll=!1;var n=json.parameters.length,panelH,maxHeight=240,getHeight=0,heightScale=1,optionHeight=[];for(var i=0;i<n;i++)json.parameters[i].type=="slider"?(getHeight+=48,optionHeight[i]=48*units):json.parameters[i].type=="sample"?(getHeight+=48,optionHeight[i]=48*units):json.parameters[i].type=="actionbutton"?(getHeight+=48,optionHeight[i]=48*units):json.parameters[i].type=="waveslider"?(getHeight+=48,optionHeight[i]=48*units):json.parameters[i].type=="waveimage"?(getHeight+=48,optionHeight[i]=48*units):json.parameters[i].type=="waveregion"?(getHeight+=60,optionHeight[i]=60*units):json.parameters[i].type=="buttons"?(getHeight+=48,optionHeight[i]=48*units):json.parameters[i].type=="ADSR"?(getHeight+=120,optionHeight[i]=120*units):json.parameters[i].type=="parametric"?(getHeight+=140,optionHeight[i]=140*units):json.parameters[i].type=="switches"?(getHeight+=60,optionHeight[i]=60*units):console.log("Option type not recognised");getHeight>maxHeight&&(heightScale=1/getHeight*maxHeight,getHeight=maxHeight),panelH=(getHeight+40)*units;var panelM=0;ctx.font="300 "+dataType+"px Dosis";if(n!=1||json.parameters[0].type!="ADSR"&&json.parameters[0].type!="parametric"){for(var i=0;i<n;i++)ctx.measureText(json.parameters[i].name.toUpperCase()).width>panelM&&(panelM=ctx.measureText(json.parameters[i].name.toUpperCase()).width);panelM+=79*units}else panelM=69*units;var panelW;App.Metrics.Device!==Device_1.Device.mobile?panelW=450*units:panelW=App.Width+44*units;var panelR=panelW-(panelM+25*units),name=json.name,nameW=ctx.measureText(name.toUpperCase()).width;this.Size.width=panelW,this.Size.height=panelH,this.Margin=panelM,this.Range=panelR,this._Name=json.name,this._NameWidth=nameW;var order=App.ThemeManager.OptionsOrder;this.SliderColours=[App.Palette[order[0]],App.Palette[order[1]],App.Palette[order[2]],App.Palette[order[3]],App.Palette[order[4]]];var topY=-(panelH*.5),margin=this.Margin;this.Outline=[],this.Outline.push(new Point(0,0),new Point(44*units,0),new Point(44*units,topY),new Point(margin-25*units,topY),new Point(margin-5*units,topY-20*units),new Point(margin+5*units+this._NameWidth,topY-20*units),new Point(margin+25*units+this._NameWidth,topY),new Point(panelW-40*units,topY),new Point(panelW-20*units,topY-20*units),new Point(panelW,topY),new Point(panelW,panelH*.5),new Point(44*units,panelH*.5),new Point(44*units,44*units));var optionTotalY=0,optionList=[];for(var i=0;i<n;i++){var option=json.parameters[i];optionHeight[i]=Math.round(optionHeight[i]*heightScale);var optionY=Math.round(-(this.Size.height*.5)+20*units+optionTotalY);if(option.type=="slider"){var sliderO=this.Margin;option.props.centered==1&&(sliderO+=this.Range/100*50);var log=option.props.logarithmic,sliderX;log==1?sliderX=this.logPosition(0,this.Range,option.props.min,option.props.max,option.props.value):(sliderX=this.linPosition(0,this.Range,option.props.min,option.props.max,option.props.value),log=!1),optionList.push(new OptionSlider_1.Slider(new Point(sliderX,optionY),new Size(1,optionHeight[i]),sliderO,option.props.value,option.props.min,option.props.max,option.props.quantised,option.name,option.setting,log)),option.props.convertDisplay&&(optionList[i].DisplayConversion=option.props.convertDisplay)}else if(option.type=="waveslider"){var sliderO=this.Margin,waveform=[];option.props.wavearray&&(waveform=option.props.wavearray);var log=option.props.logarithmic,sliderX;log==1?sliderX=this.logPosition(0,this.Range,option.props.min,option.props.max,option.props.value):(sliderX=this.linPosition(0,this.Range,option.props.min,option.props.max,option.props.value),log=!1),optionList.push(new OptionWaveSlider_1.WaveSlider(new Point(sliderX,optionY),new Size(1,optionHeight[i]),sliderO,option.props.value,option.props.min,option.props.max,option.props.quantised,option.name,option.setting,log,waveform,option.props.spread))}else if(option.type=="waveimage"){var sliderO=this.Margin,waveform=[];option.props.wavearray&&(waveform=option.props.wavearray),optionList.push(new OptionWaveImage_1.WaveImage(new Point(0,optionY),new Size(1,optionHeight[i]),sliderO,option.name,waveform))}else if(option.type=="waveregion"){var handles=[],sliderO=this.Margin,waveform=[];option.props.wavearray&&(waveform=option.props.wavearray);var emptystring="";option.props.emptystring&&(emptystring=option.props.emptystring);var startX=this.linPosition(0,this.Range,option.props.min,option.props.max,option.nodes[0].value),endX=this.linPosition(0,this.Range,option.props.min,option.props.max,option.nodes[1].value),loopStartX=this.linPosition(0,this.Range,option.props.min,option.props.max,option.nodes[2].value),loopEndX=this.linPosition(0,this.Range,option.props.min,option.props.max,option.nodes[3].value),xs=[startX,endX,loopStartX,loopEndX];for(var j=0;j<4;j++)handles[j]=new OptionHandle_1.OptionHandle(new Point(xs[j],optionY),option.nodes[j].value,option.props.min,option.props.max,this.Range,0,0,0,0,option.nodes[j].setting,"");optionList.push(new OptionWaveRegion_1.WaveRegion(new Point(0,optionY),new Size(1,optionHeight[i]),sliderO,option.props.value,option.props.min,option.props.max,option.props.quantised,option.name,option.setting,log,waveform,handles,option.props.mode,emptystring))}else if(option.type=="sample")optionList.push(new OptionSample_1.OptionSample(new Point(sliderX,optionY),new Size(1,optionHeight[i]),option.name,option.props.track,option.props.user,option.props.permalink,option.setting));else if(option.type=="actionbutton")optionList.push(new OptionActionButton_1.OptionActionButton(new Point(sliderX,optionY),new Size(1,optionHeight[i]),option.name,option.props.text,option.setting));else if(option.type=="switches"){var switches=[],margin=20*units,switchWidth=60*units;switchWidth=(this.Range-margin*3)/4;var switchStartX=this.Range*.5-(switchWidth*option.switches.length+margin*(option.switches.length-1))*.5,switchX=0;for(var j=0;j<option.switches.length;j++)switchX=switchStartX+j*(switchWidth+margin),switches[j]=new OptionSwitch_1.OptionSwitch(new Point(switchX,optionY),option.switches[j].name,option.switches[j].setting,option.switches[j].value,new Size(switchWidth,optionHeight[i]*.43),option.switches[j].lit,option.switches[j].mode);optionList.push(new OptionSwitchArray_1.SwitchArray(new Point(sliderX,optionY),new Size(1,optionHeight[i]),switches))}else if(option.type=="buttons"){var buttons=[],margin=20*units,buttonWidth=(this.Range-margin*(option.buttons.length-1))/option.buttons.length;buttonWidth=this.Range/5;var buttonStartX=this.Range*.5-buttonWidth*option.buttons.length*.5,buttonX=0;for(var j=0;j<option.buttons.length;j++)buttonX=buttonStartX+j*buttonWidth,buttons[j]=new OptionButton_1.OptionButton(new Point(buttonX,optionY),option.buttons[j].name,j==option.props.value,j,new Size(buttonWidth,optionHeight[i]));optionList.push(new OptionButtonArray_1.ButtonArray(new Point(0,optionY),new Size(this.Range,optionHeight[i]),option.name,option.setting,buttons,option.props.mode))}else if(option.type=="ADSR"){var Xrange,handleX,Yrange,handleY,handles=[];Xrange=option.nodes[0].max-option.nodes[0].min,handleX=this.Range*.28/Xrange*(option.nodes[0].value-option.nodes[0].min),Yrange=option.nodes[2].max-option.nodes[2].min,handleY=optionHeight[i]*.8/Yrange*(option.nodes[2].value-option.nodes[2].min),handles[0]=new OptionHandle_1.OptionHandle(new Point(handleX,handleY),option.nodes[0].value,option.nodes[0].min,option.nodes[0].max,this.Range*.28,0,0,0,0,option.nodes[0].setting,""),Xrange=option.nodes[1].max-option.nodes[1].min,handleX=this.Range*.28/Xrange*(option.nodes[1].value-option.nodes[1].min),handles[1]=new OptionHandle_1.OptionHandle(new Point(handleX,handleY),option.nodes[1].value,option.nodes[1].min,option.nodes[1].max,this.Range*.28,option.nodes[2].value,option.nodes[2].min,option.nodes[2].max,optionHeight[i]*.8,option.nodes[1].setting,option.nodes[2].setting),Xrange=option.nodes[3].max-option.nodes[3].min,handleX=this.Range*.4/Xrange*(option.nodes[3].value-option.nodes[3].min),handles[2]=new OptionHandle_1.OptionHandle(new Point(handleX,handleY),option.nodes[3].value,option.nodes[3].min,option.nodes[3].max,this.Range*.4,0,0,0,0,option.nodes[3].setting,""),optionList.push(new OptionADSR_1.ADSR(new Point(0,optionY),new Size(this.Range,optionHeight[i]),option.name,handles[0],handles[1],handles[2]))}else if(option.type=="parametric"){var handles=[],subHandles=[],Xmin,Xmax,Xval,Xrange,handleX,Ymin,Ymax,Yval,Yrange,handleY,Qmin,Qmax,Qval,QRmin,QRmax,QX;for(var j=0;j<4;j++)Xmin=option.nodes[j].x_min,Xmax=option.nodes[j].x_max,Xval=option.nodes[j].x_value,Ymin=option.nodes[j].y_min,Ymax=option.nodes[j].y_max,Yval=option.nodes[j].y_value,Xrange=Xmax-Xmin,handleX=this.Range/Xrange*(Xval-Xmin),handleX=this.logPosition(0,this.Range,Xmin,Xmax,Xval),Yrange=Ymax-Ymin,handleY=optionHeight[i]*.7/Yrange*(Yval-Ymin),handles[j]=new OptionHandle_1.OptionHandle(new Point(handleX,handleY),Xval,Xmin,Xmax,this.Range,Yval,Ymin,Ymax,optionHeight[i]*.7,option.nodes[j].x_setting,option.nodes[j].y_setting),handles[j].XLog=!0,Qmin=option.nodes[j].q_min,Qmax=option.nodes[j].q_max,Qval=option.nodes[j].q_value,QRmin=this.Range/100*2,QRmax=this.Range/100*10,QX=this.logPosition(QRmin,QRmax,Qmin,Qmax,Qval),subHandles[j]=new OptionSubHandle_1.OptionSubHandle(new Point(QX,handleY),Qval,Qmin,Qmax,QRmin,QRmax,option.nodes[j].q_setting);optionList.push(new OptionParametric_1.Parametric(new Point(0,optionY),new Size(this.Range,optionHeight[i]),option.name,handles[0],handles[1],handles[2],handles[3])),optionList[i].SubHandles=subHandles,optionList[i].PlotGraph()}optionTotalY+=optionHeight[i]}this.Options=optionList,this._DrawReady=!0},OptionsPanel.prototype.UpdateOptions=function(){this.SelectedBlock.UpdateOptionsForm();var json=this.SelectedBlock.OptionsForm,n=json.parameters.length;for(var i=0;i<n;i++){var option=json.parameters[i];if(option.type=="slider"){this.Options[i].Value=option.props.value;var sliderO=this.Margin;option.props.centered==1&&(sliderO+=this.Range/100*50);var log=option.props.logarithmic;log==1?this.Options[i].Position.x=this.logPosition(0,this.Range,option.props.min,option.props.max,option.props.value):this.Options[i].Position.x=this.linPosition(0,this.Range,option.props.min,option.props.max,option.props.value)}else option.type=="waveslider"&&(this.Options[i].Value=option.props.value,this.Options[i].Spread=option.props.spread,this.Options[i].Mode=option.props.mode)}this._DrawReady=!0},OptionsPanel.prototype.Update=function(){this._JsonMemory.updateeveryframe==1,this.Animating&&(this._DrawReady=!0)},OptionsPanel.prototype.Draw=function(){var units=App.Unit,ctxOuter=App.Canvas.Ctx,ctx=this.Ctx;this._DrawReady&&(this.DrawToOffscreenCanvas(ctx),this._DrawReady=!1),this.Scale>0&&(ctxOuter.globalAlpha=1,ctxOuter.setTransform(this.Scale,0,0,this.Scale,this.Position.x,this.Position.y),ctxOuter.drawImage(this.Canvas,0,-Math.round(App.Metrics.C.y)),ctxOuter.setTransform(1,0,0,1,0,0))},OptionsPanel.prototype.DrawToOffscreenCanvas=function(ctx){ctx.clearRect(0,0,App.Width,App.Height),ctx.setTransform(1,0,0,1,0,Math.round(App.Metrics.C.y));var units=App.Unit,sx=0,sy=0;ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=.16,this.panelDraw(sx,sy+5*units),ctx.globalAlpha=.9,this.panelDraw(sx,sy),ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(sx+this.Size.width-24*units,sy-this.Size.height*.5+4*units),ctx.lineTo(sx+this.Size.width-16*units,sy-this.Size.height*.5-4*units),ctx.moveTo(sx+this.Size.width-24*units,sy-this.Size.height*.5-4*units),ctx.lineTo(sx+this.Size.width-16*units,sy-this.Size.height*.5+4*units),ctx.stroke(),ctx.lineWidth=1,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.textAlign="left",ctx.fillText(this._Name.toUpperCase(),this.Margin,-this.Size.height*.5);for(var i=0;i<this.Options.length;i++)this.Options[i].Draw(ctx,units,i,this);ctx.setTransform(1,0,0,1,0,0)},OptionsPanel.prototype.panelDraw=function(x,y){var units=App.Unit,ctx=this.Ctx;ctx.beginPath(),ctx.moveTo(x+44*units,y-this.Size.height*.5),ctx.lineTo(x+this.Margin-25*units,y-this.Size.height*.5),ctx.lineTo(x+this.Margin-5*units,y-this.Size.height*.5-20*units),ctx.lineTo(x+this.Margin+5*units+this._NameWidth,y-this.Size.height*.5-20*units),ctx.lineTo(x+this.Margin+25*units+this._NameWidth,y-this.Size.height*.5),ctx.lineTo(x+this.Size.width-40*units,y-this.Size.height*.5),ctx.lineTo(x+this.Size.width-20*units,y-this.Size.height*.5-20*units),ctx.lineTo(x+this.Size.width,y-this.Size.height*.5),ctx.lineTo(x+this.Size.width,y+this.Size.height*.5),ctx.lineTo(x+44*units,y+this.Size.height*.5),ctx.lineTo(x+44*units,y+44*units),ctx.lineTo(x,y),ctx.lineTo(x+44*units,y),ctx.closePath(),ctx.fill()},OptionsPanel.prototype.diagonalFill=function(x,y,w,h,s){var pr=App.Metrics.PixelRatio;s*=pr;var ctx=this.Ctx,lineNo=Math.round((w+h)/s),pos1=new Point(0,0),pos2=new Point(0,0);ctx.beginPath();for(var j=0;j<lineNo;j++)pos1.x=s*.5+s*j,pos1.y=0,pos2.x=pos1.x-h,pos2.y=h,pos2.x<0&&(pos2.y=h+pos2.x,pos2.x=0),pos1.x>w&&(pos1.y=pos1.x-w,pos1.x=w),ctx.moveTo(x+pos1.x,y+pos1.y),ctx.lineTo(x+pos2.x,y+pos2.y);ctx.stroke()},OptionsPanel.prototype.NumberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},OptionsPanel.prototype.PanelScale=function(panel,destination,t){var psTween=new window.TWEEN.Tween({x:panel.Scale});psTween.to({x:destination},t),psTween.onUpdate(function(){panel.Scale=this.x}),psTween.start(this.LastVisualTick),psTween.easing(window.TWEEN.Easing.Quintic.InOut)},OptionsPanel.prototype.Open=function(block){block.UpdateOptionsForm();if(block.OptionsForm){var newBlock=block!==this.SelectedBlock;this.Scale==1&&newBlock&&this.Close(),this.Opening=!0,this.SelectedBlock=block,App.MainScene.MainSceneDragger.Jump(block.Position,new Point(App.Metrics.OptionsPoint.x,App.Metrics.OptionsPoint.y));var me=this;setTimeout(function(){me.Opening=!1,me.Populate(block.OptionsForm,!0),me.PanelScale(me,1,200)},400)}},OptionsPanel.prototype.Refresh=function(){this.Scale==1&&(this.SelectedBlock.UpdateOptionsForm(),this.Populate(this.SelectedBlock.OptionsForm,!1))},OptionsPanel.prototype.Resize=function(){if(!App.Width)return;App.Metrics.Device!==Device_1.Device.mobile?(this.Position.x=Math.round(App.Width*App.Metrics.OptionsPoint.x),this.Position.y=Math.round(App.Height*App.Metrics.OptionsPoint.y)):(this.Position.x=-44*App.Unit,this.Position.y=Math.round(App.Height*.65))},OptionsPanel.prototype.Close=function(){this.PanelScale(this,0,200)},OptionsPanel.prototype.MouseDown=function(mx,my){this.RolloverCheck(mx,my);for(var i=0;i<this.Options.length;i++){this._SliderRoll[i]&&(this.Options[i].Selected=!0,this.SliderSet(i,mx));if(this.Options[i].Type=="ADSR"){var xStart=[0,this.Options[i].Handles[0].Position.x,this.Range*.6];for(var j=0;j<this.Options[i].Handles.length;j++)this.Options[i].HandleRoll[j]&&(this.Options[i].Handles[j].Selected=!0,this.HandleSet(i,j,xStart[j],this.Options[i].Size.height*.9,mx,my))}if(this.Options[i].Type=="waveregion")for(var j=this.Options[i].Handles.length-1;j>-1;j--)if(this.Options[i].HandleRoll[j]){this.Options[i].Handles[j].Selected=!0,this.HandleSet(i,j,0,this.Options[i].Size.height,mx,my);return}if(this.Options[i].Type=="switches")for(var j=0;j<this.Options[i].Switches.length;j++)if(this.Options[i].HandleRoll[j]){this.SwitchValue(this.Options[i].Switches[j],"Selected","Setting");return}if(this.Options[i].Type=="buttons")for(var j=0;j<this.Options[i].Buttons.length;j++)if(this.Options[i].HandleRoll[j]){for(var h=0;h<this.Options[i].Buttons.length;h++)this.Options[i].Buttons[h].Selected=!1;this.Options[i].Buttons[j].Selected=!0,this.PushValue(this.Options[i],j,"Setting");return}if(this.Options[i].Type=="parametric"){for(var j=0;j<this.Options[i].Handles.length;j++)if(this.Options[i].HandleRoll[j]){this.Options[i].Handles[j].Selected=!0,this.HandleSet(i,j,0,this.Options[i].Size.height*.8,mx,my),this.Options[i].PlotGraph();break}for(var j=0;j<this.Options[i].SubHandles.length;j++)if(this.Options[i].SubHandleRoll[j]){this.Options[i].SubHandles[j].Selected=!0,this.SubHandleSet(this.Options[i].SubHandles[j],this.Options[i].Handles[j].Position.x,mx),this.Options[i].PlotGraph();break}}if(this.Options[i].Type=="sample"){if(this.Options[i].HandleRoll[0]){this.Sketch.SoundcloudPanel.OpenPanel();return}if(this.Options[i].HandleRoll[1]&&this.Options[i].Permalink!==""){window.open(""+this.Options[i].Permalink,"_blank");return}}if(this.Options[i].Type=="actionbutton"&&this.Options[i].HandleRoll[0]){var val=0;console.log(""+this.Options[i].Setting+" | "+val),this.SelectedBlock.SetParam(this.Options[i].Setting,val);return}}this._PanelCloseRoll&&this.Close()},OptionsPanel.prototype.MouseUp=function(){for(var i=0;i<this.Options.length;i++){this.Options[i].Selected=!1;if(this.Options[i].Type=="ADSR"||this.Options[i].Type=="waveregion")for(var j=0;j<this.Options[i].Handles.length;j++)this.Options[i].Handles[j].Selected=!1;if(this.Options[i].Type=="parametric")for(var j=0;j<this.Options[i].Handles.length;j++)this.Options[i].Handles[j].Selected=!1,this.Options[i].SubHandles[j].Selected=!1}this.Hover&&(this._DrawReady=!0)},OptionsPanel.prototype.MouseMove=function(mx,my){this.RolloverCheck(mx,my);for(var i=0;i<this.Options.length;i++){(this.Options[i].Type=="slider"||this.Options[i].Type=="waveslider")&&this.Options[i].Selected&&this.SliderSet(i,mx);if(this.Options[i].Type=="ADSR"){var xStart=[0,this.Options[i].Handles[0].Position.x,this.Range*.6];for(var j=0;j<this.Options[i].Handles.length;j++)this.Options[i].Handles[j].Selected&&this.HandleSet(i,j,xStart[j],this.Options[i].Size.height*.9,mx,my)}if(this.Options[i].Type=="waveregion"){for(var j=0;j<this.Options[i].Handles.length;j++){var handles=this.Options[i].Handles;handles[j].Selected&&this.HandleSet(i,j,0,this.Options[i].Size.height,mx,my)}handles[3].Position.x<handles[2].Position.x+1&&this.HandleSet(i,3,0,this.Options[i].Size.height,handles[2].Position.x+1+this.Position.x+this.Margin,my),handles[3].Position.x<handles[0].Position.x&&this.HandleSet(i,3,0,this.Options[i].Size.height,handles[0].Position.x+this.Position.x+this.Margin,my),handles[1].Position.x<handles[0].Position.x+1&&this.HandleSet(i,1,0,this.Options[i].Size.height,handles[0].Position.x+1+this.Position.x+this.Margin,my)}if(this.Options[i].Type=="parametric"){for(var j=0;j<this.Options[i].Handles.length;j++)this.Options[i].Handles[j].Selected&&(this.HandleSet(i,j,0,this.Options[i].Size.height*.8,mx,my),this.Options[i].PlotGraph());for(var j=0;j<this.Options[i].SubHandles.length;j++)this.Options[i].SubHandles[j].Selected&&(this.SubHandleSet(this.Options[i].SubHandles[j],this.Options[i].Handles[j].Position.x,mx),this.Options[i].PlotGraph())}}},OptionsPanel.prototype.RolloverCheck=function(mx,my){var units=App.Unit;this.Hover=this.OutlineTest(new Point(mx,my));for(var i=0;i<this.Options.length;i++)if(this.Options[i].Type=="slider"||this.Options[i].Type=="waveslider")this._SliderRoll[i]=Dimensions.HitRect(this.Position.x+this.Margin-10*units,this.Position.y+this.Options[i].Position.y,this.Range+20*units,this.Options[i].Size.height,mx,my);else if(this.Options[i].Type=="ADSR")this.Options[i].HandleRoll[0]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Handles[0].Position.x-10*units,this.Position.y+this.Options[i].Position.y+this.Options[i].Size.height*.1-10*units,20*units,20*units,mx,my),this.Options[i].HandleRoll[1]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Handles[0].Position.x+this.Options[i].Handles[1].Position.x-10*units,this.Position.y+this.Options[i].Position.y+this.Options[i].Size.height*.9-this.Options[i].Handles[1].Position.y-10*units,20*units,20*units,mx,my),this.Options[i].HandleRoll[2]=Dimensions.HitRect(this.Position.x+this.Margin+this.Range*.6+this.Options[i].Handles[2].Position.x-10*units,this.Position.y+this.Options[i].Position.y+this.Options[i].Size.height*.9-10*units,20*units,20*units,mx,my);else if(this.Options[i].Type=="waveregion")for(var j=0;j<4;j++)!this.Options[i].Mode&&j>1||this.Options[i].Mode&&j==1?this.Options[i].HandleRoll[j]=!1:this.Options[i].HandleRoll[j]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Handles[j].Position.x-10*units,this.Position.y+this.Options[i].Position.y,20*units,this.Options[i].Size.height,mx,my);else if(this.Options[i].Type=="switches")for(var j=0;j<this.Options[i].Switches.length;j++)this.Options[i].HandleRoll[j]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Switches[j].Position.x,this.Position.y+this.Options[i].Position.y,this.Options[i].Switches[j].Size.width,this.Options[i].Size.height*.7,mx,my);else if(this.Options[i].Type=="buttons")for(var j=0;j<this.Options[i].Buttons.length;j++)this.Options[i].HandleRoll[j]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Buttons[j].Position.x,this.Position.y+this.Options[i].Position.y,this.Options[i].Buttons[j].Size.width,this.Options[i].Size.height,mx,my);else if(this.Options[i].Type=="parametric")for(var j=0;j<this.Options[i].Handles.length;j++)this.Options[i].HandleRoll[j]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Handles[j].Position.x-10*units,this.Position.y+this.Options[i].Position.y+this.Options[i].Size.height*.8-this.Options[i].Handles[j].Position.y-10*units,20*units,20*units,mx,my),j!==0&&j!==this.Options[i].Handles.length-1&&(this.Options[i].SubHandleRoll[j]=Dimensions.HitRect(this.Position.x+this.Margin+this.Options[i].Handles[j].Position.x-this.Options[i].SubHandles[j].Position.x-10*units,this.Position.y+this.Options[i].Position.y+this.Options[i].Size.height*.9-10*units,this.Options[i].SubHandles[j].Position.x*2+20*units,20*units,mx,my));else this.Options[i].Type=="sample"?(this.Options[i].HandleRoll[0]=Dimensions.HitRect(this.Position.x+this.Margin+this.Range*.65,this.Position.y+this.Options[i].Position.y,this.Range*.35,this.Options[i].Size.height,mx,my),this.Options[i].HandleRoll[1]=Dimensions.HitRect(this.Position.x+this.Margin+this.Range*.5,this.Position.y+this.Options[i].Position.y,this.Range*.15,this.Options[i].Size.height,mx,my)):this.Options[i].Type=="actionbutton"&&(this.Options[i].HandleRoll[0]=Dimensions.HitRect(this.Position.x+this.Margin+this.Range*.25,this.Position.y+this.Options[i].Position.y,this.Range*.5,this.Options[i].Size.height,mx,my));this.Scale==1&&(this._PanelCloseRoll=Dimensions.HitRect(this.Position.x+this.Size.width-30*units,this.Position.y-this.Size.height*.5-10*units,20*units,20*units,mx,my))},OptionsPanel.prototype.OutlineTest=function(point){this.Ctx.beginPath(),this.Ctx.moveTo(this.Position.x+this.Outline[0].x,this.Position.y+this.Outline[0].y);for(var i=1;i<this.Outline.length;i++)this.Ctx.lineTo(this.Position.x+this.Outline[i].x,this.Position.y+this.Outline[i].y);return this.Ctx.closePath(),this.Ctx.isPointInPath(point.x,point.y)},OptionsPanel.prototype.HandleSet=function(n,h,xStart,yRange,mx,my){var mPosX=mx-(this.Position.x+this.Margin+xStart),mPosY=my-(this.Position.y+this.Options[n].Position.y+yRange);this.Options[n].Handles[h].Position.x=mPosX,this.Options[n].Handles[h].Position.y=-mPosY,this.Options[n].Handles[h].Position.x=this.ValueInRange(this.Options[n].Handles[h].Position.x,0,this.Options[n].Handles[h].XRange),this.Options[n].Handles[h].Position.y=this.ValueInRange(this.Options[n].Handles[h].Position.y,0,this.Options[n].Handles[h].YRange);var log=!1;this.Options[n].Handles[h].Log==1&&(log=!0);var xlog=!1;this.Options[n].Handles[h].XLog==1&&(xlog=!0);var ylog=!1;this.Options[n].Handles[h].YLog==1&&(ylog=!0),this.UpdateValue(this.Options[n].Handles[h],"XValue","XMin","XMax",0,this.Options[n].Handles[h].XRange,"XSetting","x",xlog),this.Options[n].Handles[h].YSetting!==""&&this.UpdateValue(this.Options[n].Handles[h],"YValue","YMin","YMax",0,this.Options[n].Handles[h].YRange,"YSetting","y",ylog)},OptionsPanel.prototype.SubHandleSet=function(handle,origin,mx){var mPosX=mx-(this.Position.x+this.Margin+origin);mPosX<0&&(mPosX=-mPosX),handle.Position.x=mPosX,handle.Position.x=this.ValueInRange(handle.Position.x,handle.RangeMin,handle.RangeMax),this.UpdateValue(handle,"Value","Min","Max",handle.RangeMin,handle.RangeMax,"Setting","x",!0)},OptionsPanel.prototype.SliderSet=function(n,mx){var mPos=mx-(this.Position.x+this.Margin);this.Options[n].Position.x=mPos,this.Options[n].Position.x=this.ValueInRange(this.Options[n].Position.x,0,this.Range);var log=!1;this.Options[n].Log==1&&(log=!0),this.UpdateValue(this.Options[n],"Value","Min","Max",0,this.Range,"Setting","x",log)},OptionsPanel.prototype.UpdateValue=function(object,value,min,max,rangemin,rangemax,setting,axis,log){this._DrawReady=!0,log==1?object[""+value]=this.logValue(rangemin,rangemax,object[""+min],object[""+max],object.Position[""+axis]):object[""+value]=this.linValue(rangemin,rangemax,object[""+min],object[""+max],object.Position[""+axis]),object.Quantised&&(object[""+value]=Math.round(object[""+value]),log==1?object.Position[""+axis]=this.logPosition(rangemin,rangemax,object[""+min],object[""+max],object[""+value]):object.Position[""+axis]=this.linPosition(rangemin,rangemax,object[""+min],object[""+max],object[""+value])),console.log(""+object[""+setting]+" | "+object[""+value]),this.SelectedBlock.SetParam(object[""+setting],object[""+value]),this._Name.toUpperCase()=="GRANULAR"&&""+object[""+setting]=="spread"&&this.UpdateOptions()},OptionsPanel.prototype.SwitchValue=function(object,value,setting){this._DrawReady=!0,console.log("from "+object[""+setting]+" | "+object[""+value]),object[""+value]=!object[""+value];var val=0;object[""+value]&&(val=1),console.log("to "+object[""+setting]+" | "+val),this.SelectedBlock.SetParam(object[""+setting],val)},OptionsPanel.prototype.PushValue=function(object,value,setting){this._DrawReady=!0,console.log(""+object[""+setting]+" | "+value),this.SelectedBlock.SetParam(object[""+setting],value)},OptionsPanel.prototype.ValueInRange=function(value,floor,ceiling){return value<floor&&(value=floor),value>ceiling&&(value=ceiling),value},OptionsPanel.prototype.logValue=function(minpos,maxpos,minval,maxval,position){var minlval=Math.log(minval),maxlval=Math.log(maxval),scale=(maxlval-minlval)/(maxpos-minpos);return Math.exp((position-minpos)*scale+minlval)},OptionsPanel.prototype.logPosition=function(minpos,maxpos,minval,maxval,value){var minlval=Math.log(minval),maxlval=Math.log(maxval),scale=(maxlval-minlval)/(maxpos-minpos);return minpos+(Math.log(value)-minlval)/scale},OptionsPanel.prototype.linValue=function(minpos,maxpos,minval,maxval,position){var scale=(maxval-minval)/(maxpos-minpos);return(position-minpos)*scale+minval},OptionsPanel.prototype.linPosition=function(minpos,maxpos,minval,maxval,value){var scale=(maxval-minval)/(maxpos-minpos);return minpos+(value-minval)/scale},OptionsPanel}(DisplayObject);exports.OptionsPanel=OptionsPanel});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("ParticleLayer",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,ParticleLayer=function(_super){__extends(ParticleLayer,_super);function ParticleLayer(){_super.apply(this,arguments)}return ParticleLayer.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo)},ParticleLayer.prototype.Update=function(){App.Particles.length&&this.UpdateParticles()},ParticleLayer.prototype.UpdateParticles=function(){var currentParticles=[];for(var i=0;i<App.Particles.length;i++){var particle=App.Particles[i];particle.Life-=1;if(particle.Life<1){particle.Reset(),particle.ReturnToPool();continue}particle.ParticleCollision(App.Metrics.FloatOnGrid(particle.Position),particle),particle.Move(),currentParticles.push(particle)}App.Particles=currentParticles},ParticleLayer.prototype.Draw=function(){for(var i=0;i<App.Particles.length;i++){var particle=App.Particles[i],pos=App.Metrics.FloatOnGrid(particle.Position),unit=App.ScaledUnit,sx=pos.x,sy=pos.y,size=particle.Size*unit;App.FillColor(this.Ctx,App.Palette[8]),this.Ctx.globalAlpha=1,this.Ctx.beginPath(),this.Ctx.moveTo(sx-size,sy),this.Ctx.lineTo(sx,sy-size),this.Ctx.lineTo(sx+size,sy),this.Ctx.lineTo(sx,sy+size),this.Ctx.closePath(),this.Ctx.fill()}},ParticleLayer}(DisplayObject);exports.ParticleLayer=ParticleLayer});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/SamplerBase",["require","exports","../Source"],function(require,exports,Source_1){var SamplerBase=function(_super){__extends(SamplerBase,_super);function SamplerBase(){_super.apply(this,arguments)}return SamplerBase.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.CreateSource()},SamplerBase.prototype.CreateSource=function(){var _this=this;this.Sources.push(new Tone.Simpler),this.Sources.forEach(function(s,i){s.player.loop=_this.Params.loop,s.player.loopStart=_this.Params.loopStart,s.player.loopEnd=_this.Params.loopEnd,s.player.retrigger=_this.Params.retrigger,s.player.reverse=_this.Params.reverse,i>0&&(s.player.buffer=_this.Sources[0].player.buffer)});if(this.Sources[this.Sources.length-1])return this.Sources[this.Sources.length-1]},SamplerBase.prototype.GetDuration=function(buffer){return buffer?buffer.duration:0},SamplerBase.prototype.TriggerAttack=function(index){var _this=this;index===void 0&&(index=0),index==="all"?this.Sources.forEach(function(s){s.triggerAttack("+0",_this.Params.startPosition,_this.Params.endPosition-_this.Params.startPosition)}):this.Sources[index].triggerAttack("+0",this.Params.startPosition,this.Params.endPosition-this.Params.startPosition)},SamplerBase.prototype.TriggerAttackRelease=function(index,duration){var _this=this;index===void 0&&(index=0),duration===void 0&&(duration=App.Config.PulseLength),index==="all"?this.Sources.forEach(function(s){s.triggerAttackRelease(duration,"+0",_this.Params.startPosition,_this.Params.endPosition-_this.Params.startPosition)}):this.Sources[index].triggerAttackRelease(duration,"+0",this.Params.startPosition,this.Params.endPosition-this.Params.startPosition)},SamplerBase.prototype.TriggerRelease=function(index,forceRelease){index===void 0&&(index=0);if(!this.IsPowered()||forceRelease)index==="all"?this.Sources.forEach(function(s){s.triggerRelease()}):this.Sources[index].triggerRelease()},SamplerBase.prototype.MouseUp=function(){this.FirstSetup(),_super.prototype.MouseUp.call(this)},SamplerBase.prototype.FirstSetup=function(){},SamplerBase.prototype.LoadTrack=function(track,fullUrl){},SamplerBase.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.Sources.forEach(function(s){s.dispose()}),this.Envelopes.forEach(function(e){e.dispose()})},SamplerBase}(Source_1.Source);exports.SamplerBase=SamplerBase});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/Recorder",["require","exports","./SamplerBase"],function(require,exports,SamplerBase_1){var Point=etch.primitives.Point,Recorder=function(_super){__extends(Recorder,_super);function Recorder(){_super.apply(this,arguments),this.IsRecording=!1}return Recorder.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Recorder.name,this.Defaults={playbackRate:1,reverse:!1,startPosition:0,endPosition:0,loop:!0,loopStart:0,loopEnd:0,retrigger:!1,volume:9,track:null,trackName:"",permalink:""},this.PopulateParams(),this._WaveForm=[],_super.prototype.Init.call(this,drawTo),this.BufferSource=App.Audio.ctx.createBufferSource(),this.Recorder=new RecorderJS(App.Audio.Master,{workerPath:App.Config.RecorderWorkerPath}),this.Envelopes.forEach(function(e,i){e=_this.Sources[i].envelope}),this.Sources.forEach(function(s){s.connect(_this.AudioInput),s.volume.value=_this.Params.volume}),this.Filename="BlokdustRecording.wav",this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(2,0),new Point(2,1),new Point(1,2))},Recorder.prototype.Update=function(){_super.prototype.Update.call(this)},Recorder.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Recorder.prototype.ToggleRecording=function(){this.IsRecording?this.StopRecording():this.StartRecording()},Recorder.prototype.StartRecording=function(){this.Recorder.clear(),App.Message("Started Recording",{seconds:1}),this.IsRecording=!0,this.Recorder.record()},Recorder.prototype.StopRecording=function(){this.Recorder.stop(),this.IsRecording=!1,App.Message("Stopped Recording",{seconds:1}),this.SetBuffers()},Recorder.prototype.SetBuffers=function(){var _this=this;this.Recorder.getBuffers(function(buffers){_this.BufferSource?_this.BufferSource&&_this.BufferSource.buffer!==null&&(_this.BufferSource=null,_this.BufferSource=App.Audio.ctx.createBufferSource()):_this.BufferSource=App.Audio.ctx.createBufferSource(),_this.BufferSource.buffer=App.Audio.ctx.createBuffer(1,buffers[0].length,44100),_this.BufferSource.buffer.getChannelData(0).set(buffers[0]),_this.BufferSource.buffer.getChannelData(0).set(buffers[1]),_this.UpdateWaveform(),_this.Sources.forEach(function(s){s.player.buffer=_this.BufferSource.buffer,s.player.loopStart=_this.Params.loopStart,s.player.loopEnd=_this.Params.loopEnd,s.player.reverse=_this.Params.reverse})})},Recorder.prototype.UpdateWaveform=function(){this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(this.BufferSource.buffer,200,2,95);var duration=this.GetDuration();this.Params.endPosition=duration,this.Params.loopStart=duration*.5,this.Params.loopEnd=duration,this.RefreshOptionsPanel()},Recorder.prototype.GetDuration=function(){return this.BufferSource&&this.BufferSource.buffer!==null?this.BufferSource.buffer.duration:10},Recorder.prototype.DownloadRecording=function(){var _this=this;this.Recorder.exportWAV(function(blob){console.log("Downloading audio... Filename: "+_this.Filename+", Size: "+blob.size+" bytes"),_this.Recorder.setupDownload(blob,_this.Filename)})},Recorder.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.BufferSource=null,this.Recorder.clear(),this.Recorder=null,this.RecordedBlob=null},Recorder.prototype.CreateSource=function(){var _this=this;this.Sources.push(new Tone.Simpler(this.BufferSource)),this.Sources.forEach(function(s,i){s.player.loop=_this.Params.loop,s.player.loopStart=_this.Params.loopStart,s.player.loopEnd=_this.Params.loopEnd,s.player.retrigger=_this.Params.retrigger,s.player.reverse=_this.Params.reverse,s.volume.value=_this.Params.volume,i>0&&(s.player.buffer=_this.Sources[0].player.buffer)});if(this.Sources[this.Sources.length-1])return this.Sources[this.Sources.length-1]},Recorder.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Recorder",parameters:[{type:"waveregion",name:"Recording",setting:"region",props:{value:5,min:0,max:this.GetDuration(),quantised:!1,centered:!1,wavearray:this._WaveForm,mode:this.Params.loop,emptystring:"No Sample"},nodes:[{setting:"startPosition",value:this.Params.startPosition},{setting:"endPosition",value:this.Params.endPosition},{setting:"loopStart",value:this.Params.loopStart},{setting:"loopEnd",value:this.Params.loopEnd}]},{type:"switches",name:"Loop",setting:"loop",switches:[{name:"Reverse",setting:"reverse",value:this.Params.reverse,lit:!0,mode:"offOn"},{name:"Looping",setting:"loop",value:this.Params.loop,lit:!0,mode:"offOn"}]},{type:"slider",name:"playback",setting:"playbackRate",props:{value:this.Params.playbackRate,min:.125,max:8,quantised:!1,centered:!0,logarithmic:!0}},{type:"actionbutton",name:"",setting:"download",props:{text:"Download Recording"}}]}},Recorder.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;switch(param){case"playbackRate":Tone.isSafari?this.Sources[0].player.playbackRate=value:this.Sources[0].player.playbackRate.value=value;break;case"reverse":value=value?!0:!1,console.log("out: "+value),this.Sources[0].player.reverse=value,this.Params[param]=val,this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(this.BufferSource.buffer,200,2,95),this.RefreshOptionsPanel();break;case"loop":value=value?!0:!1,this.Sources.forEach(function(s){s.player.loop=value}),value===!0&&this.IsPowered()&&this.Sources.forEach(function(s){s.player.stop(),s.player.start(s.player.startPosition)}),this.Params[param]=val,this.RefreshOptionsPanel();break;case"loopStart":this.Sources.forEach(function(s){s.player.loopStart=value});break;case"loopEnd":this.Sources.forEach(function(s){s.player.loopEnd=value});break;case"download":this.BufferSource.buffer===null?App.Message("This block doesn't have a recording to download yet."):this.DownloadRecording()}this.Params[param]=val},Recorder}(SamplerBase_1.SamplerBase);exports.Recorder=Recorder});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/RecorderPanel",["require","exports","../Blocks/Sources/Recorder"],function(require,exports,Recorder_1){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,RecorderPanel=function(_super){__extends(RecorderPanel,_super);function RecorderPanel(){_super.apply(this,arguments)}return RecorderPanel.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this._Blocks=[],this._Roll=[],this.Hover=!1},RecorderPanel.prototype.Update=function(){var blocks=[];for(var i=0;i<App.Blocks.length;i++){var block=App.Blocks[i];block instanceof Recorder_1.Recorder&&blocks.push(block)}this._Blocks=blocks},RecorderPanel.prototype.Draw=function(){for(var i=0;i<this._Blocks.length;i++){var block=this._Blocks[i],myPos=App.Metrics.PointOnGrid(block.Position);this.DrawPanel(myPos.x,myPos.y,block.IsRecording,this._Roll[i])}},RecorderPanel.prototype.DrawPanel=function(x,y,rec,hover){var units=App.Unit,grd=App.GridSize,ctx=this.Ctx,w=grd*3,h=grd*3;App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=.16,this.BGDraw(x,y+5*units,w,h,ctx),ctx.globalAlpha=.9,this.BGDraw(x,y,w,h,ctx),ctx.globalAlpha=1,rec?App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]):App.FillColor(ctx,App.Palette[13]),ctx.beginPath(),ctx.moveTo(x-grd,y-w*.5-h*.5),ctx.lineTo(x,y-w*.5-h*.5-grd),ctx.lineTo(x+grd,y-w*.5-h*.5),ctx.lineTo(x,y-w*.5-h*.5+grd),ctx.closePath(),ctx.fill(),rec?App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]):App.FillColor(ctx,App.Palette[12]),ctx.beginPath(),ctx.moveTo(x-grd,y-w*.5-h*.5),ctx.lineTo(x,y-w*.5-h*.5-grd),ctx.lineTo(x,y-w*.5-h*.5+grd),ctx.closePath(),ctx.fill(),hover&&(App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillRect(x-grd,y-w*.5-h*.5-grd,4*units,4*units))},RecorderPanel.prototype.BGDraw=function(x,y,w,h,ctx){ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(x-w*.5,y-w*.5),ctx.lineTo(x-w*.5,y-w*.5-h),ctx.lineTo(x+w*.5,y-w*.5-h),ctx.lineTo(x+w*.5,y-w*.5),ctx.lineTo(x,y-w*.5),ctx.closePath(),ctx.fill()},RecorderPanel.prototype.MouseDown=function(point){this.RolloverCheck(point);for(var i=0;i<this._Blocks.length;i++)this._Roll[i]&&this._Blocks[i].ToggleRecording()},RecorderPanel.prototype.MouseMove=function(point){this.RolloverCheck(point)},RecorderPanel.prototype.RolloverCheck=function(point){this.Hover=!1;var grd=App.GridSize,w=grd*3,h=grd*3;for(var i=0;i<this._Blocks.length;i++){var block=this._Blocks[i],myPos=App.Metrics.PointOnGrid(block.Position);this._Roll[i]=Dimensions.HitRect(myPos.x-w*.5,myPos.y-w*.5-h,w,h,point.x,point.y),this._Roll[i]==1&&(console.log("ROLL "+i),this.Hover=!0)}},RecorderPanel}(DisplayObject);exports.RecorderPanel=RecorderPanel});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/Sampler",["require","exports","./SamplerBase"],function(require,exports,SamplerBase_1){var Point=etch.primitives.Point,Sampler=function(_super){__extends(Sampler,_super);function Sampler(){_super.apply(this,arguments),this._FirstRelease=!0,this._LoadFromShare=!1,this._fileInput=document.getElementById("audioFileInput")}return Sampler.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Sampler.name,this.Params&&(this._LoadFromShare=!0,setTimeout(function(){_this.FirstSetup()},100)),this.Defaults={playbackRate:1,reverse:!1,startPosition:0,endPosition:null,loop:!0,loopStart:0,loopEnd:0,retrigger:!1,volume:11,track:"",trackName:"",permalink:""},this.PopulateParams(),this._WaveForm=[],_super.prototype.Init.call(this,drawTo),this.FileReaderInit(),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(2,0),new Point(1,1),new Point(0,1))},Sampler.prototype.FirstSetup=function(){var _this=this;this._FirstRelease&&(this.Envelopes.forEach(function(e,i){e=_this.Sources[i].envelope}),this.Sources.forEach(function(s){s.connect(_this.AudioInput)}),this.FileReaderInit(),this.HandleFileUploadButtonClick(),this._FirstRelease=!1)},Sampler.prototype.FileReaderInit=function(){window.File&&window.FileReader&&window.FileList&&window.Blob||App.Message("The File APIs are not fully supported in this browser."),this._fileInput.addEventListener("change",this.HandleFileUploadButton.bind(this),!1)},Sampler.prototype.HandleFileUploadButtonClick=function(){var event=document.createEvent("HTMLEvents");event.initEvent("click",!0,!1),this._fileInput.dispatchEvent(event)},Sampler.prototype.HandleFileUploadButton=function(e){var _this=this,files=e.target.files;App.Audio.AudioFileManager.DecodeFileData(files,function(file,buffer){buffer&&(_this.SetBuffers(buffer),_this.Params.trackName=files[0].name)})},Sampler.prototype.SetBuffers=function(buffer){var _this=this;this.Sources.forEach(function(s){s.triggerRelease()}),App.AnimationsLayer.AddToList(this),this._FirstBuffer&&this._FirstBuffer.dispose(),this._FirstBuffer=new Tone.Buffer,this._FirstBuffer.buffer=buffer,this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(buffer,200,5,95),App.AnimationsLayer.RemoveFromList(this);var duration=this.GetDuration(this._FirstBuffer);this._LoadFromShare||(this.Params.startPosition=0,this.Params.endPosition=duration,this.Params.loopStart=duration*.5,this.Params.loopEnd=duration),this._LoadFromShare=!1,this.RefreshOptionsPanel(),this.Sources.forEach(function(s){s.player.buffer=buffer,s.player.loopStart=_this.Params.loopStart,s.player.loopEnd=_this.Params.loopEnd,s.player.reverse=_this.Params.reverse}),this.IsPowered()&&this.TriggerAttack(),this._FirstBuffer.onerror=function(){console.error("Error loading audio file"),App.Message("Error loading audio file")}},Sampler.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Sampler.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Sampler",parameters:[{type:"waveregion",name:"Region",setting:"region",props:{value:5,min:0,max:this.GetDuration(this._FirstBuffer),quantised:!1,centered:!1,wavearray:this._WaveForm,mode:this.Params.loop},nodes:[{setting:"startPosition",value:this.Params.startPosition},{setting:"endPosition",value:this.Params.endPosition},{setting:"loopStart",value:this.Params.loopStart},{setting:"loopEnd",value:this.Params.loopEnd}]},{type:"sample",name:"Sample",setting:"sample",props:{track:this.Params.track}},{type:"switches",name:"Loop",setting:"loop",switches:[{name:"Reverse",setting:"reverse",value:this.Params.reverse,lit:!0},{name:"Looping",setting:"loop",value:this.Params.loop,lit:!0}]},{type:"slider",name:"playback",setting:"playbackRate",props:{value:this.Params.playbackRate,min:.125,max:8,quantised:!1,centered:!0,logarithmic:!0}}]}},Sampler.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;switch(param){case"playbackRate":Tone.isSafari?this.Sources[0].player.playbackRate=value:this.Sources[0].player.playbackRate.value=value;break;case"reverse":value=value?!0:!1,this.Sources[0].player.reverse=value,this.Params[param]=val,this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(this._FirstBuffer.buffer,200,5,95),this.RefreshOptionsPanel();break;case"loop":value=value?!0:!1,this.Sources.forEach(function(s){s.player.loop=value}),value===!0&&this.IsPowered()&&this.Sources.forEach(function(s){s.player.stop(),s.player.start(s.player.startPosition)}),this.Params[param]=val,this.RefreshOptionsPanel();break;case"loopStart":this.Sources.forEach(function(s){s.player.loopStart=value});break;case"loopEnd":this.Sources.forEach(function(s){s.player.loopEnd=value})}this.Params[param]=value},Sampler.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this._fileInput.removeEventListener("change",this.HandleFileUploadButton,!1)},Sampler}(SamplerBase_1.SamplerBase);exports.Sampler=Sampler});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionColorTheme",["require","exports","./Option"],function(require,exports,Option_1){var ThemeSelector=function(_super){__extends(ThemeSelector,_super);function ThemeSelector(name){_super.call(this),this.Type="themeSelector",this.Name=name,this.HandleRoll=[]}return ThemeSelector.prototype.Draw=function(ctx,units,i,panel,yoveride){_super.prototype.Draw.call(this,ctx,units,i,panel);var width=panel.Range,height=60*units,x=panel.Margin,y=yoveride||0,dataType=Math.round(units*10);ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke()),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(App.ThemeManager.CurrentTheme.Name,x+width*.5-15*units,y+height*.5+6*units),ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+dataType*.4),ctx.beginPath(),ctx.moveTo(x+20*units,y+height*.5-20*units),ctx.lineTo(x,y+height*.5),ctx.lineTo(x+20*units,y+height*.5+20*units),ctx.moveTo(x+width-20*units,y+height*.5-20*units),ctx.lineTo(x+width,y+height*.5),ctx.lineTo(x+width-20*units,y+height*.5+20*units),ctx.stroke();var grd=App.GridSize*.5,dx=x+width*.5,dy=y+height*.5-grd*.5,startX=3;App.FillColor(ctx,App.Palette[0]),this.DrawDiamond(ctx,dx+grd*startX,dy),App.FillColor(ctx,App.Palette[1]),this.DrawDiamond(ctx,dx+grd*(startX+1),dy+grd),App.FillColor(ctx,App.Palette[3]),this.DrawDiamond(ctx,dx+grd*(startX+2),dy),App.FillColor(ctx,App.Palette[4]),this.DrawDiamond(ctx,dx+grd*(startX+3),dy+grd),App.FillColor(ctx,App.Palette[5]),this.DrawDiamond(ctx,dx+grd*(startX+4),dy),App.FillColor(ctx,App.Palette[6]),this.DrawDiamond(ctx,dx+grd*(startX+5),dy+grd),App.FillColor(ctx,App.Palette[7]),this.DrawDiamond(ctx,dx+grd*(startX+6),dy),App.FillColor(ctx,App.Palette[8]),this.DrawDiamond(ctx,dx+grd*(startX+7),dy+grd),App.FillColor(ctx,App.Palette[9]),this.DrawDiamond(ctx,dx+grd*(startX+8),dy),App.FillColor(ctx,App.Palette[10]),this.DrawDiamond(ctx,dx+grd*(startX+9),dy+grd),App.FillColor(ctx,App.Palette[14]),this.DrawDiamond(ctx,dx+grd*(startX+10),dy),App.StrokeColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(x+width*.5,y+5*units),ctx.lineTo(x+width*.5,y+height-5*units),ctx.stroke()},ThemeSelector.prototype.DrawDiamond=function(ctx,x,y){var grd=App.GridSize*.5;ctx.beginPath(),ctx.moveTo(x,y-grd),ctx.lineTo(x-grd,y),ctx.lineTo(x,y+grd),ctx.lineTo(x+grd,y),ctx.closePath(),ctx.fill()},ThemeSelector}(Option_1.Option);exports.ThemeSelector=ThemeSelector});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Options/OptionMeter",["require","exports","./Option"],function(require,exports,Option_1){var OptionMeter=function(_super){__extends(OptionMeter,_super);function OptionMeter(name){_super.call(this),this.Type="meter",this.Name=name,this.Level=0,this.Peak=0,this._Zero=0}return OptionMeter.prototype.Draw=function(ctx,units,i,panel,yoveride){_super.prototype.Draw.call(this,ctx,units,i,panel);var width=panel.Range,height=48*units,x=panel.Margin,y=yoveride||0,dataType=Math.round(units*10);this.Monitor(panel),ctx.globalAlpha=1,App.StrokeColor(ctx,App.Palette[1]),i!==panel.Options.length-1&&(ctx.beginPath(),ctx.moveTo(panel.Margin-units,y+height),ctx.lineTo(panel.Range+panel.Margin+units,y+height),ctx.stroke()),this.DiagonalFill(ctx,x+this._Zero,y+units,panel.Range-this._Zero,46*units,9),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=App.Metrics.TxtMid,ctx.textAlign="right",ctx.fillText(this.Name.toUpperCase(),panel.Margin-15*units,y+height*.5+dataType*.4);var bodyType=units*5;ctx.font="400 "+bodyType+"px PT Sans",ctx.textAlign="right",ctx.fillText("0dB",x+this._Zero-5*units,y+height*.5+2.5*units);var col=panel.SliderColours[i-Math.floor(i/panel.SliderColours.length)*panel.SliderColours.length];App.FillColor(ctx,col),ctx.fillRect(x-units,y+9*units,units+this.Level,30*units),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillRect(x+this.Peak-.5*units,y+9*units,units,30*units),ctx.beginPath(),ctx.moveTo(x+this.Peak-2*units,y+height*.5),ctx.lineTo(x+this.Peak,y+height*.5-2*units),ctx.lineTo(x+this.Peak+2*units,y+height*.5),ctx.lineTo(x+this.Peak,y+height*.5+2*units),ctx.closePath(),ctx.fill()},OptionMeter.prototype.Monitor=function(panel){App.Audio.Monitor();var min=-50,max=10;this.Level=panel.linPosition(0,panel.Range,min,max,App.Audio.Level),this.Level=panel.ValueInRange(this.Level,0,panel.Range),this._Zero=panel.linPosition(0,panel.Range,min,max,0),this.Level>this.Peak&&(this.Peak=this.Level)},OptionMeter.prototype.MonitorReset=function(){App.Audio.MonitorReset(),this.Peak=0},OptionMeter}(Option_1.Option);exports.OptionMeter=OptionMeter});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/SettingsPanel",["require","exports","../Device","./MenuCategory","./Options/OptionColorTheme","./../_Version","./Options/OptionSlider","./Options/OptionMeter","./Options/OptionActionButton"],function(require,exports,Device_1,MenuCategory_1,OptionColorTheme_1,_Version_1,OptionSlider_1,OptionMeter_1,OptionActionButton_1){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,Size=minerva.Size,SettingsPanel=function(_super){__extends(SettingsPanel,_super);function SettingsPanel(){_super.apply(this,arguments),this.MenuItems=[]}return SettingsPanel.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Open=!1,this.OffsetY=-this.DrawTo.Height,this._RollOvers=[],this.Height=60,this.MenuItems=[],this._MenuCols=App.ThemeManager.MenuOrder,this._OpenTab=0,this._VersionNumber=_Version_1.Version,this.Range=0,this.Margin=0,this.SliderColours=[],this.Options=[],this._OptionsRoll=[],this._Attribution=App.L10n.Attribution,this._Attribution.build=String.format(this._Attribution.build,this._VersionNumber),this.MenuJson={categories:[{name:"settings"},{name:"connect"},{name:"about"}]},this._CopyJson={guideLine:"Visit the BlokDust companion guide for an in depth Wiki, tutorials, news & more:",guideURL:"BlokDust Guide",copyLine:"Spread the word about BlokDust:",connectLine:"Connect with BlokDust elsewhere:",generateLine:"Randomise Title",facebook:"share on facebook",twitter:"share on twitter",google:"share on google +",bookmark:"bookmark creation",tweetText:"Browser-based music making with @blokdust - ",links:["FACEBOOK","TWITTER","YOUTUBE","GITHUB"],urls:["guide.blokdust.com","facebook.com/blokdust","twitter.com/blokdust","youtube.com/channel/UCukBbnIMiUZBbD4fJHrcHZQ","github.com/BlokDust/BlokDust"]},this.Populate(this.MenuJson)},SettingsPanel.prototype.Populate=function(json){var units=App.Unit,ctx=this.Ctx,dataType=units*10,gutter=60,menuCats=[];App.Metrics.Device!==Device_1.Device.desktop&&(gutter=40);var n=json.categories.length;ctx.font="400 "+dataType+"px Dosis",ctx.textAlign="left";var catWidth=[],menuWidth=this.DrawTo.Width/7*4;for(var i=0;i<n;i++)catWidth[i]=ctx.measureText(json.categories[i].name.toUpperCase()).width+gutter*units;var catX=this.DrawTo.Width*.5-menuWidth*.5;for(var i=0;i<n;i++){var name=json.categories[i].name.toUpperCase(),point=new Point(catX+catWidth[i]*.5,0),size=new Size(catWidth[i],16),offset=-this.DrawTo.Height;this._OpenTab===i&&(offset=0),menuCats[i]=new MenuCategory_1.MenuCategory(point,size,name,offset),catX+=catWidth[i]}this.MenuItems=menuCats,this.MenuItems[this._OpenTab].Selected=1,this._LinkWidth=[],this._LinksWidth=0;for(var i=0;i<this._CopyJson.links.length;i++)this._LinkWidth[i]=ctx.measureText(this._CopyJson.links[i]).width,this._LinksWidth+=this._LinkWidth[i];this.PopulateOptions()},SettingsPanel.prototype.Draw=function(){var ctx=this.Ctx,midType=App.Metrics.TxtMid,headType=App.Metrics.TxtHeader,largeType=App.Metrics.TxtLarge,urlType=App.Metrics.TxtUrl2,italicType2=App.Metrics.TxtItalic2,units=App.Unit,grid=App.GridSize,centerY=this.OffsetY+App.Height*.5,tabY=this.OffsetY,menuWidth=App.Width/7*4,halfWidth=menuWidth*.5,dx=App.Width*.5,leftX=dx-halfWidth,pageY=tabY+120*units,tab;if(this.Open){App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=.95,this.Open&&ctx.fillRect(0,this.OffsetY,App.Width,App.Height),ctx.globalAlpha=1;var closeY=tabY+30*units;ctx.lineWidth=2,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(dx+halfWidth+12.5*units,closeY-7.5*units),ctx.lineTo(dx+halfWidth+27.5*units,closeY+7.5*units),ctx.moveTo(dx+halfWidth+27.5*units,closeY-7.5*units),ctx.lineTo(dx+halfWidth+12.5*units,closeY+7.5*units),ctx.stroke();var gutter=40*units,thirdWidth=(menuWidth-gutter*2)/3,thirdY=pageY+130*units,x1=dx-halfWidth,x2=dx-halfWidth+thirdWidth+gutter,x3=dx-halfWidth+thirdWidth*2+gutter*2;ctx.textAlign="left",ctx.font=headType,ctx.fillText(this._Attribution.title.toUpperCase(),20*units,this.OffsetY+30*units+11*units),ctx.save(),ctx.beginPath(),ctx.moveTo(dx-App.Width*.5,tabY+60*units),ctx.lineTo(dx+App.Width*.5,tabY+60*units),ctx.lineTo(dx+App.Width*.5,App.Height),ctx.lineTo(dx-App.Width*.5,App.Height),ctx.closePath(),ctx.clip(),tab=this.MenuItems[0].YOffset,this.Options[0].Draw(ctx,units,0,this,pageY+tab),this.Options[1].Draw(ctx,units,1,this,pageY+tab+60*units),this.Options[2].Draw(ctx,units,2,this,pageY+tab+108*units),this.Options[3].Draw(ctx,units,3,this,pageY+tab+156*units),tab=this.MenuItems[1].YOffset,App.FillColor(ctx,App.Palette[4]),ctx.fillRect(dx-210*units,pageY+tab+10*units,420*units,40*units),this._RollOvers[7]&&(ctx.beginPath(),ctx.moveTo(dx,pageY+tab+59*units),ctx.lineTo(dx+10*units,pageY+tab+49*units),ctx.lineTo(dx-10*units,pageY+tab+49*units),ctx.closePath(),ctx.fill()),ctx.font=urlType,ctx.textAlign="center",App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillText(this._CopyJson.guideURL.toUpperCase(),dx,pageY+tab+39*units);var shareY=pageY+tab+155*units,elsewhereY=pageY+tab+110*units;ctx.fillStyle="#fc4742",ctx.fillRect(dx+80*units,shareY,130*units,30*units),this._RollOvers[10]&&(ctx.beginPath(),ctx.moveTo(dx+145*units,shareY+39*units),ctx.lineTo(dx+135*units,shareY+29*units),ctx.lineTo(dx+155*units,shareY+29*units),ctx.closePath(),ctx.fill()),ctx.fillStyle="#2db0e7",ctx.fillRect(dx-65*units,shareY,130*units,30*units),this._RollOvers[9]&&(ctx.beginPath(),ctx.moveTo(dx,shareY+39*units),ctx.lineTo(dx-10*units,shareY+29*units),ctx.lineTo(dx+10*units,shareY+29*units),ctx.closePath(),ctx.fill()),ctx.fillStyle="#2152ad",ctx.fillRect(dx-210*units,shareY,130*units,30*units),this._RollOvers[8]&&(ctx.beginPath(),ctx.moveTo(dx-145*units,shareY+39*units),ctx.lineTo(dx-135*units,shareY+29*units),ctx.lineTo(dx-155*units,shareY+29*units),ctx.closePath(),ctx.fill()),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.textAlign="center",ctx.font=italicType2,ctx.fillText(this._CopyJson.copyLine,dx,shareY-10*units),ctx.fillText(this._CopyJson.connectLine,dx,elsewhereY-25*units),ctx.fillText(this._CopyJson.guideLine,dx,pageY+tab),ctx.textAlign="center",ctx.font=midType,ctx.fillText(this._CopyJson.facebook.toUpperCase(),dx-145*units,shareY+18.5*units),ctx.fillText(this._CopyJson.twitter.toUpperCase(),dx,shareY+18.5*units),ctx.fillText(this._CopyJson.google.toUpperCase(),dx+145*units,shareY+18.5*units);var spacer=30*units,linkWidth=this._LinkWidth,linksWidth=this._LinksWidth+spacer*3;ctx.textAlign="left",ctx.fillText(this._CopyJson.links[0],dx-linksWidth*.5,elsewhereY),ctx.fillText(this._CopyJson.links[1],dx-linksWidth*.5+linkWidth[0]+spacer,elsewhereY),ctx.fillText(this._CopyJson.links[2],dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+spacer*2,elsewhereY),ctx.fillText(this._CopyJson.links[3],dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+spacer*3,elsewhereY),App.StrokeColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(dx-linksWidth*.5+linkWidth[0]+spacer*.5,elsewhereY-15*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0]+spacer*.5,elsewhereY+10*units),ctx.moveTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+spacer*1.5,elsewhereY-15*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+spacer*1.5,elsewhereY+10*units),ctx.moveTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+spacer*2.5,elsewhereY-15*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+spacer*2.5,elsewhereY+10*units),ctx.stroke(),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=1,ctx.beginPath(),this._RollOvers[11]&&(ctx.moveTo(dx-linksWidth*.5,elsewhereY+2*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0],elsewhereY+2*units)),this._RollOvers[12]&&(ctx.moveTo(dx-linksWidth*.5+linkWidth[0]+spacer,elsewhereY+2*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+spacer,elsewhereY+2*units)),this._RollOvers[13]&&(ctx.moveTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+spacer*2,elsewhereY+2*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+spacer*2,elsewhereY+2*units)),this._RollOvers[14]&&(ctx.moveTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+spacer*3,elsewhereY+2*units),ctx.lineTo(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+linkWidth[3]+spacer*3,elsewhereY+2*units)),ctx.stroke(),tab=this.MenuItems[2].YOffset,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=largeType,ctx.textAlign="left",this.WordWrap(ctx,this._Attribution.about,dx-halfWidth,pageY+tab,units*16,Math.ceil(menuWidth));var xs=[x1,x2,x3],widths=[],strings=[this._Attribution.twyman.url,this._Attribution.phillips.url,this._Attribution.silverton.url,this._Attribution.twyman.twitter,this._Attribution.phillips.twitter,this._Attribution.silverton.twitter];ctx.font=italicType2;for(var i=1;i<=strings.length;i++)widths.push(ctx.measureText(strings[i-1]).width);App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=1;for(var i=1;i<4;i++)this._RollOvers[i]&&(ctx.beginPath(),ctx.moveTo(xs[i-1],thirdY+44*units+tab),ctx.lineTo(xs[i-1]+widths[i-1],thirdY+44*units+tab),ctx.stroke()),this._RollOvers[i+3]&&(ctx.beginPath(),ctx.moveTo(xs[i-1],thirdY+58*units+tab),ctx.lineTo(xs[i-1]+widths[i+2],thirdY+58*units+tab),ctx.stroke());App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),this.WordWrap(ctx,this._Attribution.twyman.blurb,x1,thirdY+tab,units*14,Math.ceil(thirdWidth)),this.WordWrap(ctx,this._Attribution.phillips.blurb,x2,thirdY+tab,units*14,Math.ceil(thirdWidth)),this.WordWrap(ctx,this._Attribution.silverton.blurb,x3,thirdY+tab,units*14,Math.ceil(thirdWidth)),ctx.fillText(this._Attribution.twyman.url,x1,thirdY+42*units+tab),ctx.fillText(this._Attribution.phillips.url,x2,thirdY+42*units+tab),ctx.fillText(this._Attribution.silverton.url,x3,thirdY+42*units+tab),ctx.fillText(this._Attribution.twyman.twitter,x1,thirdY+56*units+tab),ctx.fillText(this._Attribution.phillips.twitter,x2,thirdY+56*units+tab),ctx.fillText(this._Attribution.silverton.twitter,x3,thirdY+56*units+tab);var blockY=thirdY-grid-10*units+tab;App.FillColor(ctx,App.Palette[4]),ctx.beginPath(),ctx.moveTo(x1,blockY-grid*3),ctx.lineTo(x1+grid,blockY-grid*3),ctx.lineTo(x1+grid*2,blockY-grid*2),ctx.lineTo(x1+grid,blockY-grid),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(x1+grid,blockY),ctx.lineTo(x1+grid*2,blockY-grid),ctx.lineTo(x1+grid*2,blockY),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[5]),ctx.beginPath(),ctx.moveTo(x2,blockY),ctx.lineTo(x2,blockY-grid),ctx.lineTo(x2+grid,blockY-grid*2),ctx.lineTo(x2+grid*3,blockY-grid*2),ctx.lineTo(x2+grid,blockY),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[7]),ctx.beginPath(),ctx.moveTo(x3,blockY),ctx.lineTo(x3+grid,blockY-grid*3),ctx.lineTo(x3+grid*2,blockY-grid*3),ctx.lineTo(x3+grid*2,blockY-grid),ctx.lineTo(x3+grid,blockY),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[3]),ctx.beginPath(),ctx.moveTo(x1,blockY),ctx.lineTo(x1,blockY-grid*3),ctx.lineTo(x1+grid,blockY-grid*2),ctx.lineTo(x1+grid,blockY-grid),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[10]),ctx.beginPath(),ctx.moveTo(x2,blockY),ctx.lineTo(x2,blockY-grid),ctx.lineTo(x2+grid,blockY-grid*2),ctx.lineTo(x2+grid,blockY),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(x2,blockY-grid*3),ctx.lineTo(x2+grid,blockY-grid*3),ctx.lineTo(x2,blockY-grid*2),ctx.closePath(),ctx.fill(),App.FillColor(ctx,App.Palette[9]),ctx.beginPath(),ctx.moveTo(x3,blockY),ctx.lineTo(x3,blockY-grid*2),ctx.lineTo(x3+grid,blockY-grid*3),ctx.lineTo(x3+grid,blockY-grid),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(x3+grid*2,blockY),ctx.lineTo(x3+grid*3,blockY),ctx.lineTo(x3+grid*3,blockY-grid),ctx.closePath(),ctx.fill(),ctx.restore(),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.font=italicType2,ctx.textAlign="right",ctx.fillText(this._Attribution.build,this.DrawTo.Width-20*units,this.OffsetY+this.DrawTo.Height-20*units),ctx.lineWidth=2,App.StrokeColor(ctx,App.Palette[1]),ctx.beginPath(),ctx.moveTo(dx-halfWidth,tabY+60*units-1),ctx.lineTo(dx+halfWidth,tabY+60*units-1);for(var i=0;i<this.MenuItems.length;i++){var cat=this.MenuItems[i],menuX=cat.Position.x;i>0&&(ctx.moveTo(Math.round(menuX-cat.Size.width*.5),tabY+16*units),ctx.lineTo(Math.round(menuX-cat.Size.width*.5),tabY+44*units))}ctx.stroke(),ctx.textAlign="center",ctx.font=midType;for(var i=0;i<this.MenuItems.length;i++){ctx.globalAlpha=1;var cat=this.MenuItems[i],col=this._MenuCols[i-Math.floor(i/this._MenuCols.length)*this._MenuCols.length];App.FillColor(ctx,App.Palette[col]),cat.Draw(ctx,units,this,tabY)}}},SettingsPanel.prototype.WordWrap=function(context,text,x,y,lineHeight,fitWidth){fitWidth=fitWidth||0;if(fitWidth<=0){context.fillText(text,x,y);return}var words=text.split(" "),currentLine=0,idx=1;while(words.length>0&&idx<=words.length){var str=words.slice(0,idx).join(" "),w=context.measureText(str).width;w>fitWidth?(idx==1&&(idx=2),context.fillText(words.slice(0,idx-1).join(" "),x,y+lineHeight*currentLine),currentLine++,words=words.splice(idx-1),idx=1):idx++}idx>0&&context.fillText(words.join(" "),x,y+lineHeight*currentLine)},SettingsPanel.prototype.NumberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},SettingsPanel.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x}),offsetTween.onComplete(function(){v==="OffsetY"&&destination!==0&&(panel.Open=!1)}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick)},SettingsPanel.prototype.OpenPanel=function(){this.Open=!0,this.OffsetY=-this.DrawTo.Height,this.DelayTo(this,0,500,0,"OffsetY"),this.MenuItems[this._OpenTab].YOffset=0},SettingsPanel.prototype.ClosePanel=function(){this.DelayTo(this,-this.DrawTo.Height,500,0,"OffsetY")},SettingsPanel.prototype.PopulateOptions=function(){var optionList=[],optionY=[],optionNames=["Color Theme","Master Volume","DB Meter","Tour"],units=App.Unit,centerY=this.OffsetY+this.DrawTo.Height*.5,tabY=this.OffsetY,pageY=tabY+120*units,dx=this.DrawTo.Width*.5,menuWidth=this.DrawTo.Width/7*4,halfWidth=menuWidth*.5,mw=0;this.Ctx.font=App.Metrics.TxtMid;for(var i=0;i<optionNames.length;i++){var nw=this.Ctx.measureText(optionNames[i].toUpperCase()).width;nw>mw&&(mw=nw)}var marginWidth=mw+15*units;this.Margin=dx-halfWidth+marginWidth,this.Range=menuWidth-marginWidth;var order=App.ThemeManager.OptionsOrder;this.SliderColours=[App.Palette[order[0]],App.Palette[order[1]],App.Palette[order[2]],App.Palette[order[3]],App.Palette[order[4]]],optionList.push(new OptionColorTheme_1.ThemeSelector(optionNames[0]));var sliderValue=App.Audio.Master.volume.value+70,sliderSetting="volume",sliderX=this.linPosition(0,this.Range,0,60,sliderValue),sliderO=this.Margin;optionList.push(new OptionSlider_1.Slider(new Point(sliderX,pageY+this.MenuItems[1].YOffset+60*units),new Size(1,48*App.Unit),sliderO,sliderValue,0,60,!0,optionNames[1],sliderSetting,!1)),optionList.push(new OptionMeter_1.OptionMeter(optionNames[2])),optionList.push(new OptionActionButton_1.OptionActionButton(new Point(0,pageY+this.MenuItems[1].YOffset+156*units),new Size(1,48*App.Unit),optionNames[3],"Launch Tutorial","tutorial")),this.Options=optionList},SettingsPanel.prototype.MouseDown=function(point){this.HitTests(point);if(this._RollOvers[0]){this.ClosePanel();return}if(this._OpenTab===0)for(var i=0;i<this.Options.length;i++)if(this._OptionsRoll[i]){this.Options[i].Selected=!0;if(this.Options[i].Type=="themeSelector"){var option=this.Options[i];option.HandleRoll[0]&&(App.ThemeManager.CurrentThemeNo-=1,App.ThemeManager.CurrentThemeNo<0&&(App.ThemeManager.CurrentThemeNo=App.ThemeManager.Themes.length-1),App.ThemeManager.LoadTheme(App.ThemeManager.CurrentThemeNo)),option.HandleRoll[1]&&(App.ThemeManager.CurrentThemeNo+=1,App.ThemeManager.CurrentThemeNo>App.ThemeManager.Themes.length-1&&(App.ThemeManager.CurrentThemeNo=0),App.ThemeManager.LoadTheme(App.ThemeManager.CurrentThemeNo))}this.Options[i].Type=="slider"&&this.SliderSet(i,point.x),this.Options[i].Type=="meter"&&this.Options[i].MonitorReset(),this.Options[i].Type=="actionbutton"&&this.Options[i].HandleRoll[0]&&this.ActionButton(this.Options[i].Setting)}for(var i=0;i<this.MenuItems.length;i++)if(this.MenuItems[i].Hover){window.TWEEN.removeAll();var cat=this.MenuItems[i];this.DelayTo(cat,1,400,0,"Selected"),this.DelayTo(cat,0,400,400,"YOffset"),this._OpenTab=i;for(var j=0;j<this.MenuItems.length;j++)if(j!==i){var cat=this.MenuItems[j];this.DelayTo(cat,0,250,0,"Selected"),this.DelayTo(cat,-this.DrawTo.Height,250,0,"YOffset")}return}if(this._OpenTab===1){var bdUrls=this._CopyJson.urls;this._RollOvers[7]&&window.open("http://"+bdUrls[0],"_blank"),this._RollOvers[8]&&this.ShareFacebook(),this._RollOvers[9]&&this.ShareTwitter(),this._RollOvers[10]&&this.ShareGoogle(),this._RollOvers[11]&&window.open("http://"+bdUrls[1],"_blank"),this._RollOvers[12]&&window.open("http://"+bdUrls[2],"_blank"),this._RollOvers[13]&&window.open("http://"+bdUrls[3],"_blank"),this._RollOvers[14]&&window.open("http://"+bdUrls[4],"_blank")}if(this._OpenTab===2){var urls=[this._Attribution.twyman.url,this._Attribution.phillips.url,this._Attribution.silverton.url,this._Attribution.twyman.twitter,this._Attribution.phillips.twitter,this._Attribution.silverton.twitter];for(var i=1;i<7;i++)this._RollOvers[i]&&(i>3?window.open("http://twitter.com/"+urls[i-1],"_blank"):window.open("http://"+urls[i-1],"_blank"))}},SettingsPanel.prototype.MouseMove=function(point){this.HitTests(point);for(var i=0;i<this.Options.length;i++)this.Options[i].Selected&&this.Options[i].Type=="slider"&&this.SliderSet(i,point.x)},SettingsPanel.prototype.HitTests=function(point){var units=App.Unit,centerY=this.OffsetY+this.DrawTo.Height*.5,tabY=this.OffsetY,pageY=tabY+120*units,closeY=tabY+30*units,dx=this.DrawTo.Width*.5,menuWidth=this.DrawTo.Width/7*4,halfWidth=menuWidth*.5,gutter=40*units,thirdWidth=(menuWidth-gutter*2)/3,thirdY=pageY+130*units,x1=dx-halfWidth,x2=dx-halfWidth+thirdWidth+gutter,x3=dx-halfWidth+thirdWidth*2+gutter*2,xs=[x1,x2,x3],tab;this._RollOvers[0]=Dimensions.HitRect(dx+halfWidth,closeY-20*units,40*units,40*units,point.x,point.y);for(var i=1;i<4;i++)this._RollOvers[i]=Dimensions.HitRect(xs[i-1],thirdY+25*units+this.MenuItems[2].YOffset,thirdWidth,20*units,point.x,point.y),this._RollOvers[i+3]=Dimensions.HitRect(xs[i-1],thirdY+45*units+this.MenuItems[2].YOffset,thirdWidth,20*units,point.x,point.y);tab=this.MenuItems[1].YOffset,this._RollOvers[7]=Dimensions.HitRect(dx-210*units,pageY+tab+10*units,420*units,40*units,point.x,point.y),this._RollOvers[8]=Dimensions.HitRect(dx-210*units,pageY+tab+155*units,130*units,30*units,point.x,point.y),this._RollOvers[9]=Dimensions.HitRect(dx-65*units,pageY+tab+155*units,130*units,30*units,point.x,point.y),this._RollOvers[10]=Dimensions.HitRect(dx+80*units,pageY+tab+155*units,130*units,30*units,point.x,point.y);var spacer=30*units,linkWidth=this._LinkWidth,linksWidth=this._LinksWidth+spacer*3;this._RollOvers[11]=Dimensions.HitRect(dx-linksWidth*.5-spacer*.5,pageY+tab+90*units,linkWidth[0]+spacer,30*units,point.x,point.y),this._RollOvers[12]=Dimensions.HitRect(dx-linksWidth*.5+linkWidth[0]+spacer*.5,pageY+tab+90*units,linkWidth[1]+spacer,30*units,point.x,point.y),this._RollOvers[13]=Dimensions.HitRect(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+spacer*1.5,pageY+tab+90*units,linkWidth[2]+spacer,30*units,point.x,point.y),this._RollOvers[14]=Dimensions.HitRect(dx-linksWidth*.5+linkWidth[0]+linkWidth[1]+linkWidth[2]+spacer*2.5,pageY+tab+90*units,linkWidth[3]+spacer,30*units,point.x,point.y);for(var i=0;i<this.MenuItems.length;i++){var cat=this.MenuItems[i];cat.Hover=Dimensions.HitRect(cat.Position.x-cat.Size.width*.5+2*units,tabY+5*units,cat.Size.width-4*units,this.Height*units-10*units,point.x,point.y)}tab=this.MenuItems[0].YOffset;for(var i=0;i<this.Options.length;i++)this.Options[i].Type=="slider"&&(this._OptionsRoll[i]=Dimensions.HitRect(this.Margin-10*units,pageY+tab+60*units,this.Range+20*units,48*App.Unit,point.x,point.y)),this.Options[i].Type=="meter"&&(this._OptionsRoll[i]=Dimensions.HitRect(this.Margin-10*units,pageY+tab+108*units,this.Range+20*units,48*App.Unit,point.x,point.y)),this.Options[i].Type=="themeSelector"&&(this._OptionsRoll[i]=Dimensions.HitRect(this.Margin-10*units,pageY+tab,this.Range+20*units,60*App.Unit,point.x,point.y),this.Options[i].HandleRoll[0]=Dimensions.HitRect(this.Margin-10*units,pageY+tab,40*units,60*units,point.x,point.y),this.Options[i].HandleRoll[1]=Dimensions.HitRect(this.Margin+this.Range-30*units,pageY+tab,40*units,60*units,point.x,point.y)),this.Options[i].Type=="actionbutton"&&(this._OptionsRoll[i]=Dimensions.HitRect(this.Margin-10*units,pageY+tab+156*units,this.Range+20*units,48*App.Unit,point.x,point.y),this.Options[i].HandleRoll[0]=Dimensions.HitRect(this.Margin+this.Range*.25,pageY+tab+156*units,this.Range*.5,this.Options[i].Size.height,point.x,point.y))},SettingsPanel.prototype.MouseUp=function(point){for(var i=0;i<this.Options.length;i++)this.Options[i].Selected=!1},SettingsPanel.prototype.SliderSet=function(n,mx){var units=App.Unit,centerY=this.OffsetY+this.DrawTo.Height*.5,tabY=this.OffsetY,pageY=tabY+120*units,dx=this.DrawTo.Width*.5,menuWidth=this.DrawTo.Width/7*4,halfWidth=menuWidth*.5;this.Options[n].Position.x=mx-this.Margin,this.Options[n].Position.x=this.ValueInRange(this.Options[n].Position.x,0,this.Range);var log=!1;this.UpdateValue(this.Options[n],"Value","Min","Max",0,this.Range,"Setting","x",log)},SettingsPanel.prototype.ActionButton=function(setting){switch(setting){case"tutorial":console.log("tutorial manually launched")}},SettingsPanel.prototype.UpdateValue=function(object,value,min,max,rangemin,rangemax,setting,axis,log){object[""+value]=this.linValue(rangemin,rangemax,object[""+min],object[""+max],object.Position[""+axis]),object.Quantised&&(object[""+value]=Math.round(object[""+value]),object.Position[""+axis]=this.linPosition(rangemin,rangemax,object[""+min],object[""+max],object[""+value]));var val=object[""+value];console.log(""+object[""+setting]+" | "+val);switch(object[""+setting]){case"volume":App.Audio.Master.volume.value=val-70,val===0&&(App.Audio.Master.volume.value=val-200)}},SettingsPanel.prototype.ShareFacebook=function(){var href="http://www.facebook.com/sharer.php?";href=""+href+"u=http://blokdust.com",window.open(href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},SettingsPanel.prototype.ShareTwitter=function(){var href="https://twitter.com/intent/tweet?text=";href=""+href+encodeURIComponent(this._CopyJson.tweetText),href=""+href+"&url=http://blokdust.com",window.open(href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},SettingsPanel.prototype.ShareGoogle=function(){var href="https://plus.google.com/share?url=";href=""+href+"http://blokdust.com",window.open(href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},SettingsPanel.prototype.ValueInRange=function(value,floor,ceiling){return value<floor&&(value=floor),value>ceiling&&(value=ceiling),value},SettingsPanel.prototype.linValue=function(minpos,maxpos,minval,maxval,position){var scale=(maxval-minval)/(maxpos-minpos);return(position-minpos)*scale+minval},SettingsPanel.prototype.linPosition=function(minpos,maxpos,minval,maxval,value){var scale=(maxval-minval)/(maxpos-minpos);return minpos+(value-minval)/scale},SettingsPanel.prototype.Resize=function(){},SettingsPanel}(DisplayObject);exports.SettingsPanel=SettingsPanel});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/SharePanel",["require","exports","./../Commands"],function(require,exports,Commands_1){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,SharePanel=function(_super){__extends(SharePanel,_super);function SharePanel(){_super.apply(this,arguments),this._Blink=0}return SharePanel.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Open=!1,this._FirstSession=!0,this._Saving=!1,this._NameUrl="",this.SessionURL="",this._SessionId="",this.OffsetX=0,this.OffsetY=-this.DrawTo.Height,this._UrlSelecting=!1,this._RollOvers=[],this._CommandManager=App.CommandManager,this._CopyJson={genUrl:"Generate share link",shareLine:"Made something cool? Generate your own unique link to share it with the world (We'd love to see):",copyLine:"Share your creation with this unique URL:",titleLine:"Title",generateLine:"Randomise Title",domain:this.GetUrl()+"?c=",facebook:"post to facebook",twitter:"post to twitter",google:"post to google +",bookmark:"bookmark creation",save:"overwrite",saveAs:"create new",saving:"saving...",tweetText:"I made this @blokdust creation: "},App.SessionId&&(this._FirstSession=!1),this.GetTitleFromUrl(),this.Resize()},SharePanel.prototype.GetUrl=function(){return[location.protocol,"//",location.host,location.pathname].join("")},SharePanel.prototype.GetTitleFromUrl=function(){var decoded=decodeURI(window.location.href),getName=decoded.split("&t=");getName.length>1?(this.SessionTitle=getName[1].toUpperCase(),this._NameUrl="&t="+encodeURI(getName[1]),this.UpdateUrlText()):this.SessionTitle=this.GenerateLabel()},SharePanel.prototype.GetString=function(){return this.SessionTitle},SharePanel.prototype.UpdateString=function(string){this.SessionTitle=string,this._NameUrl="&t="+encodeURI(string.toLowerCase()),this.UpdateUrlText()},SharePanel.prototype.StringReturn=function(){},SharePanel.prototype.Draw=function(){var ctx=this.Ctx,midType=App.Metrics.TxtMid,headType=App.Metrics.TxtHeader,urlType=App.Metrics.TxtUrl2,italicType=App.Metrics.TxtItalic2,units=App.Unit,centerY=this.OffsetY+App.Height*.5,shareX=this.OffsetX+App.Width,buttonY=centerY+35*units,appWidth=App.Width,appHeight=App.Height;if(this.Open){App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=.95,ctx.fillRect(0,this.OffsetY,appWidth,appHeight),ctx.globalAlpha=1,App.FillColor(ctx,App.Palette[1]),ctx.fillRect(shareX+appWidth*.5-210*units,centerY-20*units,420*units,40*units),this._FirstSession?(this._Saving?App.FillColor(ctx,App.Palette[1]):App.FillColor(ctx,App.Palette[4]),ctx.fillRect(this.OffsetX+appWidth*.5-210*units,centerY-20*units,420*units,40*units),this._RollOvers[3]&&!this._Saving&&(ctx.beginPath(),ctx.moveTo(this.OffsetX+appWidth*.5,centerY+29*units),ctx.lineTo(this.OffsetX+appWidth*.5-10*units,centerY+19*units),ctx.lineTo(this.OffsetX+appWidth*.5+10*units,centerY+19*units),ctx.closePath(),ctx.fill()),ctx.font=urlType,ctx.textAlign="center",App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillText(this._CopyJson.genUrl.toUpperCase(),this.OffsetX+appWidth*.5,centerY+9*units),ctx.font=italicType,ctx.textAlign="left",this.WordWrap(ctx,this._CopyJson.shareLine,this.OffsetX+appWidth*.5-210*units,centerY-59*units,14*units,210*units)):(this._Saving?App.FillColor(ctx,App.Palette[1]):App.FillColor(ctx,App.Palette[4]),ctx.fillRect(this.OffsetX+appWidth*.5-210*units,centerY-20*units,202.5*units,40*units),this._RollOvers[4]&&!this._Saving&&(ctx.beginPath(),ctx.moveTo(this.OffsetX+appWidth*.5-108.75*units,centerY+29*units),ctx.lineTo(this.OffsetX+appWidth*.5-118.75*units,centerY+19*units),ctx.lineTo(this.OffsetX+appWidth*.5-98.75*units,centerY+19*units),ctx.closePath(),ctx.fill()),this._Saving?App.FillColor(ctx,App.Palette[1]):App.FillColor(ctx,App.Palette[5]),ctx.fillRect(this.OffsetX+appWidth*.5+7.5*units,centerY-20*units,202.5*units,40*units),this._RollOvers[5]&&!this._Saving&&(ctx.beginPath(),ctx.moveTo(this.OffsetX+appWidth*.5+108.75*units,centerY+29*units),ctx.lineTo(this.OffsetX+appWidth*.5+118.75*units,centerY+19*units),ctx.lineTo(this.OffsetX+appWidth*.5+98.75*units,centerY+19*units),ctx.closePath(),ctx.fill()),ctx.font=urlType,ctx.textAlign="center",App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.fillText(this._CopyJson.save.toUpperCase(),this.OffsetX+appWidth*.5-108.75*units,centerY+9*units),ctx.fillText(this._CopyJson.saveAs.toUpperCase(),this.OffsetX+appWidth*.5+108.75*units,centerY+9*units),ctx.font=italicType,ctx.textAlign="left",this.WordWrap(ctx,this._CopyJson.shareLine,this.OffsetX+appWidth*.5-210*units,centerY-59*units,14*units,210*units),ctx.lineWidth=2,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(this.OffsetX+appWidth*.5+275*units,centerY-20*units),ctx.lineTo(this.OffsetX+appWidth*.5+295*units,centerY),ctx.lineTo(this.OffsetX+appWidth*.5+275*units,centerY+20*units),ctx.stroke(),ctx.font=midType,ctx.fillText("SKIP",this.OffsetX+appWidth*.5+275*units,centerY+35*units)),this._Saving&&(ctx.font=midType,ctx.textAlign="center",ctx.fillText(this._CopyJson.saving.toUpperCase(),this.OffsetX+appWidth*.5,centerY+75*units),App.AnimationsLayer.DrawSprite(ctx,"loading",appWidth*.5,centerY+50*units,16,!0)),ctx.lineWidth=2,App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(shareX+appWidth*.5-275*units,centerY-20*units),ctx.lineTo(shareX+appWidth*.5-295*units,centerY),ctx.lineTo(shareX+appWidth*.5-275*units,centerY+20*units),ctx.stroke(),ctx.fillStyle="#fc4742",ctx.fillRect(shareX+appWidth*.5+80*units,buttonY,130*units,30*units),this._RollOvers[8]&&(ctx.beginPath(),ctx.moveTo(shareX+appWidth*.5+145*units,buttonY+39*units),ctx.lineTo(shareX+appWidth*.5+135*units,buttonY+29*units),ctx.lineTo(shareX+appWidth*.5+155*units,buttonY+29*units),ctx.closePath(),ctx.fill()),ctx.fillStyle="#2db0e7",ctx.fillRect(shareX+appWidth*.5-65*units,buttonY,130*units,30*units),this._RollOvers[7]&&(ctx.beginPath(),ctx.moveTo(shareX+appWidth*.5,buttonY+39*units),ctx.lineTo(shareX+appWidth*.5-10*units,buttonY+29*units),ctx.lineTo(shareX+appWidth*.5+10*units,buttonY+29*units),ctx.closePath(),ctx.fill()),ctx.fillStyle="#2152ad",ctx.fillRect(shareX+appWidth*.5-210*units,buttonY,130*units,30*units),this._RollOvers[6]&&(ctx.beginPath(),ctx.moveTo(shareX+appWidth*.5-145*units,buttonY+39*units),ctx.lineTo(shareX+appWidth*.5-135*units,buttonY+29*units),ctx.lineTo(shareX+appWidth*.5-155*units,buttonY+29*units),ctx.closePath(),ctx.fill()),App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.textAlign="left",ctx.font=midType,ctx.font=italicType,ctx.fillText(this._CopyJson.copyLine,shareX+appWidth*.5-210*units,centerY-33*units),ctx.textAlign="center",ctx.font=midType,ctx.fillText(this._CopyJson.facebook.toUpperCase(),shareX+appWidth*.5-145*units,buttonY+18.5*units),ctx.fillText(this._CopyJson.twitter.toUpperCase(),shareX+appWidth*.5,buttonY+18.5*units),ctx.fillText(this._CopyJson.google.toUpperCase(),shareX+appWidth*.5+145*units,buttonY+18.5*units),ctx.textAlign="right",ctx.fillText(this._CopyJson.titleLine.toUpperCase(),appWidth*.5-225*units,centerY-106*units),ctx.beginPath(),ctx.moveTo(appWidth*.5-210*units,centerY-90*units),ctx.lineTo(appWidth*.5+210*units,centerY-90*units),ctx.stroke(),ctx.textAlign="left",ctx.font=headType,ctx.fillText(this.SessionTitle,appWidth*.5-210*units,centerY-100*units);var titleW=ctx.measureText(this.SessionTitle).width;this._Blink>50&&ctx.fillRect(appWidth*.5-210*units+titleW+5*units,centerY-123*units,2*units,26*units),this._Blink+=1,this._Blink==100&&(this._Blink=0),ctx.font=headType,ctx.fillText("SHARE",20*units,this.OffsetY+30*units+11*units),ctx.font=midType;var genW=ctx.measureText(this._CopyJson.generateLine.toUpperCase()).width;ctx.fillText(this._CopyJson.generateLine.toUpperCase(),appWidth*.5+205*units-genW,centerY-106*units),ctx.beginPath(),ctx.moveTo(appWidth*.5+210*units,centerY-120*units),ctx.lineTo(appWidth*.5+200*units-genW,centerY-120*units),ctx.lineTo(appWidth*.5+200*units-genW,centerY-100*units),ctx.lineTo(appWidth*.5+210*units,centerY-100*units),ctx.closePath(),ctx.stroke(),ctx.beginPath(),ctx.moveTo(appWidth*.5+222.5*units,centerY-122.5*units),ctx.lineTo(appWidth*.5+237.5*units,centerY-137.5*units),ctx.moveTo(appWidth*.5+237.5*units,centerY-122.5*units),ctx.lineTo(appWidth*.5+222.5*units,centerY-137.5*units),ctx.stroke()}},SharePanel.prototype.WordWrap=function(context,text,x,y,lineHeight,fitWidth){fitWidth=fitWidth||0;if(fitWidth<=0){context.fillText(text,x,y);return}var words=text.split(" "),currentLine=0,idx=1;while(words.length>0&&idx<=words.length){var str=words.slice(0,idx).join(" "),w=context.measureText(str).width;w>fitWidth?(idx==1&&(idx=2),context.fillText(words.slice(0,idx-1).join(" "),x,y+lineHeight*currentLine),currentLine++,words=words.splice(idx-1),idx=1):idx++}idx>0&&context.fillText(words.join(" "),x,y+lineHeight*currentLine)},SharePanel.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x;var units=App.Unit,shareUrl=document.getElementById("shareUrl"),pr=App.Metrics.PixelRatio;v=="OffsetX"&&(shareUrl.style.left=""+(this.x+App.Width*1.5-units*200)/pr+"px"),v=="OffsetY"&&(shareUrl.style.top=""+(this.x+App.Height*.5-units*20)/pr+"px")}),offsetTween.onComplete(function(){if(v=="OffsetY"){if(destination!==0){panel.Open=!1;var shareUrl=document.getElementById("shareUrl");shareUrl.style.display="none",shareUrl.style.visibility="false"}panel.OffsetX=0;var shareUrl=document.getElementById("shareUrl");shareUrl.style.left="1000%"}v=="OffsetX"&&panel._FirstSession&&(panel._FirstSession=!1)}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick)},SharePanel.prototype.GenerateLabel=function(){var label="",diceRoll,prefixA=["al","aal","blok","bjør","brø","drø","du","ef","en","jen","ja","lek","lu","mal","svi","svar","sku","spru","kø","kin","kvi","kna","kvar","hof","tje","fja","ub","rø","vø","vol","va","ey","ly","sky","ske","skø","sji","yø","ø"],syllableA=["jen","ke","kil","kol","kof","nø","ken","ren","re","rol","sen","se","sa","then","tol","te","ty","ple","pa","ka","y"],suffixA=["berg","holm","sorg","fla","trad","stad","mark","dt","de","s","kla","ken","kjen","gen","gan","likt","tra","tet","tal","man","la","tt","bb","na","k","ka","bø","dø","gø","jø","kø","lø","mø","nø","pø","sø","slø","tø","vø","lok","vik","slik","dust"],joinerA=["berg","sorg","fla","lag","tra","tet","tal","du","na","bø","dø","gø","jø","kø","lø","mø","nø","pø","sø","slø","tø","vø","lok","vik","dust","dok","blok"],prefixB=["al","aal","blok","björ","brö","drö","du","ef","en","jen","jä","lek","lü","mal","svi","svar","sku","spru","ko","kin","kvi","kna","kvär","höf","tje","fjä","ub","ro","vo","vol","vä","ey","ly","sky","ske","sko","sji","yö","ö"],syllableB=["jen","ke","kil","kol","kof","nö","ken","ren","re","rol","sen","se","sa","then","tol","te","ty","ple","pa","ka","y"],suffixB=["berg","holm","sorg","fla","träd","städ","mark","dt","de","s","kla","ken","kjen","gen","gan","likt","tra","tet","tal","man","la","tt","bb","na","k","ka","bö","dö","gö","jö","kö","lö","mö","nö","pö","sö","slö","tö","vö","lok","vik","slik","dust"],joinerB=["berg","sorg","fla","lag","tra","tet","tal","dü","na","bö","dö","gö","jö","kö","lö","mö","nö","pö","sö","slö","tö","vö","lok","vik","dust","dok","blok"],prefixes=[prefixA,prefixB],syllables=[syllableA,syllableB],suffixes=[suffixA,suffixB],joiners=[joinerA,joinerB],dialect=Math.round(Math.random()),prefix=prefixes[dialect],syllable=syllables[dialect],suffix=suffixes[dialect],joiner=joiners[dialect];return label=""+label+prefix[Math.floor(Math.random()*prefix.length)],diceRoll=Math.floor(Math.random()*8),diceRoll==0&&(label=""+label+syllable[Math.floor(Math.random()*syllable.length)]),label=""+label+suffix[Math.floor(Math.random()*suffix.length)],diceRoll=Math.floor(Math.random()*10),diceRoll==0&&(label=""+label+" "+joiner[Math.floor(Math.random()*joiner.length)]),diceRoll=Math.floor(Math.random()*2),diceRoll!==0&&(label=""+label+" "+prefix[Math.floor(Math.random()*prefix.length)],diceRoll=Math.floor(Math.random()*5),diceRoll==0&&(label=""+label+syllable[Math.floor(Math.random()*syllable.length)]),label=""+label+suffix[Math.floor(Math.random()*suffix.length)]),this._NameUrl="&t="+encodeURI(label),this.UpdateUrlText(),label.toUpperCase()},SharePanel.prototype.OpenPanel=function(){this.Open=!0,this.OffsetY=-App.Height;var shareUrl=document.getElementById("shareUrl");shareUrl.style.display="block",shareUrl.style.visibility="true",this.DelayTo(this,0,500,0,"OffsetY"),App.TypingManager.Enable(this)},SharePanel.prototype.ClosePanel=function(){this._Saving=!1,this.DelayTo(this,-App.Height,500,0,"OffsetY"),App.TypingManager.Disable()},SharePanel.prototype.GenerateLink=function(){this._Saving=!0,this._CommandManager.ExecuteCommand(Commands_1.Commands.SAVE_AS)},SharePanel.prototype.UpdateLink=function(){this._Saving=!0,this._CommandManager.ExecuteCommand(Commands_1.Commands.SAVE)},SharePanel.prototype.ReturnLink=function(id){this._Saving=!1,this._SessionId=id,this.UpdateUrlText(),this.DelayTo(this,-App.Width,500,0,"OffsetX")},SharePanel.prototype.UpdateUrlText=function(){this.SessionURL=""+this._CopyJson.domain+this._SessionId+this._NameUrl;var shareUrl=document.getElementById("shareUrl");shareUrl.innerHTML=""+this.SessionURL},SharePanel.prototype.ShareFacebook=function(url){FB.ui({method:"share",href:url,title:this.SessionTitle,description:"Interactive music.",image:"http://localhost:8000/image.jpg"},function(response){})},SharePanel.prototype.ShareTwitter=function(){var href="https://twitter.com/intent/tweet?text=";href=""+href+encodeURIComponent(this._CopyJson.tweetText),href=""+href+"&url="+encodeURIComponent(this.SessionURL),window.open(href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},SharePanel.prototype.ShareGoogle=function(){var href="https://plus.google.com/share?url=";href=""+href+encodeURIComponent(this.SessionURL),window.open(href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},SharePanel.prototype.MouseDown=function(point){this.HitTests(point);if(!this._RollOvers[0]){if(this._RollOvers[1]){this.ClosePanel();return}if(this._RollOvers[2]){this.SessionTitle=this.GenerateLabel(),App.TypingManager.Enable(this);return}if(this._RollOvers[3]){this.GenerateLink();return}if(this._RollOvers[4]){this.UpdateLink();return}if(this._RollOvers[5]){this.GenerateLink();return}if(this._RollOvers[6]){var url=""+this.SessionURL;this.ShareFacebook(url);return}if(this._RollOvers[7]){this.ShareTwitter();return}if(this._RollOvers[8]){this.ShareGoogle();return}if(this._RollOvers[9]){this.DelayTo(this,0,500,0,"OffsetX");return}if(this._RollOvers[10]){this.DelayTo(this,-App.Width,500,0,"OffsetX");return}this._UrlSelecting=!1}else this._UrlSelecting=!0},SharePanel.prototype.MouseUp=function(point){this._UrlSelecting?this.SelectText("shareUrl"):this.DeselectText()},SharePanel.prototype.MouseMove=function(point){this.HitTests(point)},SharePanel.prototype.HitTests=function(point){var units=App.Unit,shareX=this.OffsetX+App.Width,centerY=this.OffsetY+App.Height*.5,buttonY=centerY+35*units,ctx=this.Ctx,midType=App.Metrics.TxtMid,appWidth=App.Width;ctx.font=midType;var genW=ctx.measureText(this._CopyJson.generateLine.toUpperCase()).width;this._RollOvers[0]=Dimensions.HitRect(shareX+appWidth*.5-210*units,centerY-20*units,420*units,40*units,point.x,point.y),this._RollOvers[1]=Dimensions.HitRect(appWidth*.5+210*units,centerY-150*units,40*units,40*units,point.x,point.y),this._RollOvers[2]=Dimensions.HitRect(appWidth*.5+200*units-genW,centerY-130*units,genW+10*units,40*units,point.x,point.y),this._FirstSession?(this._RollOvers[3]=Dimensions.HitRect(this.OffsetX+appWidth*.5-210*units,centerY-20*units,420*units,40*units,point.x,point.y),this._RollOvers[4]=!1,this._RollOvers[5]=!1,this._RollOvers[10]=!1):(this._RollOvers[3]=!1,this._RollOvers[4]=Dimensions.HitRect(this.OffsetX+appWidth*.5-210*units,centerY-20*units,202.5*units,40*units,point.x,point.y),this._RollOvers[5]=Dimensions.HitRect(this.OffsetX+appWidth*.5+7.5*units,centerY-20*units,202.5*units,40*units,point.x,point.y),this._RollOvers[10]=Dimensions.HitRect(this.OffsetX+appWidth*.5+270*units,centerY-units*20,30*units,40*units,point.x,point.y)),this._RollOvers[6]=Dimensions.HitRect(shareX+appWidth*.5-210*units,buttonY,130*units,30*units,point.x,point.y),this._RollOvers[7]=Dimensions.HitRect(shareX+appWidth*.5-65*units,buttonY,130*units,30*units,point.x,point.y),this._RollOvers[8]=Dimensions.HitRect(shareX+appWidth*.5+80*units,buttonY,130*units,30*units,point.x,point.y),this._RollOvers[9]=Dimensions.HitRect(shareX+appWidth*.5-300*units,centerY-units*20,30*units,40*units,point.x,point.y)},SharePanel.prototype.SelectText=function(element){var doc=document,text=doc.getElementById(element),range,selection;window.getSelection&&(selection=window.getSelection(),selection.toString()!==this.SessionURL&&(range=document.createRange(),range.selectNodeContents(text),selection.removeAllRanges(),selection.addRange(range)))},SharePanel.prototype.DeselectText=function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},SharePanel.prototype.Resize=function(){var units=App.Unit,pr=App.Metrics.PixelRatio,shareUrl=document.getElementById("shareUrl");shareUrl.style.font=App.Metrics.TxtUrl,shareUrl.style.width=""+units*(400/pr)+"px",shareUrl.style.height=""+units*(40/pr)+"px",shareUrl.style.lineHeight=""+units*(40/pr)+"px",shareUrl.style.display="block",this.Open||(this.OffsetY=-App.Height,shareUrl.style.display="none",shareUrl.style.visibility="false"),this.OffsetX!==0&&(this.OffsetX=-App.Width);var offsetX=this.OffsetX/pr,offsetY=this.OffsetY/pr,width=App.Width/pr,height=App.Height/pr;shareUrl.style.left=""+(offsetX+width*1.5-units*(200/pr))+"px",shareUrl.style.top=""+(offsetY+height*.5-units*(20/pr))+"px"},SharePanel}(DisplayObject);exports.SharePanel=SharePanel});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/SoundcloudPanel",["require","exports"],function(require,exports){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,SoundcloudPanel=function(_super){__extends(SoundcloudPanel,_super);function SoundcloudPanel(){_super.apply(this,arguments),this._Page=1,this._ItemNo=5,this._Blink=0}return SoundcloudPanel.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Open=!1,this.OffsetX=0,this.OffsetY=-this.DrawTo.Height,this._RollOvers=[],this.SearchString="Hello",this._CopyJson={titleLine:"Title",searchLine:"Search SoundCloud",randomLine:"Randomise",saving:"saving...",noResults:"No results found"};var colors=["black","grey","white","red","yellow","pink","green","orange","purple","blue","turquoise","cream"],animals=["cat","dog","horse","rat","deer","snake","bat","mouse","wolf","hound","fox"],places=["home","house","shack","work","country","county","land","mountain","lake","sea","valley","desert","plains","ocean","space","sky","temple","church","shrine"],objects=["train","car","plane","jet","rocket","satellite","hand","head","back","eyes","legs","mouth","paper","crystal","skull","bones","flag","dust","rock","metal","mineral","plant","flower","sun","moon","day","night","gun","blood","gang","sample","drum","clap","echo","sound","song"],descriptions=["wet","dry","hot","cold","good","bad","evil","soft","hard","light","dark","heavy","clean","dirty","short","long","royal","magic","holy"];this._RandomWords=colors.concat(animals,places,objects,descriptions)},SoundcloudPanel.prototype.GetString=function(){return this.SearchString},SoundcloudPanel.prototype.UpdateString=function(string){this.SearchString=string},SoundcloudPanel.prototype.StringReturn=function(){this._SelectedBlock.SearchString=this.SearchString,this._SelectedBlock.Search(this.SearchString),this._Page=1,this.OffsetX=0},SoundcloudPanel.prototype.Draw=function(){var ctx=this.Ctx,midType=App.Metrics.TxtMid,headType=App.Metrics.TxtHeader,units=App.Unit,centerY=this.OffsetY+App.Height*.5,appWidth=App.Width,appHeight=App.Height,margin=appWidth*.5-210*units,pageW=420*units;if(this.Open){App.FillColor(ctx,App.Palette[2]),ctx.globalAlpha=.95,ctx.fillRect(0,this.OffsetY,appWidth,appHeight),ctx.globalAlpha=1,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[1]),ctx.lineWidth=2;var block=this._SelectedBlock,results=block.SearchResults.length,itemNo=this._ItemNo,pageNo=this._Page;ctx.font=App.Metrics.TxtItalic,ctx.textAlign="left",ctx.save(),ctx.beginPath(),ctx.moveTo(margin-5*units,centerY-100*units),ctx.lineTo(margin-5*units,centerY+130*units),ctx.lineTo(margin+pageW+10*units,centerY+130*units),ctx.lineTo(margin+pageW+10*units,centerY-100*units),ctx.closePath(),ctx.clip();for(var i=0;i<results;i++){var p=Math.floor(i/itemNo),n=i-p*itemNo,x=this.OffsetX+(pageW+10*units)*p,y=centerY-70*units+n*40*units;if(p>this._Page-3&&p<this._Page+1){n<4&&i<results-1&&(ctx.beginPath(),ctx.moveTo(x+margin,y+12*units),ctx.lineTo(x+margin+pageW,y+12*units),ctx.stroke());if(p==this._Page-1&&this._RollOvers[5+n]){var sy=centerY-98*units+40*n*units;App.FillColor(ctx,App.Palette[4]),ctx.fillRect(margin-5*units,sy,pageW+10*units,40*units),ctx.beginPath(),ctx.moveTo(appWidth*.5,sy+45*units),ctx.lineTo(appWidth*.5-10*units,sy+35*units),ctx.lineTo(appWidth*.5+10*units,sy+35*units),ctx.closePath(),ctx.fill()}App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]);var track=block.SearchResults[i],title=track.Title,user=track.User;ctx.fillText(title,x+margin+units,y-10*units),ctx.fillText("By "+user,x+margin+units,y),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(x+margin+pageW-25*units,y-10.5*units),ctx.lineTo(x+margin+pageW-20*units,y-5.5*units),ctx.lineTo(x+margin+pageW-15*units,y-10.5*units),ctx.stroke(),App.StrokeColor(ctx,App.Palette[1])}}ctx.restore(),ctx.font=App.Metrics.TxtMid;var maxNo=itemNo*pageNo;maxNo>results&&(maxNo=results),results>0?ctx.fillText(""+(1+itemNo*(pageNo-1))+" - "+maxNo+" of "+results,margin,centerY+160*units):block.Searching?App.AnimationsLayer.DrawSprite(ctx,"loading",appWidth*.5,centerY,16,!0):(ctx.font=App.Metrics.TxtHeader,ctx.textAlign="center",ctx.fillText(this._CopyJson.noResults.toLocaleUpperCase(),appWidth*.5,centerY+10*units));if(results>itemNo){ctx.font=App.Metrics.TxtHeader;var pNo=""+this._Page,pTotal=""+Math.ceil(results/itemNo);ctx.textAlign="center",ctx.fillText(pNo+"/"+pTotal,margin-75*units,centerY-68*units)}App.StrokeColor(ctx,App.Palette[1]),this._Page>1&&App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(appWidth*.5-275*units,centerY-20*units),ctx.lineTo(appWidth*.5-295*units,centerY),ctx.lineTo(appWidth*.5-275*units,centerY+20*units),ctx.stroke(),App.StrokeColor(ctx,App.Palette[1]),this._Page<Math.ceil(results/itemNo)&&App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(appWidth*.5+275*units,centerY-20*units),ctx.lineTo(appWidth*.5+295*units,centerY),ctx.lineTo(appWidth*.5+275*units,centerY+20*units),ctx.stroke(),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.beginPath(),ctx.moveTo(margin,centerY-110*units),ctx.lineTo(margin+pageW,centerY-110*units),ctx.stroke(),ctx.textAlign="left",ctx.font=headType,ctx.fillText(this.SearchString.toUpperCase(),margin,centerY-120*units);var titleW=ctx.measureText(this.SearchString.toUpperCase()).width;this._Blink>50&&ctx.fillRect(margin+titleW+5*units,centerY-143*units,2*units,26*units),this._Blink+=1,this._Blink==100&&(this._Blink=0),ctx.font=midType;var searchW=ctx.measureText(this._CopyJson.searchLine.toUpperCase()).width;ctx.fillText(this._CopyJson.searchLine.toUpperCase(),appWidth*.5+205*units-searchW,centerY-126*units),ctx.beginPath(),ctx.moveTo(appWidth*.5+210*units,centerY-140*units),ctx.lineTo(appWidth*.5+200*units-searchW,centerY-140*units),ctx.lineTo(appWidth*.5+200*units-searchW,centerY-120*units),ctx.lineTo(appWidth*.5+210*units,centerY-120*units),ctx.closePath(),ctx.stroke(),searchW=ctx.measureText(this._CopyJson.randomLine.toUpperCase()).width,ctx.fillText(this._CopyJson.randomLine.toUpperCase(),appWidth*.5+210*units-searchW,centerY+160*units);var rx=appWidth*.5+210*units-searchW*.5;ctx.beginPath(),ctx.moveTo(rx-7.5*units,centerY+165*units),ctx.lineTo(rx-2.5*units,centerY+170*units),ctx.lineTo(rx+2.5*units,centerY+165*units),ctx.lineTo(rx+7.5*units,centerY+170*units),ctx.stroke(),ctx.beginPath(),ctx.moveTo(appWidth*.5+222.5*units,centerY-142.5*units),ctx.lineTo(appWidth*.5+237.5*units,centerY-157.5*units),ctx.moveTo(appWidth*.5+237.5*units,centerY-142.5*units),ctx.lineTo(appWidth*.5+222.5*units,centerY-157.5*units),ctx.stroke()}},SoundcloudPanel.prototype.WordWrap=function(context,text,x,y,lineHeight,fitWidth){fitWidth=fitWidth||0;if(fitWidth<=0){context.fillText(text,x,y);return}var words=text.split(" "),currentLine=0,idx=1;while(words.length>0&&idx<=words.length){var str=words.slice(0,idx).join(" "),w=context.measureText(str).width;w>fitWidth?(idx==1&&(idx=2),context.fillText(words.slice(0,idx-1).join(" "),x,y+lineHeight*currentLine),currentLine++,words=words.splice(idx-1),idx=1):idx++}idx>0&&context.fillText(words.join(" "),x,y+lineHeight*currentLine)},SoundcloudPanel.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x}),offsetTween.onComplete(function(){v=="OffsetY"&&destination!==0&&(panel.Open=!1)}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick)},SoundcloudPanel.prototype.OpenPanel=function(){this._SelectedBlock=App.MainScene.OptionsPanel.SelectedBlock,this._Page=this._SelectedBlock.ResultsPage,this.SearchString=this._SelectedBlock.SearchString,this.Open=!0,this.OffsetY=-App.Height,this.OffsetX=-((this._Page-1)*430*App.Unit),this.DelayTo(this,0,500,0,"OffsetY"),App.TypingManager.Enable(this)},SoundcloudPanel.prototype.ClosePanel=function(){this._SelectedBlock.ResultsPage=this._Page,this.DelayTo(this,-App.Height,500,0,"OffsetY"),App.TypingManager.Disable()},SoundcloudPanel.prototype.MouseDown=function(point){this.HitTests(point);var block=this._SelectedBlock;if(this._RollOvers[1]){this.ClosePanel();return}if(this._RollOvers[2]){this.StringReturn();return}if(this._RollOvers[10]){block.Search(this.RandomSearch(this._SelectedBlock)),App.TypingManager.Enable(this),this._Page=1,this.OffsetX=0;return}if(this._RollOvers[3]){this._Page>1&&(this._Page-=1,this.DelayTo(this,-((this._Page-1)*430*App.Unit),350,0,"OffsetX"));return}if(this._RollOvers[4]){this._Page<Math.ceil(block.SearchResults.length/this._ItemNo)&&(this._Page+=1,this.DelayTo(this,-((this._Page-1)*430*App.Unit),350,0,"OffsetX"));return}for(var i=5;i<10;i++)if(this._RollOvers[i]){var n=(this._Page-2)*this._ItemNo+i,track=block.SearchResults[n];track&&(block.LoadTrack(track),this.ClosePanel());return}},SoundcloudPanel.prototype.MouseUp=function(point){},SoundcloudPanel.prototype.MouseMove=function(point){this.HitTests(point)},SoundcloudPanel.prototype.HitTests=function(point){var units=App.Unit,shareX=this.OffsetX+App.Width,centerY=this.OffsetY+App.Height*.5,ctx=this.Ctx,midType=App.Metrics.TxtMid,appWidth=App.Width;ctx.font=midType;var searchW=ctx.measureText(this._CopyJson.searchLine.toUpperCase()).width,randomW=ctx.measureText(this._CopyJson.randomLine.toUpperCase()).width;this._RollOvers[0]=Dimensions.HitRect(shareX+appWidth*.5-210*units,centerY-20*units,420*units,40*units,point.x,point.y),this._RollOvers[1]=Dimensions.HitRect(appWidth*.5+210*units,centerY-170*units,40*units,40*units,point.x,point.y),this._RollOvers[2]=Dimensions.HitRect(appWidth*.5+200*units-searchW,centerY-150*units,searchW+10*units,40*units,point.x,point.y),this._RollOvers[3]=Dimensions.HitRect(appWidth*.5-300*units,centerY-units*20,30*units,40*units,point.x,point.y),this._RollOvers[4]=Dimensions.HitRect(appWidth*.5+270*units,centerY-units*20,30*units,40*units,point.x,point.y),this._RollOvers[5]=Dimensions.HitRect(appWidth*.5-210*units,centerY-units*98,420*units,40*units,point.x,point.y),this._RollOvers[6]=Dimensions.HitRect(appWidth*.5-210*units,centerY-units*58,420*units,40*units,point.x,point.y),this._RollOvers[7]=Dimensions.HitRect(appWidth*.5-210*units,centerY-units*18,420*units,40*units,point.x,point.y),this._RollOvers[8]=Dimensions.HitRect(appWidth*.5-210*units,centerY+units*22,420*units,40*units,point.x,point.y),this._RollOvers[9]=Dimensions.HitRect(appWidth*.5-210*units,centerY+units*62,420*units,40*units,point.x,point.y),this._RollOvers[10]=Dimensions.HitRect(appWidth*.5+205*units-randomW,centerY+136*units,randomW+10*units,40*units,point.x,point.y)},SoundcloudPanel.prototype.Resize=function(){this.OffsetX=-((this._Page-1)*430*App.Unit)},SoundcloudPanel.prototype.RandomSearch=function(block){var words=this._RandomWords,q=""+words[Math.floor(Math.random()*words.length)]+" "+words[Math.floor(Math.random()*words.length)];return this.SearchString=q,block.SearchString=q,q},SoundcloudPanel}(DisplayObject);exports.SoundcloudPanel=SoundcloudPanel});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/StageDragger",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,Point=minerva.Point,StageDragger=function(_super){__extends(StageDragger,_super);function StageDragger(){_super.apply(this,arguments),this._Dragging=!1}return StageDragger.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Tweens=[],this.Destination=new Point(App.DragOffset.x,App.DragOffset.y)},StageDragger.prototype.Update=function(){if(Math.round(App.DragOffset.x)!==Math.round(this.Destination.x)||Math.round(App.DragOffset.y)!==Math.round(this.Destination.y)){var speed=App.Config.ScrollEasing;App.DragOffset.x+=(this.Destination.x-App.DragOffset.x)/100*speed,App.DragOffset.y+=(this.Destination.y-App.DragOffset.y)/100*speed,App.Metrics.UpdateGridScale()}},StageDragger.prototype.Draw=function(){if(this._Dragging&&(App.DragOffset.x!==this._OffsetStart.x||App.DragOffset.y!==this._OffsetStart.y)){var cx=App.Metrics.C.x,cy=App.Metrics.C.y,units=App.Unit,ctx=App.MainScene.Ctx;App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(cx-5*units,cy),ctx.lineTo(cx+5*units,cy),ctx.moveTo(cx,cy-5*units),ctx.lineTo(cx,cy+5*units),ctx.stroke()}},StageDragger.prototype.DelayTo=function(panel,destination,t,delay,v){var me=this,offsetTween=new window.TWEEN.Tween({x:panel[""+v].x,y:panel[""+v].y});offsetTween.to({x:destination.x,y:destination.y},t),offsetTween.onUpdate(function(){panel[""+v].x=this.x,panel[""+v].y=this.y,me.Destination.x=this.x,me.Destination.y=this.y,panel.Metrics.UpdateGridScale()}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick),this.Tweens.push(offsetTween)},StageDragger.prototype.StopAllTweens=function(){if(this.Tweens.length){for(var j=0;j<this.Tweens.length;j++)this.Tweens[j].stop();this.Tweens=[]}},StageDragger.prototype.MouseDown=function(point){this._DragStart=new Point(point.x,point.y),this._OffsetStart=new Point(App.DragOffset.x,App.DragOffset.y),this._Dragging=!0},StageDragger.prototype.MouseMove=function(point){this._Dragging&&this.Drag(point)},StageDragger.prototype.MouseUp=function(){this._Dragging=!1},StageDragger.prototype.Drag=function(point){var speed=App.Config.ScrollSpeed;this.Destination.x=this._OffsetStart.x+(point.x-this._DragStart.x)/App.Unit*(speed/App.ZoomLevel),this.Destination.y=this._OffsetStart.y+(point.y-this._DragStart.y)/App.Unit*(speed/App.ZoomLevel)},StageDragger.prototype.Jump=function(point,to){this.StopAllTweens();var blockX=-point.x*App.GridSize,blockY=-point.y*App.GridSize,screenX=App.Width*to.x-App.Metrics.C.x,screenY=App.Height*to.y-App.Metrics.C.y,x=(blockX+screenX/App.ZoomLevel)/App.Unit,y=(blockY+screenY/App.ZoomLevel)/App.Unit;this.DelayTo(App,new Point(x,y),400,0,"DragOffset"),App.MainScene.ToolTipClose()},StageDragger}(DisplayObject);exports.StageDragger=StageDragger});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/ToolTip",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,ToolTip=function(_super){__extends(ToolTip,_super);function ToolTip(){_super.apply(this,arguments)}return ToolTip.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Name="",this.Alpha=0,this.Open=!1,this.Position=new Point(0,0)},ToolTip.prototype.Draw=function(){var units=App.Unit,ctx=this.Ctx,dataType=Math.round(units*10),thisAlpha=this.Alpha/100;ctx.font=App.Metrics.TxtMid;var thisWidth=ctx.measureText(this.Name.toUpperCase()).width+40*units,x=this.Position.x,y=this.Position.y;ctx.globalAlpha=thisAlpha*.9,App.FillColor(ctx,App.Palette[2]),ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(x+thisWidth,y),ctx.lineTo(x+thisWidth,y+20*units),ctx.lineTo(x+20*units,y+20*units),ctx.closePath(),ctx.fill(),ctx.globalAlpha=thisAlpha,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.textAlign="left",ctx.fillText(this.Name.toUpperCase(),x+30*units,y+10*units+dataType*.36)},ToolTip.prototype.AlphaTo=function(panel,destination,t){this._AlphaTween&&this._AlphaTween.stop(),window.TWEEN.remove(this._AlphaTween),this._AlphaTween=new window.TWEEN.Tween({x:this.Alpha}),this._AlphaTween.to({x:destination},t),this._AlphaTween.onUpdate(function(){panel.Alpha=this.x}),this._AlphaTween.easing(window.TWEEN.Easing.Quintic.InOut),this._AlphaTween.start(this.LastVisualTick)},ToolTip.prototype.StopTween=function(){window.TWEEN.remove(this._AlphaTween)},ToolTip}(DisplayObject);exports.ToolTip=ToolTip});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/TrashCan",["require","exports"],function(require,exports){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,TrashCan=function(_super){__extends(TrashCan,_super);function TrashCan(){_super.apply(this,arguments)}return TrashCan.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this._RollOver=!1},TrashCan.prototype.Draw=function(){var units=App.Unit,ctx=this.Ctx,tx=this.DrawTo.Width-30*units,ty=this.DrawTo.Height-30*units,s=1;this._RollOver&&this.DrawTo.IsDraggingABlock&&(s=1.2),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]),ctx.lineWidth=1,ctx.beginPath(),ctx.moveTo(tx-11*s*units,ty-11*s*units),ctx.lineTo(tx+11*s*units,ty-11*s*units),ctx.lineTo(tx+8*s*units,ty+11*s*units),ctx.lineTo(tx-8*s*units,ty+11*s*units),ctx.closePath(),ctx.stroke(),ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(tx-4*s*units,ty-4*s*units),ctx.lineTo(tx+4*s*units,ty+4*s*units),ctx.moveTo(tx+4*s*units,ty-4*s*units),ctx.lineTo(tx-4*s*units,ty+4*s*units),ctx.stroke(),ctx.lineWidth=1},TrashCan.prototype.MouseMove=function(point){var units=App.Unit;this._RollOver=Dimensions.HitRect(this.DrawTo.Width-60*units,this.DrawTo.Height-60*units,60*units,60*units,point.x,point.y)},TrashCan.prototype.MouseUp=function(){return this._RollOver?(this.DrawTo.DeleteSelectedBlock(),!0):!1},TrashCan}(DisplayObject);exports.TrashCan=TrashCan});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/Tutorial",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,Tutorial=function(_super){__extends(Tutorial,_super);function Tutorial(){_super.apply(this,arguments)}return Tutorial.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),console.log("Tutorial")},Tutorial.prototype.Draw=function(){var ctx=this.Ctx,units=App.Unit,midType=App.Metrics.TxtMid},Tutorial.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x}),offsetTween.onComplete(function(){v=="OffsetY"&&destination!==0&&(panel.Open=!1)}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick)},Tutorial.prototype.OpenPanel=function(){},Tutorial.prototype.ClosePanel=function(){},Tutorial.prototype.MouseDown=function(point){this.HitTests(point)},Tutorial.prototype.MouseUp=function(point){},Tutorial.prototype.MouseMove=function(point){this.HitTests(point)},Tutorial.prototype.HitTests=function(point){var ctx=this.Ctx,units=App.Unit},Tutorial}(DisplayObject);exports.Tutorial=Tutorial});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("UI/ZoomButtons",["require","exports"],function(require,exports){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,Point=minerva.Point,ZoomButtons=function(_super){__extends(ZoomButtons,_super);function ZoomButtons(){_super.apply(this,arguments)}return ZoomButtons.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.InRoll=this.OutRoll=!1,this.Tweens=[],this._ZoomSlots=[.25,.5,1,2,4],this.CurrentSlot=2,this.ZoomAlpha=0},ZoomButtons.prototype.UpdateSlot=function(zoom){this.CurrentSlot=this._ZoomSlots.indexOf(zoom)},ZoomButtons.prototype.Draw=function(){var units=App.Unit,ctx=this.Ctx;ctx.globalAlpha=1,ctx.lineWidth=2,App.FillColor(ctx,App.Palette[App.ThemeManager.Txt]),App.StrokeColor(ctx,App.Palette[App.ThemeManager.Txt]);var zin=this._InPos,zout=this._OutPos,diamond=11;ctx.beginPath(),ctx.moveTo(zin.x,zin.y-5*units),ctx.lineTo(zin.x,zin.y+5*units),ctx.moveTo(zin.x-5*units,zin.y),ctx.lineTo(zin.x+5*units,zin.y),ctx.stroke(),ctx.beginPath(),ctx.moveTo(zout.x-5*units,zout.y),ctx.lineTo(zout.x+5*units,zout.y),ctx.stroke(),ctx.lineWidth=1;var x=zin.x+(zout.x-zin.x)*.5;ctx.beginPath(),ctx.moveTo(x,zin.y-diamond*units),ctx.lineTo(x,zin.y+diamond*units),ctx.closePath(),ctx.stroke(),this.InRoll&&(ctx.beginPath(),ctx.moveTo(zin.x-diamond*units,zin.y),ctx.lineTo(zin.x,zin.y-diamond*units),ctx.lineTo(zin.x+diamond*units,zin.y),ctx.lineTo(zin.x,zin.y+diamond*units),ctx.closePath(),ctx.stroke()),this.OutRoll&&(ctx.beginPath(),ctx.moveTo(zout.x-diamond*units,zout.y),ctx.lineTo(zout.x,zout.y-diamond*units),ctx.lineTo(zout.x+diamond*units,zout.y),ctx.lineTo(zout.x,zout.y+diamond*units),ctx.closePath(),ctx.stroke());if(this.ZoomAlpha>0){ctx.globalAlpha=this.ZoomAlpha,ctx.textAlign="center",ctx.font=App.Metrics.TxtUrl2;var string="x "+Math.round(App.ZoomLevel*100)/100;ctx.fillText(string,50*units,App.Height-50*units)}ctx.globalAlpha=1},ZoomButtons.prototype.DelayTo=function(panel,destination,t,delay,v){var offsetTween=new window.TWEEN.Tween({x:panel[""+v]});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x,v==="ZoomLevel"&&panel.Metrics.UpdateGridScale()}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick),this.Tweens.push(offsetTween)},ZoomButtons.prototype.StopAllTweens=function(){if(this.Tweens.length){for(var j=0;j<this.Tweens.length;j++)this.Tweens[j].stop();this.Tweens=[]}},ZoomButtons.prototype.MouseMove=function(point){this.HitTests(point)},ZoomButtons.prototype.MouseDown=function(point){this.HitTests(point),this.InRoll&&this.ZoomIn(),this.OutRoll&&this.ZoomOut()},ZoomButtons.prototype.MouseWheel=function(e){var delta=0;e.wheelDelta!==undefined?delta=e.wheelDelta:e.detail!==undefined&&(delta=-e.detail),delta>0?this.ZoomIn():delta<0&&this.ZoomOut()},ZoomButtons.prototype.HitTests=function(point){var units=App.Unit,zin=this._InPos,zout=this._OutPos,area=30*units;this.InRoll=Dimensions.HitRect(zin.x-area*.5,zin.y-area*.5,area,area,point.x,point.y),this.OutRoll=Dimensions.HitRect(zout.x-area*.5,zout.y-area*.5,area,area,point.x,point.y)},ZoomButtons.prototype.ZoomIn=function(){this.CurrentSlot<this._ZoomSlots.length-1&&(App.MainScene.OptionsPanel.Close(),this.CurrentSlot+=1,this.StopAllTweens(),this.ZoomAlpha=1,this.DelayTo(App,this._ZoomSlots[this.CurrentSlot],500,0,"ZoomLevel"),this.DelayTo(this,0,500,700,"ZoomAlpha"))},ZoomButtons.prototype.ZoomOut=function(){this.CurrentSlot>0&&(App.MainScene.OptionsPanel.Close(),this.CurrentSlot-=1,this.StopAllTweens(),this.ZoomAlpha=1,this.DelayTo(App,this._ZoomSlots[this.CurrentSlot],500,0,"ZoomLevel"),this.DelayTo(this,0,500,700,"ZoomAlpha"))},ZoomButtons.prototype.Resize=function(){var units=App.Unit;this._InPos=new Point(30*units,App.Height-30*units),this._OutPos=new Point(70*units,App.Height-30*units)},ZoomButtons}(DisplayObject);exports.ZoomButtons=ZoomButtons});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("MainScene",["require","exports","./UI/AnimationsLayer","./UI/CreateNew","./Commands","./UI/ConnectionLines","./UI/Header","./LaserBeams","./UI/MessagePanel","./UI/OptionsPanel","./ParticleLayer","./Blocks/Power/PowerEffect","./Blocks/Power/PowerSource","./UI/RecorderPanel","./Blocks/Sources/Sampler","./UI/SettingsPanel","./UI/SharePanel","./UI/SoundcloudPanel","./UI/StageDragger","./UI/ToolTip","./UI/TrashCan","./UI/Tutorial","./UI/ZoomButtons"],function(require,exports,AnimationsLayer_1,CreateNew_1,Commands_1,ConnectionLines_1,Header_1,LaserBeams_1,MessagePanel_1,OptionsPanel_1,ParticleLayer_1,PowerEffect_1,PowerSource_1,RecorderPanel_1,Sampler_1,SettingsPanel_1,SharePanel_1,SoundcloudPanel_1,StageDragger_1,ToolTip_1,TrashCan_1,Tutorial_1,ZoomButtons_1){var Dimensions=Utils.Measurements.Dimensions,DisplayObject=etch.drawing.DisplayObject,Point=etch.primitives.Point,MainScene=function(_super){__extends(MainScene,_super);function MainScene(){_super.call(this),this._IsPointerDown=!1,this.IsDraggingABlock=!1}return MainScene.prototype.Setup=function(){var _this=this;_super.prototype.Setup.call(this),App.PointerInputManager.MouseDown.on(function(s,e){_this.MouseDown(e)},this),App.PointerInputManager.MouseUp.on(function(s,e){_this.MouseUp(e)},this),App.PointerInputManager.MouseMove.on(function(s,e){_this.MouseMove(e)},this),App.PointerInputManager.MouseWheel.on(function(s,e){_this.MouseWheel(e)},this),App.PointerInputManager.TouchStart.on(function(s,e){_this.TouchStart(e)},this),App.PointerInputManager.TouchEnd.on(function(s,e){_this.TouchEnd(e)},this),App.PointerInputManager.TouchMove.on(function(s,e){_this.TouchMove(e)},this),App.OperationManager.OperationComplete.on(function(operation){_this._Invalidate()},this),App.CompositionLoaded.on(function(s,e){_this.CompositionLoaded(e)},this),App.DragFileInputManager.Dropped.on(function(s,e){e.stopPropagation(),e.preventDefault();var b=_this.CreateBlockFromType(Sampler_1.Sampler),files=e.dataTransfer.files;App.Audio.AudioFileManager.DecodeFileData(files,function(file,buffer){buffer&&console.log(file.name+" dropped")})},this),App.DragFileInputManager.DragEnter.on(function(s,e){console.log("file drag entered area")},this),App.DragFileInputManager.DragMove.on(function(s,e){e.stopPropagation(),e.preventDefault(),console.log("file drag over")},this),App.DragFileInputManager.DragLeave.on(function(s,e){console.log("file left drag area")},this),OptionTimeout=!1,this._PointerPoint=new Point,this._SelectedBlockPosition=new Point,this.ConnectionLines=new ConnectionLines_1.ConnectionLines,this.DisplayList.Add(this.ConnectionLines),this.ConnectionLines.Init(this),this.BlocksContainer=new DisplayObject,this.DisplayList.Add(this.BlocksContainer),this.BlocksContainer.Init(this),this.LaserBeams=new LaserBeams_1.LaserBeams,this.DisplayList.Add(this.LaserBeams),this.LaserBeams.Init(this),this.Particles=new ParticleLayer_1.ParticleLayer,this.DisplayList.Add(this.Particles),this.Particles.Init(this),this._ToolTip=new ToolTip_1.ToolTip,this.DisplayList.Add(this._ToolTip),this._ToolTip.Init(this),this.AnimationsLayer=new AnimationsLayer_1.AnimationsLayer,this.DisplayList.Add(this.AnimationsLayer),this.AnimationsLayer.Init(this),this._RecorderPanel=new RecorderPanel_1.RecorderPanel,this.DisplayList.Add(this._RecorderPanel),this._RecorderPanel.Init(this),this.ZoomButtons=new ZoomButtons_1.ZoomButtons,this.DisplayList.Add(this.ZoomButtons),this.ZoomButtons.Init(this),this.MainSceneDragger=new StageDragger_1.StageDragger,this.DisplayList.Add(this.MainSceneDragger),this.MainSceneDragger.Init(this),this._TrashCan=new TrashCan_1.TrashCan,this.DisplayList.Add(this._TrashCan),this._TrashCan.Init(this),this.CreateNew=new CreateNew_1.CreateNew,this.DisplayList.Add(this.CreateNew),this.CreateNew.Init(this),this.Tutorial=new Tutorial_1.Tutorial,this.DisplayList.Add(this.Tutorial),this.Tutorial.Init(this),this.OptionsPanel=new OptionsPanel_1.OptionsPanel,this.DisplayList.Add(this.OptionsPanel),this.OptionsPanel.Init(this),this._Header=new Header_1.Header,this.DisplayList.Add(this._Header),this._Header.Init(this),this.SharePanel=new SharePanel_1.SharePanel,this.DisplayList.Add(this.SharePanel),this.SharePanel.Init(this),this.SettingsPanel=new SettingsPanel_1.SettingsPanel,this.DisplayList.Add(this.SettingsPanel),this.SettingsPanel.Init(this),this.SoundcloudPanel=new SoundcloudPanel_1.SoundcloudPanel,this.DisplayList.Add(this.SoundcloudPanel),this.SoundcloudPanel.Init(this),this.MessagePanel=new MessagePanel_1.MessagePanel,this.DisplayList.Add(this.MessagePanel),this.MessagePanel.Init(this),this._Invalidate()},MainScene.prototype.Update=function(){if(this.IsPaused)return;_super.prototype.Update.call(this)},MainScene.prototype.Draw=function(){_super.prototype.Draw.call(this),App.FillColor(this.Ctx,App.Palette[0]),this.Ctx.globalAlpha=1,this.Ctx.fillRect(0,0,this.Width,this.Height)},MainScene.prototype.MouseDown=function(e){var position=new Point(e.clientX,e.clientY);this._PointerDown(position)},MainScene.prototype.MouseUp=function(e){var position=new Point(e.clientX,e.clientY);this._PointerUp(position),this._CheckHover(position)},MainScene.prototype.MouseMove=function(e){var position=new Point(e.clientX,e.clientY);this._PointerMove(position)},MainScene.prototype.MouseWheel=function(e){this._MouseWheel(e)},MainScene.prototype.TouchStart=function(e){var touch=e.touches[0],point=new Point(touch.clientX,touch.clientY);this._PointerDown(point)},MainScene.prototype.TouchEnd=function(e){var touch=e.changedTouches[0],point=new Point(touch.clientX,touch.clientY);this._PointerUp(point)},MainScene.prototype.TouchMove=function(e){var touch=e.touches[0],point=new Point(touch.clientX,touch.clientY);this._PointerMove(point)},MainScene.prototype._PointerDown=function(point){App.Metrics.ConvertToPixelRatioPoint(point),this._IsPointerDown=!0,this._PointerPoint=point;var UIInteraction,collision,tooltip=this._ToolTip,zoom=this.ZoomButtons,header=this._Header,soundcloud=this.SoundcloudPanel,share=this.SharePanel,settings=this.SettingsPanel,recorder=this._RecorderPanel,options=this.OptionsPanel,message=this.MessagePanel;UIInteraction=this._UIInteraction(),tooltip.Open&&this.ToolTipClose();if(message.Hover){message.MouseDown(point);return}if(share.Open){share.MouseDown(point);return}if(settings.Open){settings.MouseDown(point);return}if(soundcloud.Open){soundcloud.MouseDown(point);return}if(!share.Open&&!settings.Open&&!soundcloud.Open){header.MouseDown(point);if(header.MenuOver)return;zoom.MouseDown(point);if(zoom.InRoll||zoom.OutRoll)return;if(options.Scale===1){options.MouseDown(point.x,point.y);if(options.Hover)return}recorder.MouseDown(point);if(recorder.Hover)return}UIInteraction||(collision=this._CheckCollision(point)),collision&&(this.IsDraggingABlock=!0,this._SelectedBlockPosition=this.SelectedBlock.Position),!collision&&!UIInteraction&&this.MainSceneDragger.MouseDown(point),this.ConnectionLines.UpdateList()},MainScene.prototype._PointerUp=function(point){App.Metrics.ConvertToPixelRatioPoint(point),this._IsPointerDown=!1;if(this.IsDraggingABlock)var blockDelete=this._TrashCan.MouseUp();this.IsDraggingABlock=!1,blockDelete||(this.SelectedBlock&&this.SelectedBlock.IsPressed&&(this.SelectedBlock.MouseUp(),Point.isEqual(this.SelectedBlock.Position,this.SelectedBlock.LastPosition)||App.CommandManager.ExecuteCommand(Commands_1.Commands.MOVE_BLOCK,this.SelectedBlock)),OptionTimeout&&this.OptionsPanel.Open(this.SelectedBlock)),this.SharePanel.Open?this.SharePanel.MouseUp(point):this.SettingsPanel.Open?this.SettingsPanel.MouseUp(point):(this._Header.MouseUp(),this.OptionsPanel.Scale===1&&this.OptionsPanel.MouseUp(),this.MainSceneDragger.MouseUp()),this.ConnectionLines.UpdateList()},MainScene.prototype._PointerMove=function(point){App.Metrics.ConvertToPixelRatioPoint(point),App.Canvas.Style.cursor="default",this._CheckHover(point),this.SelectedBlock&&(this.SelectedBlock.MouseMove(point),this._CheckProximity(),this.IsDraggingABlock&&(Math.round(this.SelectedBlock.Position.x)!==Math.round(this._SelectedBlockPosition.x)||Math.round(this.SelectedBlock.Position.y)!==Math.round(this._SelectedBlockPosition.y))&&(this._SelectedBlockPosition=this.SelectedBlock.Position,this._ABlockHasBeenMoved(),this.OptionsPanel.Scale===1&&this.OptionsPanel.Close())),this.OptionsPanel.Scale===1&&this.OptionsPanel.MouseMove(point.x,point.y),this.SharePanel.Open&&this.SharePanel.MouseMove(point),this.SettingsPanel.Open&&this.SettingsPanel.MouseMove(point),this.SoundcloudPanel.Open&&this.SoundcloudPanel.MouseMove(point),this.MessagePanel.Open&&this.MessagePanel.MouseMove(point),this._Header.MouseMove(point),this._RecorderPanel.MouseMove(point),this.ZoomButtons.MouseMove(point),this._TrashCan.MouseMove(point),this.MainSceneDragger.MouseMove(point)},MainScene.prototype._MouseWheel=function(e){this.ZoomButtons.MouseWheel(e)},MainScene.prototype._CheckProximity=function(){for(var j=0;j<App.Sources.length;j++){var source=App.Sources[j];for(var i=0;i<App.Effects.length;i++){var effect=App.Effects[i],catchmentArea=App.Metrics.ConvertGridUnitsToAbsolute(new Point(effect.CatchmentArea,effect.CatchmentArea)),distanceFromEffect=source.DistanceFrom(App.Metrics.ConvertGridUnitsToAbsolute(effect.Position));distanceFromEffect<=catchmentArea.x?!source.Connections.Contains(effect)&&(source instanceof PowerSource_1.PowerSource&&effect instanceof PowerEffect_1.PowerEffect||!(source instanceof PowerSource_1.PowerSource))&&(effect.AddSource(source),source.AddEffect(effect),this._Invalidate(),App.Audio.ConnectionManager.Update()):source.Connections.Contains(effect)&&(effect.RemoveSource(source),source.RemoveEffect(effect),this._Invalidate(),App.Audio.ConnectionManager.Update())}}},MainScene.prototype._CheckCollision=function(point){for(var i=App.Blocks.length-1;i>=0;i--){var block=App.Blocks[i];if(block.HitTest(point))return block.MouseDown(),this.SelectedBlock=block,OptionTimeout=!0,setTimeout(function(){OptionTimeout=!1},App.Config.SingleClickTime),!0}return this.OptionsPanel.Close(),!1},MainScene.prototype._CheckHover=function(point){var panelCheck=!1,blockHover=!1,panel=this._ToolTip;this.OptionsPanel.Scale===1&&(panelCheck=Dimensions.HitRect(this.OptionsPanel.Position.x,this.OptionsPanel.Position.y-this.OptionsPanel.Size.height*.5,this.OptionsPanel.Size.width,this.OptionsPanel.Size.height,point.x,point.y));if(!panelCheck&&!this._IsPointerDown)for(var i=App.Blocks.length-1;i>=0;i--){var block=App.Blocks[i];if(block.HitTest(point)){panel.Name=block.BlockName;var blockPos=App.Metrics.PointOnGrid(block.Position);panel.Position.x=blockPos.x,panel.Position.y=blockPos.y,blockHover=!0;break}}blockHover&&!panel.Open&&!this.OptionsPanel.Opening&&(panel.Open=!0,panel.Alpha>0?panel.AlphaTo(panel,100,600):this._ToolTipTimeout=setTimeout(function(){panel.Alpha===0&&panel.AlphaTo(panel,100,600)},550)),!blockHover&&panel.Open&&this.ToolTipClose()},MainScene.prototype.ToolTipClose=function(){var panel=this._ToolTip;clearTimeout(this._ToolTipTimeout),panel.StopTween(),panel.AlphaTo(panel,0,200),panel.Open=!1},MainScene.prototype._ABlockHasBeenMoved=function(){this.LaserBeams.UpdateAllLasers=!0,this.ConnectionLines.UpdateList()},MainScene.prototype._UIInteraction=function(){var zoom=this.ZoomButtons,header=this._Header,share=this.SharePanel,settings=this.SettingsPanel,soundcloud=this.SoundcloudPanel,recorder=this._RecorderPanel,options=this.OptionsPanel,message=this.MessagePanel;return zoom.InRoll||zoom.OutRoll||header.MenuOver||share.Open||settings.Open||soundcloud.Open||recorder.Hover||message.Hover||options.Scale===1&&options.Hover?(console.log("UI INTERACTION"),!0):!1},Object.defineProperty(MainScene.prototype,"SelectedBlock",{get:function(){return this._SelectedBlock},set:function(block){!block&&this._SelectedBlock?(this._SelectedBlock.IsSelected=!1,this._SelectedBlock=null):(this._SelectedBlock&&(this._SelectedBlock.IsSelected=!1),block.IsSelected=!0,this._SelectedBlock=block,this.BlockToFront(block))},enumerable:!0,configurable:!0}),MainScene.prototype.BlockToFront=function(block){this.BlocksContainer.DisplayList.ToFront(block)},MainScene.prototype._Invalidate=function(){this._ValidateBlocks(),this._CheckProximity(),this.ConnectionLines.UpdateList()},MainScene.prototype._ValidateBlocks=function(){for(var i=0;i<App.Sources.length;i++){var src=App.Sources[i];src.ValidateEffects()}for(var i=0;i<App.Effects.length;i++){var effect=App.Effects[i];effect.ValidateSources()}},MainScene.prototype.DuplicateParams=function(params){var paramsCopy={};for(var key in params)paramsCopy[""+key]=params[""+key];return paramsCopy},MainScene.prototype.CreateBlockFromType=function(t,params){var block=new t;return block.Id=App.GetBlockId(),block.Position=this._PointerPoint,params&&(block.Params=this.DuplicateParams(params)),block.Init(this),block.Type=t,App.CommandManager.ExecuteCommand(Commands_1.Commands.CREATE_BLOCK,block),block.MouseDown(),this.SelectedBlock=block,this.BlockToFront(block),this.IsDraggingABlock=!0,block},MainScene.prototype.CompositionLoaded=function(e){var _this=this;this.BlocksContainer.DisplayList.AddRange(App.Blocks);for(var i=0;i<this.BlocksContainer.DisplayList.Count;i++){var block=this.BlocksContainer.DisplayList.GetValueAt(i);block.Init(this)}this.MainSceneDragger&&(this.MainSceneDragger.Destination=new Point(e.SaveFile.DragOffset.x,e.SaveFile.DragOffset.y)),this.ZoomButtons.UpdateSlot(e.SaveFile.ZoomLevel),App.Metrics.UpdateGridScale(),this._Invalidate(),setTimeout(function(){_this.Play(),App.Audio.Master.volume.rampTo(App.Audio.MasterVolume,1)},200)},MainScene.prototype.DeleteSelectedBlock=function(){if(!this.SelectedBlock)return;this.SelectedBlock.MouseUp(),this.OptionsPanel.Close(),App.CommandManager.ExecuteCommand(Commands_1.Commands.DELETE_BLOCK,this.SelectedBlock),this.SelectedBlock=null},MainScene.prototype.Resize=function(){this.OptionsPanel.Close(),this._Header.Populate(this._Header.MenuJson),this.SettingsPanel.Populate(this.SettingsPanel.MenuJson)},MainScene}(DisplayObject);exports.MainScene=MainScene});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Splash",["require","exports"],function(require,exports){var DisplayObject=etch.drawing.DisplayObject,Point=minerva.Point,Splash=function(_super){__extends(Splash,_super);function Splash(){_super.apply(this,arguments),this.IsAnimationFinished=!1,this.AnimationFinished=new nullstone.Event}return Splash.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo)},Splash.prototype.Setup=function(){_super.prototype.Setup.call(this),this._Offset=new Point(0,0),this.XOffset=0,this.YOffset=-1,this.LoadOffset=0},Splash.prototype.Draw=function(){_super.prototype.Draw.call(this),this.IsFirstFrame()&&this.TransitionIn();var colorful=!1,units=App.Unit;this._Scale=100*units;if(App.IsLoadingComposition){var dx=0,dy=App.Height*this.LoadOffset;App.FillColor(this.Ctx,App.Palette[0]),this.Ctx.fillRect(dx,dy,App.Width,App.Height);var dx=App.Width*.5,dy=App.Height*.5+App.Height*this.LoadOffset;App.FillColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),this.Ctx.textAlign="center",this.Ctx.font=App.Metrics.TxtHeader,this.Ctx.fillText("LOADING SCENE",dx,dy+26*units),App.AnimationsLayer.DrawSprite(this.Ctx,"loading",dx,dy-16*units,16,!0)}this._Offset=new Point(0,1),App.FillRGBA(this.Ctx,10,10,10,1),this.CenterRect(),this._Center=new Point(-0.5,-0.5),this._Offset=new Point(0,0),App.FillColor(this.Ctx,App.Palette[3]),colorful||App.FillColor(this.Ctx,App.Palette[2]),this.CenterRect(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(2,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,-1),this.DrawLineTo(0,0),this.DrawLineTo(0,2),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[6]),this.DrawMoveTo(0,0),this.DrawLineTo(1,0),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this._Center=new Point(-0.5,0),this._Offset=new Point(-1,0),App.FillColor(this.Ctx,App.Palette[4]),colorful||App.FillColor(this.Ctx,App.Palette[0]),this.CenterRect(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[5]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(2,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[3]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,0),this.DrawLineTo(1,1),this.DrawLineTo(0,1),this.Ctx.closePath(),this.Ctx.fill(),this._Center=new Point(0,-0.5),this._Offset=new Point(-1,-1),App.FillColor(this.Ctx,App.Palette[5]),colorful||App.FillColor(this.Ctx,App.Palette[2]),this.CenterRect(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[4]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,0),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[8]),this.DrawMoveTo(-1,0),this.DrawLineTo(0,-1),this.DrawLineTo(1,-1),this.DrawLineTo(0,0),this.Ctx.closePath(),this.Ctx.fill(),this._Center=new Point(0,-0.5),this._Offset=new Point(0,-1),App.FillColor(this.Ctx,App.Palette[6]),colorful||App.FillColor(this.Ctx,App.Palette[0]),this.CenterRect(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[7]),this.DrawMoveTo(-1,-1),this.DrawLineTo(1,-1),this.DrawLineTo(1,0),this.DrawLineTo(-1,2),this.Ctx.closePath(),this.Ctx.fill(),this.Ctx.beginPath(),App.FillColor(this.Ctx,App.Palette[9]),this.DrawLineTo(-1,-1),this.DrawLineTo(0,-1),this.DrawLineTo(0,0),this.DrawLineTo(-1,1),this.Ctx.closePath(),this.Ctx.fill(),this._Center=new Point(0,0),this._Offset=new Point(1,-1),App.FillColor(this.Ctx,App.Palette[2]),this.CenterRect();var dx=App.Width*.5+this._Center.x*this._Scale+App.Width*(this._Offset.x+this.XOffset),dy=App.Height*.5+this._Center.y*this._Scale+App.Height*(this._Offset.y+this.YOffset),headerType=100*units;App.FillColor(this.Ctx,App.Palette[App.ThemeManager.Txt]),this.Ctx.textAlign="center",this.Ctx.font="200 "+headerType+"px Dosis",this.Ctx.fillText("BLOKDUST",dx,dy+headerType*.38)},Splash.prototype.DrawMoveTo=function(x,y){var scale=this._Scale,dx=App.Width*.5+this._Center.x*scale+App.Width*(this._Offset.x+this.XOffset),dy=App.Height*.5+this._Center.y*scale+App.Height*(this._Offset.y+this.YOffset);this.Ctx.moveTo(dx+x*scale,dy+y*scale)},Splash.prototype.DrawLineTo=function(x,y){var scale=this._Scale,dx=App.Width*.5+this._Center.x*scale+App.Width*(this._Offset.x+this.XOffset),dy=App.Height*.5+this._Center.y*scale+App.Height*(this._Offset.y+this.YOffset);this.Ctx.lineTo(dx+x*scale,dy+y*scale)},Splash.prototype.CenterRect=function(){var dx=App.Width*(this._Offset.x+this.XOffset),dy=App.Height*(this._Offset.y+this.YOffset);this.Ctx.fillRect(dx,dy,App.Width,App.Height)},Splash.prototype.DelayTo=function(panel,destination,t,delay,v,s){var offsetTween=new window.TWEEN.Tween({x:s});offsetTween.to({x:destination},t),offsetTween.onUpdate(function(){panel[""+v]=this.x}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.delay(delay),offsetTween.start(this.LastVisualTick)},Splash.prototype.TransitionIn=function(){var _this=this,initDelay=300,tweenLength=250,viewLength=350;this.DelayTo(this,0,tweenLength,initDelay,"YOffset",-1),this.DelayTo(this,1,tweenLength,viewLength+tweenLength+initDelay,"XOffset",0),this.DelayTo(this,1,tweenLength,viewLength*2+tweenLength*2+initDelay,"YOffset",0),this.DelayTo(this,0,tweenLength,viewLength*3+tweenLength*3+initDelay,"XOffset",1),this.DelayTo(this,-1,tweenLength,viewLength*4+tweenLength*4+initDelay,"XOffset",0),this.DelayTo(this,2,tweenLength+200,viewLength*5+tweenLength*5+initDelay+200,"YOffset",1),setTimeout(function(){_this.IsAnimationFinished=!0,_this.AnimationFinished.raise(_this,null)},viewLength*5+tweenLength*5+initDelay+200)},Splash.prototype.TransitionOut=function(){this.DelayTo(this,1,450,300,"LoadOffset",0)},Splash}(DisplayObject);exports.Splash=Splash});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Stage",["require","exports","./MainScene","./Splash"],function(require,exports,MainScene_1,Splash_1){var Stage=function(_super){__extends(Stage,_super);function Stage(){var _this=this;_super.call(this),this.MainScene=new MainScene_1.MainScene,this.DisplayList.Add(this.MainScene),this.MainScene.Init(App.Canvas),this.MainScene.Hide(),this.Splash=new Splash_1.Splash,this.DisplayList.Add(this.Splash),this.Splash.Init(App.Canvas),this.Splash.AnimationFinished.on(function(s){App.IsLoadingComposition||(_this.MainScene.Show(),_this.Splash.TransitionOut())},this),App.CompositionLoaded.on(function(s,e){_this.CompositionLoaded(e)},this)}return Stage.prototype.CompositionLoaded=function(e){this.Splash.IsAnimationFinished&&(this.Splash.TransitionOut(),this.MainScene.Show())},Stage.prototype.OnTicked=function(lastTime,nowTime){_super.prototype.OnTicked.call(this,lastTime,nowTime)},Stage.prototype.UpdateDisplayList=function(displayList){_super.prototype.UpdateDisplayList.call(this,displayList)},Stage.prototype.DrawDisplayList=function(displayList){_super.prototype.DrawDisplayList.call(this,displayList)},Stage.prototype.ResizeDisplayList=function(displayList){_super.prototype.ResizeDisplayList.call(this,displayList)},Stage.prototype.Resize=function(){_super.prototype.Resize.call(this)},Stage}(etch.drawing.Stage);exports.Stage=Stage}),define("Core/Visual/ColorTheme",["require","exports"],function(require,exports){var ColorTheme=function(){function ColorTheme(name,url,options){this.Name=name,this.PaletteURL=url,this.Options=options||{}}return ColorTheme}();exports.ColorTheme=ColorTheme}),define("Core/Visual/ThemeChangeEventArgs",["require","exports"],function(require,exports){var ThemeChangeEventArgs=function(){function ThemeChangeEventArgs(index,palette){Object.defineProperty(this,"Index",{value:index,writable:!1}),Object.defineProperty(this,"Palette",{value:palette,writable:!1})}return ThemeChangeEventArgs}();exports.ThemeChangeEventArgs=ThemeChangeEventArgs}),define("Core/Visual/ThemeManager",["require","exports","./ColorTheme","./ThemeChangeEventArgs"],function(require,exports,ColorTheme_1,ThemeChangeEventArgs_1){var ThemeManager=function(){function ThemeManager(){this.ThemeChanged=new nullstone.Event,this.Loaded=!1,this.Themes=[new ColorTheme_1.ColorTheme("MODE STEREO",App.Config.PixelPaletteImagePath[0],{options:[3,4,7,5,9]}),new ColorTheme_1.ColorTheme("PENCIL CONTROL",App.Config.PixelPaletteImagePath[2]),new ColorTheme_1.ColorTheme("FJORD",App.Config.PixelPaletteImagePath[1]),new ColorTheme_1.ColorTheme("CONSOLE",App.Config.PixelPaletteImagePath[10],{menu:[3,5,7,4,6],options:[3,4,5,7,6]}),new ColorTheme_1.ColorTheme("FRIENDS",App.Config.PixelPaletteImagePath[3],{menu:[3,5,7,4,6]}),new ColorTheme_1.ColorTheme("KORAL",App.Config.PixelPaletteImagePath[4],{options:[7,6,9,4,3]}),new ColorTheme_1.ColorTheme("SEA CUCUMBER",App.Config.PixelPaletteImagePath[9],{menu:[3,9,10,4,6],options:[3,4,9,10,6]}),new ColorTheme_1.ColorTheme("RIKI",App.Config.PixelPaletteImagePath[7]),new ColorTheme_1.ColorTheme("ARROW MOUNTAIN",App.Config.PixelPaletteImagePath[8],{menu:[6,5,7,4,3]})],this._Defaults={txt:8,menu:[9,5,7,4,3],options:[3,4,9,7,5]},this._Value={txt:this._Defaults.txt,menu:this._Defaults.menu,options:this._Defaults.options},this.Txt=16,this.MenuOrder=[17,18,19,20,21],this.OptionsOrder=[22,23,24,25,26]}return ThemeManager.prototype.LoadTheme=function(theme){var _this=this;this.CurrentThemeNo=theme,this.CurrentTheme=this.Themes[theme];var selectedtheme=this.Themes[theme];this._Value.txt=selectedtheme.Options.txt||this._Defaults.txt,this._Value.menu=selectedtheme.Options.menu||this._Defaults.menu,this._Value.options=selectedtheme.Options.options||this._Defaults.options,this.Loaded=!1;var pixelPalette=new PixelPalette(selectedtheme.PaletteURL);pixelPalette.Load(function(palette){var i,l;_this.Txt=palette.length,palette.push(palette[_this._Value.txt].clone()),_this.NewPalette=palette,l=palette.length,_this.MenuOrder=[l,l+1,l+2,l+3,l+4];for(i=0;i<_this._Value.menu.length;i++)palette.push(palette[_this._Value.menu[i]].clone());l=palette.length,_this.OptionsOrder=[l,l+1,l+2,l+3,l+4];for(i=0;i<_this._Value.options.length;i++)palette.push(palette[_this._Value.options[i]].clone());var shareUrl=document.getElementById("shareUrl");shareUrl.style.color=App.ColorManager.ColorString(_this.NewPalette[_this.Txt]);var styleElem=document.getElementById("selectStyle"),highlightCol=App.ColorManager.DarkerColor(_this.NewPalette[1],15),col=App.ColorManager.ColorString(highlightCol);styleElem.innerHTML="::selection{ background-color: "+col+"; background-blend-mode: normal; mix-blend-mode: normal;}",_this.Loaded=!0,_this.ThemeChanged.raise(_this,new ThemeChangeEventArgs_1.ThemeChangeEventArgs(theme,palette));if(App.Stage)for(i=0;i<palette.length;i++)_this.ColorTo(App.Palette[i],_this.NewPalette[i],800)})},ThemeManager.prototype.ColorTo=function(color,destination,t){var offsetTween=new window.TWEEN.Tween({r:color.R,g:color.G,b:color.B,a:color.A});offsetTween.to({r:destination.R,g:destination.G,b:destination.B,a:destination.A},t),offsetTween.onUpdate(function(){color.R=Math.round(this.r),color.G=Math.round(this.g),color.B=Math.round(this.b),color.A=Math.round(this.a),color.toString=function(){return"rgba("+color.R+","+color.G+","+color.B+","+color.A+")"}}),offsetTween.easing(window.TWEEN.Easing.Exponential.InOut),offsetTween.start(App.Stage.LastVisualTick)},ThemeManager}();exports.ThemeManager=ThemeManager});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Core/Inputs/TypingManager",["require","exports","./KeyboardInputManager"],function(require,exports,KeyboardInputManager_1){var TypingManager=function(_super){__extends(TypingManager,_super);function TypingManager(){_super.call(this),this.IsEnabled=!1,this._String="",this._CharLimit=20}return TypingManager.prototype.KeyboardDown=function(e){_super.prototype.KeyboardDown.call(this,e);if(!this.IsEnabled)return;var code=e.keyCode;this.AddToString(code),this.RemoveFromString(),this.StringReturn()},TypingManager.prototype.KeyboardUp=function(e){_super.prototype.KeyboardUp.call(this,e);if(!this.IsEnabled)return},TypingManager.prototype.AddToString=function(code){if(!this.IsModifierDown()&&this._String.length<this._CharLimit)if(code>47&&code<91||code>105&&code<112||code>185&&code<193||code>218&&code<223||code==32){var key=""+String.fromCharCode(code);this._String=""+this._String+key,this._Panel.UpdateString(this._String)}},TypingManager.prototype.RemoveFromString=function(){this.IsKeyCodeDown(KeyCodes.KeyDown.Backspace)&&(this._String=this._String.substring(0,this._String.length-1),this._Panel.UpdateString(this._String))},TypingManager.prototype.StringReturn=function(){this.IsKeyCodeDown(KeyCodes.KeyDown.Enter)&&this._Panel.StringReturn()},TypingManager.prototype.Enable=function(panel){this.IsEnabled=!0,this._Panel=panel,this._String=panel.GetString()},TypingManager.prototype.Disable=function(){this.IsEnabled=!1},TypingManager}(KeyboardInputManager_1.KeyboardInputManager);exports.TypingManager=TypingManager}),define("CommandHandlers/UndoCommandHandler",["require","exports","../Commands","../CommandCategories"],function(require,exports,Commands_1,CommandCategories_1){var UndoCommandHandler=function(){function UndoCommandHandler(){}return UndoCommandHandler.prototype.Execute=function(){if(App.OperationManager.CanUndo())return App.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Commands_1.Commands.UNDO.toString()),App.OperationManager.Undo()},UndoCommandHandler}();exports.UndoCommandHandler=UndoCommandHandler}),define("Core/Audio/SoundCloud/SoundcloudTrack",["require","exports"],function(require,exports){var SoundCloudTrack=function(){function SoundCloudTrack(title,user,uri,permalink){this._Long=65,this._Short=30,title.length>this._Long?this.Title=title.substring(0,this._Long)+"...":this.Title=title,title.length>this._Short?this.TitleShort=title.substring(0,this._Short)+"...":this.TitleShort=title,this.Title=this.Title.toUpperCase(),this.TitleShort=this.TitleShort.toUpperCase(),user.length>this._Long?this.User=user.substring(0,this._Long)+"...":this.User=user,user.length>this._Short?this.UserShort=user.substring(0,this._Short)+"...":this.UserShort=user,this.User=this.Capitalise(this.User),this.UserShort=this.Capitalise(this.UserShort),this.URI=uri,this.Permalink=permalink}return SoundCloudTrack.prototype.Capitalise=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},SoundCloudTrack}();exports.SoundCloudTrack=SoundCloudTrack});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/Granular",["require","exports","../../Core/Audio/SoundCloud/SoundCloudAPI","../../Core/Audio/SoundCloud/SoundcloudTrack","../Source"],function(require,exports,SoundCloudAPI_1,SoundcloudTrack_1,Source_1){var Point=etch.primitives.Point,Granular=function(_super){__extends(Granular,_super);function Granular(){_super.apply(this,arguments),this.Grains=[],this._Envelopes=[],this._FirstRelease=!0,this._CurrentGrain=0,this.GrainsAmount=16,this._NoteOn=!1,this._LoadFromShare=!1}return Granular.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Granular.name,this.Params&&(this._LoadFromShare=!0,setTimeout(function(){_this.FirstSetup()},100)),this.Defaults={playbackRate:1,density:10,region:0,spread:1.5,grainlength:.25,track:SoundCloudAPI_1.SoundCloudAPI.PickRandomTrack(1),trackName:"TEUFELSBERG",user:"BGXA",permalink:""},this.PopulateParams(),this._tempPlaybackRate=this.Params.playbackRate,this._WaveForm=[],this.SearchResults=[],this.Searching=!1,this._FallBackTrack=new SoundcloudTrack_1.SoundCloudTrack(this.Params.trackName,this.Params.user,this.Params.track,this.Params.permalink),_super.prototype.Init.call(this,drawTo),this.CreateSource(),this.CreateEnvelope(),this.CreateGrains(),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(2,0),new Point(2,1),new Point(1,2))},Granular.prototype.Reset=function(){this.Grains.length=0,this._Envelopes.length=0},Granular.prototype.Search=function(query){var _this=this;this.Searching=!0,App.MainScene.OptionsPanel.Animating=!0,this.ResultsPage=1,this.SearchResults=[],SoundCloudAPI_1.SoundCloudAPI.Search(query,App.Config.GranularMaxTrackLength,function(track){_this.SearchResults.push(new SoundcloudTrack_1.SoundCloudTrack(track.title,track.user.username,track.uri,track.permalink_url)),_this.Searching=!1,App.MainScene.OptionsPanel.Animating=!1},function(error){_this.Searching=!1,App.MainScene.OptionsPanel.Animating=!1,error.status===452})},Granular.prototype.LoadTrack=function(track,fullUrl){fullUrl=fullUrl||!1,fullUrl?this.Params.track=track.URI:(this.Params.track=SoundCloudAPI_1.SoundCloudAPI.LoadTrack(track),this.Params.permalink=track.Permalink),this.Params.trackName=track.TitleShort,this.Params.user=track.UserShort,this._WaveForm=[],this.SetupGrains(),this.RefreshOptionsPanel("animate")},Granular.prototype.TrackFallBack=function(){this.LoadTrack(this._FallBackTrack,!0),App.Message("Load Failed: This Track Is Unavailable. Reloading last track.")},Granular.prototype.CreateGrains=function(){if(!this.Grains[0]){for(var i=0;i<this.GrainsAmount;i++)this.Grains[i]=new Tone.Player,this._Envelopes[i]=new Tone.AmplitudeEnvelope(this.Params.grainlength/2,.01,.9,this.Params.grainlength/2),this.Grains[i].connect(this._Envelopes[i]),this._Envelopes[i].connect(this.Sources[0]),Tone.isSafari?this.Grains[i].playbackRate=this.Params.playbackRate:this.Grains[i].playbackRate.value=this.Params.playbackRate;this.Sources[0].connect(this.AudioInput)}},Granular.prototype.SetupGrains=function(){var _this=this;this._IsLoaded=!1;var duration=this.GetDuration();App.AnimationsLayer.AddToList(this),this._FirstBuffer&&this._FirstBuffer.dispose(),this._FirstBuffer=new Tone.Player(this.Params.track,function(e){clearTimeout(_this.LoadTimeout),_this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(e.buffer._buffer,200,2,80),App.AnimationsLayer.RemoveFromList(_this),_this._IsLoaded=!0;for(var i=0;i<_this.GrainsAmount;i++)_this.Grains[i].buffer=e.buffer;var duration=_this.GetDuration();_this._LoadFromShare||(_this.Params.region=duration/2),_this._LoadFromShare=!1,_this._FallBackTrack=new SoundcloudTrack_1.SoundCloudTrack(_this.Params.trackName,_this.Params.user,_this.Params.track,_this.Params.permalink),_this.RefreshOptionsPanel(),_this.GrainLoop()});var me=this;clearTimeout(this.LoadTimeout),this.LoadTimeout=setTimeout(function(){me.TrackFallBack()},App.Config.SoundCloudLoadTimeout*1e3),this._FirstBuffer.onerror=function(){console.log("error"),me.TrackFallBack()}},Granular.prototype.FirstSetup=function(){var _this=this;this._FirstRelease&&(this.Sources.forEach(function(s,i){s.connect(_this.Envelopes[i])}),this.Envelopes.forEach(function(e){e.connect(_this.AudioInput)}),this.Search(App.MainScene.SoundcloudPanel.RandomSearch(this)),this.SetupGrains(),this._FirstRelease=!1)},Granular.prototype.GetDuration=function(){return this._FirstBuffer?this._FirstBuffer.buffer.duration:0},Granular.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Granular.prototype.CreateSource=function(){return this.Sources.push(new Tone.Signal),_super.prototype.CreateSource.call(this)},Granular.prototype.CreateEnvelope=function(){return this.Envelopes.push(new Tone.AmplitudeEnvelope(this.Settings.envelope.attack,this.Settings.envelope.decay,this.Settings.envelope.sustain,this.Settings.envelope.release)),_super.prototype.CreateEnvelope.call(this)},Granular.prototype.TriggerAttack=function(){_super.prototype.TriggerAttack.call(this),this._IsLoaded&&(clearTimeout(this.EndTimeout),this._NoteOn||(this._NoteOn=!0,this.GrainLoop()))},Granular.prototype.TriggerRelease=function(){var _this=this;_super.prototype.TriggerRelease.call(this),this.EndTimeout=setTimeout(function(){_this._NoteOn=!1},this._Envelopes[0].release*1e3)},Granular.prototype.TriggerAttackRelease=function(index,duration){var _this=this;index===void 0&&(index=0),duration===void 0&&(duration=App.Config.PulseLength),this._IsLoaded&&(clearTimeout(this.EndTimeout),this._NoteOn||(this._NoteOn=!0,this.GrainLoop())),this.ReleaseTimeout=setTimeout(function(){_this.EndTimeout=setTimeout(function(){_this._NoteOn=!1},_this._Envelopes[0].release*1e3)},duration)},Granular.prototype.MouseUp=function(){this.FirstSetup(),_super.prototype.MouseUp.call(this)},Granular.prototype.GrainLoop=function(){var _this=this;if(this._Envelopes[this._CurrentGrain]&&(this.IsPowered()||this._NoteOn)){var location=this.LocationRange(this.Params.region-this.Params.spread*.5+Math.random()*this.Params.spread);this._Envelopes[this._CurrentGrain].triggerAttackRelease(this.Params.grainlength/2,"+0.01"),this.Grains[this._CurrentGrain].stop(),this.Grains[this._CurrentGrain].playbackRate.value=this._tempPlaybackRate,this.Grains[this._CurrentGrain].start("+0.01",location,this.Params.grainlength*this._tempPlaybackRate*1.9),clearTimeout(this.Timeout),this.Timeout=setTimeout(function(){_this.GrainLoop()},Math.round(this.Params.grainlength*2/this.Params.density*1500)),this._CurrentGrain+=1,this._CurrentGrain>=this.Params.density&&(this._CurrentGrain=0)}},Granular.prototype.LocationRange=function(location){var locationCap=this.Grains[0].duration-this.Params.grainlength;return location<0?location=0:location>locationCap&&(location=locationCap),location},Granular.prototype.SetPitch=function(pitch,sourceId,rampTime){pitch/=App.Config.BaseNote;for(var i=0;i<this.GrainsAmount;i++)Tone.isSafari?this.Grains[i].playbackRate=pitch:this.Grains[i].playbackRate.value=pitch;this._tempPlaybackRate=pitch,console.log(this._tempPlaybackRate),console.log(this.Params.playbackRate)},Granular.prototype.ResetPitch=function(){if(App.Config.ResetPitchesOnInteractionDisconnect){this._tempPlaybackRate=this.Params.playbackRate;for(var i=0;i<this.GrainsAmount;i++)Tone.isSafari?this.Grains[i].playbackRate=this.Params.playbackRate:this.Grains[i].playbackRate.value=this.Params.playbackRate}},Granular.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);switch(param){case"density":this.Params.density=value;break;case"grainlength":this.Params.grainlength=value;for(var i=0;i<this.GrainsAmount;i++)this._Envelopes[i].attack=value/2,this._Envelopes[i].release=value/2;break;case"spread":this.Params.spread=value;break;case"region":this.Params.region=value}},Granular.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Granular",parameters:[{type:"waveslider",name:"Location",setting:"region",props:{value:this.Params.region,min:0,max:this.GetDuration(),quantised:!1,centered:!1,wavearray:this._WaveForm,spread:this.Params.spread}},{type:"sample",name:"Sample",setting:"sample",props:{track:this.Params.trackName,user:this.Params.user,permalink:this.Params.permalink}},{type:"slider",name:"Spread",setting:"spread",props:{value:this.Params.spread,min:0,max:4,quantised:!1,centered:!1}},{type:"slider",name:"Grain Size",setting:"grainlength",props:{value:this.Params.grainlength,min:.03,max:.5,quantised:!1,centered:!1}},{type:"slider",name:"Density",setting:"density",props:{value:this.Params.density,min:2,max:this.GrainsAmount,quantised:!0,centered:!1}}]}},Granular.prototype.Dispose=function(){_super.prototype.Dispose.call(this),clearTimeout(this.Timeout),this._NoteOn=!1,this.Grains.forEach(function(g){g.dispose()}),this._Envelopes.forEach(function(e){e.dispose()}),this.Envelopes.forEach(function(e){e.dispose()}),this.Sources.forEach(function(s){s.dispose()}),this.Grains.length=0,this._Envelopes.length=0},Granular}(Source_1.Source);exports.Granular=Granular});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/Microphone",["require","exports","../Source"],function(require,exports,Source_1){var Point=etch.primitives.Point,Microphone=function(_super){__extends(Microphone,_super);function Microphone(){_super.apply(this,arguments),this.Muted=!1,this._unmutedVolume=1}return Microphone.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Microphone.name,this.Defaults={gain:1,monitor:!0},this.PopulateParams(),_super.prototype.Init.call(this,drawTo),navigator.getUserMedia||App.Message("Unfortunately the microphone will not work in this browser because it doesn't support 'getUserMedia'. Try using the latest Chrome"),this.CreateSource(),this.Volume=App.Audio.ctx.createGain(),this.Sources.forEach(function(s){s.open(function(){s.connect(_this.Volume),s.start()})}),this.Volume.gain.value=this.Params.gain,this.Volume.connect(this.AudioInput),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(1,1),new Point(0,2),new Point(-1,1))},Microphone.prototype.Mute=function(){this.Muted||(this._unmutedVolume=this.Volume.gain.value,this.Volume.gain.value=0,this.Muted=!0)},Microphone.prototype.Unmute=function(){this.Muted&&(this.Volume.gain.value=this._unmutedVolume,this.Muted=!1)},Microphone.prototype.CreateSource=function(){return this.Sources.push(new Tone.Microphone),this.Sources[this.Sources.length-1]},Microphone.prototype.UpdateConnections=function(chain){this.Chain=chain,this.IsPressed||this.TriggerRelease()},Microphone.prototype.TriggerAttack=function(index){this.Unmute()},Microphone.prototype.TriggerRelease=function(index){this.IsPowered()||this.Mute()},Microphone.prototype.TriggerAttackRelease=function(duration){var _this=this;this.Unmute(),duration||(duration=App.Config.PulseLength),setTimeout(function(){_this.Mute()},this.Sources[0].toSeconds(duration)*1e3)},Microphone.prototype.SetParam=function(param,value){var val=value;param=="monitor",this.Params[""+param]=val,_super.prototype.SetParam.call(this,param,value)},Microphone.prototype.Update=function(){_super.prototype.Update.call(this)},Microphone.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Microphone.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.Sources.forEach(function(s){s.dispose()}),this.Volume=null,this.Muted=null},Microphone}(Source_1.Source);exports.Microphone=Microphone});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/Noise",["require","exports","../Source"],function(require,exports,Source_1){var Point=etch.primitives.Point,Noise=function(_super){__extends(Noise,_super);function Noise(){_super.apply(this,arguments)}return Noise.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Noise.name,this.Defaults={playbackRate:1,waveform:2},this.PopulateParams(),_super.prototype.Init.call(this,drawTo),this.CreateSource(),this.CreateEnvelope(),this.Envelopes.forEach(function(e){e.connect(_this.AudioInput)}),this.Sources.forEach(function(s,i){s.connect(_this.Envelopes[i]).start()}),this.DelayedRelease=0,this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(1,0),new Point(-1,2))},Noise.prototype.CreateSource=function(){return this.Sources.push(new Tone.Noise(App.Audio.WaveformTypeIndexNoise[this.Params.waveform])),_super.prototype.CreateSource.call(this)},Noise.prototype.CreateEnvelope=function(){return this.Envelopes.push(new Tone.AmplitudeEnvelope(this.Settings.envelope.attack,this.Settings.envelope.decay,this.Settings.envelope.sustain,this.Settings.envelope.release)),_super.prototype.CreateEnvelope.call(this)},Noise.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Noise.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Noise",parameters:[{type:"buttons",name:"Wave",setting:"waveform",props:{value:this.Params.waveform,mode:"string"},buttons:[{name:"White"},{name:"Pink"},{name:"Brown"}]}]}},Noise.prototype.SetParam=function(param,value){switch(param){case"waveform":this.Sources.forEach(function(s){s.type=App.Audio.WaveformTypeIndexNoise[value]})}this.Params[param]=value},Noise.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.Sources.forEach(function(s){s.dispose()}),this.Envelopes.forEach(function(e){e.dispose()})},Noise}(Source_1.Source);exports.Noise=Noise});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/Soundcloud",["require","exports","./SamplerBase","../../Core/Audio/SoundCloud/SoundCloudAPI","../../Core/Audio/SoundCloud/SoundcloudTrack"],function(require,exports,SamplerBase_1,SoundCloudAPI_1,SoundcloudTrack_1){var Point=etch.primitives.Point,Soundcloud=function(_super){__extends(Soundcloud,_super);function Soundcloud(){_super.apply(this,arguments),this._FirstRelease=!0,this._LoadFromShare=!1}return Soundcloud.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Soundcloud.name,this.Params&&(this._LoadFromShare=!0,setTimeout(function(){_this.FirstSetup()},100)),this.Defaults={playbackRate:1,reverse:!1,startPosition:0,endPosition:null,loop:!0,loopStart:0,loopEnd:0,retrigger:!1,volume:11,track:"http://files.blokdust.com/impulse-responses/teufelsberg01.wav",trackName:"TEUFELSBERG",user:"BGXA"},this.PopulateParams(),this._WaveForm=[],this.SearchResults=[],this.Searching=!1,this._FallBackTrack=new SoundcloudTrack_1.SoundCloudTrack(this.Params.trackName,this.Params.user,this.Params.track,this.Params.permalink),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(2,0),new Point(1,1),new Point(0,1))},Soundcloud.prototype.SetBuffers=function(){var _this=this;this.Sources.forEach(function(s){s.triggerRelease()}),App.AnimationsLayer.AddToList(this),this._FirstBuffer&&this._FirstBuffer.dispose(),this._FirstBuffer=new Tone.Buffer(this.Params.track,function(e){clearTimeout(_this.LoadTimeout),App.AnimationsLayer.RemoveFromList(_this);var duration=_this.GetDuration(_this._FirstBuffer);_this._LoadFromShare||(_this.Params.startPosition=0,_this.Params.endPosition=duration,_this.Params.loopStart=duration*.5,_this.Params.loopEnd=duration,_this.Params.reverse=!1),_this._LoadFromShare=!1,_this._FallBackTrack=new SoundcloudTrack_1.SoundCloudTrack(_this.Params.trackName,_this.Params.user,_this.Params.track,_this.Params.permalink),_this.Sources.forEach(function(s){s.player.buffer=e,s.player.loopStart=_this.Params.loopStart,s.player.loopEnd=_this.Params.loopEnd,s.player.reverse=_this.Params.reverse}),_this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(e._buffer,200,5,95),_this.RefreshOptionsPanel(),_this.IsPowered()&&_this.TriggerAttack()}),clearTimeout(this.LoadTimeout),this.LoadTimeout=setTimeout(function(){_this.TrackFallBack()},App.Config.SoundCloudLoadTimeout*1e3),this._FirstBuffer.onerror=function(){console.log("error"),_this.TrackFallBack()}},Soundcloud.prototype.Search=function(query){var _this=this;this.Searching=!0,App.MainScene.OptionsPanel.Animating=!0,this.ResultsPage=1,this.SearchResults=[],SoundCloudAPI_1.SoundCloudAPI.Search(query,App.Config.SoundCloudMaxTrackLength,function(track){_this.SearchResults.push(new SoundcloudTrack_1.SoundCloudTrack(track.title,track.user.username,track.uri,track.permalink_url)),_this.Searching=!1,App.MainScene.OptionsPanel.Animating=!1},function(error){_this.Searching=!1,App.MainScene.OptionsPanel.Animating=!1,error.status===452})},Soundcloud.prototype.LoadTrack=function(track,fullUrl){_super.prototype.LoadTrack.call(this,track,fullUrl),fullUrl=fullUrl||!1,fullUrl?this.Params.track=track.URI:(this.Params.track=SoundCloudAPI_1.SoundCloudAPI.LoadTrack(track),this.Params.permalink=track.Permalink),this.Params.trackName=track.TitleShort,this.Params.user=track.UserShort,this.Params.reverse=!1,this._WaveForm=[],this.SetBuffers(),this.RefreshOptionsPanel("animate")},Soundcloud.prototype.TrackFallBack=function(){this.LoadTrack(this._FallBackTrack,!0),App.Message("Load Failed: This Track Is Unavailable. Reloading last track.")},Soundcloud.prototype.FirstSetup=function(){var _this=this;this._FirstRelease&&(this.Search(App.MainScene.SoundcloudPanel.RandomSearch(this)),this.SetBuffers(),this.Envelopes.forEach(function(e,i){e=_this.Sources[i].envelope}),this.Sources.forEach(function(s){s.connect(_this.AudioInput)}),this._FirstRelease=!1)},Soundcloud.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Soundcloud.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Soundcloud",parameters:[{type:"waveregion",name:"Region",setting:"region",props:{value:5,min:0,max:this.GetDuration(this._FirstBuffer),quantised:!1,centered:!1,wavearray:this._WaveForm,mode:this.Params.loop},nodes:[{setting:"startPosition",value:this.Params.startPosition},{setting:"endPosition",value:this.Params.endPosition},{setting:"loopStart",value:this.Params.loopStart},{setting:"loopEnd",value:this.Params.loopEnd}]},{type:"sample",name:"Sample",setting:"sample",props:{track:this.Params.trackName,user:this.Params.user,permalink:this.Params.permalink}},{type:"switches",name:"Loop",setting:"loop",switches:[{name:"Reverse",setting:"reverse",value:this.Params.reverse,lit:!0,mode:"offOn"},{name:"Looping",setting:"loop",value:this.Params.loop,lit:!0,mode:"offOn"}]},{type:"slider",name:"playback",setting:"playbackRate",props:{value:this.Params.playbackRate,min:.125,max:8,quantised:!1,centered:!0,logarithmic:!0}}]}},Soundcloud.prototype.SetParam=function(param,value){var _this=this;_super.prototype.SetParam.call(this,param,value);var val=value;switch(param){case"playbackRate":Tone.isSafari?this.Sources[0].player.playbackRate=value:this.Sources[0].player.playbackRate.value=value;break;case"reverse":value=value?!0:!1,this._FirstBuffer.reverse=value,this.Sources.forEach(function(s){s.player.buffer=_this._FirstBuffer}),this.Params[param]=val,this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(this._FirstBuffer._buffer,200,5,95),this.RefreshOptionsPanel();break;case"loop":value=value?!0:!1,this.Sources.forEach(function(s){s.player.loop=value}),value===!0&&this.IsPowered()&&this.Sources.forEach(function(s){s.player.stop(),s.player.start(s.player.startPosition)}),this.Params[param]=val,this.RefreshOptionsPanel();break;case"loopStart":this.Sources.forEach(function(s){s.player.loopStart=value});break;case"loopEnd":this.Sources.forEach(function(s){s.player.loopEnd=value})}this.Params[param]=value},Soundcloud.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},Soundcloud}(SamplerBase_1.SamplerBase);exports.Soundcloud=Soundcloud});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/ToneSource",["require","exports","../Source"],function(require,exports,Source_1){var Point=etch.primitives.Point,ToneSource=function(_super){__extends(ToneSource,_super);function ToneSource(){_super.apply(this,arguments)}return ToneSource.prototype.Init=function(drawTo){var _this=this;this.BlockName=App.L10n.Blocks.Source.Blocks.Tone.name,this.Defaults={waveform:2,transpose:0,fine:0},this.PopulateParams(),_super.prototype.Init.call(this,drawTo),this.CreateSource(),this.CreateEnvelope(),this.Envelopes.forEach(function(e){e.connect(_this.AudioInput)}),this.Sources.forEach(function(s,i){s.connect(_this.Envelopes[i]),s.start()}),this.Outline.push(new Point(-2,0),new Point(0,-2),new Point(2,0),new Point(1,1),new Point(-1,1))},ToneSource.prototype.BackwardsCompatibilityPatch=function(){this.Params.frequency=this.GetFrequency(),this.Params.baseFrequency=this.GetFrequency()},ToneSource.prototype.CreateSource=function(){return this.Sources.push(new Tone.Oscillator(this.GetFrequency(),App.Audio.WaveformTypeIndex[this.Params.waveform])),_super.prototype.CreateSource.call(this)},ToneSource.prototype.CreateEnvelope=function(){return this.Envelopes.push(new Tone.AmplitudeEnvelope(this.Settings.envelope.attack,this.Settings.envelope.decay,this.Settings.envelope.sustain,this.Settings.envelope.release)),_super.prototype.CreateEnvelope.call(this)},ToneSource.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.Sources.forEach(function(s){s.dispose()}),this.Envelopes.forEach(function(e){e.dispose()})},ToneSource.prototype.Update=function(){_super.prototype.Update.call(this)},ToneSource.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},ToneSource.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Tone",parameters:[{type:"slider",name:"Note",setting:"transpose",props:{value:this.Params.transpose,min:-48,max:48,quantised:!0,centered:!0,convertDisplay:this.DisplayNote}},{type:"slider",name:"Fine",setting:"fine",props:{value:this.Params.fine,min:-1,max:1,quantised:!1,centered:!0}},{type:"buttons",name:"Wave",setting:"waveform",props:{value:this.Params.waveform,mode:"wave"},buttons:[{name:"Sine"},{name:"Square"},{name:"Triangle"},{name:"Saw"}]}]}},ToneSource.prototype.SetParam=function(param,value){switch(param){case"transpose":this.Params.transpose=value,this.SetPitch(this.GetFrequency(this.Params.transpose,this.Params.fine),0,0);break;case"fine":this.SetPitch(this.GetFrequency(value,this.Params.transpose),0,0);break;case"waveform":this.Sources.forEach(function(s){s.type=App.Audio.WaveformTypeIndex[value]})}this.Params[param]=value},ToneSource.prototype.DisplayNote=function(value){var octave=ToneSource.GetOctaveFromTransposeValue(value),note=ToneSource.GetNoteFromTransposeValue(value);return""+note+""+octave},ToneSource.GetOctaveFromTransposeValue=function(value){return Math.floor(value/12)+4},ToneSource.GetNoteFromTransposeValue=function(value){return value%=12,value<0&&(value+=12),App.Audio.NoteIndex[value]},ToneSource.prototype.GetFrequency=function(transpose,fine){return transpose=typeof transpose=="number"?transpose:this.Params.transpose,fine=typeof fine=="number"?fine:this.Params.fine,App.Config.BaseNote*App.Audio.Tone.intervalToFrequencyRatio(transpose+fine)},ToneSource}(Source_1.Source);exports.ToneSource=ToneSource}),define("WaveVoice",["require","exports"],function(require,exports){var WaveVoice=function(){function WaveVoice(type,wave,frequency,gain,drift,sequence,slide){this.Frequency=frequency,this.Value=0,this.Polarity=1,this.VoiceType=type,this.WaveType=wave,this.Volume=gain,this.Drift=drift,this.Sequence=sequence,this.Slide=slide,this.FDest=frequency}return WaveVoice}();exports.WaveVoice=WaveVoice});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Sources/WaveGen",["require","exports","./SamplerBase","../../WaveVoice"],function(require,exports,SamplerBase_1,WaveVoice_1){var Point=etch.primitives.Point,WaveGen=function(_super){__extends(WaveGen,_super);function WaveGen(){_super.apply(this,arguments),this._FirstRelease=!0,this._LoadFromShare=!1}return WaveGen.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Source.Blocks.WaveGen.name;if(this.Params){this._LoadFromShare=!0;var me=this;setTimeout(function(){me.FirstSetup()},100)}this.Defaults={playbackRate:1,reverse:!1,startPosition:0,endPosition:null,loop:!0,loopStart:0,loopEnd:0,retrigger:!1,volume:11,generate:null,seed:{}},this.PopulateParams(),this._WaveForm=[],this._WaveVoices=[],this._SeedLoad=!0,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(0,-1),new Point(1,0),new Point(1,2),new Point(0,2),new Point(-1,1))},WaveGen.prototype.Arp=function(mode,notes,octave,range,length){var seq=[];switch(mode){case 1:for(var j=0;j<length;j++)seq.push(this.Sources[0].noteToFrequency(""+notes[0]+(octave+Math.floor(Math.random()*range))));return seq;case 2:for(var j=0;j<length;j++)seq.push(this.Sources[0].noteToFrequency(""+notes[Math.floor(Math.random()*notes.length)]+(octave+Math.floor(Math.random()*range))));return seq;case 3:var dir=1;this.Dice(2)&&(dir=-1);var change=3+Math.round(Math.random()*5),note=Math.floor(Math.random()*notes.length),thisOctave=Math.floor(Math.random()*range);for(var j=0;j<length;j++)seq.push(this.Sources[0].noteToFrequency(""+notes[note]+(octave+thisOctave))),this.Dice(change)&&(dir=-dir),note+=dir,note<0&&(thisOctave>0?(note=notes.length-1,thisOctave-=1):(note+=2,dir=1)),note>notes.length-1&&(thisOctave<range?(note=0,thisOctave+=1):(note-=2,dir=-1));return seq}},WaveGen.prototype.Dice=function(sides){return Math.floor(Math.random()*sides)==0},WaveGen.prototype.DataToBuffer=function(){var seconds=2,sampleRate=App.Audio.sampleRate,gain=1,noise=0;this.Dice(2)&&(noise=Math.random()*.5);var waveType=Math.floor(Math.random()*3),octaving=0,organise=!1;this.Dice(8)&&(this.Dice(3)?octaving=2:octaving=1,this.Dice(3)&&(organise=!0));var following=!1;this.Dice(4)&&(following=!0);var glide=1+Math.round(Math.random()*20),noGlide=!1;this.Dice(2)&&(noGlide=!0);var notes=["c","d","e","f","g","a","b"],wonder=["c","e","f","a"],minor=["c","d#","g","g#"],jpent=["c","c#","f","g","a#"],second=["c","f","g","g#"],jazz=["c","d","d#","g","a","a#"],scales=[wonder,minor,jpent,second,jazz],scale,sequenceLength=Math.pow(2,1+Math.round(Math.random()*6));sequenceLength==2&&this.Dice(2)&&(sequenceLength=4);var octave=4,range=1,arpMode;switch(Math.floor(Math.random()*10)){case 0:arpMode=1;break;case 1:case 2:case 3:case 4:case 5:case 6:arpMode=2;break;case 7:case 8:case 9:arpMode=3}var octaveLower=0;this.Dice(2)&&(octaveLower=Math.ceil(Math.random()*2)),arpMode==1&&(octave=2+Math.round(Math.random()*(3-octaveLower)),range=2+Math.round(Math.random()*(4-(octave-2))),sequenceLength<8&&this.Dice(2)&&(sequenceLength=8),scale=notes),arpMode==2&&(octave=1+Math.round(Math.random()*(6-octaveLower)),range=1+Math.floor(Math.random()*(6-(octave-1))),scale=notes,this.Dice(4)&&(scale=scales[Math.floor(Math.random()*scales.length)])),arpMode==3&&(octave=1+Math.round(Math.random()*(5-octaveLower)),range=1+Math.floor(Math.random()*(6-(octave-1))),sequenceLength<8&&(sequenceLength=8),scale=scales[Math.floor(Math.random()*scales.length)]),this._BufferData=new Float32Array(sampleRate*seconds);var data=this._BufferData,voices,harmonics,lfo;this._WaveVoices=[],voices=1+Math.round(Math.random()*3),harmonics=Math.round(Math.random()*13),lfo=Math.round(Math.random()),this.Dice(8)&&(voices=1+Math.round(Math.random()*20),harmonics=3+Math.round(Math.random()*6)),this.Dice(8)&&(voices=10+Math.round(Math.random()*10),harmonics=3,lfo=0);var totalGain=0;for(var i=0;i<voices+harmonics+lfo;i++){var t,w,f,vol,d,s,sl;vol=.05+Math.random()*30,f=440,d=1,s=[],sl=!1,w=waveType;if(i<voices){t=0,arpMode>0&&(i==0?s=this.Arp(arpMode,scale,octave,range,sequenceLength):this.Dice(3)&&(s=this.Arp(arpMode,scale,octave,range,sequenceLength)));if(w==1){f*=.5;if(s.length>0)for(j=0;j<s.length;j++)s[j]*=.5}organise&&i>0&&(vol=this._WaveVoices[0].Volume),this.Dice(3)&&(d=.9999+Math.random()*2e-4),following&&i>0&&(d=this._WaveVoices[0].Drift),this.Dice(4)&&!noGlide&&(sl=!0)}else i>=voices&&i<voices+harmonics?(t=1,this.Dice(4)&&!noGlide&&(sl=!0)):(t=2,vol=10+Math.random()*100,f=1+Math.round(Math.random()*15));this._WaveVoices.push(new WaveVoice_1.WaveVoice(t,w,f,vol,d,s,sl)),totalGain+=vol}var amp=1/totalGain;if(this.Params.seed.waveVoices&&this._SeedLoad&&this._LoadFromShare){var seed=this.Params.seed;console.log(this.Params.seed),sequenceLength=seed.sequenceLength,seconds=seed.seconds,gain=seed.gain,noise=seed.noise,octaving=seed.octaving,glide=seed.glide,this._WaveVoices=seed.waveVoices,voices=seed.voices,harmonics=seed.harmonics,amp=seed.amp,this._SeedLoad=!1}this.Params.seed={sequenceLength:sequenceLength,seconds:seconds,gain:gain,noise:noise,octaving:octaving,glide:glide,waveVoices:this._WaveVoices,voices:voices,harmonics:harmonics,amp:amp};var waveVoices=this._WaveVoices,overflow=800,dataLength=data.length;for(var i=0;i<dataLength+overflow;i++){var totalVal=0;for(var j=0;j<waveVoices.length;j++){var v=waveVoices[j];switch(v.VoiceType){case 0:i==Math.round(dataLength/sequenceLength)*Math.round(sequenceLength/dataLength*i)&&i<dataLength&&(v.Sequence.length==0?(octaving==1?v.FDest=waveVoices[0].Frequency*2*j:octaving==2?v.FDest=waveVoices[0].Frequency/(2*j):v.FDest=waveVoices[0].Frequency+5*j,v.Slide||(v.Frequency=v.FDest)):(v.FDest=v.Sequence[Math.floor(sequenceLength/dataLength*i)],v.Slide||(v.Frequency=v.FDest))),v.Slide&&(v.Frequency+=(v.FDest-v.Frequency)/1e4*glide),v.Frequency*=v.Drift;break;case 1:v.FDest=waveVoices[0].Frequency*j,v.Slide?v.Frequency+=(v.FDest-v.Frequency)/1e4*glide:v.Frequency=v.FDest}var maxFreq=2e4;v.Frequency>maxFreq&&(v.Frequency=maxFreq),v.Frequency<1&&(v.Frequency=1),totalVal+=v.Value*v.Volume;if(v.WaveType<2){var step=v.Frequency*(amp*4/sampleRate);v.Value+=step*v.Polarity;if(v.Value>amp){var spill=v.Value-amp;v.WaveType==1&&j<voices+harmonics?v.Value=-(amp-spill):(v.Value=amp-spill,v.Polarity=-v.Polarity)}if(v.Value<-amp){var spill=v.Value- -amp;v.Value=-amp-spill,v.Polarity=-v.Polarity}}else{var a1=v.Frequency*i*Math.PI*2/sampleRate;v.Value=Math.sin(a1)*amp}}var roam=1-noise*.5+Math.random()*noise,totalTotal=totalVal*roam*gain;if(i<dataLength-1)data[i]=totalTotal;else{var ni=i-(dataLength-1),gainA=1-1/overflow*ni,gainB=1/overflow*ni;data[ni]=totalTotal*gainA+data[ni]*gainB}}console.log("WAVETYPE: "+waveType),this.PopulateBuffer(sampleRate)},WaveGen.prototype.PopulateBuffer=function(sampleRate){var _this=this;this._FirstBuffer||(this._FirstBuffer=App.Audio.ctx.createBuffer(1,this._BufferData.length,sampleRate)),this._FirstBuffer.copyToChannel(this._BufferData,0,0),this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(this._FirstBuffer,200,5,95);var duration=this.GetDuration(this._FirstBuffer);this._LoadFromShare||(this.Params.startPosition=0,this.Params.loopStart=0,this.Params.loopEnd=this.Params.endPosition=duration,this.Params.reverse=!1),this.RefreshOptionsPanel(),this.Sources.forEach(function(s){s.player.buffer=_this._FirstBuffer,s.player.loopStart=_this.Params.loopStart,s.player.loopEnd=_this.Params.loopEnd,s.player.reverse=_this.Params.reverse}),this.IsPowered()&&this._LoadFromShare&&this.TriggerAttack(),this._LoadFromShare=!1},WaveGen.prototype.FirstSetup=function(){var _this=this;this._FirstRelease&&(this.DataToBuffer(),this.Envelopes.forEach(function(e,i){e=_this.Sources[i].envelope}),this.Sources.forEach(function(s){s.connect(_this.AudioInput)}),this._FirstRelease=!1)},WaveGen.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},WaveGen.prototype.MouseUp=function(){this.FirstSetup(),_super.prototype.MouseUp.call(this)},WaveGen.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"WaveGen",parameters:[{type:"waveregion",name:"Wave",setting:"region",props:{value:5,min:0,max:this.GetDuration(this._FirstBuffer),quantised:!1,centered:!1,wavearray:this._WaveForm,mode:this.Params.loop,emptystring:"Generating Wave"},nodes:[{setting:"startPosition",value:this.Params.startPosition},{setting:"endPosition",value:this.Params.endPosition},{setting:"loopStart",value:this.Params.loopStart},{setting:"loopEnd",value:this.Params.loopEnd}]},{type:"actionbutton",name:"Generate",setting:"generate",props:{text:"Generate Wave"}},{type:"switches",name:"Loop",setting:"loop",switches:[{name:"Reverse",setting:"reverse",value:this.Params.reverse,lit:!0,mode:"offOn"},{name:"Looping",setting:"loop",value:this.Params.loop,lit:!0,mode:"offOn"}]},{type:"slider",name:"playback",setting:"playbackRate",props:{value:this.Params.playbackRate,min:.125,max:8,quantised:!1,centered:!0,logarithmic:!0}}]}},WaveGen.prototype.SetParam=function(param,value){var _this=this;_super.prototype.SetParam.call(this,param,value);var val=value;switch(param){case"playbackRate":Tone.isSafari?this.Sources[0].player.playbackRate=value:this.Sources[0].player.playbackRate.value=value;break;case"generate":this._WaveForm=[],this.RefreshOptionsPanel();var me=this;setTimeout(function(){me.DataToBuffer()},16);break;case"reverse":value=value?!0:!1,this._BufferData=this.ReverseBuffer(this._BufferData),this._FirstBuffer.copyToChannel(this._BufferData,0,0),this.Sources.forEach(function(s){s.player.buffer=_this._FirstBuffer}),this.Params[param]=val,this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(this._FirstBuffer,200,5,95),this.RefreshOptionsPanel();break;case"loop":value=value?!0:!1,this.Sources.forEach(function(s){s.player.loop=value}),value===!0&&this.IsPowered()&&this.Sources.forEach(function(s){s.player.stop(),s.player.start(s.player.startPosition)}),this.Params[param]=value,this.RefreshOptionsPanel();break;case"loopStart":this.Sources.forEach(function(s){s.player.loopStart=value});break;case"loopEnd":this.Sources.forEach(function(s){s.player.loopEnd=value})}this.Params[param]=value},WaveGen.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},WaveGen.prototype.ReverseBuffer=function(buffer){var newBuffer=new Float32Array(buffer.length);for(var i=0;i<buffer.length;i++)newBuffer[i]=buffer[buffer.length-1-i];return newBuffer},WaveGen}(SamplerBase_1.SamplerBase);exports.WaveGen=WaveGen});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/AutoWah",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,AutoWah=function(_super){__extends(AutoWah,_super);function AutoWah(){_super.apply(this,arguments)}return AutoWah.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.AutoWah.name,this.Defaults={octaves:5,baseFrequency:100,mix:.3,attack:.75,release:.3},this.PopulateParams(),this.Effect=new Tone.AutoWah({baseFrequency:this.Params.baseFrequency,octaves:this.Params.octaves,sensitivity:-10,gain:30,rolloff:-18,follower:{attack:.1,release:1}}),this.Effect.wet.value=this.Params.mix,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(0,-1),new Point(1,-1),new Point(1,1),new Point(-2,1))},AutoWah.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},AutoWah.prototype.Dispose=function(){this.Effect.dispose()},AutoWah.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param==="mix"?this.Effect.wet.value=val:param==="octaves"?this.Effect.octaves=val:param==="baseFrequency"?this.Effect.baseFrequency=val:param==="attack"?this.Effect.follower.attack=val:param==="release"&&(this.Effect.follower.release=val),this.Params[param]=val},AutoWah.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Auto Wah",parameters:[{type:"slider",name:"Range",setting:"octaves",props:{value:this.Params.octaves,min:1,max:8,quantised:!1,centered:!1}},{type:"slider",name:"Frequency",setting:"baseFrequency",props:{value:this.Params.baseFrequency,min:50,max:1200,quantised:!0,centered:!1}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}},{type:"slider",name:"Attack",setting:"attack",props:{value:this.Params.attack,min:.01,max:2,quantised:!1,centered:!1}},{type:"slider",name:"Release",setting:"release",props:{value:this.Params.release,min:.01,max:2,quantised:!1,centered:!1}}]}},AutoWah}(PostEffect_1.PostEffect);exports.AutoWah=AutoWah});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/BitCrusher",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,BitCrusher=function(_super){__extends(BitCrusher,_super);function BitCrusher(){_super.apply(this,arguments)}return BitCrusher.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.BitCrusher.name,this.Defaults={bits:7,mix:.5},this.PopulateParams(),this.Effect=new Tone.BitCrusher(this.Params.bits),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(1,-2),new Point(1,0),new Point(0,1),new Point(-1,1))},BitCrusher.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},BitCrusher.prototype.Dispose=function(){this.Effect.dispose()},BitCrusher.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value),param==="bits"?this.Effect.bits=value:param==="mix"&&(this.Effect.wet.value=value),this.Params[param]=value},BitCrusher.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Bit Crusher",parameters:[{type:"slider",name:"Bits",setting:"bits",props:{value:this.Params.bits,min:1,max:8,quantised:!1,centered:!1}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},BitCrusher}(PostEffect_1.PostEffect);exports.BitCrusher=BitCrusher});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Chomp",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Chomp=function(_super){__extends(Chomp,_super);function Chomp(){_super.apply(this,arguments)}return Chomp.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Chomp.name,!this.Params,this.Defaults={rate:13,Q:.6,gain:15},this.PopulateParams(),this.Effect=new Tone.Filter({type:"peaking",frequency:440,rolloff:-12,Q:this.Params.Q,gain:this.Params.gain}),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,0),new Point(1,1),new Point(0,2),new Point(-1,2)),this.SetFrequency()},Chomp.prototype.SetFrequency=function(){var me=this;this.Timer=setTimeout(function(){me.Effect&&(me.Effect.frequency.value=100+Math.round(Math.random()*1e4),me.SetFrequency())},this.Params.rate)},Chomp.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Chomp.prototype.Dispose=function(){clearTimeout(this.Timer),this.Effect.dispose()},Chomp.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="rate"?val=Math.round(101-val):param=="Q"?this.Effect.Q.value=val:param=="gain"&&(this.Effect.gain.value=val),this.Params[param]=val},Chomp.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Chomp",parameters:[{type:"slider",name:"Rate",setting:"rate",props:{value:Math.round(101-this.Params.rate),min:1,max:100,quantised:!0,centered:!1}},{type:"slider",name:"Width",setting:"Q",props:{value:this.Params.Q,min:.1,max:5,quantised:!1,centered:!1}},{type:"slider",name:"Gain",setting:"gain",props:{value:this.Params.gain,min:0,max:20,quantised:!1,centered:!1}}]}},Chomp}(PostEffect_1.PostEffect);exports.Chomp=Chomp});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Chopper",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Chopper=function(_super){__extends(Chopper,_super);function Chopper(){_super.apply(this,arguments)}return Chopper.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Chopper.name,this.Defaults={rate:8,depth:1,spread:0,waveform:2,mix:1},this.PopulateParams(),this.Effect=(new Tone.Tremolo({frequency:this.Defaults.rate,depth:this.Defaults.depth,spread:this.Defaults.spread,type:App.Audio.WaveformTypeIndex[this.Defaults.waveform],wet:this.Defaults.mix})).start(),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(1,1),new Point(0,2),new Point(-1,1))},Chopper.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Chopper.prototype.Dispose=function(){this.Effect.stop(),this.Effect.dispose()},Chopper.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Chopper",parameters:[{type:"slider",name:"Rate",setting:"rate",props:{value:this.Params.rate,min:0,max:50,quantised:!1,centered:!1}},{type:"slider",name:"Depth",setting:"depth",props:{value:this.Params.depth,min:0,max:1,quantised:!1,centered:!1}},{type:"buttons",name:"Wave",setting:"waveform",props:{value:this.Params.waveform,mode:"wave"},buttons:[{name:"Sine"},{name:"Square"},{name:"Triangle"},{name:"Saw"}]},{type:"slider",name:"Spread",setting:"spread",props:{value:this.Params.spread,min:0,max:180,quantised:!1,centered:!1}}]}},Chopper.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);switch(param){case"rate":this.Effect.frequency.value=value;break;case"depth":this.Effect.depth.value=value;break;case"waveform":this.Effect.type=App.Audio.WaveformTypeIndex[value];break;case"spread":this.Effect.spread=value}this.Params[param]=value},Chopper}(PostEffect_1.PostEffect);exports.Chopper=Chopper});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Chorus",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Chorus=function(_super){__extends(Chorus,_super);function Chorus(){_super.apply(this,arguments)}return Chorus.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Chorus.name,this.Defaults={rate:1.5,delayTime:1.5,depth:.75,feedback:.4},this.PopulateParams(),this.Effect=new Tone.Chorus({rate:this.Params.rate,delayTime:this.Params.delayTime,type:"sine",depth:this.Params.depth,feedback:this.Params.feedback}),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(0,-1),new Point(1,0),new Point(0,1),new Point(-1,1))},Chorus.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Chorus.prototype.Dispose=function(){this.Effect.dispose()},Chorus.prototype.SetParam=function(param,value){var val=value;param==="rate"?this.Effect.frequency.value=val:param==="feedback"?this.Effect.feedback.value=val:this.Effect[param]=val,this.Params[param]=val},Chorus.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Chorus",parameters:[{type:"slider",name:"Rate",setting:"rate",props:{value:this.Params.rate,min:0,max:5,quantised:!1,centered:!1}},{type:"slider",name:"Delay Time",setting:"delayTime",props:{value:this.Params.delayTime,min:0,max:5,quantised:!1,centered:!1}},{type:"slider",name:"Depth",setting:"depth",props:{value:this.Params.depth,min:0,max:1,quantised:!1,centered:!1}},{type:"slider",name:"Feedback",setting:"feedback",props:{value:this.Params.feedback,min:0,max:.496,quantised:!1,centered:!1}}]}},Chorus}(PostEffect_1.PostEffect);exports.Chorus=Chorus});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/ConvolutionReverb",["require","exports","../PostEffect","../../../Core/Audio/SoundCloud/SoundCloudAPI","../../../Core/Audio/SoundCloud/SoundcloudTrack"],function(require,exports,PostEffect_1,SoundCloudAPI_1,SoundcloudTrack_1){var Point=etch.primitives.Point,Convolver=function(_super){__extends(Convolver,_super);function Convolver(){_super.apply(this,arguments),this._FirstRelease=!0}return Convolver.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Convolution.name;if(this.Params){var me=this;setTimeout(function(){me.FirstSetup()},100)}this.Defaults={mix:1,track:"http://files.blokdust.com/impulse-responses/teufelsberg01.wav",trackName:"TEUFELSBERG",user:"BGXA",permalink:""},this.PopulateParams(),this._WaveForm=[],this.SearchResults=[],this.Searching=!1,this._FallBackTrack=new SoundcloudTrack_1.SoundCloudTrack(this.Params.trackName,this.Params.user,this.Params.track,this.Params.permalink),this.Effect=new Tone.Convolver,this.Effect.wet.value=this.Params.mix,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(1,-1),new Point(2,0),new Point(0,2),new Point(-1,1))},Convolver.prototype.SetBuffer=function(){var _this=this;App.AnimationsLayer.AddToList(this),this._FirstBuffer&&this._FirstBuffer.dispose(),this._FirstBuffer=new Tone.Buffer(this.Params.track,function(e){clearTimeout(_this.LoadTimeout),_this._WaveForm=App.Audio.Waveform.GetWaveformFromBuffer(e._buffer,200,5,95),App.AnimationsLayer.RemoveFromList(_this),_this._FallBackTrack=new SoundcloudTrack_1.SoundCloudTrack(_this.Params.trackName,_this.Params.user,_this.Params.track,_this.Params.permalink),_this.RefreshOptionsPanel(),_this.Effect.buffer=e});var me=this;clearTimeout(this.LoadTimeout),this.LoadTimeout=setTimeout(function(){me.TrackFallBack()},App.Config.SoundCloudLoadTimeout*1e3),this._FirstBuffer.onerror=function(){console.log("error"),me.TrackFallBack()}},Convolver.prototype.Search=function(query){var _this=this;this.Searching=!0,App.MainScene.OptionsPanel.Animating=!0,this.ResultsPage=1,this.SearchResults=[],SoundCloudAPI_1.SoundCloudAPI.Search(query,App.Config.ConvolverMaxTrackLength,function(track){_this.SearchResults.push(new SoundcloudTrack_1.SoundCloudTrack(track.title,track.user.username,track.uri,track.permalink_url)),_this.Searching=!1,App.MainScene.OptionsPanel.Animating=!1},function(error){_this.Searching=!1,App.MainScene.OptionsPanel.Animating=!1,error.status===452})},Convolver.prototype.LoadTrack=function(track,fullUrl){fullUrl=fullUrl||!1,fullUrl?this.Params.track=track.URI:(this.Params.track=SoundCloudAPI_1.SoundCloudAPI.LoadTrack(track),this.Params.permalink=track.Permalink),this.Params.trackName=track.TitleShort,this.Params.user=track.UserShort,this._WaveForm=[],this.SetBuffer(),this.RefreshOptionsPanel("animate")},Convolver.prototype.TrackFallBack=function(){this.LoadTrack(this._FallBackTrack,!0),App.Message("Load Failed: This Track Is Unavailable. Reloading last track.")},Convolver.prototype.FirstSetup=function(){this._FirstRelease&&(this.Search(App.MainScene.SoundcloudPanel.RandomSearch(this)),this.SetBuffer(),this._FirstRelease=!1)},Convolver.prototype.GetDuration=function(){return this._FirstBuffer?this._FirstBuffer.duration:0},Convolver.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Convolver.prototype.MouseUp=function(){this.FirstSetup(),_super.prototype.MouseUp.call(this)},Convolver.prototype.Dispose=function(){this.Effect.dispose()},Convolver.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="mix"&&(this.Effect.wet.value=val),this.Params[param]=val},Convolver.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Convolver",parameters:[{type:"waveimage",name:"Wave",setting:"region",props:{wavearray:this._WaveForm}},{type:"sample",name:"Sample",setting:"sample",props:{track:this.Params.trackName,user:this.Params.user,permalink:this.Params.permalink}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},Convolver}(PostEffect_1.PostEffect);exports.Convolver=Convolver});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Delay",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Delay=function(_super){__extends(Delay,_super);function Delay(){_super.apply(this,arguments)}return Delay.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Delay.name,this.Defaults={delayTime:.25,feedback:.4,mix:.5},this.PopulateParams(),this.Effect=new Tone.PingPongDelay(this.Params.delayTime),this.Effect.feedback.value=this.Params.feedback,this.Effect.wet.value=this.Params.mix,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,0),new Point(1,2),new Point(0,1),new Point(-1,2))},Delay.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Delay.prototype.Dispose=function(){this.Effect.dispose()},Delay.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="mix"?this.Effect.wet.value=val:param=="delayTime"?this.Effect.delayTime.rampTo(val,.1):this.Effect[param].value=val,this.Params[param]=val},Delay.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Delay",parameters:[{type:"slider",name:"Delay Time",setting:"delayTime",props:{value:this.Params.delayTime,min:.05,max:.5,quantised:!1,centered:!1}},{type:"slider",name:"Feedback",setting:"feedback",props:{value:this.Params.feedback,min:0,max:.9,quantised:!1,centered:!1}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},Delay}(PostEffect_1.PostEffect);exports.Delay=Delay});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Distortion",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Distortion=function(_super){__extends(Distortion,_super);function Distortion(){_super.apply(this,arguments)}return Distortion.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Distortion.name,this.Defaults={drive:.65,mix:.75},this.PopulateParams(),this.Effect=new Tone.Distortion(this.Params.drive),this.Effect.wet.value=this.Params.mix,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(1,-1),new Point(1,0),new Point(-1,2))},Distortion.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Distortion.prototype.Dispose=function(){this.Effect.dispose()},Distortion.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="mix"?this.Effect.wet.value=val:this.Effect.distortion=val,this.Params[param]=val},Distortion.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Distortion",parameters:[{type:"slider",name:"Drive",setting:"drive",props:{value:this.Params.drive,min:.1,max:1,quantised:!1,centered:!1}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},Distortion}(PostEffect_1.PostEffect);exports.Distortion=Distortion});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Pre/Envelope",["require","exports","../PreEffect"],function(require,exports,PreEffect_1){var Point=etch.primitives.Point,Envelope=function(_super){__extends(Envelope,_super);function Envelope(){_super.apply(this,arguments)}return Envelope.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Envelope.name,this.Defaults={attack:1,decay:5,sustain:.7,release:4},this.PopulateParams(),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(1,-1),new Point(1,1),new Point(0,2),new Point(-1,1))},Envelope.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Envelope.prototype.UpdateConnections=function(chain){var _this=this;_super.prototype.UpdateConnections.call(this,chain),chain.Sources.forEach(function(source){source.Envelopes.length?source.Envelopes.forEach(function(e){e.attack=_this.Params.attack,e.decay=_this.Params.decay,e.sustain=_this.Params.sustain,e.release=_this.Params.release}):source.Sources[0]instanceof Tone.Simpler&&source.Sources.forEach(function(s){var e=s.envelope;e.attack=_this.Params.attack,e.decay=_this.Params.decay,e.sustain=_this.Params.sustain,e.release=_this.Params.release})})},Envelope.prototype.SetParam=function(param,value){var _this=this;_super.prototype.SetParam.call(this,param,value),this.Params[param]=value,this.Chain&&this.Chain.Sources&&this.Chain.Sources.forEach(function(source){source.Envelopes.length?source.Envelopes.forEach(function(e){e.attack=_this.Params.attack,e.decay=_this.Params.decay,e.sustain=_this.Params.sustain,e.release=_this.Params.release}):source.Sources[0]instanceof Tone.Simpler&&source.Sources.forEach(function(s){var e=s.envelope;e.attack=_this.Params.attack,e.decay=_this.Params.decay,e.sustain=_this.Params.sustain,e.release=_this.Params.release})})},Envelope.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Envelope",parameters:[{type:"ADSR",name:"ADSR",setting:"adsr",nodes:[{setting:"attack",value:this.Params.attack,min:.01,max:10},{setting:"decay",value:this.Params.decay,min:.01,max:15},{setting:"sustain",value:this.Params.sustain,min:0,max:1},{setting:"release",value:this.Params.release,min:.01,max:15}]}]}},Envelope}(PreEffect_1.PreEffect);exports.Envelope=Envelope});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/EQ",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,EQ=function(_super){__extends(EQ,_super);function EQ(){_super.apply(this,arguments)}return EQ.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Eq.name,this.Defaults={frequency_1:50,Q_1:1,gain_1:0,frequency_2:440,Q_2:1,gain_2:0,frequency_3:2e3,Q_3:2.5,gain_3:0,frequency_4:1e4,Q_4:1,gain_4:0},this.PopulateParams(),this.Effect=new Tone.EQMultiband([{type:"lowshelf",frequency:this.Params.frequency_1,rolloff:-12,Q:this.Params.Q_1,gain:this.Params.gain_1},{type:"peaking",frequency:this.Params.frequency_2,rolloff:-12,Q:this.Params.Q_2,gain:this.Params.gain_2},{type:"peaking",frequency:this.Params.frequency_3,rolloff:-12,Q:this.Params.Q_3,gain:this.Params.gain_3},{type:"highshelf",frequency:this.Params.frequency_4,rolloff:-12,Q:this.Params.Q_4,gain:this.Params.gain_4}]),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,-1),new Point(2,0),new Point(1,1),new Point(0,1))},EQ.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},EQ.prototype.Dispose=function(){this.Effect.dispose()},EQ.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value,paramWithBand=param.split("_"),paramtype=paramWithBand[0],band=parseInt(paramWithBand[1]);switch(paramtype){case"frequency":this.Effect.setFrequency(val,band);break;case"Q":this.Effect.setQ(val,band);break;case"gain":this.Effect.setGain(val,band)}this.Params[param]=val},EQ.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"EQ",parameters:[{type:"parametric",name:"Filter",setting:"parametric",nodes:[{x_setting:"frequency_1",x_value:this.Params.frequency_1,x_min:20,x_max:2e4,y_setting:"gain_1",y_value:this.Params.gain_1,y_min:-50,y_max:50,q_setting:"Q_1",q_value:this.Params.Q_1,q_min:20,q_max:1},{x_setting:"frequency_2",x_value:this.Params.frequency_2,x_min:20,x_max:2e4,y_setting:"gain_2",y_value:this.Params.gain_2,y_min:-50,y_max:50,q_setting:"Q_2",q_value:this.Params.Q_2,q_min:14,q_max:.5},{x_setting:"frequency_3",x_value:this.Params.frequency_3,x_min:20,x_max:2e4,y_setting:"gain_3",y_value:this.Params.gain_3,y_min:-50,y_max:50,q_setting:"Q_3",q_value:this.Params.Q_3,q_min:14,q_max:.5},{x_setting:"frequency_4",x_value:this.Params.frequency_4,x_min:20,x_max:2e4,y_setting:"gain_4",y_value:this.Params.gain_4,y_min:-50,y_max:50,q_setting:"Q_4",q_value:this.Params.Q_4,q_min:20,q_max:1}]}]}},EQ}(PostEffect_1.PostEffect);exports.EQ=EQ});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Filter",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Filter=function(_super){__extends(Filter,_super);function Filter(){_super.apply(this,arguments)}return Filter.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Filter.name,this.Defaults={frequency:440,gain:0},this.PopulateParams(),this.Effect=new Tone.Filter({type:"peaking",frequency:this.Params.frequency,rolloff:-12,Q:1,gain:this.Params.gain}),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-2),new Point(1,0),new Point(1,2),new Point(-1,0))},Filter.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Filter.prototype.Dispose=function(){this.Effect.dispose()},Filter.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;this.Effect[param].value=val,this.Params[param]=val},Filter.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Filter",parameters:[{type:"slider",name:"Frequency",setting:"frequency",props:{value:this.Params.frequency,min:20,max:2e4,quantised:!0,centered:!1,logarithmic:!0}},{type:"slider",name:"Gain",setting:"gain",props:{value:this.Params.gain,min:-50,max:50,quantised:!1,centered:!0}}]}},Filter}(PostEffect_1.PostEffect);exports.Filter=Filter});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Gain",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Gain=function(_super){__extends(Gain,_super);function Gain(){_super.apply(this,arguments)}return Gain.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Volume.name,this.Defaults={gain:1.2},this.PopulateParams(),this.Effect=App.Audio.ctx.createGain(),this.Effect.gain.value=this.Params.gain/10+1,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(2,1),new Point(0,1))},Gain.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Gain.prototype.Dispose=function(){this.Effect.disconnect(),this.Effect=null},Gain.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value),this.Effect.gain.value=value/10+1,this.Params[param]=value},Gain.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Volume",parameters:[{type:"slider",name:"Gain",setting:"gain",props:{value:this.Params.gain,min:-10,max:20,quantised:!1,centered:!0}}]}},Gain}(PostEffect_1.PostEffect);exports.Gain=Gain});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Pre/LFObase",["require","exports","../../Sources/Granular","../PreEffect"],function(require,exports,Granular_1,PreEffect_1){var LFObase=function(_super){__extends(LFObase,_super);function LFObase(){_super.apply(this,arguments)}return LFObase.prototype.Dispose=function(){this.OscLFO.stop(),this.SamplerLFO.stop(),this.OscLFO.dispose(),this.SamplerLFO.dispose()},LFObase.prototype.InitializeLFOs=function(){this.OscLFO=new Tone.LFO,this.SamplerLFO=new Tone.LFO,this.OscLFO.frequency.value=this.Params.rate,this.SamplerLFO.frequency.value=this.Params.rate,this.OscLFO.min=-this.Params.depth,this.SamplerLFO.min=LFObase.ConvertLFODepthToPlaybackDepth(-this.Params.depth),this.OscLFO.max=this.Params.depth,this.SamplerLFO.max=LFObase.ConvertLFODepthToPlaybackDepth(this.Params.depth),this.OscLFO.type=App.Audio.WaveformTypeIndex[this.Params.waveform],this.SamplerLFO.type=App.Audio.WaveformTypeIndex[this.Params.waveform],this.OscLFO.start(),this.SamplerLFO.start()},LFObase.prototype.SetParam=function(param,value){var val=value;param=="rate"?(this.OscLFO.frequency.value=val,this.SamplerLFO.frequency.value=val):param=="depth"?(this.OscLFO.min=-val,this.SamplerLFO.min=LFObase.ConvertLFODepthToPlaybackDepth(-val),this.OscLFO.max=val,this.SamplerLFO.max=LFObase.ConvertLFODepthToPlaybackDepth(val)):param=="waveform"&&(this.OscLFO.type=App.Audio.WaveformTypeIndex[val],this.SamplerLFO.type=App.Audio.WaveformTypeIndex[val]),this.Params[param]=val},LFObase.prototype.UpdateConnections=function(chain){var _this=this;_super.prototype.UpdateConnections.call(this,chain),this.OscLFO.disconnect(),this.SamplerLFO.disconnect();for(var i=0;i<chain.Sources.length;i++){var source=chain.Sources[i];if(source instanceof Granular_1.Granular)source.Grains.forEach(function(s){s.playbackRate&&_this.SamplerLFO.connect(s.playbackRate)});else for(var j=0;j<source.Sources.length;j++){var s=source.Sources[j];s.detune?this.OscLFO.connect(s.detune):s.player&&s.player.playbackRate?this.SamplerLFO.connect(s.player.playbackRate):s.playbackRate&&this.SamplerLFO.connect(s.playbackRate)}}},LFObase.ConvertLFODepthToPlaybackDepth=function(val){return val/400+1},LFObase}(PreEffect_1.PreEffect);exports.LFObase=LFObase});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Pre/Vibrato",["require","exports","./LFObase"],function(require,exports,LFObase_1){var Point=etch.primitives.Point,Vibrato=function(_super){__extends(Vibrato,_super);function Vibrato(){_super.apply(this,arguments)}return Vibrato.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Vibrato.name,this.Defaults={rate:2,depth:20,waveform:2},this.PopulateParams(),this.InitializeLFOs(),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(1,0),new Point(1,2))},Vibrato.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Vibrato.prototype.UpdateOptionsForm=function(){this.OptionsForm={name:"Vibrato",parameters:[{type:"slider",name:"Rate",setting:"rate",props:{value:this.Params.rate,min:0,max:20,quantised:!1,centered:!1}},{type:"slider",name:"Depth",setting:"depth",props:{value:this.Params.depth,min:0,max:200,quantised:!1,centered:!1}},{type:"buttons",name:"Wave",setting:"waveform",props:{value:this.Params.waveform,mode:"wave"},buttons:[{name:"Sine"},{name:"Square"},{name:"Triangle"},{name:"Saw"}]}]}},Vibrato}(LFObase_1.LFObase);exports.Vibrato=Vibrato});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Phaser",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Phaser=function(_super){__extends(Phaser,_super);function Phaser(){_super.apply(this,arguments)}return Phaser.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Phaser.name,this.Defaults={rate:.5,depth:9,baseFrequency:500,mix:.75},this.PopulateParams(),this.Effect=new Tone.Phaser({rate:this.Params.rate,depth:this.Params.depth,Q:.1,baseFrequency:this.Params.baseFrequency}),this.Effect.wet.value=this.Params.mix,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(-1,-2),new Point(1,0),new Point(1,2))},Phaser.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Phaser.prototype.Dispose=function(){this.Effect.dispose()},Phaser.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="mix"?this.Effect.wet.value=val:param=="rate"?this.Effect.frequency.value=val:this.Effect[param]=val,this.Params[param]=val},Phaser.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Phaser",parameters:[{type:"slider",name:"Rate",setting:"rate",props:{value:this.Params.rate,min:0,max:10,quantised:!1,centered:!1}},{type:"slider",name:"Depth",setting:"depth",props:{value:this.Params.depth,min:0,max:10,quantised:!0,centered:!1}},{type:"slider",name:"Frequency",setting:"baseFrequency",props:{value:this.Params.baseFrequency,min:10,max:2e3,quantised:!0,centered:!1}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},Phaser}(PostEffect_1.PostEffect);exports.Phaser=Phaser});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Pitch",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Pitch=function(_super){__extends(Pitch,_super);function Pitch(){_super.apply(this,arguments)}return Pitch.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.PitchShifter.name,this.Defaults={mix:1,pitchOffset:3,windowSize:.07},this.PopulateParams(),this.Effect=new Tone.PitchShift(this.Params.pitchOffset),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(2,-1),new Point(0,1))},Pitch.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Pitch.prototype.Dispose=function(){this.Effect.dispose()},Pitch.prototype.SetParam=function(param,value){param=="pitchOffset"?this.Effect.pitch=value:param=="windowSize"?this.Effect.windowSize=value:param==="mix"&&(this.Effect.wet.value=value),this.Params[param]=value},Pitch.prototype.UpdateOptionsForm=function(){this.OptionsForm={name:"Pitch",parameters:[{type:"slider",name:"Pitchshift",setting:"pitchOffset",props:{value:this.Params.pitchOffset,min:-12,max:12,quantised:!1,centered:!0}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},Pitch}(PostEffect_1.PostEffect);exports.Pitch=Pitch});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Post/Reverb",["require","exports","../PostEffect"],function(require,exports,PostEffect_1){var Point=etch.primitives.Point,Reverb=function(_super){__extends(Reverb,_super);function Reverb(){_super.apply(this,arguments)}return Reverb.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Reverb.name,this.Defaults={dampening:.7,roomSize:.5,mix:.5},this.PopulateParams(),this.Effect=new Tone.Freeverb(this.Params.dampening,this.Params.roomSize),this.Effect.wet.value=this.Params.mix,_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(1,-1),new Point(2,0),new Point(0,2),new Point(-1,1))},Reverb.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Reverb.prototype.Dispose=function(){this.Effect.dispose()},Reverb.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value);var val=value;param=="mix"?this.Effect.wet.value=val:param=="dampening"?this.Effect.dampening.value=val:param=="roomSize"&&(this.Effect.roomSize.value=val),this.Params[param]=val},Reverb.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Reverb",parameters:[{type:"slider",name:"Dampening",setting:"dampening",props:{value:this.Params.dampening,min:.1,max:1,quantised:!1,centered:!1}},{type:"slider",name:"Room Size",setting:"roomSize",props:{value:this.Params.roomSize,min:.1,max:.95,quantised:!1,centered:!1}},{type:"slider",name:"Mix",setting:"mix",props:{value:this.Params.mix,min:0,max:1,quantised:!1,centered:!1}}]}},Reverb}(PostEffect_1.PostEffect);exports.Reverb=Reverb});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Effects/Pre/Scuzz",["require","exports","./LFObase"],function(require,exports,LFObase_1){var Point=etch.primitives.Point,Scuzz=function(_super){__extends(Scuzz,_super);function Scuzz(){_super.apply(this,arguments)}return Scuzz.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Effect.Blocks.Scuzz.name,this.Defaults={depth:1e3,rate:100,waveform:2},this.PopulateParams(),this.InitializeLFOs(),_super.prototype.Init.call(this,drawTo),this.Outline.push(new Point(-1,-1),new Point(2,-1),new Point(0,1),new Point(-1,0))},Scuzz.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Scuzz.prototype.UpdateOptionsForm=function(){this.OptionsForm={name:"Scuzz",parameters:[{type:"slider",name:"Power",setting:"depth",props:{value:this.Params.depth,min:1e3,max:1e4,quantised:!0,centered:!1}},{type:"slider",name:"Pulverisation",setting:"rate",props:{value:this.Params.rate,min:100,max:1e4,quantised:!0,centered:!1}}]}},Scuzz}(LFObase_1.LFObase);exports.Scuzz=Scuzz});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/Logic/Momentary",["require","exports","./Logic","./../ParticleEmitter"],function(require,exports,Logic_1,ParticleEmitter_1){var Point=etch.primitives.Point,Momentary=function(_super){__extends(Momentary,_super);function Momentary(){_super.apply(this,arguments)}return Momentary.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.BlockName=App.L10n.Blocks.Power.Blocks.MomentaryPower.name,this.Outline.push(new Point(0,-1),new Point(1,-1),new Point(1,1),new Point(0,2),new Point(-1,2),new Point(-1,0))},Momentary.prototype.UpdateConnections=function(){},Momentary.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Momentary.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},Momentary.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Momentary Power",parameters:[{type:"slider",name:"Off/On",setting:"logic",props:{value:0,min:0,max:0,quantised:!0}}]}},Momentary.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value),param=="logic"&&this.PerformLogic()},Momentary.prototype.PerformLogic=function(){this.Params.logic=!0;var connections=this.Connections.ToArray();connections.forEach(function(source){source.AddPower(),setTimeout(function(){source.RemovePower()},100),source instanceof ParticleEmitter_1.ParticleEmitter&&source.EmitParticle()}),this.Params.logic=!1},Momentary}(Logic_1.Logic);exports.Momentary=Momentary});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Power/Logic/Toggle",["require","exports","./Logic"],function(require,exports,Logic_1){var Point=etch.primitives.Point,Toggle=function(_super){__extends(Toggle,_super);function Toggle(){_super.apply(this,arguments)}return Toggle.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.BlockName=App.L10n.Blocks.Power.Blocks.TogglePower.name,this.Outline.push(new Point(0,-1),new Point(1,0),new Point(1,2),new Point(0,2),new Point(-1,1),new Point(-1,-1))},Toggle.prototype.UpdateConnections=function(){var _this=this,newConnections=this.Connections.ToArray();this.OldConnections.forEach(function(source){_this.Params.logic&&newConnections.indexOf(source)===-1&&source.RemovePower()}),newConnections.forEach(function(source){_this.Params.logic&&_this.OldConnections.indexOf(source)===-1&&source.AddPower()}),this.OldConnections=newConnections},Toggle.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},Toggle.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Toggle Power",parameters:[{type:"switches",name:"Power",setting:"",switches:[{name:"Off/On",setting:"logic",value:this.Params.logic,lit:!0,mode:"offOn"}]}]}},Toggle.prototype.SetParam=function(param,value){_super.prototype.SetParam.call(this,param,value),param=="logic"&&this.PerformLogic(),this.Params[""+param]=value},Toggle.prototype.PerformLogic=function(){if(this.Params.logic){this.Params.logic=!1;var connections=this.Connections.ToArray();connections.forEach(function(source){source.RemovePower()})}else{this.Params.logic=!0;var connections=this.Connections.ToArray();connections.forEach(function(source){source.AddPower()})}this.RefreshOptionsPanel()},Toggle.prototype.Stop=function(){if(this.Params.logic){var connections=this.Connections.ToArray();connections.forEach(function(source){source.RemovePower()})}},Toggle}(Logic_1.Logic);exports.Toggle=Toggle}),define("Blocks/Interaction/VoiceObject",["require","exports"],function(require,exports){var VoiceCreator=function(){function VoiceCreator(id){this.ID=id}return Object.defineProperty(VoiceCreator.prototype,"Key",{get:function(){return this._key},set:function(key){this._key=key},enumerable:!0,configurable:!0}),VoiceCreator}();exports.VoiceCreator=VoiceCreator});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Interaction/Interaction",["require","exports","../Sources/Granular","../Sources/Microphone","../Power/Power","../Power/PowerEffect","./VoiceObject"],function(require,exports,Granular_1,Microphone_1,Power_1,PowerEffect_1,VoiceObject_1){var Interaction=function(_super){__extends(Interaction,_super);function Interaction(){_super.apply(this,arguments)}return Interaction.prototype.CreateVoices=function(source){if(source instanceof Power_1.Power||source instanceof Microphone_1.Microphone||source instanceof Granular_1.Granular)return;var diff=App.Config.PolyphonicVoices-source.Sources.length;if(diff>0)for(var i=1;i<=App.Config.PolyphonicVoices;i++){var s=source.CreateSource(),e=void 0;e=source.CreateEnvelope(),e?(s.connect(e),s.start(),e.connect(source.AudioInput)):source.Sources[0]instanceof Tone.Simpler&&(e=source.Sources[i].envelope,s.connect(source.AudioInput)),source.FreeVoices.push(new VoiceObject_1.VoiceCreator(i))}},Interaction}(PowerEffect_1.PowerEffect);exports.Interaction=Interaction});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Interaction/Keyboard",["require","exports","./Interaction","../Sources/SamplerBase"],function(require,exports,Interaction_1,SamplerBase_1){var Keyboard=function(_super){__extends(Keyboard,_super);function Keyboard(){_super.apply(this,arguments),this.KeysDown={}}return Keyboard.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo)},Keyboard.prototype.Draw=function(){_super.prototype.Draw.call(this)},Keyboard.prototype.UpdateConnections=function(){var _this=this,connections=this.Connections.ToArray();connections.forEach(function(source){_this.SetBaseFrequency(source),_this.KeysDown={},source.Sources.length===1&&_this.Params.isPolyphonic&&_this.CreateVoices(source),source.TriggerRelease("all")})},Keyboard.prototype.Dispose=function(){this.KeysDown=null,this.BaseFrequency=null},Keyboard.prototype.SetParam=function(param,value){var _this=this;_super.prototype.SetParam.call(this,param,value);if(param==="glide")value/=100;else if(param==="octave")for(var i=0,source=void 0;i<this.Connections.Count;i++){source=this.Connections.GetValueAt(i);var diff=value-this.Params.octave;source.OctaveShift(diff)}else if(param==="polyphonic"){this.Params.isPolyphonic=value;var connections=this.Connections.ToArray();connections.forEach(function(source){source.TriggerRelease("all"),_this.CreateVoices(source)}),App.Audio.ConnectionManager.Update()}this.Params[param]=value},Keyboard.prototype.SetBaseFrequency=function(source){source.Params&&source.Params.frequency?this.BaseFrequency=source.Params.frequency:this.BaseFrequency=App.Config.BaseNote},Keyboard.prototype.GetStartOctave=function(source){var octave,note=source.Source.frequencyToNote(this.BaseFrequency);return note.length===3?octave=parseInt(note.charAt(2)):octave=parseInt(note.charAt(1)),octave},Keyboard.prototype.GetKeyNoteOctaveString=function(keyCode){return keyCode.replace("note_","").replace("_a",this.Params.octave).replace("_b",this.Params.octave+1).replace("_c",this.Params.octave+2).replace("_d",this.Params.octave+3).toString()},Keyboard.prototype.GetFrequencyOfNote=function(note,source){return typeof source.Params.transpose=="number"||typeof source.Params.fine=="number"?source.Sources[0].noteToFrequency(note)*App.Audio.Tone.intervalToFrequencyRatio(source.Params.transpose+source.Params.fine):source instanceof SamplerBase_1.SamplerBase?source.Sources[0].noteToFrequency(note)*source.Params.playbackRate:source.Sources[0].noteToFrequency(note)},Keyboard.prototype.MidiVelocityToGain=function(velocity){return velocity/127},Keyboard}(Interaction_1.Interaction);exports.Keyboard=Keyboard});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Interaction/ComputerKeyboard",["require","exports","../Sources/Granular","./Keyboard"],function(require,exports,Granular_1,Keyboard_1){var Point=etch.primitives.Point,ComputerKeyboard=function(_super){__extends(ComputerKeyboard,_super);function ComputerKeyboard(){_super.apply(this,arguments),this.KeyboardCommands={OctaveUp:"octave-up",OctaveDown:"octave-down"}}return ComputerKeyboard.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Interaction.Blocks.ComputerKeyboard.name,this.Defaults={octave:3,glide:.05,isPolyphonic:!1},this.PopulateParams(),_super.prototype.Init.call(this,drawTo),App.PianoKeyboardManager.KeyDownChange.on(this.KeyDownCallback,this),App.PianoKeyboardManager.KeyUpChange.on(this.KeyUpCallback,this),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(2,1),new Point(1,2),new Point(-1,2))},ComputerKeyboard.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},ComputerKeyboard.prototype.Dispose=function(){_super.prototype.Dispose.call(this),this.Params.octave=null,this.KeyboardCommands=null},ComputerKeyboard.prototype.Stop=function(){var connections=this.Connections.ToArray();connections.forEach(function(source){source.TriggerRelease("all")}),App.PianoKeyboardManager.KeyDownChange.off(this.KeyDownCallback,this),App.PianoKeyboardManager.KeyUpChange.off(this.KeyUpCallback,this)},ComputerKeyboard.prototype.KeyDownCallback=function(e){var _this=this;if(e.KeyDown&&e.KeyDown.substring(0,5)==="note_"||e.KeyDown==="blank"){this.KeysDown=e.KeysDown;var connections=this.Connections.ToArray();connections.forEach(function(source){_this.KeyboardDown(e.KeyDown,source)})}else this._ExecuteKeyboardCommand(e.KeyDown,this.Connections.ToArray())},ComputerKeyboard.prototype.KeyUpCallback=function(e){var _this=this,connections=this.Connections.ToArray();connections.forEach(function(source){(e.KeyUp&&e.KeyUp.substring(0,5)==="note_"||e.KeyDown==="blank")&&_this.KeyboardUp(e.KeyUp,source)}),e.KeyDown&&e.KeyDown.substring(0,5)==="note_"&&(this.KeysDown=e.KeysDown)},ComputerKeyboard.prototype._ExecuteKeyboardCommand=function(key,sources){key=="octave-up"&&this.Params.octave<9?(sources.forEach(function(source){source.OctaveShift(1)}),this.Params.octave++,this.RefreshOptionsPanel()):key==="octave-down"&&this.Params.octave!==0&&(sources.forEach(function(source){source.OctaveShift(-1)}),this.Params.octave--,this.RefreshOptionsPanel())},ComputerKeyboard.prototype.KeyboardDown=function(keyDown,source){keyDown==="blank"&&source.TriggerRelease("all");var keyPressed=this.GetKeyNoteOctaveString(keyDown),frequency=this.GetFrequencyOfNote(keyPressed,source);if(!this.Params.isPolyphonic||!source.ActiveVoices.length&&!source.FreeVoices.length||source instanceof Granular_1.Granular)Object.keys(this.KeysDown).length===1?(source.SetPitch(frequency),source.TriggerAttack()):source.SetPitch(frequency,0,this.Params.glide);else if(source.FreeVoices.length>0){var voice=source.FreeVoices.shift();voice.Key=keyDown,source.ActiveVoices.push(voice),source.SetPitch(frequency,voice.ID),source.TriggerAttack(voice.ID)}else{var voice=source.ActiveVoices.shift();voice.Key=keyDown,source.SetPitch(frequency,voice.ID),source.ActiveVoices.push(voice)}},ComputerKeyboard.prototype.KeyboardUp=function(keyUp,source){keyUp==="blank"&&source.TriggerRelease("all"),!this.Params.isPolyphonic||source instanceof Granular_1.Granular?Object.keys(this.KeysDown).length===0&&source.TriggerRelease():source.ActiveVoices.forEach(function(voice,i){voice.Key===keyUp&&(source.TriggerRelease(voice.ID),source.ActiveVoices.splice(i,1),source.FreeVoices.push(voice))})},ComputerKeyboard.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"Computer Keyboard",parameters:[{type:"switches",name:"",switches:[{name:"Mono/Poly",setting:"polyphonic",value:this.Params.isPolyphonic,mode:"fewMany"}]},{type:"slider",name:"Octave",setting:"octave",props:{value:this.Params.octave,min:0,max:9,quantised:!0,centered:!1}},{type:"slider",name:"Glide",setting:"glide",props:{value:this.Params.glide*100,min:.001,max:100,truemin:0,truemax:1,quantised:!1,centered:!1}}]}},ComputerKeyboard}(Keyboard_1.Keyboard);exports.ComputerKeyboard=ComputerKeyboard});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("Blocks/Interaction/MIDIController",["require","exports","../Sources/Granular","./Keyboard"],function(require,exports,Granular_1,Keyboard_1){var Point=etch.primitives.Point,MIDIController=function(_super){__extends(MIDIController,_super);function MIDIController(){_super.apply(this,arguments)}return MIDIController.prototype.Init=function(drawTo){this.BlockName=App.L10n.Blocks.Interaction.Blocks.MIDIController.name,this.Defaults={glide:.05,isPolyphonic:!1,octave:3},this.PopulateParams(),_super.prototype.Init.call(this,drawTo),App.Audio.MIDIManager.MIDIMessage.on(this._OnMIDIMessage,this),this.Outline.push(new Point(-1,0),new Point(0,-1),new Point(2,1),new Point(1,2),new Point(-1,2))},MIDIController.prototype._OnMIDIMessage=function(MIDIManager,e){var _this=this,cmd=e.MIDI.cmd,channel=e.MIDI.channel,type=e.MIDI.type,note=e.MIDI.note,velocity=e.MIDI.velocity;if(channel==9)return;if(cmd==8||cmd==9&&velocity==0){typeof note!="undefined"&&note!==""&&delete this.KeysDown[note];var connections=this.Connections.ToArray();connections.forEach(function(source){_this.KeyboardUp(note,source)})}else if(cmd===9){this.KeysDown[note]=!0;var connections=this.Connections.ToArray();connections.forEach(function(source){_this.KeyboardDown(note,source)})}},MIDIController.prototype.Draw=function(){_super.prototype.Draw.call(this),this.DrawSprite(this.BlockName)},MIDIController.prototype.KeyboardDown=function(keyDown,source){var frequency=this.GetFrequencyOfNote(keyDown,source);if(!this.Params.isPolyphonic||source instanceof Granular_1.Granular)Object.keys(this.KeysDown).length===1?(source.SetPitch(frequency),source.TriggerAttack()):source.SetPitch(frequency,0,this.Params.glide);else if(source.FreeVoices.length>0){var voice=source.FreeVoices.shift();voice.Key=keyDown,source.ActiveVoices.push(voice),source.SetPitch(frequency,voice.ID),source.TriggerAttack(voice.ID)}else{var voice=source.ActiveVoices.shift();voice.Key=keyDown,source.SetPitch(frequency,voice.ID),source.ActiveVoices.push(voice)}},MIDIController.prototype.KeyboardUp=function(keyUp,source){!this.Params.isPolyphonic||source instanceof Granular_1.Granular?Object.keys(this.KeysDown).length===0&&source.TriggerRelease():source.ActiveVoices.forEach(function(voice,i){voice.Key===keyUp&&(source.TriggerRelease(voice.ID),source.ActiveVoices.splice(i,1),source.FreeVoices.push(voice))})},MIDIController.prototype.Dispose=function(){_super.prototype.Dispose.call(this)},MIDIController.prototype.Stop=function(){var connections=this.Connections.ToArray();connections.forEach(function(source){source.TriggerRelease("all")}),App.Audio.MIDIManager.MIDIMessage.off(this._OnMIDIMessage,this)},MIDIController.prototype.UpdateOptionsForm=function(){_super.prototype.UpdateOptionsForm.call(this),this.OptionsForm={name:"MIDI Keyboard",parameters:[{type:"switches",name:"",setting:"",props:{value:0,min:0,max:1,quantised:!0},switches:[{name:"Mono/Poly",setting:"polyphonic",value:this.Params.isPolyphonic,mode:"fewMany"}]},{type:"slider",name:"Glide",setting:"glide",props:{value:this.Params.glide*100,min:.001,max:100,truemin:0,truemax:1,quantised:!1,centered:!1}}]}},MIDIController}(Keyboard_1.Keyboard);exports.MIDIController=MIDIController}),define("BlockCreator",["require","exports","./Blocks/Sources/Granular","./Blocks/Sources/Microphone","./Blocks/Sources/Noise","./Blocks/Sources/Recorder","./Blocks/Sources/Sampler","./Blocks/Sources/Soundcloud","./Blocks/Sources/ToneSource","./Blocks/Sources/WaveGen","Blocks/Effects/Post/AutoWah","Blocks/Effects/Post/BitCrusher","Blocks/Effects/Post/Chomp","Blocks/Effects/Post/Chopper","Blocks/Effects/Post/Chorus","Blocks/Effects/Post/ConvolutionReverb","Blocks/Effects/Post/Delay","Blocks/Effects/Post/Distortion","Blocks/Effects/Pre/Envelope","Blocks/Effects/Post/EQ","Blocks/Effects/Post/Filter","Blocks/Effects/Post/Gain","Blocks/Effects/Pre/Vibrato","Blocks/Effects/Post/Phaser","Blocks/Effects/Post/Pitch","Blocks/Effects/Post/Reverb","Blocks/Effects/Pre/Scuzz","./Blocks/Power/Laser","./Blocks/Power/Logic/Momentary","./Blocks/Power/ParticleEmitter","./Blocks/Power/Power","./Blocks/Power/Logic/Toggle","./Blocks/Power/Void","Blocks/Interaction/ComputerKeyboard","Blocks/Interaction/MIDIController"],function(require,exports,Granular_1,Microphone_1,Noise_1,Recorder_1,Sampler_1,Soundcloud_1,ToneSource_1,WaveGen_1,AutoWah_1,BitCrusher_1,Chomp_1,Chopper_1,Chorus_1,ConvolutionReverb_1,Delay_1,Distortion_1,Envelope_1,EQ_1,Filter_1,Gain_1,Vibrato_1,Phaser_1,Pitch_1,Reverb_1,Scuzz_1,Laser_1,Momentary_1,ParticleEmitter_1,Power_1,Toggle_1,Void_1,ComputerKeyboard_1,MIDIController_1){var BlockCreator=function(){function BlockCreator(){this.Granular=Granular_1.Granular,this.Microphone=Microphone_1.Microphone,this.Noise=Noise_1.Noise,this.Recorder=Recorder_1.Recorder,this.Sampler=Sampler_1.Sampler,this.Soundcloud=Soundcloud_1.Soundcloud,this.ToneSource=ToneSource_1.ToneSource,this.WaveGen=WaveGen_1.WaveGen,this.AutoWah=AutoWah_1.AutoWah,this.BitCrusher=BitCrusher_1.BitCrusher,this.Chomp=Chomp_1.Chomp,this.Chopper=Chopper_1.Chopper,this.Chorus=Chorus_1.Chorus,this.Convolver=ConvolutionReverb_1.Convolver,this.Delay=Delay_1.Delay,this.Distortion=Distortion_1.Distortion,this.Envelope=Envelope_1.Envelope,this.EQ=EQ_1.EQ,this.Filter=Filter_1.Filter,this.Volume=Gain_1.Gain,this.Vibrato=Vibrato_1.Vibrato,this.Phaser=Phaser_1.Phaser,this.PitchShifter=Pitch_1.Pitch,this.Reverb=Reverb_1.Reverb,this.Scuzz=Scuzz_1.Scuzz,this.Laser=Laser_1.Laser,this.Momentary=Momentary_1.Momentary,this.ParticleEmitter=ParticleEmitter_1.ParticleEmitter,this.Power=Power_1.Power,this.Toggle=Toggle_1.Toggle,this.Void=Void_1.Void,this.ComputerKeyboard=ComputerKeyboard_1.ComputerKeyboard,this.MIDIController=MIDIController_1.MIDIController,this.MenuJson={categories:[{name:App.L10n.Blocks.Source.Label,items:[{name:App.L10n.Blocks.Source.Blocks.Tone.name,id:ToneSource_1.ToneSource,description:App.L10n.Blocks.Source.Blocks.Tone.description},{name:App.L10n.Blocks.Source.Blocks.Noise.name,id:Noise_1.Noise,description:App.L10n.Blocks.Source.Blocks.Noise.description},{name:App.L10n.Blocks.Source.Blocks.Microphone.name,id:Microphone_1.Microphone,description:App.L10n.Blocks.Source.Blocks.Microphone.description},{name:App.L10n.Blocks.Source.Blocks.Soundcloud.name,id:Soundcloud_1.Soundcloud,description:App.L10n.Blocks.Source.Blocks.Soundcloud.description},{name:App.L10n.Blocks.Source.Blocks.Sampler.name,id:Sampler_1.Sampler,description:App.L10n.Blocks.Source.Blocks.Sampler.description},{name:App.L10n.Blocks.Source.Blocks.Granular.name,id:Granular_1.Granular,description:App.L10n.Blocks.Source.Blocks.Granular.description},{name:App.L10n.Blocks.Source.Blocks.Recorder.name,id:Recorder_1.Recorder,description:App.L10n.Blocks.Source.Blocks.Recorder.description},{name:App.L10n.Blocks.Source.Blocks.WaveGen.name,id:WaveGen_1.WaveGen,description:App.L10n.Blocks.Source.Blocks.WaveGen.description}]},{name:App.L10n.Blocks.Effect.Label,items:[{name:App.L10n.Blocks.Effect.Blocks.AutoWah.name,id:AutoWah_1.AutoWah,description:App.L10n.Blocks.Effect.Blocks.AutoWah.description},{name:App.L10n.Blocks.Effect.Blocks.BitCrusher.name,id:BitCrusher_1.BitCrusher,description:App.L10n.Blocks.Effect.Blocks.BitCrusher.description},{name:App.L10n.Blocks.Effect.Blocks.Chomp.name,id:Chomp_1.Chomp,description:App.L10n.Blocks.Effect.Blocks.Chomp.description},{name:App.L10n.Blocks.Effect.Blocks.Chopper.name,id:Chopper_1.Chopper,description:App.L10n.Blocks.Effect.Blocks.Chopper.description},{name:App.L10n.Blocks.Effect.Blocks.Chorus.name,id:Chorus_1.Chorus,description:App.L10n.Blocks.Effect.Blocks.Chorus.description},{name:App.L10n.Blocks.Effect.Blocks.Convolution.name,id:ConvolutionReverb_1.Convolver,description:App.L10n.Blocks.Effect.Blocks.Convolution.description},{name:App.L10n.Blocks.Effect.Blocks.Delay.name,id:Delay_1.Delay,description:App.L10n.Blocks.Effect.Blocks.Delay.description},{name:App.L10n.Blocks.Effect.Blocks.Distortion.name,id:Distortion_1.Distortion,description:App.L10n.Blocks.Effect.Blocks.Distortion.description},{name:App.L10n.Blocks.Effect.Blocks.Envelope.name,id:Envelope_1.Envelope,description:App.L10n.Blocks.Effect.Blocks.Envelope.description},{name:App.L10n.Blocks.Effect.Blocks.Eq.name,id:EQ_1.EQ,description:App.L10n.Blocks.Effect.Blocks.Eq.description},{name:App.L10n.Blocks.Effect.Blocks.Filter.name,id:Filter_1.Filter,description:App.L10n.Blocks.Effect.Blocks.Filter.description},{name:App.L10n.Blocks.Effect.Blocks.Vibrato.name,id:Vibrato_1.Vibrato,description:App.L10n.Blocks.Effect.Blocks.Vibrato.description},{name:App.L10n.Blocks.Effect.Blocks.Phaser.name,id:Phaser_1.Phaser,description:App.L10n.Blocks.Effect.Blocks.Phaser.description},{name:App.L10n.Blocks.Effect.Blocks.PitchShifter.name,id:Pitch_1.Pitch,description:App.L10n.Blocks.Effect.Blocks.PitchShifter.description},{name:App.L10n.Blocks.Effect.Blocks.Reverb.name,id:Reverb_1.Reverb,description:App.L10n.Blocks.Effect.Blocks.Reverb.description},{name:App.L10n.Blocks.Effect.Blocks.Scuzz.name,id:Scuzz_1.Scuzz,description:App.L10n.Blocks.Effect.Blocks.Scuzz.description},{name:App.L10n.Blocks.Effect.Blocks.Volume.name,id:Gain_1.Gain,description:App.L10n.Blocks.Effect.Blocks.Volume.description}]},{name:App.L10n.Blocks.Power.Label,items:[{name:App.L10n.Blocks.Power.Blocks.ParticleEmitter.name,id:ParticleEmitter_1.ParticleEmitter,description:App.L10n.Blocks.Power.Blocks.ParticleEmitter.description},{name:App.L10n.Blocks.Power.Blocks.Power.name,id:Power_1.Power,description:App.L10n.Blocks.Power.Blocks.Power.description},{name:App.L10n.Blocks.Power.Blocks.TogglePower.name,id:Toggle_1.Toggle,description:App.L10n.Blocks.Power.Blocks.TogglePower.description},{name:App.L10n.Blocks.Power.Blocks.Void.name,id:Void_1.Void,description:App.L10n.Blocks.Power.Blocks.Void.description},{name:App.L10n.Blocks.Power.Blocks.MomentaryPower.name,id:Momentary_1.Momentary,description:App.L10n.Blocks.Power.Blocks.MomentaryPower.description},{name:App.L10n.Blocks.Power.Blocks.Laser.name,id:Laser_1.Laser,description:App.L10n.Blocks.Power.Blocks.Laser.description}]},{name:App.L10n.Blocks.Interaction.Label,items:[{name:App.L10n.Blocks.Interaction.Blocks.ComputerKeyboard.name,id:ComputerKeyboard_1.ComputerKeyboard,description:App.L10n.Blocks.Interaction.Blocks.ComputerKeyboard.description},{name:App.L10n.Blocks.Interaction.Blocks.MIDIController.name,id:MIDIController_1.MIDIController,description:App.L10n.Blocks.Interaction.Blocks.MIDIController.description}]}]}}return BlockCreator.prototype.GetBlock=function(type){type=this.BackwardsCompatibilityCheck(type);var b=eval("new this."+type+"()");return b.Type=eval("this."+type),b},BlockCreator.prototype.BackwardsCompatibilityCheck=function(type){switch(type){case"Gain":type="Volume";break;case"Pitch":type="PitchShifter";break;case"LFO":type="Vibrato"}return type},BlockCreator}();exports.BlockCreator=BlockCreator});var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};define("GAVariables",["require","exports","./StringValue"],function(require,exports,StringValue_1){var GAVariable=function(_super){__extends(GAVariable,_super);function GAVariable(){_super.apply(this,arguments)}return GAVariable}(StringValue_1.StringValue),GAVariables=function(){function GAVariables(){}return GAVariables.THEME=new GAVariable("theme"),GAVariables}();exports.GAVariables=GAVariables}),define("App",["require","exports","./Core/Audio/Audio","./Blocks/BlockSprites","./Core/Visual/ColorManager","./Core/Resources/CommandHandlerFactory","./Core/Commands/CommandManager","./Core/Inputs/CommandsInputManager","./Commands","./CompositionLoadedEventArgs","./CommandHandlers/CreateBlockCommandHandler","./CommandHandlers/DeleteBlockCommandHandler","./Core/Inputs/DragFileInputManager","./Blocks/Effect","./Core/Inputs/FocusManager","./CommandHandlers/LoadCommandHandler","./Metrics","./CommandHandlers/MoveBlockCommandHandler","./Core/Operations/OperationManager","./Particle","./Core/Inputs/PianoKeyboardManager","./Core/Inputs/PointerInputManager","./Core/Resources/PooledFactoryResource","./Blocks/Power/PowerEffect","./Blocks/Power/PowerSource","./CommandHandlers/RedoCommandHandler","./Core/Resources/ResourceManager","./CommandHandlers/SaveAsCommandHandler","./CommandHandlers/SaveCommandHandler","./Serializer","./Core/Audio/SoundCloud/SoundCloudAPI","./Blocks/Source","./Stage","./Core/Visual/ThemeManager","./Core/Inputs/TypingManager","./CommandHandlers/UndoCommandHandler","./BlockCreator","./CommandCategories","./Errors","./GAVariables"],function(require,exports,Audio_1,BlockSprites_1,ColorManager_1,CommandHandlerFactory_1,CommandManager_1,CommandsInputManager_1,Commands_1,CompositionLoadedEventArgs_1,CreateBlockCommandHandler_1,DeleteBlockCommandHandler_1,DragFileInputManager_1,Effect_1,FocusManager_1,LoadCommandHandler_1,Metrics_1,MoveBlockCommandHandler_1,OperationManager_1,Particle_1,PianoKeyboardManager_1,PointerInputManager_1,PooledFactoryResource_1,PowerEffect_1,PowerSource_1,RedoCommandHandler_1,ResourceManager_1,SaveAsCommandHandler_1,SaveCommandHandler_1,Serializer_1,SoundCloudAPI_1,Source_1,Stage_1,ThemeManager_1,TypingManager_1,UndoCommandHandler_1,BlockCreator_1,CommandCategories_1,Errors_1,GAVariables_1){var Canvas=etch.drawing.Canvas,Point=minerva.Point,App=function(){function App(config,l10n){this.CompositionLoaded=new nullstone.Event,this.Audio=new Audio_1.Audio,this.Blocks=[],this.DragOffset=new Point(0,0),this.IsLoadingComposition=!1,this.Palette=[],this.Particles=[],this.Config=JSON.parse(config),this.L10n=JSON.parse(l10n)}return Object.defineProperty(App.prototype,"AnimationsLayer",{get:function(){return this.MainScene.AnimationsLayer},enumerable:!0,configurable:!0}),Object.defineProperty(App.prototype,"MainScene",{get:function(){return this.Stage.MainScene},enumerable:!0,configurable:!0}),Object.defineProperty(App.prototype,"Sources",{get:function(){return this.Blocks.en().where(function(b){return b instanceof Source_1.Source}).toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(App.prototype,"Effects",{get:function(){return this.Blocks.en().where(function(b){return b instanceof Effect_1.Effect}).toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(App.prototype,"PowerEffects",{get:function(){return this.Blocks.en().where(function(b){return b instanceof PowerEffect_1.PowerEffect}).toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(App.prototype,"PowerSources",{get:function(){return this.Blocks.en().where(function(b){return b instanceof PowerSource_1.PowerSource}).toArray()},enumerable:!0,configurable:!0}),App.prototype.GetBlockId=function(){var max=0;for(var i=0;i<this.Blocks.length;i++){var b=this.Blocks[i];b.Id>max&&(max=b.Id)}return max+1},Object.defineProperty(App.prototype,"SessionId",{get:function(){if(this._SessionId)return this._SessionId;var sessionId=Utils.Storage.get(this.CompositionId,Utils.StorageType.local);if(sessionId)return sessionId.value},set:function(value){this._SessionId=value,Utils.Storage.set(this.CompositionId,this._SessionId,31536e4,Utils.StorageType.local)},enumerable:!0,configurable:!0}),App.prototype.Setup=function(){var _this=this;this.Canvas=new Canvas,this.BlockCreator=new BlockCreator_1.BlockCreator,this.Metrics=new Metrics_1.Metrics,this.BlockSprites=new BlockSprites_1.BlockSprites,this.SubCanvas=[],this.CreateSubCanvas(0),window.onresize=function(){_this.Resize()},this.Audio.Init(),this._FontsLoaded=0,WebFont.load({custom:{families:["Merriweather Sans:i3","Dosis:n2,n4"]},fontactive:function(font,fvd){_this.FontsLoaded(font,fvd)},timeout:3e3}),setTimeout(function(){_this.FontsNotLoaded()},3020),this.OperationManager=new OperationManager_1.OperationManager,this.OperationManager.MaxOperations=this.Config.MaxOperations,this.ResourceManager=new ResourceManager_1.ResourceManager,this.CommandManager=new CommandManager_1.CommandManager(this.ResourceManager),this.TypingManager=new TypingManager_1.TypingManager,this.DragFileInputManager=new DragFileInputManager_1.DragFileInputManager,this.PianoKeyboardManager=new PianoKeyboardManager_1.PianoKeyboardManager,this.CommandsInputManager=new CommandsInputManager_1.CommandsInputManager(this.CommandManager),this.PointerInputManager=new PointerInputManager_1.PointerInputManager,this.ColorManager=new ColorManager_1.ColorManager,this.ThemeManager=new ThemeManager_1.ThemeManager,this.FocusManager=new FocusManager_1.FocusManager,this.FocusManager.FocusChanged.on(function(s,e){e.HasFocus||(_this.TypingManager.ClearKeysDown(),_this.PianoKeyboardManager.ClearKeysDown(),_this.CommandsInputManager.ClearKeysDown(),_this.Sources.forEach(function(s){s.TriggerRelease("all")}))},this),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.CREATE_BLOCK,CreateBlockCommandHandler_1.CreateBlockCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.DELETE_BLOCK,DeleteBlockCommandHandler_1.DeleteBlockCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.MOVE_BLOCK,MoveBlockCommandHandler_1.MoveBlockCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.SAVE,SaveCommandHandler_1.SaveCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.SAVE_AS,SaveAsCommandHandler_1.SaveAsCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.LOAD,LoadCommandHandler_1.LoadCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.UNDO,UndoCommandHandler_1.UndoCommandHandler.prototype)),this.ResourceManager.AddResource(new CommandHandlerFactory_1.CommandHandlerFactory(Commands_1.Commands.REDO,RedoCommandHandler_1.RedoCommandHandler.prototype)),this.ParticlesPool=new PooledFactoryResource_1.PooledFactoryResource(10,100,Particle_1.Particle.prototype),SoundCloudAPI_1.SoundCloudAPI.Initialize(),this.ThemeManager.ThemeChanged.on(function(s,e){_this.TrackVariable(GAVariables_1.GAVariables.THEME.toString(),e.Index.toString()),_this.TrackEvent(CommandCategories_1.CommandCategories.SETTINGS.toString(),Commands_1.Commands.CHANGE_THEME.toString());var firstLoad=_this.Palette.length===0;_this.Palette=e.Palette,firstLoad&&_this.LoadReady()},this),this.ThemeManager.LoadTheme(0)},App.prototype.FontsLoaded=function(font,fvd){this._FontsLoaded+=1,this._FontsLoaded===3&&this.LoadReady()},App.prototype.FontsNotLoaded=function(){this._FontsLoaded!==3&&(console.log("FONTS ARE MISSING"),this.LoadReady())},App.prototype.LoadReady=function(){this._FontsLoaded===3&&this.ThemeManager.Loaded&&this.LoadComposition()},App.prototype.LoadComposition=function(){var _this=this;this.CompositionId=Utils.Urls.GetQuerystringParameter("c"),this.CompositionName=Utils.Urls.GetQuerystringParameter("t"),this.CompositionId&&(this.IsLoadingComposition=!0,this.CommandManager.ExecuteCommand(Commands_1.Commands.LOAD,this.CompositionId).then(function(data){_this.CompositionLoadComplete(data)}).catch(function(error){_this.TrackEvent(CommandCategories_1.CommandCategories.COMPOSITIONS.toString(),Errors_1.Errors.LOAD_FAILED.toString(),_this.CompositionId),_this.CompositionId=null})),this.CreateStage()},App.prototype.CreateStage=function(){this.Stage=new Stage_1.Stage,this.Stage.Init(this.Canvas),this.Stage.Drawn.on(function(s,time){window.TWEEN.update(time)},this),this.Resize()},App.prototype.CompositionLoadComplete=function(data){this.Deserialize(data);for(var i=0;i<this.Blocks.length;i++)this.Blocks[i].Duplicable=!0;this._SaveFile.ColorThemeNo&&this.ThemeManager.LoadTheme(this._SaveFile.ColorThemeNo),this.ZoomLevel=this._SaveFile.ZoomLevel,this.Audio.Master.volume.value=-100,this.Audio.ConnectionManager.Update(),this.IsLoadingComposition=!1,this.CompositionLoaded.raise(this,new CompositionLoadedEventArgs_1.CompositionLoadedEventArgs(this._SaveFile))},App.prototype.Serialize=function(){return Serializer_1.Serializer.Serialize()},App.prototype.Deserialize=function(json){this._SaveFile=Serializer_1.Serializer.Deserialize(json),this.Blocks=this._SaveFile.Composition.en().traverseUnique(function(block){return block.Connections}).toArray(),this.Blocks.sort(function(a,b){return a.ZIndex-b.ZIndex})},App.prototype.Message=function(message,options){this.MainScene&&this.MainScene.MessagePanel.NewMessage(message,options)},App.prototype.CreateSubCanvas=function(i){this.SubCanvas[i]=document.createElement("canvas"),document.body.appendChild(this.SubCanvas[i])},App.prototype.TrackEvent=function(category,action,label){window.trackEvent(category,action,label)},App.prototype.TrackVariable=function(name,value){window.trackVariable(name,value)},App.prototype.IsLocalhost=function(){return document.location.href.indexOf("localhost")!=-1},App.prototype.Resize=function(){this.Metrics.Compute(),this.Stage.Resize()},App.prototype.FillColor=function(ctx,col){this.ColorManager.FillColor(ctx,col)},App.prototype.FillRGBA=function(ctx,r,g,b,a){this.ColorManager.FillRGBA(ctx,r,g,b,a)},App.prototype.StrokeColor=function(ctx,col){this.ColorManager.StrokeColor(ctx,col)},App.prototype.StrokeRGBA=function(ctx,r,g,b,a){this.ColorManager.StrokeRGBA(ctx,r,g,b,a)},App}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=App}),define("text!config.json",[],function(){return'{\r\n    "MaxOperations": 5,\r\n    "PixelPaletteImagePath": [\r\n        "img/palette6.gif",\r\n        "img/palette9.gif",\r\n        "img/palette10.gif",\r\n        "img/palette14.gif",\r\n        "img/palette18.gif",\r\n        "img/palette25.gif",\r\n        "img/palette27.gif",\r\n        "img/palette24.gif",\r\n        "img/palette28.gif",\r\n        "img/palette19.gif",\r\n        "img/palette29.gif",\r\n        "img/palette.gif"\r\n    ],\r\n    "SoundCloudClientId": "7258ff07f16ddd167b55b8f9b9a3ed33",\r\n    "SoundCloudDefaultTracks": [\r\n        "24456532",\r\n        "25216773",\r\n        "5243666",\r\n        "51167662",\r\n        "172375224",\r\n        "43883752"\r\n    ],\r\n    "SoundCloudMaxTrackLength": 510,\r\n    "GranularDefaultTracks": [\r\n        "24456532",\r\n        "183588346",\r\n        "48387282",\r\n        "127905486",\r\n        "50894420",\r\n        "76097469",\r\n        "130501492"\r\n    ],\r\n    "GranularMaxTrackLength": 240,\r\n    "ConvolverDefaultTracks": [],\r\n    "ConvolverMaxTrackLength": 12,\r\n    "RecorderWorkerPath": "Assets/Recorder/recorderWorker.js",\r\n    "PolyphonicVoices": 5,\r\n    "PulseLength": "16n",\r\n    "BaseNote": 261.6,\r\n    "SoundCloudLoadTimeout": 20,\r\n    "ResetPitchesOnInteractionDisconnect": true,\r\n    "ScrollSpeed": 1.5,\r\n    "ScrollEasing": 25,\r\n    "SingleClickTime": 140\r\n}\r\n'}),define("text!l10n.json",[],function(){return'{\r\n  "Attribution": {\r\n    "title": "General",\r\n    "about": "BlokDust is a collaboration between Luke Twyman, Luke Phillips and Edward Silverton. Developed in Brighton UK and released in 2016, BlokDust uses the Web Audio API and makes use of Tone.js as an audio framework.",\r\n    "twyman": {\r\n      "blurb": "Luke Twyman - project concept, design & UI.",\r\n      "url": "whitevinyldesign.com",\r\n      "twitter": "@whitevinylUK"\r\n    },\r\n    "phillips": {\r\n      "blurb": "Luke Phillips - audio development & musical interaction.",\r\n      "url": "femurdesign.com",\r\n      "twitter": "@lukephills"\r\n    },\r\n    "silverton": {\r\n      "blurb": "Edward Silverton - client & server architecture & core development.",\r\n      "url": "edsilv.com",\r\n      "twitter": "@edsilv"\r\n    },\r\n    "thanks": "Thanks also to Yotam Mann and Brad Sickles.",\r\n    "build": "Current Build: {0}"\r\n  },\r\n  "Blocks": {\r\n    "Source": {\r\n      "Label": "Source",\r\n      "Blocks": {\r\n        "Tone": {\r\n          "name": "Tone",\r\n          "description": "A single oscillator. Creates a waveform used as the basis of most synths."\r\n        },\r\n        "Noise": {\r\n          "name": "Noise",\r\n          "description": "A noise generator with \'White\', \'Brown\' and \'Pink\' waveform types."\r\n        },\r\n        "Microphone": {\r\n          "name": "Microphone",\r\n          "description": "Captures sound from your device\'s microphone input. Connect to a Power source & avoid feedback by using headphones."\r\n        },\r\n        "Soundcloud": {\r\n          "name": "Soundcloud",\r\n          "description": "A sample player loaded with a SoundCloud track of your choice."\r\n        },\r\n        "Sampler": {\r\n          "name": "Sampler",\r\n          "description": "A sample player loaded with an audio file from your device."\r\n        },\r\n        "Granular": {\r\n          "name": "Granular",\r\n          "description": "It takes a SoundCloud sample of your choice and chops it into tiny pieces which are used as a sound source."\r\n        },\r\n        "Recorder": {\r\n          "name": "Recorder",\r\n          "description": "It can record the master output and then be used as a sample player."\r\n        },\r\n        "WaveGen": {\r\n          "name": "WaveGen",\r\n          "description": "Procedurally generates a new audio sample, for creating unique textures or arpeggiated loops."\r\n        }\r\n      }\r\n    },\r\n    "Effect": {\r\n      "Label": "Effect",\r\n      "Blocks": {\r\n        "AutoWah": {\r\n          "name": "AutoWah",\r\n          "description": "Creates a filter sweep in response to the volume of audio input."\r\n        },\r\n        "BitCrusher": {\r\n          "name": "Bit Crusher",\r\n          "description": "Creates distortion by reducing the audio resolution."\r\n        },\r\n        "Chomp": {\r\n          "name": "Chomp",\r\n          "description": "A randomised filter with adjustable rate & width."\r\n        },\r\n        "Chopper": {\r\n          "name": "Chopper",\r\n          "description": "A tremolo effect that modulates the volume with an adjustable rate & depth."\r\n        },\r\n        "Chorus": {\r\n          "name": "Chorus",\r\n          "description": "Stereo chorus. Creates a delayed & modulated copy of the audio."\r\n        },\r\n        "Convolution": {\r\n          "name": "Convolution",\r\n          "description": "A convolution reverb which simulates a physical space by using a recorded sample."\r\n        },\r\n        "Delay": {\r\n          "name": "Delay",\r\n          "description": "A \'ping-pong\' delay/echo with adjustable time & feedback."\r\n        },\r\n        "Distortion": {\r\n          "name": "Distortion",\r\n          "description": "A digital clipping distortion."\r\n        },\r\n        "Envelope": {\r\n          "name": "Envelope",\r\n          "description": "An ADSR envelope which alters the volume of sound over time."\r\n        },\r\n        "Eq": {\r\n          "name": "EQ",\r\n          "description": "A \'parametric\' EQ with 4 filters."\r\n        },\r\n        "Filter": {\r\n          "name": "Filter",\r\n          "description": "A \'peaking\' filter used for boosting or suppressing frequencies."\r\n        },\r\n        "Vibrato": {\r\n          "name": "Vibrato",\r\n          "description": "An oscillation effect that modulates pitch and playback rate."\r\n        },\r\n        "Phaser": {\r\n          "name": "Phaser",\r\n          "description": "A modulating phaser effect that sweeps through a spectrum of sound frequencies."\r\n        },\r\n        "PitchShifter": {\r\n          "name": "Pitch Shifter",\r\n          "description": "Shifts the pitch of any sound."\r\n        },\r\n        "Reverb": {\r\n          "name": "Reverb",\r\n          "description": "A digital reverb with adjustable room size and dampening."\r\n        },\r\n        "Scuzz": {\r\n          "name": "Scuzz",\r\n          "description": "Frequency modulation (FM) synthesis style effect that can create harmonic and overtone signals."\r\n        },\r\n        "Volume": {\r\n          "name": "Volume",\r\n          "description": "Increase or decrease the volume."\r\n        }\r\n      }\r\n    },\r\n    "Power": {\r\n      "Label": "Power",\r\n      "Blocks": {\r\n        "ParticleEmitter": {\r\n          "name": "Particle Emitter",\r\n          "description": "Fires energy particles. When a particle hits a source block, that source is momentarily triggered."\r\n        },\r\n        "Power": {\r\n          "name": "Power",\r\n          "description": "Provides energy for sources, particle emitters & lasers. This allows them to be constantly on."\r\n        },\r\n        "TogglePower": {\r\n          "name": "Toggle Power",\r\n          "description": "When \'on\' provides energy for sources, particle emitters & lasers."\r\n        },\r\n        "Void": {\r\n          "name": "Void",\r\n          "description": "Absorbs any laser beams or particles that collide with it."\r\n        },\r\n        "MomentaryPower": {\r\n          "name": "Momentary Power",\r\n          "description": "Provides a short fire of energy for sources, particle emitters & lasers."\r\n        },\r\n        "Laser": {\r\n          "name": "Laser",\r\n          "description": "A laser beam that gives energy to sources, particle emitters & other lasers in its path."\r\n        }\r\n      }\r\n    },\r\n    "Interaction": {\r\n      "Label": "Interaction",\r\n      "Blocks": {\r\n        "ComputerKeyboard": {\r\n          "name": "Computer Keyboard",\r\n          "description": "Trigger sources using your computer keys arranged into a 2 1/2 octave piano."\r\n        },\r\n        "MIDIController": {\r\n          "name": "MIDI Controller",\r\n          "description": "Trigger sources using any connected USB MIDI device. Chrome only"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  "Errors": {\r\n    "SaveError": "Save failed, please try again.",\r\n    "SoundCloud": {\r\n      "FailedTrackFiltering": "Tracks were found, but cannot be used. Make sure the track you\'re searching for is streamable for public use and is either tagged \'blokdust\' or has a creative commons license.",\r\n      "InternalServerError": "Error: Something went wrong with SoundCloud\'s servers.",\r\n      "ServiceUnavailable": "SoundCloud\'s servers were too busy. Please try again.",\r\n      "TooManyRequests":"Error: Too many requests. SoundCloud\'s 15,000 limit has been reached. Try again tomorrow",\r\n      "Uninitialized": "SoundCloud API isn\'t connected. Check your internet connection, save & refresh the page.",\r\n      "Unknown": "Something went wrong with SoundCloud. Check console for errors."\r\n    }\r\n  }\r\n}\r\n'}),function(global){function PxLoader(settings){settings=settings||{},this.settings=settings,settings.statusInterval==null&&(settings.statusInterval=5e3),settings.loggingDelay==null&&(settings.loggingDelay=2e4),settings.noProgressTimeout==null&&(settings.noProgressTimeout=Infinity);var entries=[],progressListeners=[],timeStarted,progressChanged=Date.now(),ResourceState={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},ensureArray=function(val){return val==null?[]:Array.isArray(val)?val:[val]};this.add=function(resource){resource.tags=new PxLoaderTags(resource.tags),resource.priority==null&&(resource.priority=Infinity),entries.push({resource:resource,status:ResourceState.QUEUED})},this.addProgressListener=function(callback,tags){progressListeners.push({callback:callback,tags:new PxLoaderTags(tags)})},this.addCompletionListener=function(callback,tags){progressListeners.push({tags:new PxLoaderTags(tags),callback:function(e){e.completedCount===e.totalCount&&callback(e)}})};var getResourceSort=function(orderedTags){orderedTags=ensureArray(orderedTags);var getTagOrder=function(entry){var resource=entry.resource,bestIndex=Infinity;for(var i=0;i<resource.tags.length;i++)for(var j=0;j<Math.min(orderedTags.length,bestIndex);j++){if(resource.tags.all[i]===orderedTags[j]&&j<bestIndex){bestIndex=j;if(bestIndex===0)break}if(bestIndex===0)break}return bestIndex};return function(a,b){var aOrder=getTagOrder(a),bOrder=getTagOrder(b);return aOrder<bOrder?-1:aOrder>bOrder?1:a.priority<b.priority?-1:a.priority>b.priority?1:0}};this.start=function(orderedTags){timeStarted=Date.now();var compareResources=getResourceSort(orderedTags);entries.sort(compareResources);for(var i=0,len=entries.length;i<len;i++){var entry=entries[i];entry.status=ResourceState.WAITING,entry.resource.start(this)}setTimeout(statusCheck,100)};var statusCheck=function(){var checkAgain=!1,noProgressTime=Date.now()-progressChanged,timedOut=noProgressTime>=settings.noProgressTimeout,shouldLog=noProgressTime>=settings.loggingDelay;for(var i=0,len=entries.length;i<len;i++){var entry=entries[i];if(entry.status!==ResourceState.WAITING)continue;entry.resource.checkStatus&&entry.resource.checkStatus(),entry.status===ResourceState.WAITING&&(timedOut?entry.resource.onTimeout():checkAgain=!0)}shouldLog&&checkAgain&&log(),checkAgain&&setTimeout(statusCheck,settings.statusInterval)};this.isBusy=function(){for(var i=0,len=entries.length;i<len;i++)if(entries[i].status===ResourceState.QUEUED||entries[i].status===ResourceState.WAITING)return!0;return!1};var onProgress=function(resource,statusType){var entry=null,i,len,numResourceTags,listener,shouldCall;for(i=0,len=entries.length;i<len;i++)if(entries[i].resource===resource){entry=entries[i];break}if(entry==null||entry.status!==ResourceState.WAITING)return;entry.status=statusType,progressChanged=Date.now(),numResourceTags=resource.tags.length;for(i=0,len=progressListeners.length;i<len;i++)listener=progressListeners[i],listener.tags.length===0?shouldCall=!0:shouldCall=resource.tags.intersects(listener.tags),shouldCall&&sendProgress(entry,listener)};this.onLoad=function(resource){onProgress(resource,ResourceState.LOADED)},this.onError=function(resource){onProgress(resource,ResourceState.ERROR)},this.onTimeout=function(resource){onProgress(resource,ResourceState.TIMEOUT)};var sendProgress=function(updatedEntry,listener){var completed=0,total=0,i,len,entry,includeResource;for(i=0,len=entries.length;i<len;i++)entry=entries[i],includeResource=!1,listener.tags.length===0?includeResource=!0:includeResource=entry.resource.tags.intersects(listener.tags),includeResource&&(total++,(entry.status===ResourceState.LOADED||entry.status===ResourceState.ERROR||entry.status===ResourceState.TIMEOUT)&&completed++);listener.callback({resource:updatedEntry.resource,loaded:updatedEntry.status===ResourceState.LOADED,error:updatedEntry.status===ResourceState.ERROR,timeout:updatedEntry.status===ResourceState.TIMEOUT,completedCount:completed,totalCount:total})},log=this.log=function(showAll){if(!window.console)return;var elapsedSeconds=Math.round((Date.now()-timeStarted)/1e3);window.console.log("PxLoader elapsed: "+elapsedSeconds+" sec");for(var i=0,len=entries.length;i<len;i++){var entry=entries[i];if(!showAll&&entry.status!==ResourceState.WAITING)continue;var message="PxLoader: #"+i+" "+entry.resource.getName();switch(entry.status){case ResourceState.QUEUED:message+=" (Not Started)";break;case ResourceState.WAITING:message+=" (Waiting)";break;case ResourceState.LOADED:message+=" (Loaded)";break;case ResourceState.ERROR:message+=" (Error)";break;case ResourceState.TIMEOUT:message+=" (Timeout)"}entry.resource.tags.length>0&&(message+=" Tags: ["+entry.resource.tags.all.join(",")+"]"),window.console.log(message)}}}function PxLoaderTags(values){this.all=[],this.first=null,this.length=0,this.lookup={};if(values){if(Array.isArray(values))this.all=values.slice(0);else if(typeof values=="object")for(var key in values)values.hasOwnProperty(key)&&this.all.push(key);else this.all.push(values);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var i=0;i<this.length;i++)this.lookup[this.all[i]]=!0}}PxLoaderTags.prototype.intersects=function(other){if(this.length===0||other.length===0)return!1;if(this.length===1&&other.length===1)return this.first===other.first;if(other.length<this.length)return other.intersects(this);for(var key in this.lookup)if(other.lookup[key])return!0;return!1},typeof define=="function"&&define.amd&&define("PxLoader",[],function(){return PxLoader}),global.PxLoader=PxLoader}(this),Date.now||(Date.now=function now(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"});function PxLoaderImage(url,tags,priority){var self=this,loader=null;this.img=new Image,this.tags=tags,this.priority=priority;var onReadyStateChange=function(){self.img.readyState==="complete"&&(removeEventHandlers(),loader.onLoad(self))},onLoad=function(){removeEventHandlers(),loader.onLoad(self)},onError=function(){removeEventHandlers(),loader.onError(self)},removeEventHandlers=function(){self.unbind("load",onLoad),self.unbind("readystatechange",onReadyStateChange),self.unbind("error",onError)};this.start=function(pxLoader){loader=pxLoader,self.bind("load",onLoad),self.bind("readystatechange",onReadyStateChange),self.bind("error",onError),self.img.src=url},this.checkStatus=function(){self.img.complete&&(removeEventHandlers(),loader.onLoad(self))},this.onTimeout=function(){removeEventHandlers(),self.img.complete?loader.onLoad(self):loader.onTimeout(self)},this.getName=function(){return url},this.bind=function(eventName,eventHandler){self.img.addEventListener?self.img.addEventListener(eventName,eventHandler,!1):self.img.attachEvent&&self.img.attachEvent("on"+eventName,eventHandler)},this.unbind=function(eventName,eventHandler){self.img.removeEventListener?self.img.removeEventListener(eventName,eventHandler,!1):self.img.detachEvent&&self.img.detachEvent("on"+eventName,eventHandler)}}PxLoader.prototype.addImage=function(url,tags,priority){var imageLoader=new PxLoaderImage(url,tags,priority);return this.add(imageLoader),imageLoader.img},typeof define=="function"&&define.amd&&define("PxLoaderImage",[],function(){return PxLoaderImage}),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define("PixelPalette",e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.PixelPalette=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function RGBA(r,g,b,a){this.R=r,this.G=g,this.B=b,this.A=a,this.toString=function(){return"rgba("+r+","+g+","+b+","+a+")"},this.clone=function(){return new RGBA(r,g,b,a)}}var PixelPalette=function(){function PixelPalette(imgPath){this.imgPath=imgPath}return PixelPalette.prototype.Load=function(cb){var loader=new PxLoader,img=loader.addImage(this.imgPath),canvas=document.createElement("canvas"),context=canvas.getContext("2d");loader.addCompletionListener(function(){var len=img.width;context.drawImage(img,0,0,len,1);var imgd=context.getImageData(0,0,len,1),pal=imgd.data,palette=[];for(var i=0;i<len*4;i+=4)palette[i/4]=new RGBA(pal[i],pal[i+1],pal[i+2],pal[i+3]);cb(palette)}),loader.start()},PixelPalette}();module.exports=PixelPalette},{}]},{},[1])(1)}),define("Tone/core/Tone",[],function(){"use strict";function isUndef(val){return val===void 0}function isFunction(val){return typeof val=="function"}var audioContext;isUndef(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),isUndef(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext);if(!isUndef(AudioContext)){audioContext=new AudioContext,isFunction(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),isFunction(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),isFunction(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),isFunction(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),isFunction(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),isFunction(AudioBuffer.prototype.copyToChannel)||(AudioBuffer.prototype.copyToChannel=function(source,channelNumber,startInChannel){var clipped=source.subarray(0,Math.min(source.length,this.length-(startInChannel|0)));this.getChannelData(channelNumber|0).set(clipped,startInChannel|0)}),isFunction(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),isFunction(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),isFunction(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(B,outNum,inNum){if(B.input)Array.isArray(B.input)?(isUndef(inNum)&&(inNum=0),this.connect(B.input[inNum])):this.connect(B.input,outNum,inNum);else try{B instanceof AudioNode?this._nativeConnect(B,outNum,inNum):this._nativeConnect(B,outNum)}catch(e){throw new Error("error connecting to node: "+B)}};var Tone=function(inputs,outputs){isUndef(inputs)||inputs===1?this.input=this.context.createGain():inputs>1&&(this.input=new Array(inputs)),isUndef(outputs)||outputs===1?this.output=this.context.createGain():outputs>1&&(this.output=new Array(inputs))};Tone.prototype.set=function(params,value,rampTime){if(this.isObject(params))rampTime=value;else if(this.isString(params)){var tmpObj={};tmpObj[params]=value,params=tmpObj}for(var attr in params){value=params[attr];var parent=this;if(attr.indexOf(".")!==-1){var attrSplit=attr.split(".");for(var i=0;i<attrSplit.length-1;i++)parent=parent[attrSplit[i]];attr=attrSplit[attrSplit.length-1]}var param=parent[attr];if(isUndef(param))continue;Tone.Signal&&param instanceof Tone.Signal||Tone.Param&&param instanceof Tone.Param?param.value!==value&&(isUndef(rampTime)?param.value=value:param.rampTo(value,rampTime)):param instanceof AudioParam?param.value!==value&&(param.value=value):param instanceof Tone?param.set(value):param!==value&&(parent[attr]=value)}return this},Tone.prototype.get=function(params){isUndef(params)?params=this._collectDefaults(this.constructor):this.isString(params)&&(params=[params]);var ret={};for(var i=0;i<params.length;i++){var attr=params[i],parent=this,subRet=ret;if(attr.indexOf(".")!==-1){var attrSplit=attr.split(".");for(var j=0;j<attrSplit.length-1;j++){var subAttr=attrSplit[j];subRet[subAttr]=subRet[subAttr]||{},subRet=subRet[subAttr],parent=parent[subAttr]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];this.isObject(params[attr])?subRet[attr]=param.get():Tone.Signal&&param instanceof Tone.Signal?subRet[attr]=param.value:Tone.Param&&param instanceof Tone.Param?subRet[attr]=param.value:param instanceof AudioParam?subRet[attr]=param.value:param instanceof Tone?subRet[attr]=param.get():!isFunction(param)&&!isUndef(param)&&(subRet[attr]=param)}return ret},Tone.prototype._collectDefaults=function(constr){var ret=[];isUndef(constr.defaults)||(ret=Object.keys(constr.defaults));if(!isUndef(constr._super)){var superDefs=this._collectDefaults(constr._super);for(var i=0;i<superDefs.length;i++)ret.indexOf(superDefs[i])===-1&&ret.push(superDefs[i])}return ret},Tone.prototype.toString=function(){for(var className in Tone){var isLetter=className[0].match(/^[A-Z]$/),sameConstructor=Tone[className]===this.constructor;if(isFunction(Tone[className])&&isLetter&&sameConstructor)return className}return"Tone"},Tone.context=audioContext,Tone.prototype.context=Tone.context,Tone.prototype.bufferSize=2048,Tone.prototype.blockTime=128/Tone.context.sampleRate,Tone.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this};var _silentNode=null;Tone.prototype.noGC=function(){return this.output.connect(_silentNode),this},AudioNode.prototype.noGC=function(){return this.connect(_silentNode),this},Tone.prototype.connect=function(unit,outputNum,inputNum){return Array.isArray(this.output)?(outputNum=this.defaultArg(outputNum,0),this.output[outputNum].connect(unit,0,inputNum)):this.output.connect(unit,outputNum,inputNum),this},Tone.prototype.disconnect=function(outputNum){return Array.isArray(this.output)?(outputNum=this.defaultArg(outputNum,0),this.output[outputNum].disconnect()):this.output.disconnect(),this},Tone.prototype.connectSeries=function(){if(arguments.length>1){var currentUnit=arguments[0];for(var i=1;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit),currentUnit=toUnit}}return this},Tone.prototype.connectParallel=function(){var connectFrom=arguments[0];if(arguments.length>1)for(var i=1;i<arguments.length;i++){var connectTo=arguments[i];connectFrom.connect(connectTo)}return this},Tone.prototype.chain=function(){if(arguments.length>0){var currentUnit=this;for(var i=0;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit),currentUnit=toUnit}}return this},Tone.prototype.fan=function(){if(arguments.length>0)for(var i=0;i<arguments.length;i++)this.connect(arguments[i]);return this},AudioNode.prototype.chain=Tone.prototype.chain,AudioNode.prototype.fan=Tone.prototype.fan,Tone.prototype.defaultArg=function(given,fallback){if(this.isObject(given)&&this.isObject(fallback)){var ret={};for(var givenProp in given)ret[givenProp]=this.defaultArg(fallback[givenProp],given[givenProp]);for(var fallbackProp in fallback)ret[fallbackProp]=this.defaultArg(given[fallbackProp],fallback[fallbackProp]);return ret}return isUndef(given)?fallback:given},Tone.prototype.optionsObject=function(values,keys,defaults){var options={};if(values.length===1&&this.isObject(values[0]))options=values[0];else for(var i=0;i<keys.length;i++)options[keys[i]]=values[i];return this.isUndef(defaults)?options:this.defaultArg(options,defaults)},Tone.prototype.isUndef=isUndef,Tone.prototype.isFunction=isFunction,Tone.prototype.isNumber=function(arg){return typeof arg=="number"},Tone.prototype.isObject=function(arg){return Object.prototype.toString.call(arg)==="[object Object]"&&arg.constructor===Object},Tone.prototype.isBoolean=function(arg){return typeof arg=="boolean"},Tone.prototype.isArray=function(arg){return Array.isArray(arg)},Tone.prototype.isString=function(arg){return typeof arg=="string"},Tone.noOp=function(){},Tone.prototype._readOnly=function(property){if(Array.isArray(property))for(var i=0;i<property.length;i++)this._readOnly(property[i]);else Object.defineProperty(this,property,{writable:!1,enumerable:!0})},Tone.prototype._writable=function(property){if(Array.isArray(property))for(var i=0;i<property.length;i++)this._writable(property[i]);else Object.defineProperty(this,property,{writable:!0})},Tone.State={Started:"started",Stopped:"stopped",Paused:"paused"},Tone.prototype.equalPowerScale=function(percent){var piFactor=.5*Math.PI;return Math.sin(percent*piFactor)},Tone.prototype.dbToGain=function(db){return Math.pow(2,db/6)},Tone.prototype.gainToDb=function(gain){return 20*(Math.log(gain)/Math.LN10)},Tone.prototype.now=function(){return this.context.currentTime},Tone.extend=function(child,parent){isUndef(parent)&&(parent=Tone);function TempConstructor(){}TempConstructor.prototype=parent.prototype,child.prototype=new TempConstructor,child.prototype.constructor=child,child._super=parent};var newContextCallbacks=[];return Tone._initAudioContext=function(callback){callback(Tone.context),newContextCallbacks.push(callback)},Tone.setContext=function(ctx){Tone.prototype.context=ctx,Tone.context=ctx;for(var i=0;i<newContextCallbacks.length;i++)newContextCallbacks[i](ctx)},Tone.startMobile=function(){var osc=Tone.context.createOscillator(),silent=Tone.context.createGain();silent.gain.value=0,osc.connect(silent),silent.connect(Tone.context.destination);var now=Tone.context.currentTime;osc.start(now),osc.stop(now+1)},Tone.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,Tone._initAudioContext(function(audioContext){Tone.prototype.blockTime=128/audioContext.sampleRate,_silentNode=audioContext.createGain(),_silentNode.gain.value=0,_silentNode.connect(audioContext.destination)}),Tone.version="r6",console.log("%c * Tone.js "+Tone.version+" * ","background: #000; color: #fff"),Tone}throw new Error("Web Audio is not supported in this browser")}),function(global,factory){typeof module=="object"&&typeof module.exports=="object"?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}(typeof window!="undefined"?window:this,function(window,noGlobal){var arr=[],slice=arr.slice,concat=arr.concat,push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,support={},document=window.document,version="2.1.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;typeof target=="boolean"&&(deep=target,target=arguments[i]||{},i++),typeof target!="object"&&!jQuery.isFunction(target)&&(target={}),i===length&&(target=this,i--);for(;i<length;i++)if((options=arguments[i])!=null)for(name in options){src=target[name],copy=options[name];if(target===copy)continue;deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy)}return target},jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)+1>=0},isPlainObject:function(obj){return jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)?!1:obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},type:function(obj){return obj==null?obj+"":typeof obj=="object"||typeof obj=="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args)if(isArray)for(;i<length;i++){value=callback.apply(obj[i],args);if(value===!1)break}else for(i in obj){value=callback.apply(obj[i],args);if(value===!1)break}else if(isArray)for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===!1)break}else for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===!1)break}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return arr!=null&&(isArraylike(Object(arr))?jQuery.merge(ret,typeof arr=="string"?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++)callbackInverse=!callback(elems[i],i),callbackInverse!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray)for(;i<length;i++)value=callback(elems[i],i,arg),value!=null&&ret.push(value);else for(i in elems)value=callback(elems[i],i,arg),value!=null&&ret.push(value);return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;return typeof context=="string"&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn)?(args=slice.call(arguments,2),proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy):undefined},now:Date.now,support:support}),jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length="length"in obj&&obj.length,type=jQuery.type(obj);return type==="function"||jQuery.isWindow(obj)?!1:obj.nodeType===1&&length?!0:type==="array"||length===0||typeof length=="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]);target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;(context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],nodeType=context.nodeType;if(typeof selector!="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11)return results;if(!seed&&documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando,newContext=context,newSelector=nodeType!==1&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;while(i--)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)while(cur=cur.nextSibling)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!="undefined"&&context}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":!1},setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement)return document;document=doc,docElem=doc.documentElement,parent=doc.defaultView,parent&&parent!==parent.top&&(parent.addEventListener?parent.addEventListener("unload",unloadHandler,!1):parent.attachEvent&&parent.attachEvent("onunload",unloadHandler)),documentIsHTML=!isXML(doc),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!="undefined"&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!="undefined")return context.getElementsByTagName(tag);if(support.qsa)return context.querySelectorAll(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++])elem.nodeType===1&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll))assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\f]' msallowcapture=''>"+"<option selected=''></option></select>",div.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),div.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")});return(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!bup&&bup.nodeType===1&&!!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16)}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare?compare:(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:compare&4?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);cur=a;while(cur=cur.parentNode)ap.unshift(cur);cur=b;while(cur=cur.parentNode)bp.unshift(cur);while(ap[i]===bp[i])i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){(elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++])elem===results[i]&&(j=duplicates.push(i));while(j--)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType)while(node=elem[i++])ret+=getText(node);else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent=="string")return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(nodeType===3||nodeType===4)return elem.nodeValue;return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),match[2]==="~="&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),match[1].slice(0,3)==="nth"?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd")),match[5]=+(match[7]+match[8]||match[3]==="odd")):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className=="string"&&elem.className||typeof elem.getAttribute!="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return result==null?operator==="!=":operator?(result+="",operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":!1):!0}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir])if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)return!1;start=dir=type==="only"&&!start&&"nextSibling"}return!0}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={}),cache=outerCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]);if(node===elem)break}return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--)idx=indexOf(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--)if(elem=unmatched[i])seed[i]=!(matches[i]=elem)}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||elemLang.indexOf(lang+"-")===0;while((elem=elem.parentNode)&&elem.nodeType===1);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);soFar=selector,groups=[],preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar)))match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[]);matched=!1;if(match=rcombinators.exec(soFar))matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length);for(type in Expr.filter)(match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))&&(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir])if(elem.nodeType===1||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir])if(elem.nodeType===1||checkNonElements)if(matcher(elem,context,xml))return!0}else while(elem=elem[dir])if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++)if(elem=unmatched[i])if(!filter||filter(elem,context,xml))newUnmatched.push(elem),mapped&&map.push(i);return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;matcher&&matcher(matcherIn,matcherOut,context,xml);if(postFilter){temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;while(i--)if(elem=temp[i])matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}if(seed){if(postFinder||preFilter){if(postFinder){temp=[],i=matcherOut.length;while(i--)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];for(;i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++)if(Expr.relative[tokens[j].type])break;return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;outermost&&(outermostContext=context!==document&&context);for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++])if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++])matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)while(i--)!unmatched[i]&&!setMatched[i]&&(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}return compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){match||(match=tokenize(selector)),i=match.length;while(i--)cached=matcherFromTokens(match[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers)),cached.selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector=="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context)return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}i=matchExpr.needsContext.test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type])break;if(find=Expr.find[type])if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1),selector=seed.length&&toSelector(tokens);if(!selector)return push.apply(results,seed),results;break}}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1}),assert(function(div){return div.innerHTML="<a href='#'></a>",div.firstChild.getAttribute("href")==="#"})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}),(!support.attributes||!assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),div.firstChild.getAttribute("value")===""}))&&addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input")return elem.defaultValue}),assert(function(div){return div.getAttribute("disabled")==null})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return elem[name]===!0?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if(typeof qualifier=="string"){if(risSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!="string")return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;i<len;i++)jQuery.find(selector,self[i],ret);return ret=this.pushStack(len>1?jQuery.unique(ret):ret),ret.selector=this.selector?this.selector+" "+selector:selector,ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,typeof selector=="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector)return this;if(typeof selector=="string"){selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3?match=[null,selector,null]:match=rquickExpr.exec(selector);if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return elem=document.getElementById(match[2]),elem&&elem.parentNode&&(this.length=1,this[0]=elem),this.context=document,this.selector=selector,this}return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector)}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?typeof rootjQuery.ready!="undefined"?rootjQuery.ready(selector):selector(jQuery):(selector.selector!==undefined&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))};init.prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.extend({dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9)if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling)n.nodeType===1&&n!==elem&&matched.push(n);return matched}}),jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){return elem?typeof elem=="string"?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return name.slice(-5)!=="Until"&&(selector=until),selector&&typeof selector=="string"&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.unique(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}});var rnotwhite=/\S+/g,optionsCache={};function createOptions(options){var object=optionsCache[options]={};return jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=!0}),object}jQuery.Callbacks=function(options){options=typeof options=="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data,fired=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length,firing=!0;for(;list&&firingIndex<firingLength;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1,list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);type==="function"?(!options.unique||!self.has(arg))&&list.push(arg):arg&&arg.length&&type!=="string"&&add(arg)})})(arguments),firing?firingLength=list.length:memory&&(firingStart=start,fire(memory))}return this},remove:function(){return list&&jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1)list.splice(index,1),firing&&(index<=firingLength&&firingLength--,index<=firingIndex&&firingIndex--)}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!list&&!!list.length},empty:function(){return list=[],firingLength=0,this},disable:function(){return list=stack=memory=undefined,this},disabled:function(){return!list},lock:function(){return stack=undefined,memory||self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return list&&(!fired||stack)&&(args=args||[],args=[context,args.slice?args.slice():args],firing?stack.push(args):fire(args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?promise:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);for(;i<length;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining}return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){return jQuery.ready.promise().done(fn),this},jQuery.extend({isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(wait!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.triggerHandler&&(jQuery(document).triggerHandler("ready"),jQuery(document).off("ready"))}});function completed(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()}jQuery.ready.promise=function(obj){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(obj)},jQuery.ready.promise();var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=!0;for(i in key)jQuery.access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(value!==undefined){chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}));if(fn)for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet};jQuery.acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.accepts=jQuery.acceptData,Data.prototype={key:function(owner){if(!Data.accepts(owner))return 0;var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock},Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock,jQuery.extend(owner,descriptor)}}return this.cache[unlock]||(this.cache[unlock]={}),unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data=="string")cache[data]=value;else if(jQuery.isEmptyObject(cache))jQuery.extend(this.cache[unlock],data);else for(prop in data)cache[prop]=data[prop];return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;return key===undefined||key&&typeof key=="string"&&value===undefined?(stored=this.get(owner,key),stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))):(this.set(owner,key,value),value!==undefined?value:key)},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined)this.cache[unlock]={};else{jQuery.isArray(key)?name=key.concat(key.map(jQuery.camelCase)):(camel=jQuery.camelCase(key),key in cache?name=[key,camel]:(name=camel,name=name in cache?[name]:name.match(rnotwhite)||[])),i=name.length;while(i--)delete cache[name[i]]}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){owner[this.expando]&&delete this.cache[owner[this.expando]]}};var data_priv=new Data,data_user=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase(),data=elem.getAttribute(name);if(typeof data=="string"){try{data=data==="true"?!0:data==="false"?!1:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}data_user.set(elem,key,data)}else data=undefined}return data}jQuery.extend({hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--)attrs[i]&&(name=attrs[i].name,name.indexOf("data-")===0&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name])));data_priv.set(elem,"hasDataAttrs",!0)}}return data}return typeof key=="object"?this.each(function(){data_user.set(this,key)}):access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined)return data;data=data_user.get(elem,camelKey);if(data!==undefined)return data;data=dataAttr(elem,camelKey,undefined);if(data!==undefined)return data;return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value),key.indexOf("-")!==-1&&data!==undefined&&data_user.set(this,key,value)})},null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=data_priv.get(elem,type),data&&(!queue||jQuery.isArray(data)?queue=data_priv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};fn==="inprogress"&&(fn=queue.shift(),startLength--),fn&&(type==="fx"&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return typeof type!="string"&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),type==="fx"&&queue[0]!=="inprogress"&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};typeof type!="string"&&(obj=type,type=undefined),type=type||"fx";while(i--)tmp=data_priv.get(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,cssExpand=["Top","Right","Bottom","Left"],isHidden=function(elem,el){return elem=el||elem,jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)},rcheckableType=/^(?:checkbox|radio)$/i;(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData)return;handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}),types=(types||"").match(rnotwhite)||[""],t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort();if(!type)continue;special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||(handlers=events[type]=[],handlers.delegateCount=0,(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===!1)&&elem.addEventListener&&elem.addEventListener(type,eventHandle,!1)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events))return;types=(types||"").match(rnotwhite)||[""],t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);continue}special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,handlers=events[type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;while(j--)handleObj=handlers[j],(mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)&&(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&((!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===!1)&&jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}jQuery.isEmptyObject(events)&&(delete elemData.handle,data_priv.remove(elem,"events"))},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8)return;if(rfocusMorph.test(type+jQuery.event.triggered))return;type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event=="object"&&event),event.isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=undefined,event.target||(event.target=elem),data=data==null?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===!1)return;if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);for(;cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped())event.type=i>1?bubbleType:special.bindType||type,handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&handle.apply&&jQuery.acceptData(cur)&&(event.result=handle.apply(cur,data),event.result===!1&&event.preventDefault());return event.type=type,!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(eventPath.pop(),data)===!1)&&jQuery.acceptData(elem)&&ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)&&(tmp=elem[ontype],tmp&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=undefined,tmp&&(elem[ontype]=tmp)),event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event,event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===!1)return;handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem,j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped())if(!event.namespace_re||event.namespace_re.test(handleObj.namespace))event.handleObj=handleObj,event.data=handleObj.data,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),ret!==undefined&&(event.result=ret)===!1&&(event.preventDefault(),event.stopPropagation())}return special.postDispatch&&special.postDispatch.call(this,event),event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click"))for(;cur!==this;cur=cur.parentNode||this)if(cur.disabled!==!0||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++)handleObj=handlers[i],sel=handleObj.selector+" ",matches[sel]===undefined&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)}),handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return event.which==null&&(event.which=original.charCode!=null?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;return event.pageX==null&&original.clientX!=null&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),!event.which&&button!==undefined&&(event.which=button&1?1:button&2?3:button&4?2:0),event}},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;while(i--)prop=copy[i],event[prop]=originalEvent[prop];return event.target||(event.target=document),event.target.nodeType===3&&(event.target=event.target.parentNode),fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){event.result!==undefined&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===!1?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related))event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix;return ret}}}),support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),data_priv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix)-1;attaches?data_priv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),data_priv.remove(doc,fix))}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types=="object"){typeof selector!="string"&&(data=data||selector,selector=undefined);for(type in types)this.on(type,selector,data,types[type],one);return this}data==null&&fn==null?(fn=selector,data=selector=undefined):fn==null&&(typeof selector=="string"?(fn=data,data=undefined):(fn=data,data=selector,selector=undefined));if(fn===!1)fn=returnFalse;else if(!fn)return this;return one===1&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if(typeof types=="object"){for(type in types)this.off(type,selector,types[type]);return this}if(selector===!1||typeof selector=="function")fn=selector,selector=undefined;return fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){return elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++)data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1)return;if(data_priv.hasData(src)){pdataOld=data_priv.access(src),pdataCur=data_priv.set(dest,pdataOld),events=pdataOld.events;if(events){delete pdataCur.handle,pdataCur.events={};for(type in events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i])}}data_user.hasData(src)&&(udataOld=data_user.access(src),udataCur=jQuery.extend({},udataOld),data_user.set(dest,udataCur))}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type))dest.checked=src.checked;else if(nodeName==="input"||nodeName==="textarea")dest.defaultValue=src.defaultValue}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(!0),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone),srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++)fixInput(srcElements[i],destElements[i])}if(dataAndEvents)if(deepDataAndEvents){srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i])}else cloneCopyEvent(elem,clone);return destElements=getAll(clone,"script"),destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0)if(jQuery.type(elem)==="object")jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(!rhtml.test(elem))nodes.push(context.createTextNode(elem));else{tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2],j=wrap[0];while(j--)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),tmp=fragment.firstChild,tmp.textContent=""}}fragment.textContent="",i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1)continue;contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(fragment.appendChild(elem),"script"),contains&&setGlobalEval(tmp);if(scripts){j=0;while(elem=tmp[j++])rscriptType.test(elem.type||"")&&scripts.push(elem)}}return fragment},cleanData:function(elems){var data,elem,type,key,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(jQuery.acceptData(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);data_priv.cache[key]&&delete data_priv.cache[key]}}delete data_user.cache[elem[data_user.expando]]}}}),jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9)this.textContent=value})},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++)!keepData&&elem.nodeType===1&&jQuery.cleanData(getAll(elem)),elem.parentNode&&(keepData&&jQuery.contains(elem.ownerDocument,elem)&&setGlobalEval(getAll(elem,"script")),elem.parentNode.removeChild(elem));return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++)elem.nodeType===1&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=dataAndEvents==null?!1:dataAndEvents,deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1)return elem.innerHTML;if(typeof value=="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++)elem=this[i]||{},elem.nodeType===1&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];return this.domManip(arguments,function(elem){arg=this.parentNode,jQuery.cleanData(getAll(this)),arg&&arg.replaceChild(elem,this)}),arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,callback){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value=="string"&&!support.checkClone&&rchecked.test(value))return this.each(function(index){var self=set.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),self.domManip(args,callback)});if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,!1,this),first=fragment.firstChild,fragment.childNodes.length===1&&(fragment=first);if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript),hasScripts=scripts.length;for(;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(this[i],node,i);if(hasScripts){doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl&&jQuery._evalUrl(node.src):jQuery.globalEval(node.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");return elem.detach(),display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement),doc=iframe[0].contentDocument,doc.write(),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach();elemdisplay[nodeName]=display}return display}var rmargin=/^margin/,rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){return elem.ownerDocument.defaultView.opener?elem.ownerDocument.defaultView.getComputedStyle(elem,null):window.getComputedStyle(elem,null)};function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return computed=computed||getStyles(elem),computed&&(ret=computed.getPropertyValue(name)||computed[name]),computed&&(ret===""&&!jQuery.contains(elem.ownerDocument,elem)&&(ret=jQuery.style(elem,name)),rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}(function(){var pixelPositionVal,boxSizingReliableVal,docElem=document.documentElement,container=document.createElement("div"),div=document.createElement("div");if(!div.style)return;div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle=div.style.backgroundClip==="content-box",container.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",container.appendChild(div);function computePixelPositionAndBoxSizingReliable(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",div.innerHTML="",docElem.appendChild(container);var divStyle=window.getComputedStyle(div,null);pixelPositionVal=divStyle.top!=="1%",boxSizingReliableVal=divStyle.width==="4px",docElem.removeChild(container)}window.getComputedStyle&&jQuery.extend(support,{pixelPosition:function(){return computePixelPositionAndBoxSizingReliable(),pixelPositionVal},boxSizingReliable:function(){return boxSizingReliableVal==null&&computePixelPositionAndBoxSizingReliable(),boxSizingReliableVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));return marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",marginDiv.style.marginRight=marginDiv.style.width="0",div.style.width="1px",docElem.appendChild(container),ret=!parseFloat(window.getComputedStyle(marginDiv,null).marginRight),docElem.removeChild(container),div.removeChild(marginDiv),ret}})})(),jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style)return name;var capName=name[0].toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style)return name}return origName}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2)extra==="margin"&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?(extra==="content"&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),extra!=="margin"&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),extra!=="padding"&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",!1,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null)val=elem.style[name];if(rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style)continue;values[index]=data_priv.get(elem,"olddisplay"),display=elem.style.display,show?(!values[index]&&display==="none"&&(elem.style.display=""),elem.style.display===""&&isHidden(elem)&&(values[index]=data_priv.access(elem,"olddisplay",defaultDisplay(elem.nodeName)))):(hidden=isHidden(elem),(display!=="none"||!hidden)&&data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display")))}for(index=0;index<length;index++){elem=elements[index];if(!elem.style)continue;if(!show||elem.style.display==="none"||elem.style.display==="")elem.style.display=show?values[index]||"":"none"}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style)return;var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name];type=typeof value,type==="string"&&(ret=rrelNum.exec(value))&&(value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name)),type="number");if(value==null||value!==value)return;type==="number"&&!jQuery.cssNumber[origName]&&(value+="px"),!support.clearCloneStyle&&value===""&&name.indexOf("background")===0&&(style[name]="inherit");if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined)style[name]=value},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),val===undefined&&(val=curCSS(elem,name,styles)),val==="normal"&&name in cssNormalTransform&&(val=cssNormalTransform[name]),extra===""||extra?(num=parseFloat(val),extra===!0||jQuery.isNumeric(num)?num||0:val):val}}),jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed)return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",!1,styles)==="border-box",styles):0)}}}),jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed)return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value=="string"?value.split(" "):[value];for(;i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem),len=name.length;for(;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return typeof state=="boolean"?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||"swing",this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return tween.elem[tween.prop]==null||!!tween.elem.style&&tween.elem.style[tween.prop]!=null?(result=jQuery.css(tween.elem,tween.prop,""),!result||result==="auto"?0:result):tween.elem[tween.prop]},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3],parts=parts||[],start=+target||1;do scale=scale||".5",start/=scale,jQuery.style(tween.elem,prop,start+unit);while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}return parts&&(start=tween.start=+start||+target||0,tween.unit=unit,tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]),tween}]};function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),hooks.unqueued==null&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),elem.nodeType===1&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],display=jQuery.css(elem,"display"),checkDisplay=display==="none"?data_priv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display,checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"&&(style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop],toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value!=="show"||!dataShow||dataShow[prop]===undefined)continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else display=undefined}if(!jQuery.isEmptyObject(orig)){dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=data_priv.access(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start=prop==="width"||prop==="height"?1:0))}else(display==="none"?defaultDisplay(elem.nodeName):display)==="inline"&&(style.display=display)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;stopped=!0;for(;index<length;index++)animation.tweens[index].run(1);return gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result)return result}return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.split(" ");var prop,index=0,length=props.length;for(;index<length;index++)prop=props[index],tweeners[prop]=tweeners[prop]||[],tweeners[prop].unshift(callback)},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed=="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration=="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===!0)opt.queue="fx";return opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||data_priv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return typeof type!="string"&&(gotoEnd=clearQueue,clearQueue=type,type=undefined),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem===this&&(type==null||timers[index].queue===type)&&(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})},finish:function(type){return type!==!1&&(type=type||"fx"),this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0);for(index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed=="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++)timer=timers[i],!timer()&&timers[i]===timer&&timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),timer()?jQuery.fx.start():jQuery.timers.pop()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=input.value!=="",support.optSelected=opt.selected,select.disabled=!0,support.optDisabled=!opt.disabled,input=document.createElement("input"),input.value="t",input.type="radio",support.radioValue=input.value==="t"}();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2)return;if(typeof elem.getAttribute===strundefined)return jQuery.prop(elem,name,value);if(nType!==1||!jQuery.isXMLDoc(elem))name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook);if(value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:(ret=jQuery.find.attr(elem,name),ret==null?undefined:ret);if(value!==null)return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem.setAttribute(name,value+""),value);jQuery.removeAttr(elem,name)},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1)while(name=attrNames[i++])propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)&&(elem[propName]=!1),elem.removeAttribute(name)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}}}),boolHook={set:function(elem,value,name){return value===!1?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;return isXML||(handle=attrHandle[name],attrHandle[name]=ret,ret=getter(elem,name,isXML)!=null?name.toLowerCase():null,attrHandle[name]=handle),ret}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}}),jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2)return;return notxml=nType!==1||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=typeof value=="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i],cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++])cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");finalValue=jQuery.trim(cur),elem.className!==finalValue&&(elem.className=finalValue)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=arguments.length===0||typeof value=="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i],cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++])while(cur.indexOf(" "+clazz+" ")>=0)cur=cur.replace(" "+clazz+" "," ");finalValue=value?jQuery.trim(cur):"",elem.className!==finalValue&&(elem.className=finalValue)}}}return this},toggleClass:function(value,stateVal){var type=typeof value;return typeof stateVal=="boolean"&&type==="string"?stateVal?this.addClass(value):this.removeClass(value):jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}):this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++])self.hasClass(className)?self.removeClass(className):self.addClass(className)}else if(type===strundefined||type==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||value===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++)if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined?ret:(ret=elem.value,typeof ret=="string"?ret.replace(rreturn,""):ret==null?"":ret);return}return isFunction=jQuery.isFunction(value),this.each(function(i){var val;if(this.nodeType!==1)return;isFunction?val=value.call(this,i,jQuery(this).val()):val=value,val==null?val="":typeof val=="number"?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return value==null?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined)this.value=val})}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one)return value;values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(option.value,values)>=0)optionSet=!0}return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value})}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now(),rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")},jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!="string")return null;try{tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}return(!xml||xml.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+data),xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=window.location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){typeof dataTypeExpression!="string"&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func))while(dataType=dataTypes[i++])dataType[0]==="+"?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport=="string"&&!seekingTransport&&!inspected[dataTypeOrTransport])return options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1;if(seekingTransport)return!(selected=dataTypeOrTransport)}),selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)src[key]!==undefined&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*")dataTypes.shift(),ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];current=dataTypes.shift();while(current){s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift();if(current)if(current==="*")current=prev;else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv)for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}}}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){typeof url=="object"&&(options=url,url=undefined),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString))responseHeaders[match[1].toLowerCase()]=match[2]}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(state<2)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""],s.crossDomain==null&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||parts[1]===ajaxLocParts[1]&&parts[2]===ajaxLocParts[2]&&(parts[3]||(parts[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),s.data&&s.processData&&typeof s.data!="string"&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2)return jqXHR;fireGlobals=jQuery.event&&s.global,fireGlobals&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(!s.beforeSend||s.beforeSend.call(callbackContext,jqXHR,s)!==!1&&state!==2){strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport)done(-1,"No Transport");else{jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(state<2))throw e;done(-1,e)}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2)return;state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=undefined,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&status<300||status===304,responses&&(response=ajaxHandleResponses(s,jqXHR,responses)),response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess)s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[cacheURL]=modified),modified=jqXHR.getResponseHeader("etag"),modified&&(jQuery.etag[cacheURL]=modified)),status===204||s.type==="HEAD"?statusText="nocontent":status===304?statusText="notmodified":(statusText=response.state,success=response.data,error=response.error,isSuccess=!error);else{error=statusText;if(status||!statusText)statusText="error",status<0&&(status=0)}jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=undefined,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}return jqXHR}return jqXHR.abort()},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=undefined),jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},jQuery.fn.extend({wrapAll:function(html){var wrap;return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapAll(html.call(this,i))}):(this[0]&&(wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){var elem=this;while(elem.firstElementChild)elem=elem.firstElementChild;return elem}).append(this)),this)},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}}),jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+(typeof v=="object"?i:"")+"]",v,traditional,add)});else if(!traditional&&jQuery.type(obj)==="object")for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};traditional===undefined&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();window.attachEvent&&window.attachEvent("onunload",function(){for(var key in xhrCallbacks)xhrCallbacks[key]()}),support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var callback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),!options.crossDomain&&!headers["X-Requested-With"]&&(headers["X-Requested-With"]="XMLHttpRequest");for(i in headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(delete xhrCallbacks[id],callback=xhr.onload=xhr.onerror=null,type==="abort"?xhr.abort():type==="error"?complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText=="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders()))}},xhr.onload=callback(),xhr.onerror=callback("error"),callback=xhrCallbacks[id]=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback)throw e}},abort:function(){callback&&callback()}}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1),s.crossDomain&&(s.type="GET")}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:!0,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove(),callback=null,evt&&complete(evt.type==="error"?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":typeof s.data=="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp")return callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=undefined}),"script"}),jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!="string")return null;typeof context=="boolean"&&(keepScripts=context,context=!1),context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=jQuery.buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!="string"&&_load)return _load.apply(this,arguments);var selector,type,response,self=this,off=url.indexOf(" ");return off>=0&&(selector=jQuery.trim(url.slice(off)),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=undefined):params&&typeof params=="object"&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};position==="static"&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1,calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),options.top!=null&&(props.top=options.top-curOffset.top+curTop),options.left!=null&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc)return;return docElem=doc.documentElement,jQuery.contains(docElem,elem)?(typeof elem.getBoundingClientRect!==strundefined&&(box=elem.getBoundingClientRect()),win=getWindow(doc),{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}):box},position:function(){if(!this[0])return;var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};return jQuery.css(elem,"position")==="fixed"?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")offsetParent=offsetParent.offsetParent;return offsetParent||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined)return win?win[prop]:elem[method];win?win.scrollTo(top?window.pageXOffset:val,top?val:window.pageYOffset):elem[method]=val},method,val,arguments.length,null)}}),jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!="boolean"),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:elem.nodeType===9?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},typeof noGlobal===strundefined&&(window.jQuery=window.$=jQuery),jQuery});var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,5)}}(),etch;(function(etch){var engine;(function(engine){var ClockTimer=function(){function ClockTimer(){this._Listeners=[],this._LastTime=0}return ClockTimer.prototype.RegisterTimer=function(listener){var ls=this._Listeners,index=ls.indexOf(listener);if(index>-1)return;ls.push(listener),ls.length===1&&this._RequestAnimationTick()},ClockTimer.prototype.UnregisterTimer=function(listener){var ls=this._Listeners,index=ls.indexOf(listener);index>-1&&ls.splice(index,1)},ClockTimer.prototype._DoTick=function(){var nowTime=(new Date).getTime(),lastTime=this._LastTime;this._LastTime=nowTime;var ls=this._Listeners,len=ls.length;if(len===0)return;for(var i=0;i<len;i++)ls[i].OnTicked(lastTime,nowTime);this._RequestAnimationTick()},ClockTimer.prototype._RequestAnimationTick=function(){var _this=this;requestAnimFrame(function(){return _this._DoTick()})},ClockTimer}();engine.ClockTimer=ClockTimer})(engine=etch.engine||(etch.engine={}))})(etch||(etch={}));var etch;(function(etch){var primitives;(function(primitives){var Vector=function(){function Vector(x,y){this.x=x,this.y=y}return Vector.prototype.Get=function(){return new Vector(this.x,this.y)},Vector.prototype.Set=function(x,y){this.x=x,this.y=y},Vector.prototype.Add=function(v){this.x+=v.x,this.y+=v.y},Vector.Add=function(v1,v2){return new Vector(v1.x+v2.x,v1.y+v2.y)},Vector.prototype.Clone=function(){return new Vector(this.x,this.y)},Vector.LERP=function(start,end,p){var x=start.x+(end.x-start.x)*p,y=start.y+(end.y-start.y)*p;return new Vector(x,y)},Vector.prototype.Sub=function(v){this.x-=v.x,this.y-=v.y},Vector.Sub=function(v1,v2){return new Vector(v1.x-v2.x,v1.y-v2.y)},Vector.prototype.Mult=function(n){this.x=this.x*n,this.y=this.y*n},Vector.Mult=function(v1,v2){return new Vector(v1.x*v2.x,v1.y*v2.y)},Vector.MultN=function(v1,n){return new Vector(v1.x*n,v1.y*n)},Vector.prototype.Div=function(n){this.x=this.x/n,this.y=this.y/n},Vector.Div=function(v1,v2){return new Vector(v1.x/v2.x,v1.y/v2.y)},Vector.DivN=function(v1,n){return new Vector(v1.x/n,v1.y/n)},Vector.prototype.Mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector.prototype.MagSq=function(){return this.x*this.x+this.y*this.y},Vector.prototype.Normalize=function(){var m=this.Mag();m!=0&&m!=1&&this.Div(m)},Vector.prototype.Limit=function(max){this.MagSq()>max*max&&(this.Normalize(),this.Mult(max))},Vector.prototype.Heading=function(){var angle=Math.atan2(-this.y,this.x);return-1*angle},Vector.Random2D=function(){return Vector.FromAngle(Math.random()*Math.TAU)},Vector.FromAngle=function(angle){return new Vector(Math.cos(angle),Math.sin(angle))},Vector.prototype.ToPoint=function(){return new primitives.Point(this.x,this.y)},Vector}();primitives.Vector=Vector})(primitives=etch.primitives||(etch.primitives={}))})(etch||(etch={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},etch;(function(etch){var exceptions;(function(exceptions){var Exception=function(){function Exception(message){this.Message=message}return Exception.prototype.toString=function(){var typeName=this.constructor.name;return typeName?typeName+": "+this.Message:this.Message},Exception}();exceptions.Exception=Exception;var ArgumentException=function(_super){__extends(ArgumentException,_super);function ArgumentException(message){_super.call(this,message)}return ArgumentException}(Exception);exceptions.ArgumentException=ArgumentException;var ArgumentNullException=function(_super){__extends(ArgumentNullException,_super);function ArgumentNullException(message){_super.call(this,message)}return ArgumentNullException}(Exception);exceptions.ArgumentNullException=ArgumentNullException;var InvalidOperationException=function(_super){__extends(InvalidOperationException,_super);function InvalidOperationException(message){_super.call(this,message)}return InvalidOperationException}(Exception);exceptions.InvalidOperationException=InvalidOperationException;var NotSupportedException=function(_super){__extends(NotSupportedException,_super);function NotSupportedException(message){_super.call(this,message)}return NotSupportedException}(Exception);exceptions.NotSupportedException=NotSupportedException;var IndexOutOfRangeException=function(_super){__extends(IndexOutOfRangeException,_super);function IndexOutOfRangeException(index){_super.call(this,index.toString())}return IndexOutOfRangeException}(Exception);exceptions.IndexOutOfRangeException=IndexOutOfRangeException;var ArgumentOutOfRangeException=function(_super){__extends(ArgumentOutOfRangeException,_super);function ArgumentOutOfRangeException(msg){_super.call(this,msg)}return ArgumentOutOfRangeException}(Exception);exceptions.ArgumentOutOfRangeException=ArgumentOutOfRangeException;var AttachException=function(_super){__extends(AttachException,_super);function AttachException(message,data){_super.call(this,message),this.Data=data}return AttachException}(Exception);exceptions.AttachException=AttachException;var InvalidJsonException=function(_super){__extends(InvalidJsonException,_super);function InvalidJsonException(jsonText,innerException){_super.call(this,"Invalid json."),this.JsonText=jsonText,this.InnerException=innerException}return InvalidJsonException}(Exception);exceptions.InvalidJsonException=InvalidJsonException;var TargetInvocationException=function(_super){__extends(TargetInvocationException,_super);function TargetInvocationException(message,innerException){_super.call(this,message),this.InnerException=innerException}return TargetInvocationException}(Exception);exceptions.TargetInvocationException=TargetInvocationException;var UnknownTypeException=function(_super){__extends(UnknownTypeException,_super);function UnknownTypeException(fullTypeName){_super.call(this,fullTypeName),this.FullTypeName=fullTypeName}return UnknownTypeException}(Exception);exceptions.UnknownTypeException=UnknownTypeException;var FormatException=function(_super){__extends(FormatException,_super);function FormatException(message){_super.call(this,message)}return FormatException}(Exception);exceptions.FormatException=FormatException})(exceptions=etch.exceptions||(etch.exceptions={}))})(etch||(etch={}));var etch;(function(etch){var collections;(function(collections){var ObservableCollection=function(){function ObservableCollection(){this._ht=[],this.CollectionChanged=new nullstone.Event,this.PropertyChanged=new nullstone.Event}return ObservableCollection.prototype.getEnumerator=function(){return nullstone.IEnumerator_.fromArray(this._ht)},Object.defineProperty(ObservableCollection.prototype,"Count",{get:function(){return this._ht.length},enumerable:!0,configurable:!0}),ObservableCollection.prototype.ToArray=function(){return this._ht.slice(0)},ObservableCollection.prototype.GetValueAt=function(index){var ht=this._ht;if(index<0||index>=ht.length)throw new etch.exceptions.IndexOutOfRangeException(index);return ht[index]},ObservableCollection.prototype.SetValueAt=function(index,value){var ht=this._ht;if(index<0||index>=ht.length)throw new etch.exceptions.IndexOutOfRangeException(index);var oldValue=ht[index];ht[index]=value,this.CollectionChanged.raise(this,CollectionChangedEventArgs.Replace(value,oldValue,index))},ObservableCollection.prototype.Add=function(value){var index=this._ht.push(value)-1;this.CollectionChanged.raise(this,CollectionChangedEventArgs.Add(value,index)),this._RaisePropertyChanged("Count")},ObservableCollection.prototype.AddRange=function(values){var index=this._ht.length,len=values.length;for(var i=0;i<len;i++)this._ht.push(values[i]);this.CollectionChanged.raise(this,CollectionChangedEventArgs.AddRange(values,index)),this._RaisePropertyChanged("Count")},ObservableCollection.prototype.Insert=function(index,value){var ht=this._ht;if(index<0||index>ht.length)throw new etch.exceptions.IndexOutOfRangeException(index);index>=ht.length?ht.push(value):ht.splice(index,0,value),this.CollectionChanged.raise(this,CollectionChangedEventArgs.Add(value,index)),this._RaisePropertyChanged("Count")},ObservableCollection.prototype.IndexOf=function(value){return this._ht.indexOf(value)},ObservableCollection.prototype.Contains=function(value){return this._ht.indexOf(value)>-1},ObservableCollection.prototype.Remove=function(value){var index=this._ht.indexOf(value);return index<0?!1:(this._ht.splice(index,1),this.CollectionChanged.raise(this,CollectionChangedEventArgs.Remove(value,index)),this._RaisePropertyChanged("Count"),!0)},ObservableCollection.prototype.RemoveAt=function(index){if(index<0||index>=this._ht.length)throw new etch.exceptions.IndexOutOfRangeException(index);var item=this._ht.splice(index,1)[0];this.CollectionChanged.raise(this,CollectionChangedEventArgs.Remove(item,index)),this._RaisePropertyChanged("Count")},ObservableCollection.prototype.Clear=function(){var old=this._ht;this._ht=[],this.CollectionChanged.raise(this,CollectionChangedEventArgs.Reset(old)),this._RaisePropertyChanged("Count")},ObservableCollection.prototype._RaisePropertyChanged=function(propertyName){this.PropertyChanged.raise(this,new collections.PropertyChangedEventArgs(propertyName))},ObservableCollection}();collections.ObservableCollection=ObservableCollection})(collections=etch.collections||(etch.collections={}))})(etch||(etch={}));var etch;(function(etch){var collections;(function(collections){var PropertyChangedEventArgs=function(){function PropertyChangedEventArgs(propertyName){Object.defineProperty(this,"PropertyName",{value:propertyName,writable:!1})}return PropertyChangedEventArgs}();collections.PropertyChangedEventArgs=PropertyChangedEventArgs,collections.INotifyPropertyChanged_=new nullstone.Interface("INotifyPropertyChanged"),collections.INotifyPropertyChanged_.is=function(o){return o&&o.PropertyChanged instanceof nullstone.Event}})(collections=etch.collections||(etch.collections={}))})(etch||(etch={}));var Size=minerva.Size,etch;(function(etch){var drawing;(function(drawing){var Canvas=function(){function Canvas(){this.IsCached=!1,this.HTMLElement=document.createElement("canvas"),document.body.appendChild(this.HTMLElement)}return Object.defineProperty(Canvas.prototype,"Ctx",{get:function(){return this.HTMLElement.getContext("2d")},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"Width",{get:function(){return this.Ctx.canvas.width},set:function(value){this.Ctx.canvas.width=value},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"Height",{get:function(){return this.Ctx.canvas.height},set:function(value){this.Ctx.canvas.height=value},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"Size",{get:function(){return new Size(this.Width,this.Height)},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"Style",{get:function(){return this.Ctx.canvas.style},enumerable:!0,configurable:!0}),Canvas}();drawing.Canvas=Canvas})(drawing=etch.drawing||(etch.drawing={}))})(etch||(etch={}));var etch;(function(etch){var drawing;(function(drawing){var DisplayObject=function(){function DisplayObject(){this._DisplayList=new drawing.DisplayObjectCollection,this.FrameCount=-1,this.IsCached=!1,this.IsInitialised=!1,this.IsPaused=!1,this.IsVisible=!0}return DisplayObject.prototype.Init=function(drawTo,drawFrom){this.DrawTo=drawTo,drawFrom&&(this.DrawFrom=drawFrom),this.IsInitialised=!0,this.Setup(),this.Resize()},Object.defineProperty(DisplayObject.prototype,"Ctx",{get:function(){return this.DrawTo.Ctx},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"CanvasWidth",{get:function(){return this.Ctx.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"CanvasHeight",{get:function(){return this.Ctx.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"DisplayList",{get:function(){return this._DisplayList},set:function(value){this._DisplayList=value},enumerable:!0,configurable:!0}),DisplayObject.prototype.Setup=function(){},DisplayObject.prototype.Update=function(){},DisplayObject.prototype.Draw=function(){},DisplayObject.prototype.IsFirstFrame=function(){return this.FrameCount===0},DisplayObject.prototype.Dispose=function(){},DisplayObject.prototype.Play=function(){this.IsPaused=!1},DisplayObject.prototype.Pause=function(){this.IsPaused=!0},DisplayObject.prototype.Resize=function(){},DisplayObject.prototype.Show=function(){this.IsVisible=!0},DisplayObject.prototype.Hide=function(){this.IsVisible=!1},DisplayObject}();drawing.DisplayObject=DisplayObject})(drawing=etch.drawing||(etch.drawing={}))})(etch||(etch={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},ObservableCollection=etch.collections.ObservableCollection,etch;(function(etch){var drawing;(function(drawing){var DisplayObjectCollection=function(_super){__extends(DisplayObjectCollection,_super);function DisplayObjectCollection(){var _this=this;_super.call(this),this.CollectionChanged.on(function(){for(var i=0;i<_this.Count;i++){var obj=_this.GetValueAt(i);obj.ZIndex=i}},this)}return DisplayObjectCollection.prototype.Swap=function(obj1,obj2){var obj1Index=this.IndexOf(obj1),obj2Index=this.IndexOf(obj2);this.SetIndex(obj1,obj2Index),this.SetIndex(obj2,obj1Index)},DisplayObjectCollection.prototype.ToFront=function(obj){var index=0;this.Count>0&&(index=this.Count-1),this.SetIndex(obj,index)},DisplayObjectCollection.prototype.ToBack=function(obj){this.SetIndex(obj,0)},DisplayObjectCollection.prototype.SetIndex=function(obj,index){if(index>this.Count||index<0)throw new etch.exceptions.Exception("index out of range");this.Remove(obj),this.Insert(index,obj)},Object.defineProperty(DisplayObjectCollection.prototype,"Bottom",{get:function(){return this.GetValueAt(0)},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayObjectCollection.prototype,"Top",{get:function(){return this.GetValueAt(this.Count-1)},enumerable:!0,configurable:!0}),DisplayObjectCollection}(ObservableCollection);drawing.DisplayObjectCollection=DisplayObjectCollection})(drawing=etch.drawing||(etch.drawing={}))})(etch||(etch={}));var DisplayObjectCollection=etch.drawing.DisplayObjectCollection,Point=etch.primitives.Point,__extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},ClockTimer=etch.engine.ClockTimer,DisplayObject=etch.drawing.DisplayObject,MAX_FPS=100,MAX_MSPF=1e3/MAX_FPS,etch;(function(etch){var drawing;(function(drawing){var Stage=function(_super){__extends(Stage,_super);function Stage(){_super.apply(this,arguments),this.LastVisualTick=(new Date(0)).getTime(),this.Updated=new nullstone.Event,this.Drawn=new nullstone.Event}return Stage.prototype.Init=function(drawTo){_super.prototype.Init.call(this,drawTo),this.Timer=new ClockTimer,this.Timer.RegisterTimer(this)},Stage.prototype.OnTicked=function(lastTime,nowTime){var now=(new Date).getTime();if(now-this.LastVisualTick<MAX_MSPF)return;this.LastVisualTick=now,this.Ctx.clearRect(0,0,this.Ctx.canvas.width,this.Ctx.canvas.height),this.UpdateDisplayList(this.DisplayList),this.Updated.raise(this,this.LastVisualTick),this.DrawDisplayList(this.DisplayList),this.Drawn.raise(this,this.LastVisualTick)},Stage.prototype.UpdateDisplayList=function(displayList){for(var i=0;i<displayList.Count;i++){var displayObject=displayList.GetValueAt(i);displayObject.FrameCount++,displayObject.LastVisualTick=this.LastVisualTick,displayObject.IsPaused||displayObject.Update(),this.UpdateDisplayList(displayObject.DisplayList)}},Stage.prototype.DrawDisplayList=function(displayList){for(var i=0;i<displayList.Count;i++){var displayObject=displayList.GetValueAt(i);displayObject.IsVisible&&displayObject.Draw(),this.DrawDisplayList(displayObject.DisplayList)}},Stage.prototype.ResizeDisplayList=function(displayList){for(var i=0;i<displayList.Count;i++){var displayObject=displayList.GetValueAt(i);displayObject.Resize(),this.ResizeDisplayList(displayObject.DisplayList)}},Stage.prototype.Resize=function(){_super.prototype.Resize.call(this),this.ResizeDisplayList(this.DisplayList)},Stage}(drawing.DisplayObject);drawing.Stage=Stage})(drawing=etch.drawing||(etch.drawing={}))})(etch||(etch={}));var etch;(function(etch){var events;(function(events){(function(CollectionChangedAction){CollectionChangedAction[CollectionChangedAction.Add=1]="Add",CollectionChangedAction[CollectionChangedAction.Remove=2]="Remove",CollectionChangedAction[CollectionChangedAction.Replace=3]="Replace",CollectionChangedAction[CollectionChangedAction.Reset=4]="Reset"})(events.CollectionChangedAction||(events.CollectionChangedAction={}));var CollectionChangedAction=events.CollectionChangedAction,CollectionChangedEventArgs=function(){function CollectionChangedEventArgs(){}return CollectionChangedEventArgs.Reset=function(allValues){var args=new CollectionChangedEventArgs;return Object.defineProperty(args,"Action",{value:CollectionChangedAction.Reset,writable:!1}),Object.defineProperty(args,"OldStartingIndex",{value:0,writable:!1}),Object.defineProperty(args,"NewStartingIndex",{value:-1,writable:!1}),Object.defineProperty(args,"OldItems",{value:allValues,writable:!1}),Object.defineProperty(args,"NewItems",{value:null,writable:!1}),args},CollectionChangedEventArgs.Replace=function(newValue,oldValue,index){var args=new CollectionChangedEventArgs;return Object.defineProperty(args,"Action",{value:CollectionChangedAction.Replace,writable:!1}),Object.defineProperty(args,"OldStartingIndex",{value:-1,writable:!1}),Object.defineProperty(args,"NewStartingIndex",{value:index,writable:!1}),Object.defineProperty(args,"OldItems",{value:[oldValue],writable:!1}),Object.defineProperty(args,"NewItems",{value:[newValue],writable:!1}),args},CollectionChangedEventArgs.Add=function(newValue,index){var args=new CollectionChangedEventArgs;return Object.defineProperty(args,"Action",{value:CollectionChangedAction.Add,writable:!1}),Object.defineProperty(args,"OldStartingIndex",{value:-1,writable:!1}),Object.defineProperty(args,"NewStartingIndex",{value:index,writable:!1}),Object.defineProperty(args,"OldItems",{value:null,writable:!1}),Object.defineProperty(args,"NewItems",{value:[newValue],writable:!1}),args},CollectionChangedEventArgs.AddRange=function(newValues,index){var args=new CollectionChangedEventArgs;return Object.defineProperty(args,"Action",{value:CollectionChangedAction.Add,writable:!1}),Object.defineProperty(args,"OldStartingIndex",{value:-1,writable:!1}),Object.defineProperty(args,"NewStartingIndex",{value:index,writable:!1}),Object.defineProperty(args,"OldItems",{value:null,writable:!1}),Object.defineProperty(args,"NewItems",{value:newValues,writable:!1}),args},CollectionChangedEventArgs.Remove=function(oldValue,index){var args=new CollectionChangedEventArgs;return Object.defineProperty(args,"Action",{value:CollectionChangedAction.Remove,writable:!1}),Object.defineProperty(args,"OldStartingIndex",{value:index,writable:!1}),Object.defineProperty(args,"NewStartingIndex",{value:-1,writable:!1}),Object.defineProperty(args,"OldItems",{value:[oldValue],writable:!1}),Object.defineProperty(args,"NewItems",{value:null,writable:!1}),args},CollectionChangedEventArgs}();events.CollectionChangedEventArgs=CollectionChangedEventArgs})(events=etch.events||(etch.events={}))})(etch||(etch={}));var CollectionChangedEventArgs=etch.events.CollectionChangedEventArgs,etch;(function(etch){var events;(function(events){events.INotifyCollectionChanged_=new nullstone.Interface("INotifyCollectionChanged"),events.INotifyCollectionChanged_.is=function(o){return o&&o.CollectionChanged instanceof nullstone.Event}})(events=etch.events||(etch.events={}))})(etch||(etch={}));var etch;(function(etch){var events;(function(events){var PropertyChangedEventArgs=function(){function PropertyChangedEventArgs(propertyName){Object.defineProperty(this,"PropertyName",{value:propertyName,writable:!1})}return PropertyChangedEventArgs}();events.PropertyChangedEventArgs=PropertyChangedEventArgs,events.INotifyPropertyChanged_=new nullstone.Interface("INotifyPropertyChanged"),events.INotifyPropertyChanged_.is=function(o){return o&&o.PropertyChanged instanceof nullstone.Event}})(events=etch.events||(etch.events={}))})(etch||(etch={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},RoutedEventArgs=etch.events.RoutedEventArgs,etch;(function(etch){var events;(function(events){var RoutedEvent=function(_super){__extends(RoutedEvent,_super);function RoutedEvent(){_super.apply(this,arguments)}return RoutedEvent}(nullstone.Event);events.RoutedEvent=RoutedEvent})(events=etch.events||(etch.events={}))})(etch||(etch={}));var etch;(function(etch){var events;(function(events){var RoutedEventArgs=function(){function RoutedEventArgs(){this.Handled=!1,this.Source=null,this.OriginalSource=null}return RoutedEventArgs}();events.RoutedEventArgs=RoutedEventArgs})(events=etch.events||(etch.events={}))})(etch||(etch={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},etch;(function(etch){var primitives;(function(primitives){var Point=function(_super){__extends(Point,_super);function Point(){_super.apply(this,arguments)}return Point.prototype.Clone=function(){return new Point(this.x,this.y)},Point.prototype.ToVector=function(){return new primitives.Vector(this.x,this.y)},Point}(minerva.Point);primitives.Point=Point})(primitives=etch.primitives||(etch.primitives={}))})(etch||(etch={})),define("etch",function(){});var exjs;(function(exjs){exjs.version="0.2.15"})(exjs||(exjs={}));var exjs;(function(exjs){Array.isArray||(Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"})})(exjs||(exjs={}));var exjs;(function(exjs){var Enumerable=function(){function Enumerable(){}return Enumerable.prototype.getEnumerator=function(){return{moveNext:function(){return!1},current:undefined}},Enumerable.prototype.aggregate=function(seed,accumulator){var active=seed;for(var enumerator=this.getEnumerator();enumerator.moveNext();)active=accumulator(active,enumerator.current);return active},Enumerable.prototype.all=function(predicate){if(predicate){var e=this.getEnumerator(),i=0;while(e.moveNext()){if(!predicate(e.current,i))return!1;i++}}return!0},Enumerable.prototype.any=function(predicate){var e=this.getEnumerator(),i=0;while(e.moveNext()){if(!predicate)return!0;if(predicate(e.current,i))return!0;i++}return!1},Enumerable.prototype.apply=function(action){throw new Error("Not implemented")},Enumerable.prototype.at=function(index){var e=this.getEnumerator(),i=0;while(e.moveNext()){if(i===index)return e.current;i++}return undefined},Enumerable.prototype.average=function(selector){var count=0,total=0;selector=selector||function(t){if(typeof t!="number")throw new Error("Object is not a number.");return t};var e=this.getEnumerator();while(e.moveNext())total+=selector(e.current),count++;return count===0?0:total/count},Enumerable.prototype.concat=function(second){throw new Error("Not implemented")},Enumerable.prototype.count=function(predicate){var count=0,e=this.getEnumerator();while(e.moveNext())(!predicate||predicate(e.current))&&count++;return count},Enumerable.prototype.difference=function(second,comparer){return comparer=comparer||function(f2,s2){return f2===s2},second instanceof Array&&(second=second.en()),{intersection:this.intersect(second,comparer).toArray().en(),aNotB:this.except(second,comparer).toArray().en(),bNotA:second.except(this,comparer).toArray().en()}},Enumerable.prototype.distinct=function(comparer){throw new Error("Not implemented")},Enumerable.prototype.except=function(second,comparer){throw new Error("Not implemented")},Enumerable.prototype.first=function(match){var e=this.getEnumerator();while(e.moveNext())if(!match||match(e.current))return e.current;return undefined},Enumerable.prototype.firstIndex=function(match){for(var e=this.getEnumerator(),i=0;e.moveNext();i++)if(!match||match(e.current))return i;return-1},Enumerable.prototype.forEach=function(action){for(var en=this.getEnumerator();en.moveNext();)action(en.current)},Enumerable.prototype.groupBy=function(keySelector,comparer){throw new Error("Not implemented")},Enumerable.prototype.intersect=function(second,comparer){throw new Error("Not implemented")},Enumerable.prototype.join=function(inner,outerKeySelector,innerKeySelector,resultSelector,comparer){throw new Error("Not implemented")},Enumerable.prototype.last=function(match){var e=this.getEnumerator(),l;while(e.moveNext())if(!match||match(e.current))l=e.current;return l},Enumerable.prototype.lastIndex=function(match){var j=-1;for(var e=this.getEnumerator(),i=0;e.moveNext();i++)if(!match||match(e.current))j=i;return j},Enumerable.prototype.max=function(selector){var e=this.getEnumerator();if(!e.moveNext())return 0;selector=selector||function(t){if(typeof t!="number")throw new Error("Object is not a number.");return t};var max=selector(e.current);while(e.moveNext())max=Math.max(max,selector(e.current));return max},Enumerable.prototype.min=function(selector){var e=this.getEnumerator();if(!e.moveNext())return 0;selector=selector||function(t){if(typeof t!="number")throw new Error("Object is not a number.");return t};var min=selector(e.current);while(e.moveNext())min=Math.min(min,selector(e.current));return min},Enumerable.prototype.orderBy=function(keySelector,comparer){throw new Error("Not implemented")},Enumerable.prototype.orderByDescending=function(keySelector,comparer){throw new Error("Not implemented")},Enumerable.prototype.reverse=function(){throw new Error("Not implemented")},Enumerable.prototype.select=function(selector){throw new Error("Not implemented")},Enumerable.prototype.selectMany=function(selector){throw new Error("Not implemented")},Enumerable.prototype.skip=function(count){throw new Error("Not implemented")},Enumerable.prototype.skipWhile=function(predicate){throw new Error("Not implemented")},Enumerable.prototype.standardDeviation=function(selector){var avg=this.average(selector),sum=0,count=0;selector=selector||function(t){if(typeof t!="number")throw new Error("Object is not a number.");return t};var e=this.getEnumerator();while(e.moveNext()){var diff=selector(e.current)-avg;sum+=diff*diff,count++}return Math.sqrt(sum/count)},Enumerable.prototype.sum=function(selector){var sum=0;selector=selector||function(t){if(typeof t!="number")throw new Error("Object is not a number.");return t};var e=this.getEnumerator();while(e.moveNext())sum+=selector(e.current);return sum},Enumerable.prototype.take=function(count){throw new Error("Not implemented")},Enumerable.prototype.takeWhile=function(predicate){throw new Error("Not implemented")},Enumerable.prototype.traverse=function(selector){throw new Error("Not implemented")},Enumerable.prototype.traverseUnique=function(selector,matcher){throw new Error("Not implemented")},Enumerable.prototype.toArray=function(){var arr=[],enumerator=this.getEnumerator();while(enumerator.moveNext())arr.push(enumerator.current);return arr},Enumerable.prototype.toMap=function(keySelector,valueSelector){var m=new exjs.Map;for(var en=this.getEnumerator();en.moveNext();)m.set(keySelector(en.current),valueSelector(en.current));return m},Enumerable.prototype.toList=function(){throw new Error("Not implemented")},Enumerable.prototype.union=function(second,comparer){throw new Error("Not implemented")},Enumerable.prototype.where=function(filter){throw new Error("Not implemented")},Enumerable.prototype.zip=function(second,resultSelector){throw new Error("Not implemented")},Enumerable}();exjs.Enumerable=Enumerable})(exjs||(exjs={}));var Symbol,exjs;(function(exjs){Symbol&&Symbol.iterator&&(exjs.Enumerable.prototype[Symbol.iterator]=function(){return iteratorFromEnumerable(this)});function iteratorFromEnumerable(enu){var en;return{next:function(){var res={done:!0,value:undefined};return enu?(en=en||enu.getEnumerator(),en?(res.done=!en.moveNext(),res.value=en.current,res):res):res}}}})(exjs||(exjs={}));var exjs;(function(exjs){function applyEnumerator(prev,action){var t,i=0,e={current:undefined,moveNext:function(){return t||(t=prev.getEnumerator()),t.moveNext()?(action(e.current=t.current,i),i++,!0):!1}};return e}exjs.Enumerable.prototype.apply=function(action){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return applyEnumerator(_this,action)},e},exjs.List&&(exjs.List.prototype.apply=exjs.Enumerable.prototype.apply)})(exjs||(exjs={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}__.prototype=b.prototype,d.prototype=new __},exjs;(function(exjs){function arrayEnumerator(arr){var len=arr.length,e={moveNext:undefined,current:undefined},index=-1;return e.moveNext=function(){return index++,index>=len?(e.current=undefined,!1):(e.current=arr[index],!0)},e}var ArrayEnumerable=function(_super){__extends(ArrayEnumerable,_super);function ArrayEnumerable(arr){_super.call(this),this.getEnumerator=function(){return arrayEnumerator(arr)},this.toArray=function(){return arr.slice(0)}}return ArrayEnumerable}(exjs.Enumerable);function en(){return this&&Array.isArray(this)?new ArrayEnumerable(this):new exjs.Enumerable}try{Object.defineProperty(Array.prototype,"en",{value:en,enumerable:!1,writable:!1,configurable:!1})}catch(e){Array.prototype.en=en}})(exjs||(exjs={}));var exjs;(function(exjs){function concatEnumerator(prev,second){var t,s=!1,e={current:undefined,moveNext:function(){return t||(t=prev.getEnumerator()),e.current=undefined,t.moveNext()?(e.current=t.current,!0):s?!1:(s=!0,t=second.getEnumerator(),t.moveNext()?(e.current=t.current,!0):!1)}};return e}exjs.Enumerable.prototype.concat=function(second){var _this=this,en=second instanceof Array?second.en():second,e=new exjs.Enumerable;return e.getEnumerator=function(){return concatEnumerator(_this,en)},e},exjs.List&&(exjs.List.prototype.concat=exjs.Enumerable.prototype.concat)})(exjs||(exjs={}));var exjs;(function(exjs){function distinctEnumerator(prev,comparer){var t,visited=[],e={current:undefined,moveNext:function(){t||(t=prev.getEnumerator()),e.current=undefined;if(!comparer){while(t.moveNext())if(visited.indexOf(t.current)<0)return visited.push(e.current=t.current),!0;return!1}while(t.moveNext()){for(var i=0,len=visited.length,hit=!1;i<len&&!hit;i++)hit=!!comparer(visited[i],t.current);if(!hit)return visited.push(e.current=t.current),!0}return!1}};return e}exjs.Enumerable.prototype.distinct=function(comparer){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return distinctEnumerator(_this,comparer)},e},exjs.List&&(exjs.List.prototype.distinct=exjs.Enumerable.prototype.distinct)})(exjs||(exjs={}));var exjs;(function(exjs){function exceptEnumerator(prev,second,comparer){comparer=comparer||function(f,s){return f===s};var t,e={current:undefined,moveNext:function(){t||(t=prev.getEnumerator()),e.current=undefined;while(t.moveNext()){for(var hit=!1,x=second.getEnumerator();x.moveNext()&&!hit;)hit=comparer(t.current,x.current);if(!hit)return e.current=t.current,!0}return!1}};return e}exjs.Enumerable.prototype.except=function(second,comparer){var _this=this,en=second instanceof Array?second.en():second,e=new exjs.Enumerable;return e.getEnumerator=function(){return exceptEnumerator(_this,en,comparer)},e},exjs.List&&(exjs.List.prototype.except=exjs.Enumerable.prototype.except)})(exjs||(exjs={})),Function.prototype.fromJson=function(o,mappingOverrides){var rv=new this;if(o==null)return rv;var mapped=[];for(var key in mappingOverrides){var j=mapSubProperty(o[key],mappingOverrides[key]);if(j===undefined)continue;rv[key]=j,mapped.push(key)}for(var key in this.$jsonMappings){if(mapped.indexOf(key)>-1)continue;var j=mapSubProperty(o[key],this.$jsonMappings[key]);if(j===undefined)continue;rv[key]=j,mapped.push(key)}for(var key in o){if(mapped.indexOf(key)>-1)continue;rv[key]=o[key]}return rv;function mapSubProperty(j,mapping){if(j==null)return j;if(mapping instanceof Function)return mapping(j);if(mapping instanceof Array){mapping=mapping[0];if(mapping instanceof Function&&j instanceof Array){var arr=[];for(var i=0;i<j.length;i++)arr.push(mapping(j[i]));return arr}return undefined}return undefined}};var exjs;(function(exjs){function groupByEnumerator(prev,keySelector,comparer){var grps,i=0,e={current:undefined,moveNext:function(){return grps||(grps=createGroups(prev,keySelector,comparer)),e.current=undefined,i>=grps.length?!1:(e.current=grps[i],i++,!0)}};return e}function createGroups(prev,keySelector,comparer){comparer=comparer||function(k1,k2){return k1===k2};var grps=[],keys=[],e=prev.getEnumerator(),key;while(e.moveNext()){key=keySelector(e.current);var index=-1;for(var i=0,len=keys.length;i<len;i++)if(comparer(key,keys[i])){index=i;break}var grp;index<0?(keys.push(key),grps.push(grp=new Group(key))):grp=grps[index],grp._add(e.current)}return grps}var Group=function(_super){__extends(Group,_super);function Group(key){var _this=this;_super.call(this),this.key=key,this._arr=[],this.getEnumerator=function(){return _this._arr.en().getEnumerator()}}return Group.prototype._add=function(e){this._arr.push(e)},Group}(exjs.Enumerable);exjs.Enumerable.prototype.groupBy=function(keySelector,comparer){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return groupByEnumerator(_this,keySelector,comparer)},e},exjs.List&&(exjs.List.prototype.groupBy=exjs.Enumerable.prototype.groupBy)})(exjs||(exjs={}));var exjs;(function(exjs){function intersectEnumerator(prev,second,comparer){comparer=comparer||function(f,s){return f===s};var t,e={current:undefined,moveNext:function(){t||(t=exjs.en(prev).distinct().getEnumerator()),e.current=undefined;while(t.moveNext()){for(var hit=!1,x=second.getEnumerator();x.moveNext()&&!hit;)hit=comparer(t.current,x.current);if(hit)return e.current=t.current,!0}return!1}};return e}exjs.Enumerable.prototype.intersect=function(second,comparer){var _this=this,en=second instanceof Array?second.en():second,e=new exjs.Enumerable;return e.getEnumerator=function(){return intersectEnumerator(_this,en,comparer)},e},exjs.List&&(exjs.List.prototype.intersect=exjs.Enumerable.prototype.intersect)})(exjs||(exjs={}));var exjs;(function(exjs){function joinEnumerator(prev,inner,outerKeySelector,innerKeySelector,resultSelector,comparer){comparer=comparer||function(k1,k2){return k1===k2};var s,ins,j=0,e={current:undefined,moveNext:function(){e.current=undefined;if(!s){s=prev.getEnumerator();if(!s.moveNext())return!1;ins=exjs.en(inner).toArray()}var cur;do{for(;j<ins.length;j++){cur=ins[j];if(comparer(outerKeySelector(s.current),innerKeySelector(cur)))return j++,e.current=resultSelector(s.current,cur),!0}j=0}while(s.moveNext());return!1}};return e}exjs.Enumerable.prototype.join=function(inner,outerKeySelector,innerKeySelector,resultSelector,comparer){var _this=this,en=inner instanceof Array?inner.en():inner,e=new exjs.Enumerable;return e.getEnumerator=function(){return joinEnumerator(_this,en,outerKeySelector,innerKeySelector,resultSelector,comparer)},e},exjs.List&&(exjs.List.prototype.join=exjs.Enumerable.prototype.join)})(exjs||(exjs={}));var exjs;(function(exjs){exjs.Enumerable.prototype.toList=function(){var l=new List,enumerator=this.getEnumerator();while(enumerator.moveNext())l.push(enumerator.current);return l};var List=function(_super){__extends(List,_super);function List(){_super.apply(this,arguments)}return List.prototype.toString=function(){throw new Error("Not implemented")},List.prototype.toLocaleString=function(){throw new Error("Not implemented")},List.prototype.pop=function(){throw new Error("Not implemented")},List.prototype.push=function(){var items=[];for(var _i=0;_i<arguments.length;_i++)items[_i-0]=arguments[_i];throw new Error("Not implemented")},List.prototype.shift=function(){throw new Error("Not implemented")},List.prototype.slice=function(start,end){throw new Error("Not implemented")},List.prototype.sort=function(compareFn){throw new Error("Not implemented")},List.prototype.splice=function(){throw new Error("Not implemented")},List.prototype.unshift=function(){var items=[];for(var _i=0;_i<arguments.length;_i++)items[_i-0]=arguments[_i];throw new Error("Not implemented")},List.prototype.indexOf=function(searchElement,fromIndex){throw new Error("Not implemented")},List.prototype.lastIndexOf=function(searchElement,fromIndex){throw new Error("Not implemented")},List.prototype.every=function(callbackfn,thisArg){throw new Error("Not implemented")},List.prototype.some=function(callbackfn,thisArg){throw new Error("Not implemented")},List.prototype.forEach=function(callbackfn,thisArg){throw new Error("Not implemented")},List.prototype.map=function(callbackfn,thisArg){throw new Error("Not implemented")},List.prototype.filter=function(callbackfn,thisArg){throw new Error("Not implemented")},List.prototype.reduce=function(callbackfn,initialValue){throw new Error("Not implemented")},List.prototype.reduceRight=function(callbackfn,initialValue){throw new Error("Not implemented")},List.prototype.remove=function(item){throw new Error("Not implemented")},List.prototype.removeWhere=function(predicate){throw new Error("Not implemented")},List}(exjs.Enumerable);exjs.List=List;for(var p in Array)Array.hasOwnProperty(p)&&(List[p]=Array[p]);function __(){this.constructor=List}__.prototype=Array.prototype,List.prototype=new __;for(var key in exjs.Enumerable.prototype){if(key==="getEnumerator")continue;List.prototype[key]=exjs.Enumerable.prototype[key]}List.prototype.getEnumerator=function(){var list=this,len=list.length,e={moveNext:undefined,current:undefined},index=-1;return e.moveNext=function(){return index++,index>=len?(e.current=undefined,!1):(e.current=list[index],!0)},e},List.prototype.remove=function(item){return this.removeWhere(function(t){return t===item}).any()},List.prototype.removeWhere=function(predicate){var removed=[],cur;for(var i=this.length-1;i>=0;i--)cur=this[i],predicate(cur,i)===!0&&(this.splice(i,1),removed.push(cur));return removed.en().reverse()}})(exjs||(exjs={}));var exjs;(function(exjs){var Map=function(){function Map(enumerable){this._keys=[],this._values=[];var enu;enumerable instanceof Array?enu=enumerable.en():enumerable&&enumerable.getEnumerator instanceof Function&&(enu=enumerable);if(!enu)return;for(var en=enu.getEnumerator();en&&en.moveNext();)this.set(en.current[0],en.current[1])}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.clear=function(){this._keys.length=0,this._values.length=0},Map.prototype.delete=function(key){var index=this._keys.indexOf(key);return index>-1?(this._keys.splice(index,1),this._values.splice(index,1),!0):!1},Map.prototype.entries=function(){var _this=this;return exjs.range(0,this.size).select(function(i){return[_this._keys[i],_this._values[i]]})},Map.prototype.forEach=function(callbackFn,thisArg){thisArg==null&&(thisArg=this);for(var i=0,keys=this._keys,vals=this._values,len=keys.length;i<len;i++)callbackFn.call(thisArg,vals[i],keys[i],this)},Map.prototype.get=function(key){var index=this._keys.indexOf(key);return this._values[index]},Map.prototype.has=function(key){return this._keys.indexOf(key)>-1},Map.prototype.keys=function(){return this._keys.en()},Map.prototype.set=function(key,value){var index=this._keys.indexOf(key);return index>-1?this._values[index]=value:(this._keys.push(key),this._values.push(value)),undefined},Map.prototype.values=function(){return this._values.en()},Map}();exjs.Map=Map,window.Map||(window.Map=Map)})(exjs||(exjs={}));var exjs;(function(exjs){function orderByEnumerable(source,keySelector,isDescending,comparer){return new OrderedEnumerable(source,keySelector,isDescending,comparer)}var OrderedEnumerable=function(_super){__extends(OrderedEnumerable,_super);function OrderedEnumerable(source,keySelector,isDescending,keyComparer){_super.call(this),this.Source=source,keyComparer=keyComparer||function(f,s){return f>s?1:f<s?-1:0};var factor=isDescending===!0?-1:1;this.Sorter=function(a,b){return factor*keyComparer(keySelector(a),keySelector(b))}}return OrderedEnumerable.prototype.getEnumerator=function(){var source=this.Source,sorter=this.Sorter,arr,i=0,e={current:undefined,moveNext:function(){return arr||(arr=exjs.en(source).toArray(),arr.sort(sorter)),e.current=undefined,i>=arr.length?!1:(e.current=arr[i],i++,!0)}};return e},OrderedEnumerable.prototype.thenBy=function(keySelector,comparer){return new ThenEnumerable(this,keySelector,!1,comparer)},OrderedEnumerable.prototype.thenByDescending=function(keySelector,comparer){return new ThenEnumerable(this,keySelector,!0,comparer)},OrderedEnumerable}(exjs.Enumerable),ThenEnumerable=function(_super){__extends(ThenEnumerable,_super);function ThenEnumerable(source,keySelector,isDescending,keyComparer){_super.call(this,source,keySelector,isDescending,keyComparer);var parentSorter=source.Sorter,thisSorter=this.Sorter;this.Sorter=function(a,b){return parentSorter(a,b)||thisSorter(a,b)}}return ThenEnumerable}(OrderedEnumerable),fn=exjs.Enumerable.prototype;fn.orderBy=function(keySelector,comparer){return orderByEnumerable(this,keySelector,!1,comparer)},fn.orderByDescending=function(keySelector,comparer){return orderByEnumerable(this,keySelector,!0,comparer)},exjs.List&&(exjs.List.prototype.orderBy=exjs.Enumerable.prototype.orderBy,exjs.List.prototype.orderByDescending=exjs.Enumerable.prototype.orderByDescending)})(exjs||(exjs={}));var exjs;(function(exjs){function rangeEnumerator(start,end,increment){var i=start-increment,e={current:undefined,moveNext:function(){return i+=increment,i>=end?!1:(e.current=i,!0)}};return e}function range(start,end,increment){start=start||0,end=end||0;if(start>end)throw new Error("Start cannot be greater than end.");increment==null&&(increment=1);var e=new exjs.Enumerable;return e.getEnumerator=function(){return rangeEnumerator(start,end,increment)},e}exjs.range=range})(exjs||(exjs={}));var exjs;(function(exjs){function reverseEnumerator(prev){var a,i=0,e={current:undefined,moveNext:function(){return a||(a=exjs.en(prev).toArray(),i=a.length),i--,e.current=a[i],i>=0}};return e}exjs.Enumerable.prototype.reverse=function(){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return reverseEnumerator(_this)},e},exjs.List&&(exjs.List.prototype.reverse=exjs.Enumerable.prototype.reverse)})(exjs||(exjs={}));var exjs;(function(exjs){function round(value,digits){digits=digits||0;if(digits===0)return Math.round(value);var shift=Math.pow(10,digits);return Math.round(value*shift)/shift}exjs.round=round})(exjs||(exjs={}));var exjs;(function(exjs){function selectEnumerator(prev,selector){var t,i=0,e={current:undefined,moveNext:function(){return t||(t=prev.getEnumerator()),t.moveNext()?(e.current=selector(t.current,i),i++,!0):!1}};return e}function selectManyEnumerator(prev,selector){var t,active,e={current:undefined,moveNext:function(){e.current=undefined,t||(t=prev.getEnumerator());while(!active||!active.moveNext()){if(!t.moveNext())return!1;active=exjs.selectorEnumerator(selector(t.current))}return e.current=active.current,!0}};return e}exjs.Enumerable.prototype.select=function(selector){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return selectEnumerator(_this,selector)},e},exjs.Enumerable.prototype.selectMany=function(selector){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return selectManyEnumerator(_this,selector)},e},exjs.List&&(exjs.List.prototype.select=exjs.Enumerable.prototype.select,exjs.List.prototype.selectMany=exjs.Enumerable.prototype.selectMany)})(exjs||(exjs={}));var exjs;(function(exjs){function selectorEnumerator(obj){return Array.isArray(obj)?obj.en().getEnumerator():obj!=null&&typeof obj.getEnumerator=="function"?obj.getEnumerator():null}exjs.selectorEnumerator=selectorEnumerator})(exjs||(exjs={}));var exjs;(function(exjs){function skipEnumerator(prev,count){var t,e={current:undefined,moveNext:function(){if(!t){t=prev.getEnumerator();for(var i=0;i<count;i++)if(!t.moveNext())return!1}return t.moveNext()?(e.current=t.current,!0):(e.current=undefined,!1)}};return e}function skipWhileEnumerator(prev,predicate){var t,e={current:undefined,moveNext:function(){if(!t){t=prev.getEnumerator();for(var i=0;t.moveNext();i++)if(!predicate(e.current=t.current,i))return!0;return e.current=undefined,!1}return t.moveNext()?(e.current=t.current,!0):(e.current=undefined,!1)}};return e}exjs.Enumerable.prototype.skip=function(count){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return skipEnumerator(_this,count)},e},exjs.Enumerable.prototype.skipWhile=function(predicate){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return skipWhileEnumerator(_this,predicate)},e},exjs.List&&(exjs.List.prototype.skip=exjs.Enumerable.prototype.skip,exjs.List.prototype.skipWhile=exjs.Enumerable.prototype.skipWhile)})(exjs||(exjs={}));var exjs;(function(exjs){function takeEnumerator(prev,count){var t,i=0,e={current:undefined,moveNext:function(){return t||(t=prev.getEnumerator()),i++,i>count?!1:(e.current=undefined,t.moveNext()?(e.current=t.current,!0):!1)}};return e}function takeWhileEnumerator(prev,predicate){var t,i=0,e={current:undefined,moveNext:function(){return t||(t=prev.getEnumerator()),!t.moveNext()||!predicate(t.current,i)?(e.current=undefined,!1):(i++,e.current=t.current,!0)}};return e}exjs.Enumerable.prototype.take=function(count){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return takeEnumerator(_this,count)},e},exjs.Enumerable.prototype.takeWhile=function(predicate){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return takeWhileEnumerator(_this,predicate)},e},exjs.List&&(exjs.List.prototype.take=exjs.Enumerable.prototype.take,exjs.List.prototype.takeWhile=exjs.Enumerable.prototype.takeWhile)})(exjs||(exjs={}));var exjs;(function(exjs){function traverseEnumerator(prev,selector){var started=!1,enstack=[],t,e={current:undefined,moveNext:function(){if(!started)t=prev.getEnumerator(),started=!0;else{if(t==null)return!1;enstack.push(t),t=exjs.selectorEnumerator(selector(e.current))}while(!t||!t.moveNext()){if(enstack.length<1)break;t=enstack.pop()}return e.current=t==null?undefined:t.current,e.current!==undefined}};return e}function traverseUniqueEnumerator(prev,selector,turnstile){var started=!1,enstack=[],t,e={current:undefined,moveNext:function(){if(!started)t=prev.getEnumerator(),started=!0;else{if(t==null)return!1;enstack.push(t),t=exjs.selectorEnumerator(selector(e.current))}do{while(!t||!t.moveNext()){if(enstack.length<1)break;t=enstack.pop()}e.current=t==null?undefined:t.current}while(turnstile(e.current));return e.current!==undefined}};return e}exjs.Enumerable.prototype.traverse=function(selector){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return traverseEnumerator(_this,selector)},e},exjs.Enumerable.prototype.traverseUnique=function(selector,matcher){var _this=this,existing=[],e=new exjs.Enumerable;return matcher?e.getEnumerator=function(){return traverseUniqueEnumerator(_this,selector,function(x){return existing.some(function(e){return matcher(x,e)})?!0:(existing.push(x),!1)})}:e.getEnumerator=function(){return traverseUniqueEnumerator(_this,selector,function(x){return existing.indexOf(x)>-1?!0:(existing.push(x),!1)})},e},exjs.List&&(exjs.List.prototype.traverse=exjs.Enumerable.prototype.traverse,exjs.List.prototype.traverseUnique=exjs.Enumerable.prototype.traverseUnique)})(exjs||(exjs={}));var exjs;(function(exjs){function unionEnumerator(prev,second,comparer){comparer=comparer||function(f,s){return f===s};var t,visited=[],s,e={current:undefined,moveNext:function(){t||(t=exjs.en(prev).distinct().getEnumerator()),e.current=undefined;if(!s&&t.moveNext())return visited.push(e.current=t.current),!0;s=s||exjs.en(second).distinct().getEnumerator();while(s.moveNext()){for(var i=0,hit=!1,len=visited.length;i<len&&!hit;i++)hit=comparer(visited[i],s.current);if(!hit)return e.current=s.current,!0}return!1}};return e}exjs.Enumerable.prototype.union=function(second,comparer){var _this=this,en=second instanceof Array?second.en():second,e=new exjs.Enumerable;return e.getEnumerator=function(){return unionEnumerator(_this,en,comparer)},e},exjs.List&&(exjs.List.prototype.union=exjs.Enumerable.prototype.union)})(exjs||(exjs={}));var exjs;(function(exjs){function whereEnumerator(prev,filter){var t,e={current:undefined,moveNext:function(){t||(t=prev.getEnumerator());var c;while(t.moveNext())if(filter(c=t.current))return e.current=c,!0;return!1}};return e}exjs.Enumerable.prototype.where=function(filter){var _this=this,e=new exjs.Enumerable;return e.getEnumerator=function(){return whereEnumerator(_this,filter)},e},exjs.List&&(exjs.List.prototype.where=exjs.Enumerable.prototype.where)})(exjs||(exjs={}));var exjs;(function(exjs){function en(enu){var x=new exjs.Enumerable;return x.getEnumerator=function(){return wrapEnumerator(enu)},x}exjs.en=en;function wrapEnumerator(enu){var wrapped=enu.getEnumerator(),x={current:undefined,moveNext:undefined};return x.moveNext=function(){return wrapped.moveNext()?(x.current=wrapped.current,!0):(x.current=undefined,!1)},x}})(exjs||(exjs={}));var ex=exjs.en,exjs;(function(exjs){function zipEnumerator(prev,second,resultSelector){var s,t,e={current:undefined,moveNext:function(){return s||(s=prev.getEnumerator()),t||(t=second.getEnumerator()),e.current=undefined,!s.moveNext()||!t.moveNext()?!1:(e.current=resultSelector(s.current,t.current),!0)}};return e}exjs.Enumerable.prototype.zip=function(second,resultSelector){var _this=this,en=second instanceof Array?second.en():second,e=new exjs.Enumerable;return e.getEnumerator=function(){return zipEnumerator(_this,en,resultSelector)},e},exjs.List&&(exjs.List.prototype.zip=exjs.Enumerable.prototype.zip)})(exjs||(exjs={})),define("exjs",function(global){return function(){var ret,fn;return ret||global.exjs}}(this)),Array.prototype.clone||(Array.prototype.clone=function(){return this.slice(0)}),Array.prototype.contains||(Array.prototype.contains=function(val){return this.indexOf(val)!==-1}),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){var i=fromIndex||0,j=this.length;for(i;i<j;i++)if(this[i]===searchElement)return i;return-1}),Array.prototype.indexOfTest=function(test,fromIndex){var i=fromIndex||0,j=this.length;for(i;i<j;i++)if(test(this[i]))return i;return-1},Array.prototype.insert=function(item,index){this.splice(index,0,item)},Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Array.prototype.move=function(fromIndex,toIndex){this.splice(toIndex,0,this.splice(fromIndex,1)[0])},Array.prototype.remove=function(item){var index=this.indexOf(item);index>-1&&this.splice(index,1)},Array.prototype.removeAt=function(index){this.splice(index,1)},Math.clamp=function(value,min,max){return Math.min(Math.max(value,min),max)},Math.constrain=function(value,low,high){return Math.clamp(value,low,high)},Math.degreesToRadians=function(degrees){return Math.TAU*(degrees/360)},Math.distanceBetween=function(x1,y1,x2,y2){return Math.sqrt(Math.sq(x2-x1)+Math.sq(y2-y1))},Math.lerp=function(start,stop,amount){return start+(stop-start)*amount},Math.mag=function(a,b,c){return Math.sqrt(a*a+b*b+c*c)},Math.map=function(value,start1,stop1,start2,stop2){return start2+(stop2-start2)*((value-start1)/(stop1-start1))},Math.median=function(values){values.sort(function(a,b){return a-b});var half=Math.floor(values.length/2);return values.length%2?values[half]:(values[half-1]+values[half])/2},Math.normalise=function(num,min,max){return(num-min)/(max-min)},Math.radiansToDegrees=function(radians){return radians*360/Math.TAU},Math.randomBetween=function(low,high){return high||(high=low,low=0),low>=high?low:low+(high-low)*Math.random()},Math.roundToDecimalPlace=function(num,dec){return Math.round(num*Math.pow(10,dec))/Math.pow(10,dec)},Math.sq=function(n){return n*n},Math.TAU=Math.PI*2,Number.prototype.isInteger||(Number.prototype.isInteger=function(){return this%1===0}),Object.keys||(Object.keys=function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!="object"&&typeof obj!="function"||obj===null)throw new TypeError("Object.keys called on non-object");var result=[];for(var prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(var i=0;i<dontEnumsLength;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}()),String.prototype.b64_to_utf8=function(){return decodeURIComponent(escape(window.atob(this)))},String.prototype.contains=function(str){return this.indexOf(str)!==-1},String.prototype.endsWith||(String.prototype.endsWith=function(str){return this.indexOf(str,this.length-str.length)!==-1}),String.format=function(){var s=arguments[0];for(var i=0;i<arguments.length-1;i++){var reg=new RegExp("\\{"+i+"\\}","gm");s=s.replace(reg,arguments[i+1])}return s},String.prototype.hashCode=function(){var hash=0,i,chr,len;if(this.length==0)return hash;for(i=0,len=this.length;i<len;i++)chr=this.charCodeAt(i),hash=(hash<<5)-hash+chr,hash|=0;return hash.toString()},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith||(String.prototype.startsWith=function(str){return this.indexOf(str)==0}),String.prototype.toCssClass=function(){return this.replace(/[^a-z0-9]/g,function(s){var c=s.charCodeAt(0);return c==32?"-":c>=65&&c<=90?"_"+s.toLowerCase():"__"+("000"+c.toString(16)).slice(-4)})},String.prototype.toFileName=function(){return this.replace(/[^a-z0-9]/gi,"_").toLowerCase()},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),String.prototype.utf8_to_b64=function(){return window.btoa(unescape(encodeURIComponent(this)))},define("extensions",function(){});function Intersection(status){arguments.length>0&&this.init(status)}Intersection.prototype.init=function(status){this.status=status,this.points=new Array},Intersection.prototype.appendPoint=function(point){this.points.push(point)},Intersection.prototype.appendPoints=function(points){this.points=this.points.concat(points)},Intersection.intersectShapes=function(shape1,shape2){var ip1=shape1.getIntersectionParams(),ip2=shape2.getIntersectionParams(),result;if(ip1!=null&&ip2!=null)if(ip1.name=="Path")result=Intersection.intersectPathShape(shape1,shape2);else if(ip2.name=="Path")result=Intersection.intersectPathShape(shape2,shape1);else{var method,params;ip1.name<ip2.name?(method="intersect"+ip1.name+ip2.name,params=ip1.params.concat(ip2.params)):(method="intersect"+ip2.name+ip1.name,params=ip2.params.concat(ip1.params));if(!(method in Intersection))throw new Error("Intersection not available: "+method);result=Intersection[method].apply(null,params)}else result=new Intersection("No Intersection");return result},Intersection.intersectPathShape=function(path,shape){return path.intersectShape(shape)},Intersection.intersectBezier2Bezier2=function(a1,a2,a3,b1,b2,b3){var a,b,c12,c11,c10,c22,c21,c20,result=new Intersection("No Intersection"),poly;a=a2.multiply(-2),c12=a1.add(a.add(a3)),a=a1.multiply(-2),b=a2.multiply(2),c11=a.add(b),c10=new Point2D(a1.x,a1.y),a=b2.multiply(-2),c22=b1.add(a.add(b3)),a=b1.multiply(-2),b=b2.multiply(2),c21=a.add(b),c20=new Point2D(b1.x,b1.y);if(c12.y==0){var v0=c12.x*(c10.y-c20.y),v1=v0-c11.x*c11.y,v2=v0+v1,v3=c11.y*c11.y;poly=new Polynomial(c12.x*c22.y*c22.y,2*c12.x*c21.y*c22.y,c12.x*c21.y*c21.y-c22.x*v3-c22.y*v0-c22.y*v1,-c21.x*v3-c21.y*v0-c21.y*v1,(c10.x-c20.x)*v3+(c10.y-c20.y)*v1)}else{var v0=c12.x*c22.y-c12.y*c22.x,v1=c12.x*c21.y-c21.x*c12.y,v2=c11.x*c12.y-c11.y*c12.x,v3=c10.y-c20.y,v4=c12.y*(c10.x-c20.x)-c12.x*v3,v5=-c11.y*v2+c12.y*v4,v6=v2*v2;poly=new Polynomial(v0*v0,2*v0*v1,(-c22.y*v6+c12.y*v1*v1+c12.y*v0*v4+v0*v5)/c12.y,(-c21.y*v6+c12.y*v1*v4+v1*v5)/c12.y,(v3*v6+v4*v5)/c12.y)}var roots=poly.getRoots();for(var i=0;i<roots.length;i++){var s=roots[i];if(0<=s&&s<=1){var xRoots=(new Polynomial(c12.x,c11.x,c10.x-c20.x-s*c21.x-s*s*c22.x)).getRoots(),yRoots=(new Polynomial(c12.y,c11.y,c10.y-c20.y-s*c21.y-s*s*c22.y)).getRoots();if(xRoots.length>0&&yRoots.length>0){var TOLERANCE=1e-4;checkRoots:for(var j=0;j<xRoots.length;j++){var xRoot=xRoots[j];if(0<=xRoot&&xRoot<=1)for(var k=0;k<yRoots.length;k++)if(Math.abs(xRoot-yRoots[k])<TOLERANCE){result.points.push(c22.multiply(s*s).add(c21.multiply(s).add(c20)));break checkRoots}}}}}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier2Bezier3=function(a1,a2,a3,b1,b2,b3,b4){var a,b,c,d,c12,c11,c10,c23,c22,c21,c20,result=new Intersection("No Intersection");a=a2.multiply(-2),c12=a1.add(a.add(a3)),a=a1.multiply(-2),b=a2.multiply(2),c11=a.add(b),c10=new Point2D(a1.x,a1.y),a=b1.multiply(-1),b=b2.multiply(3),c=b3.multiply(-3),d=a.add(b.add(c.add(b4))),c23=new Vector2D(d.x,d.y),a=b1.multiply(3),b=b2.multiply(-6),c=b3.multiply(3),d=a.add(b.add(c)),c22=new Vector2D(d.x,d.y),a=b1.multiply(-3),b=b2.multiply(3),c=a.add(b),c21=new Vector2D(c.x,c.y),c20=new Vector2D(b1.x,b1.y);var c10x2=c10.x*c10.x,c10y2=c10.y*c10.y,c11x2=c11.x*c11.x,c11y2=c11.y*c11.y,c12x2=c12.x*c12.x,c12y2=c12.y*c12.y,c20x2=c20.x*c20.x,c20y2=c20.y*c20.y,c21x2=c21.x*c21.x,c21y2=c21.y*c21.y,c22x2=c22.x*c22.x,c22y2=c22.y*c22.y,c23x2=c23.x*c23.x,c23y2=c23.y*c23.y,poly=new Polynomial(-2*c12.x*c12.y*c23.x*c23.y+c12x2*c23y2+c12y2*c23x2,-2*c12.x*c12.y*c22.x*c23.y-2*c12.x*c12.y*c22.y*c23.x+2*c12y2*c22.x*c23.x+2*c12x2*c22.y*c23.y,-2*c12.x*c21.x*c12.y*c23.y-2*c12.x*c12.y*c21.y*c23.x-2*c12.x*c12.y*c22.x*c22.y+2*c21.x*c12y2*c23.x+c12y2*c22x2+c12x2*(2*c21.y*c23.y+c22y2),2*c10.x*c12.x*c12.y*c23.y+2*c10.y*c12.x*c12.y*c23.x+c11.x*c11.y*c12.x*c23.y+c11.x*c11.y*c12.y*c23.x-2*c20.x*c12.x*c12.y*c23.y-2*c12.x*c20.y*c12.y*c23.x-2*c12.x*c21.x*c12.y*c22.y-2*c12.x*c12.y*c21.y*c22.x-2*c10.x*c12y2*c23.x-2*c10.y*c12x2*c23.y+2*c20.x*c12y2*c23.x+2*c21.x*c12y2*c22.x-c11y2*c12.x*c23.x-c11x2*c12.y*c23.y+c12x2*(2*c20.y*c23.y+2*c21.y*c22.y),2*c10.x*c12.x*c12.y*c22.y+2*c10.y*c12.x*c12.y*c22.x+c11.x*c11.y*c12.x*c22.y+c11.x*c11.y*c12.y*c22.x-2*c20.x*c12.x*c12.y*c22.y-2*c12.x*c20.y*c12.y*c22.x-2*c12.x*c21.x*c12.y*c21.y-2*c10.x*c12y2*c22.x-2*c10.y*c12x2*c22.y+2*c20.x*c12y2*c22.x-c11y2*c12.x*c22.x-c11x2*c12.y*c22.y+c21x2*c12y2+c12x2*(2*c20.y*c22.y+c21y2),2*c10.x*c12.x*c12.y*c21.y+2*c10.y*c12.x*c21.x*c12.y+c11.x*c11.y*c12.x*c21.y+c11.x*c11.y*c21.x*c12.y-2*c20.x*c12.x*c12.y*c21.y-2*c12.x*c20.y*c21.x*c12.y-2*c10.x*c21.x*c12y2-2*c10.y*c12x2*c21.y+2*c20.x*c21.x*c12y2-c11y2*c12.x*c21.x-c11x2*c12.y*c21.y+2*c12x2*c20.y*c21.y,-2*c10.x*c10.y*c12.x*c12.y-c10.x*c11.x*c11.y*c12.y-c10.y*c11.x*c11.y*c12.x+2*c10.x*c12.x*c20.y*c12.y+2*c10.y*c20.x*c12.x*c12.y+c11.x*c20.x*c11.y*c12.y+c11.x*c11.y*c12.x*c20.y-2*c20.x*c12.x*c20.y*c12.y-2*c10.x*c20.x*c12y2+c10.x*c11y2*c12.x+c10.y*c11x2*c12.y-2*c10.y*c12x2*c20.y-c20.x*c11y2*c12.x-c11x2*c20.y*c12.y+c10x2*c12y2+c10y2*c12x2+c20x2*c12y2+c12x2*c20y2),roots=poly.getRootsInInterval(0,1);for(var i=0;i<roots.length;i++){var s=roots[i],xRoots=(new Polynomial(c12.x,c11.x,c10.x-c20.x-s*c21.x-s*s*c22.x-s*s*s*c23.x)).getRoots(),yRoots=(new Polynomial(c12.y,c11.y,c10.y-c20.y-s*c21.y-s*s*c22.y-s*s*s*c23.y)).getRoots();if(xRoots.length>0&&yRoots.length>0){var TOLERANCE=1e-4;checkRoots:for(var j=0;j<xRoots.length;j++){var xRoot=xRoots[j];if(0<=xRoot&&xRoot<=1)for(var k=0;k<yRoots.length;k++)if(Math.abs(xRoot-yRoots[k])<TOLERANCE){result.points.push(c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20))));break checkRoots}}}}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier2Circle=function(p1,p2,p3,c,r){return Intersection.intersectBezier2Ellipse(p1,p2,p3,c,r,r)},Intersection.intersectBezier2Ellipse=function(p1,p2,p3,ec,rx,ry){var a,b,c2,c1,c0,result=new Intersection("No Intersection");a=p2.multiply(-2),c2=p1.add(a.add(p3)),a=p1.multiply(-2),b=p2.multiply(2),c1=a.add(b),c0=new Point2D(p1.x,p1.y);var rxrx=rx*rx,ryry=ry*ry,roots=(new Polynomial(ryry*c2.x*c2.x+rxrx*c2.y*c2.y,2*(ryry*c2.x*c1.x+rxrx*c2.y*c1.y),ryry*(2*c2.x*c0.x+c1.x*c1.x)+rxrx*(2*c2.y*c0.y+c1.y*c1.y)-2*(ryry*ec.x*c2.x+rxrx*ec.y*c2.y),2*(ryry*c1.x*(c0.x-ec.x)+rxrx*c1.y*(c0.y-ec.y)),ryry*(c0.x*c0.x+ec.x*ec.x)+rxrx*(c0.y*c0.y+ec.y*ec.y)-2*(ryry*ec.x*c0.x+rxrx*ec.y*c0.y)-rxrx*ryry)).getRoots();for(var i=0;i<roots.length;i++){var t=roots[i];0<=t&&t<=1&&result.points.push(c2.multiply(t*t).add(c1.multiply(t).add(c0)))}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier2Line=function(p1,p2,p3,a1,a2){var a,b,c2,c1,c0,cl,n,min=a1.min(a2),max=a1.max(a2),result=new Intersection("No Intersection");a=p2.multiply(-2),c2=p1.add(a.add(p3)),a=p1.multiply(-2),b=p2.multiply(2),c1=a.add(b),c0=new Point2D(p1.x,p1.y),n=new Vector2D(a1.y-a2.y,a2.x-a1.x),cl=a1.x*a2.y-a2.x*a1.y,roots=(new Polynomial(n.dot(c2),n.dot(c1),n.dot(c0)+cl)).getRoots();for(var i=0;i<roots.length;i++){var t=roots[i];if(0<=t&&t<=1){var p4=p1.lerp(p2,t),p5=p2.lerp(p3,t),p6=p4.lerp(p5,t);a1.x==a2.x?min.y<=p6.y&&p6.y<=max.y&&(result.status="Intersection",result.appendPoint(p6)):a1.y==a2.y?min.x<=p6.x&&p6.x<=max.x&&(result.status="Intersection",result.appendPoint(p6)):p6.gte(min)&&p6.lte(max)&&(result.status="Intersection",result.appendPoint(p6))}}return result},Intersection.intersectBezier2Polygon=function(p1,p2,p3,points){var result=new Intersection("No Intersection"),length=points.length;for(var i=0;i<length;i++){var a1=points[i],a2=points[(i+1)%length],inter=Intersection.intersectBezier2Line(p1,p2,p3,a1,a2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier2Rectangle=function(p1,p2,p3,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectBezier2Line(p1,p2,p3,min,topRight),inter2=Intersection.intersectBezier2Line(p1,p2,p3,topRight,max),inter3=Intersection.intersectBezier2Line(p1,p2,p3,max,bottomLeft),inter4=Intersection.intersectBezier2Line(p1,p2,p3,bottomLeft,min),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier3Bezier3=function(a1,a2,a3,a4,b1,b2,b3,b4){var a,b,c,d,c13,c12,c11,c10,c23,c22,c21,c20,result=new Intersection("No Intersection");a=a1.multiply(-1),b=a2.multiply(3),c=a3.multiply(-3),d=a.add(b.add(c.add(a4))),c13=new Vector2D(d.x,d.y),a=a1.multiply(3),b=a2.multiply(-6),c=a3.multiply(3),d=a.add(b.add(c)),c12=new Vector2D(d.x,d.y),a=a1.multiply(-3),b=a2.multiply(3),c=a.add(b),c11=new Vector2D(c.x,c.y),c10=new Vector2D(a1.x,a1.y),a=b1.multiply(-1),b=b2.multiply(3),c=b3.multiply(-3),d=a.add(b.add(c.add(b4))),c23=new Vector2D(d.x,d.y),a=b1.multiply(3),b=b2.multiply(-6),c=b3.multiply(3),d=a.add(b.add(c)),c22=new Vector2D(d.x,d.y),a=b1.multiply(-3),b=b2.multiply(3),c=a.add(b),c21=new Vector2D(c.x,c.y),c20=new Vector2D(b1.x,b1.y);var c10x2=c10.x*c10.x,c10x3=c10.x*c10.x*c10.x,c10y2=c10.y*c10.y,c10y3=c10.y*c10.y*c10.y,c11x2=c11.x*c11.x,c11x3=c11.x*c11.x*c11.x,c11y2=c11.y*c11.y,c11y3=c11.y*c11.y*c11.y,c12x2=c12.x*c12.x,c12x3=c12.x*c12.x*c12.x,c12y2=c12.y*c12.y,c12y3=c12.y*c12.y*c12.y,c13x2=c13.x*c13.x,c13x3=c13.x*c13.x*c13.x,c13y2=c13.y*c13.y,c13y3=c13.y*c13.y*c13.y,c20x2=c20.x*c20.x,c20x3=c20.x*c20.x*c20.x,c20y2=c20.y*c20.y,c20y3=c20.y*c20.y*c20.y,c21x2=c21.x*c21.x,c21x3=c21.x*c21.x*c21.x,c21y2=c21.y*c21.y,c22x2=c22.x*c22.x,c22x3=c22.x*c22.x*c22.x,c22y2=c22.y*c22.y,c23x2=c23.x*c23.x,c23x3=c23.x*c23.x*c23.x,c23y2=c23.y*c23.y,c23y3=c23.y*c23.y*c23.y,poly=new Polynomial(-c13x3*c23y3+c13y3*c23x3-3*c13.x*c13y2*c23x2*c23.y+3*c13x2*c13.y*c23.x*c23y2,-6*c13.x*c22.x*c13y2*c23.x*c23.y+6*c13x2*c13.y*c22.y*c23.x*c23.y+3*c22.x*c13y3*c23x2-3*c13x3*c22.y*c23y2-3*c13.x*c13y2*c22.y*c23x2+3*c13x2*c22.x*c13.y*c23y2,-6*c21.x*c13.x*c13y2*c23.x*c23.y-6*c13.x*c22.x*c13y2*c22.y*c23.x+6*c13x2*c22.x*c13.y*c22.y*c23.y+3*c21.x*c13y3*c23x2+3*c22x2*c13y3*c23.x+3*c21.x*c13x2*c13.y*c23y2-3*c13.x*c21.y*c13y2*c23x2-3*c13.x*c22x2*c13y2*c23.y+c13x2*c13.y*c23.x*(6*c21.y*c23.y+3*c22y2)+c13x3*(-c21.y*c23y2-2*c22y2*c23.y-c23.y*(2*c21.y*c23.y+c22y2)),c11.x*c12.y*c13.x*c13.y*c23.x*c23.y-c11.y*c12.x*c13.x*c13.y*c23.x*c23.y+6*c21.x*c22.x*c13y3*c23.x+3*c11.x*c12.x*c13.x*c13.y*c23y2+6*c10.x*c13.x*c13y2*c23.x*c23.y-3*c11.x*c12.x*c13y2*c23.x*c23.y-3*c11.y*c12.y*c13.x*c13.y*c23x2-6*c10.y*c13x2*c13.y*c23.x*c23.y-6*c20.x*c13.x*c13y2*c23.x*c23.y+3*c11.y*c12.y*c13x2*c23.x*c23.y-2*c12.x*c12y2*c13.x*c23.x*c23.y-6*c21.x*c13.x*c22.x*c13y2*c23.y-6*c21.x*c13.x*c13y2*c22.y*c23.x-6*c13.x*c21.y*c22.x*c13y2*c23.x+6*c21.x*c13x2*c13.y*c22.y*c23.y+2*c12x2*c12.y*c13.y*c23.x*c23.y+c22x3*c13y3-3*c10.x*c13y3*c23x2+3*c10.y*c13x3*c23y2+3*c20.x*c13y3*c23x2+c12y3*c13.x*c23x2-c12x3*c13.y*c23y2-3*c10.x*c13x2*c13.y*c23y2+3*c10.y*c13.x*c13y2*c23x2-2*c11.x*c12.y*c13x2*c23y2+c11.x*c12.y*c13y2*c23x2-c11.y*c12.x*c13x2*c23y2+2*c11.y*c12.x*c13y2*c23x2+3*c20.x*c13x2*c13.y*c23y2-c12.x*c12y2*c13.y*c23x2-3*c20.y*c13.x*c13y2*c23x2+c12x2*c12.y*c13.x*c23y2-3*c13.x*c22x2*c13y2*c22.y+c13x2*c13.y*c23.x*(6*c20.y*c23.y+6*c21.y*c22.y)+c13x2*c22.x*c13.y*(6*c21.y*c23.y+3*c22y2)+c13x3*(-2*c21.y*c22.y*c23.y-c20.y*c23y2-c22.y*(2*c21.y*c23.y+c22y2)-c23.y*(2*c20.y*c23.y+2*c21.y*c22.y)),6*c11.x*c12.x*c13.x*c13.y*c22.y*c23.y+c11.x*c12.y*c13.x*c22.x*c13.y*c23.y+c11.x*c12.y*c13.x*c13.y*c22.y*c23.x-c11.y*c12.x*c13.x*c22.x*c13.y*c23.y-c11.y*c12.x*c13.x*c13.y*c22.y*c23.x-6*c11.y*c12.y*c13.x*c22.x*c13.y*c23.x-6*c10.x*c22.x*c13y3*c23.x+6*c20.x*c22.x*c13y3*c23.x+6*c10.y*c13x3*c22.y*c23.y+2*c12y3*c13.x*c22.x*c23.x-2*c12x3*c13.y*c22.y*c23.y+6*c10.x*c13.x*c22.x*c13y2*c23.y+6*c10.x*c13.x*c13y2*c22.y*c23.x+6*c10.y*c13.x*c22.x*c13y2*c23.x-3*c11.x*c12.x*c22.x*c13y2*c23.y-3*c11.x*c12.x*c13y2*c22.y*c23.x+2*c11.x*c12.y*c22.x*c13y2*c23.x+4*c11.y*c12.x*c22.x*c13y2*c23.x-6*c10.x*c13x2*c13.y*c22.y*c23.y-6*c10.y*c13x2*c22.x*c13.y*c23.y-6*c10.y*c13x2*c13.y*c22.y*c23.x-4*c11.x*c12.y*c13x2*c22.y*c23.y-6*c20.x*c13.x*c22.x*c13y2*c23.y-6*c20.x*c13.x*c13y2*c22.y*c23.x-2*c11.y*c12.x*c13x2*c22.y*c23.y+3*c11.y*c12.y*c13x2*c22.x*c23.y+3*c11.y*c12.y*c13x2*c22.y*c23.x-2*c12.x*c12y2*c13.x*c22.x*c23.y-2*c12.x*c12y2*c13.x*c22.y*c23.x-2*c12.x*c12y2*c22.x*c13.y*c23.x-6*c20.y*c13.x*c22.x*c13y2*c23.x-6*c21.x*c13.x*c21.y*c13y2*c23.x-6*c21.x*c13.x*c22.x*c13y2*c22.y+6*c20.x*c13x2*c13.y*c22.y*c23.y+2*c12x2*c12.y*c13.x*c22.y*c23.y+2*c12x2*c12.y*c22.x*c13.y*c23.y+2*c12x2*c12.y*c13.y*c22.y*c23.x+3*c21.x*c22x2*c13y3+3*c21x2*c13y3*c23.x-3*c13.x*c21.y*c22x2*c13y2-3*c21x2*c13.x*c13y2*c23.y+c13x2*c22.x*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c13x2*c13.y*c23.x*(6*c20.y*c22.y+3*c21y2)+c21.x*c13x2*c13.y*(6*c21.y*c23.y+3*c22y2)+c13x3*(-2*c20.y*c22.y*c23.y-c23.y*(2*c20.y*c22.y+c21y2)-c21.y*(2*c21.y*c23.y+c22y2)-c22.y*(2*c20.y*c23.y+2*c21.y*c22.y)),c11.x*c21.x*c12.y*c13.x*c13.y*c23.y+c11.x*c12.y*c13.x*c21.y*c13.y*c23.x+c11.x*c12.y*c13.x*c22.x*c13.y*c22.y-c11.y*c12.x*c21.x*c13.x*c13.y*c23.y-c11.y*c12.x*c13.x*c21.y*c13.y*c23.x-c11.y*c12.x*c13.x*c22.x*c13.y*c22.y-6*c11.y*c21.x*c12.y*c13.x*c13.y*c23.x-6*c10.x*c21.x*c13y3*c23.x+6*c20.x*c21.x*c13y3*c23.x+2*c21.x*c12y3*c13.x*c23.x+6*c10.x*c21.x*c13.x*c13y2*c23.y+6*c10.x*c13.x*c21.y*c13y2*c23.x+6*c10.x*c13.x*c22.x*c13y2*c22.y+6*c10.y*c21.x*c13.x*c13y2*c23.x-3*c11.x*c12.x*c21.x*c13y2*c23.y-3*c11.x*c12.x*c21.y*c13y2*c23.x-3*c11.x*c12.x*c22.x*c13y2*c22.y+2*c11.x*c21.x*c12.y*c13y2*c23.x+4*c11.y*c12.x*c21.x*c13y2*c23.x-6*c10.y*c21.x*c13x2*c13.y*c23.y-6*c10.y*c13x2*c21.y*c13.y*c23.x-6*c10.y*c13x2*c22.x*c13.y*c22.y-6*c20.x*c21.x*c13.x*c13y2*c23.y-6*c20.x*c13.x*c21.y*c13y2*c23.x-6*c20.x*c13.x*c22.x*c13y2*c22.y+3*c11.y*c21.x*c12.y*c13x2*c23.y-3*c11.y*c12.y*c13.x*c22x2*c13.y+3*c11.y*c12.y*c13x2*c21.y*c23.x+3*c11.y*c12.y*c13x2*c22.x*c22.y-2*c12.x*c21.x*c12y2*c13.x*c23.y-2*c12.x*c21.x*c12y2*c13.y*c23.x-2*c12.x*c12y2*c13.x*c21.y*c23.x-2*c12.x*c12y2*c13.x*c22.x*c22.y-6*c20.y*c21.x*c13.x*c13y2*c23.x-6*c21.x*c13.x*c21.y*c22.x*c13y2+6*c20.y*c13x2*c21.y*c13.y*c23.x+2*c12x2*c21.x*c12.y*c13.y*c23.y+2*c12x2*c12.y*c21.y*c13.y*c23.x+2*c12x2*c12.y*c22.x*c13.y*c22.y-3*c10.x*c22x2*c13y3+3*c20.x*c22x2*c13y3+3*c21x2*c22.x*c13y3+c12y3*c13.x*c22x2+3*c10.y*c13.x*c22x2*c13y2+c11.x*c12.y*c22x2*c13y2+2*c11.y*c12.x*c22x2*c13y2-c12.x*c12y2*c22x2*c13.y-3*c20.y*c13.x*c22x2*c13y2-3*c21x2*c13.x*c13y2*c22.y+c12x2*c12.y*c13.x*(2*c21.y*c23.y+c22y2)+c11.x*c12.x*c13.x*c13.y*(6*c21.y*c23.y+3*c22y2)+c21.x*c13x2*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c12x3*c13.y*(-2*c21.y*c23.y-c22y2)+c10.y*c13x3*(6*c21.y*c23.y+3*c22y2)+c11.y*c12.x*c13x2*(-2*c21.y*c23.y-c22y2)+c11.x*c12.y*c13x2*(-4*c21.y*c23.y-2*c22y2)+c10.x*c13x2*c13.y*(-6*c21.y*c23.y-3*c22y2)+c13x2*c22.x*c13.y*(6*c20.y*c22.y+3*c21y2)+c20.x*c13x2*c13.y*(6*c21.y*c23.y+3*c22y2)+c13x3*(-2*c20.y*c21.y*c23.y-c22.y*(2*c20.y*c22.y+c21y2)-c20.y*(2*c21.y*c23.y+c22y2)-c21.y*(2*c20.y*c23.y+2*c21.y*c22.y)),-c10.x*c11.x*c12.y*c13.x*c13.y*c23.y+c10.x*c11.y*c12.x*c13.x*c13.y*c23.y+6*c10.x*c11.y*c12.y*c13.x*c13.y*c23.x-6*c10.y*c11.x*c12.x*c13.x*c13.y*c23.y-c10.y*c11.x*c12.y*c13.x*c13.y*c23.x+c10.y*c11.y*c12.x*c13.x*c13.y*c23.x+c11.x*c11.y*c12.x*c12.y*c13.x*c23.y-c11.x*c11.y*c12.x*c12.y*c13.y*c23.x+c11.x*c20.x*c12.y*c13.x*c13.y*c23.y+c11.x*c20.y*c12.y*c13.x*c13.y*c23.x+c11.x*c21.x*c12.y*c13.x*c13.y*c22.y+c11.x*c12.y*c13.x*c21.y*c22.x*c13.y-c20.x*c11.y*c12.x*c13.x*c13.y*c23.y-6*c20.x*c11.y*c12.y*c13.x*c13.y*c23.x-c11.y*c12.x*c20.y*c13.x*c13.y*c23.x-c11.y*c12.x*c21.x*c13.x*c13.y*c22.y-c11.y*c12.x*c13.x*c21.y*c22.x*c13.y-6*c11.y*c21.x*c12.y*c13.x*c22.x*c13.y-6*c10.x*c20.x*c13y3*c23.x-6*c10.x*c21.x*c22.x*c13y3-2*c10.x*c12y3*c13.x*c23.x+6*c20.x*c21.x*c22.x*c13y3+2*c20.x*c12y3*c13.x*c23.x+2*c21.x*c12y3*c13.x*c22.x+2*c10.y*c12x3*c13.y*c23.y-6*c10.x*c10.y*c13.x*c13y2*c23.x+3*c10.x*c11.x*c12.x*c13y2*c23.y-2*c10.x*c11.x*c12.y*c13y2*c23.x-4*c10.x*c11.y*c12.x*c13y2*c23.x+3*c10.y*c11.x*c12.x*c13y2*c23.x+6*c10.x*c10.y*c13x2*c13.y*c23.y+6*c10.x*c20.x*c13.x*c13y2*c23.y-3*c10.x*c11.y*c12.y*c13x2*c23.y+2*c10.x*c12.x*c12y2*c13.x*c23.y+2*c10.x*c12.x*c12y2*c13.y*c23.x+6*c10.x*c20.y*c13.x*c13y2*c23.x+6*c10.x*c21.x*c13.x*c13y2*c22.y+6*c10.x*c13.x*c21.y*c22.x*c13y2+4*c10.y*c11.x*c12.y*c13x2*c23.y+6*c10.y*c20.x*c13.x*c13y2*c23.x+2*c10.y*c11.y*c12.x*c13x2*c23.y-3*c10.y*c11.y*c12.y*c13x2*c23.x+2*c10.y*c12.x*c12y2*c13.x*c23.x+6*c10.y*c21.x*c13.x*c22.x*c13y2-3*c11.x*c20.x*c12.x*c13y2*c23.y+2*c11.x*c20.x*c12.y*c13y2*c23.x+c11.x*c11.y*c12y2*c13.x*c23.x-3*c11.x*c12.x*c20.y*c13y2*c23.x-3*c11.x*c12.x*c21.x*c13y2*c22.y-3*c11.x*c12.x*c21.y*c22.x*c13y2+2*c11.x*c21.x*c12.y*c22.x*c13y2+4*c20.x*c11.y*c12.x*c13y2*c23.x+4*c11.y*c12.x*c21.x*c22.x*c13y2-2*c10.x*c12x2*c12.y*c13.y*c23.y-6*c10.y*c20.x*c13x2*c13.y*c23.y-6*c10.y*c20.y*c13x2*c13.y*c23.x-6*c10.y*c21.x*c13x2*c13.y*c22.y-2*c10.y*c12x2*c12.y*c13.x*c23.y-2*c10.y*c12x2*c12.y*c13.y*c23.x-6*c10.y*c13x2*c21.y*c22.x*c13.y-c11.x*c11.y*c12x2*c13.y*c23.y-2*c11.x*c11y2*c13.x*c13.y*c23.x+3*c20.x*c11.y*c12.y*c13x2*c23.y-2*c20.x*c12.x*c12y2*c13.x*c23.y-2*c20.x*c12.x*c12y2*c13.y*c23.x-6*c20.x*c20.y*c13.x*c13y2*c23.x-6*c20.x*c21.x*c13.x*c13y2*c22.y-6*c20.x*c13.x*c21.y*c22.x*c13y2+3*c11.y*c20.y*c12.y*c13x2*c23.x+3*c11.y*c21.x*c12.y*c13x2*c22.y+3*c11.y*c12.y*c13x2*c21.y*c22.x-2*c12.x*c20.y*c12y2*c13.x*c23.x-2*c12.x*c21.x*c12y2*c13.x*c22.y-2*c12.x*c21.x*c12y2*c22.x*c13.y-2*c12.x*c12y2*c13.x*c21.y*c22.x-6*c20.y*c21.x*c13.x*c22.x*c13y2-c11y2*c12.x*c12.y*c13.x*c23.x+2*c20.x*c12x2*c12.y*c13.y*c23.y+6*c20.y*c13x2*c21.y*c22.x*c13.y+2*c11x2*c11.y*c13.x*c13.y*c23.y+c11x2*c12.x*c12.y*c13.y*c23.y+2*c12x2*c20.y*c12.y*c13.y*c23.x+2*c12x2*c21.x*c12.y*c13.y*c22.y+2*c12x2*c12.y*c21.y*c22.x*c13.y+c21x3*c13y3+3*c10x2*c13y3*c23.x-3*c10y2*c13x3*c23.y+3*c20x2*c13y3*c23.x+c11y3*c13x2*c23.x-c11x3*c13y2*c23.y-c11.x*c11y2*c13x2*c23.y+c11x2*c11.y*c13y2*c23.x-3*c10x2*c13.x*c13y2*c23.y+3*c10y2*c13x2*c13.y*c23.x-c11x2*c12y2*c13.x*c23.y+c11y2*c12x2*c13.y*c23.x-3*c21x2*c13.x*c21.y*c13y2-3*c20x2*c13.x*c13y2*c23.y+3*c20y2*c13x2*c13.y*c23.x+c11.x*c12.x*c13.x*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c12x3*c13.y*(-2*c20.y*c23.y-2*c21.y*c22.y)+c10.y*c13x3*(6*c20.y*c23.y+6*c21.y*c22.y)+c11.y*c12.x*c13x2*(-2*c20.y*c23.y-2*c21.y*c22.y)+c12x2*c12.y*c13.x*(2*c20.y*c23.y+2*c21.y*c22.y)+c11.x*c12.y*c13x2*(-4*c20.y*c23.y-4*c21.y*c22.y)+c10.x*c13x2*c13.y*(-6*c20.y*c23.y-6*c21.y*c22.y)+c20.x*c13x2*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c21.x*c13x2*c13.y*(6*c20.y*c22.y+3*c21y2)+c13x3*(-2*c20.y*c21.y*c22.y-c20y2*c23.y-c21.y*(2*c20.y*c22.y+c21y2)-c20.y*(2*c20.y*c23.y+2*c21.y*c22.y)),-c10.x*c11.x*c12.y*c13.x*c13.y*c22.y+c10.x*c11.y*c12.x*c13.x*c13.y*c22.y+6*c10.x*c11.y*c12.y*c13.x*c22.x*c13.y-6*c10.y*c11.x*c12.x*c13.x*c13.y*c22.y-c10.y*c11.x*c12.y*c13.x*c22.x*c13.y+c10.y*c11.y*c12.x*c13.x*c22.x*c13.y+c11.x*c11.y*c12.x*c12.y*c13.x*c22.y-c11.x*c11.y*c12.x*c12.y*c22.x*c13.y+c11.x*c20.x*c12.y*c13.x*c13.y*c22.y+c11.x*c20.y*c12.y*c13.x*c22.x*c13.y+c11.x*c21.x*c12.y*c13.x*c21.y*c13.y-c20.x*c11.y*c12.x*c13.x*c13.y*c22.y-6*c20.x*c11.y*c12.y*c13.x*c22.x*c13.y-c11.y*c12.x*c20.y*c13.x*c22.x*c13.y-c11.y*c12.x*c21.x*c13.x*c21.y*c13.y-6*c10.x*c20.x*c22.x*c13y3-2*c10.x*c12y3*c13.x*c22.x+2*c20.x*c12y3*c13.x*c22.x+2*c10.y*c12x3*c13.y*c22.y-6*c10.x*c10.y*c13.x*c22.x*c13y2+3*c10.x*c11.x*c12.x*c13y2*c22.y-2*c10.x*c11.x*c12.y*c22.x*c13y2-4*c10.x*c11.y*c12.x*c22.x*c13y2+3*c10.y*c11.x*c12.x*c22.x*c13y2+6*c10.x*c10.y*c13x2*c13.y*c22.y+6*c10.x*c20.x*c13.x*c13y2*c22.y-3*c10.x*c11.y*c12.y*c13x2*c22.y+2*c10.x*c12.x*c12y2*c13.x*c22.y+2*c10.x*c12.x*c12y2*c22.x*c13.y+6*c10.x*c20.y*c13.x*c22.x*c13y2+6*c10.x*c21.x*c13.x*c21.y*c13y2+4*c10.y*c11.x*c12.y*c13x2*c22.y+6*c10.y*c20.x*c13.x*c22.x*c13y2+2*c10.y*c11.y*c12.x*c13x2*c22.y-3*c10.y*c11.y*c12.y*c13x2*c22.x+2*c10.y*c12.x*c12y2*c13.x*c22.x-3*c11.x*c20.x*c12.x*c13y2*c22.y+2*c11.x*c20.x*c12.y*c22.x*c13y2+c11.x*c11.y*c12y2*c13.x*c22.x-3*c11.x*c12.x*c20.y*c22.x*c13y2-3*c11.x*c12.x*c21.x*c21.y*c13y2+4*c20.x*c11.y*c12.x*c22.x*c13y2-2*c10.x*c12x2*c12.y*c13.y*c22.y-6*c10.y*c20.x*c13x2*c13.y*c22.y-6*c10.y*c20.y*c13x2*c22.x*c13.y-6*c10.y*c21.x*c13x2*c21.y*c13.y-2*c10.y*c12x2*c12.y*c13.x*c22.y-2*c10.y*c12x2*c12.y*c22.x*c13.y-c11.x*c11.y*c12x2*c13.y*c22.y-2*c11.x*c11y2*c13.x*c22.x*c13.y+3*c20.x*c11.y*c12.y*c13x2*c22.y-2*c20.x*c12.x*c12y2*c13.x*c22.y-2*c20.x*c12.x*c12y2*c22.x*c13.y-6*c20.x*c20.y*c13.x*c22.x*c13y2-6*c20.x*c21.x*c13.x*c21.y*c13y2+3*c11.y*c20.y*c12.y*c13x2*c22.x+3*c11.y*c21.x*c12.y*c13x2*c21.y-2*c12.x*c20.y*c12y2*c13.x*c22.x-2*c12.x*c21.x*c12y2*c13.x*c21.y-c11y2*c12.x*c12.y*c13.x*c22.x+2*c20.x*c12x2*c12.y*c13.y*c22.y-3*c11.y*c21x2*c12.y*c13.x*c13.y+6*c20.y*c21.x*c13x2*c21.y*c13.y+2*c11x2*c11.y*c13.x*c13.y*c22.y+c11x2*c12.x*c12.y*c13.y*c22.y+2*c12x2*c20.y*c12.y*c22.x*c13.y+2*c12x2*c21.x*c12.y*c21.y*c13.y-3*c10.x*c21x2*c13y3+3*c20.x*c21x2*c13y3+3*c10x2*c22.x*c13y3-3*c10y2*c13x3*c22.y+3*c20x2*c22.x*c13y3+c21x2*c12y3*c13.x+c11y3*c13x2*c22.x-c11x3*c13y2*c22.y+3*c10.y*c21x2*c13.x*c13y2-c11.x*c11y2*c13x2*c22.y+c11.x*c21x2*c12.y*c13y2+2*c11.y*c12.x*c21x2*c13y2+c11x2*c11.y*c22.x*c13y2-c12.x*c21x2*c12y2*c13.y-3*c20.y*c21x2*c13.x*c13y2-3*c10x2*c13.x*c13y2*c22.y+3*c10y2*c13x2*c22.x*c13.y-c11x2*c12y2*c13.x*c22.y+c11y2*c12x2*c22.x*c13.y-3*c20x2*c13.x*c13y2*c22.y+3*c20y2*c13x2*c22.x*c13.y+c12x2*c12.y*c13.x*(2*c20.y*c22.y+c21y2)+c11.x*c12.x*c13.x*c13.y*(6*c20.y*c22.y+3*c21y2)+c12x3*c13.y*(-2*c20.y*c22.y-c21y2)+c10.y*c13x3*(6*c20.y*c22.y+3*c21y2)+c11.y*c12.x*c13x2*(-2*c20.y*c22.y-c21y2)+c11.x*c12.y*c13x2*(-4*c20.y*c22.y-2*c21y2)+c10.x*c13x2*c13.y*(-6*c20.y*c22.y-3*c21y2)+c20.x*c13x2*c13.y*(6*c20.y*c22.y+3*c21y2)+c13x3*(-2*c20.y*c21y2-c20y2*c22.y-c20.y*(2*c20.y*c22.y+c21y2)),-c10.x*c11.x*c12.y*c13.x*c21.y*c13.y+c10.x*c11.y*c12.x*c13.x*c21.y*c13.y+6*c10.x*c11.y*c21.x*c12.y*c13.x*c13.y-6*c10.y*c11.x*c12.x*c13.x*c21.y*c13.y-c10.y*c11.x*c21.x*c12.y*c13.x*c13.y+c10.y*c11.y*c12.x*c21.x*c13.x*c13.y-c11.x*c11.y*c12.x*c21.x*c12.y*c13.y+c11.x*c11.y*c12.x*c12.y*c13.x*c21.y+c11.x*c20.x*c12.y*c13.x*c21.y*c13.y+6*c11.x*c12.x*c20.y*c13.x*c21.y*c13.y+c11.x*c20.y*c21.x*c12.y*c13.x*c13.y-c20.x*c11.y*c12.x*c13.x*c21.y*c13.y-6*c20.x*c11.y*c21.x*c12.y*c13.x*c13.y-c11.y*c12.x*c20.y*c21.x*c13.x*c13.y-6*c10.x*c20.x*c21.x*c13y3-2*c10.x*c21.x*c12y3*c13.x+6*c10.y*c20.y*c13x3*c21.y+2*c20.x*c21.x*c12y3*c13.x+2*c10.y*c12x3*c21.y*c13.y-2*c12x3*c20.y*c21.y*c13.y-6*c10.x*c10.y*c21.x*c13.x*c13y2+3*c10.x*c11.x*c12.x*c21.y*c13y2-2*c10.x*c11.x*c21.x*c12.y*c13y2-4*c10.x*c11.y*c12.x*c21.x*c13y2+3*c10.y*c11.x*c12.x*c21.x*c13y2+6*c10.x*c10.y*c13x2*c21.y*c13.y+6*c10.x*c20.x*c13.x*c21.y*c13y2-3*c10.x*c11.y*c12.y*c13x2*c21.y+2*c10.x*c12.x*c21.x*c12y2*c13.y+2*c10.x*c12.x*c12y2*c13.x*c21.y+6*c10.x*c20.y*c21.x*c13.x*c13y2+4*c10.y*c11.x*c12.y*c13x2*c21.y+6*c10.y*c20.x*c21.x*c13.x*c13y2+2*c10.y*c11.y*c12.x*c13x2*c21.y-3*c10.y*c11.y*c21.x*c12.y*c13x2+2*c10.y*c12.x*c21.x*c12y2*c13.x-3*c11.x*c20.x*c12.x*c21.y*c13y2+2*c11.x*c20.x*c21.x*c12.y*c13y2+c11.x*c11.y*c21.x*c12y2*c13.x-3*c11.x*c12.x*c20.y*c21.x*c13y2+4*c20.x*c11.y*c12.x*c21.x*c13y2-6*c10.x*c20.y*c13x2*c21.y*c13.y-2*c10.x*c12x2*c12.y*c21.y*c13.y-6*c10.y*c20.x*c13x2*c21.y*c13.y-6*c10.y*c20.y*c21.x*c13x2*c13.y-2*c10.y*c12x2*c21.x*c12.y*c13.y-2*c10.y*c12x2*c12.y*c13.x*c21.y-c11.x*c11.y*c12x2*c21.y*c13.y-4*c11.x*c20.y*c12.y*c13x2*c21.y-2*c11.x*c11y2*c21.x*c13.x*c13.y+3*c20.x*c11.y*c12.y*c13x2*c21.y-2*c20.x*c12.x*c21.x*c12y2*c13.y-2*c20.x*c12.x*c12y2*c13.x*c21.y-6*c20.x*c20.y*c21.x*c13.x*c13y2-2*c11.y*c12.x*c20.y*c13x2*c21.y+3*c11.y*c20.y*c21.x*c12.y*c13x2-2*c12.x*c20.y*c21.x*c12y2*c13.x-c11y2*c12.x*c21.x*c12.y*c13.x+6*c20.x*c20.y*c13x2*c21.y*c13.y+2*c20.x*c12x2*c12.y*c21.y*c13.y+2*c11x2*c11.y*c13.x*c21.y*c13.y+c11x2*c12.x*c12.y*c21.y*c13.y+2*c12x2*c20.y*c21.x*c12.y*c13.y+2*c12x2*c20.y*c12.y*c13.x*c21.y+3*c10x2*c21.x*c13y3-3*c10y2*c13x3*c21.y+3*c20x2*c21.x*c13y3+c11y3*c21.x*c13x2-c11x3*c21.y*c13y2-3*c20y2*c13x3*c21.y-c11.x*c11y2*c13x2*c21.y+c11x2*c11.y*c21.x*c13y2-3*c10x2*c13.x*c21.y*c13y2+3*c10y2*c21.x*c13x2*c13.y-c11x2*c12y2*c13.x*c21.y+c11y2*c12x2*c21.x*c13.y-3*c20x2*c13.x*c21.y*c13y2+3*c20y2*c21.x*c13x2*c13.y,c10.x*c10.y*c11.x*c12.y*c13.x*c13.y-c10.x*c10.y*c11.y*c12.x*c13.x*c13.y+c10.x*c11.x*c11.y*c12.x*c12.y*c13.y-c10.y*c11.x*c11.y*c12.x*c12.y*c13.x-c10.x*c11.x*c20.y*c12.y*c13.x*c13.y+6*c10.x*c20.x*c11.y*c12.y*c13.x*c13.y+c10.x*c11.y*c12.x*c20.y*c13.x*c13.y-c10.y*c11.x*c20.x*c12.y*c13.x*c13.y-6*c10.y*c11.x*c12.x*c20.y*c13.x*c13.y+c10.y*c20.x*c11.y*c12.x*c13.x*c13.y-c11.x*c20.x*c11.y*c12.x*c12.y*c13.y+c11.x*c11.y*c12.x*c20.y*c12.y*c13.x+c11.x*c20.x*c20.y*c12.y*c13.x*c13.y-c20.x*c11.y*c12.x*c20.y*c13.x*c13.y-2*c10.x*c20.x*c12y3*c13.x+2*c10.y*c12x3*c20.y*c13.y-3*c10.x*c10.y*c11.x*c12.x*c13y2-6*c10.x*c10.y*c20.x*c13.x*c13y2+3*c10.x*c10.y*c11.y*c12.y*c13x2-2*c10.x*c10.y*c12.x*c12y2*c13.x-2*c10.x*c11.x*c20.x*c12.y*c13y2-c10.x*c11.x*c11.y*c12y2*c13.x+3*c10.x*c11.x*c12.x*c20.y*c13y2-4*c10.x*c20.x*c11.y*c12.x*c13y2+3*c10.y*c11.x*c20.x*c12.x*c13y2+6*c10.x*c10.y*c20.y*c13x2*c13.y+2*c10.x*c10.y*c12x2*c12.y*c13.y+2*c10.x*c11.x*c11y2*c13.x*c13.y+2*c10.x*c20.x*c12.x*c12y2*c13.y+6*c10.x*c20.x*c20.y*c13.x*c13y2-3*c10.x*c11.y*c20.y*c12.y*c13x2+2*c10.x*c12.x*c20.y*c12y2*c13.x+c10.x*c11y2*c12.x*c12.y*c13.x+c10.y*c11.x*c11.y*c12x2*c13.y+4*c10.y*c11.x*c20.y*c12.y*c13x2-3*c10.y*c20.x*c11.y*c12.y*c13x2+2*c10.y*c20.x*c12.x*c12y2*c13.x+2*c10.y*c11.y*c12.x*c20.y*c13x2+c11.x*c20.x*c11.y*c12y2*c13.x-3*c11.x*c20.x*c12.x*c20.y*c13y2-2*c10.x*c12x2*c20.y*c12.y*c13.y-6*c10.y*c20.x*c20.y*c13x2*c13.y-2*c10.y*c20.x*c12x2*c12.y*c13.y-2*c10.y*c11x2*c11.y*c13.x*c13.y-c10.y*c11x2*c12.x*c12.y*c13.y-2*c10.y*c12x2*c20.y*c12.y*c13.x-2*c11.x*c20.x*c11y2*c13.x*c13.y-c11.x*c11.y*c12x2*c20.y*c13.y+3*c20.x*c11.y*c20.y*c12.y*c13x2-2*c20.x*c12.x*c20.y*c12y2*c13.x-c20.x*c11y2*c12.x*c12.y*c13.x+3*c10y2*c11.x*c12.x*c13.x*c13.y+3*c11.x*c12.x*c20y2*c13.x*c13.y+2*c20.x*c12x2*c20.y*c12.y*c13.y-3*c10x2*c11.y*c12.y*c13.x*c13.y+2*c11x2*c11.y*c20.y*c13.x*c13.y+c11x2*c12.x*c20.y*c12.y*c13.y-3*c20x2*c11.y*c12.y*c13.x*c13.y-c10x3*c13y3+c10y3*c13x3+c20x3*c13y3-c20y3*c13x3-3*c10.x*c20x2*c13y3-c10.x*c11y3*c13x2+3*c10x2*c20.x*c13y3+c10.y*c11x3*c13y2+3*c10.y*c20y2*c13x3+c20.x*c11y3*c13x2+c10x2*c12y3*c13.x-3*c10y2*c20.y*c13x3-c10y2*c12x3*c13.y+c20x2*c12y3*c13.x-c11x3*c20.y*c13y2-c12x3*c20y2*c13.y-c10.x*c11x2*c11.y*c13y2+c10.y*c11.x*c11y2*c13x2-3*c10.x*c10y2*c13x2*c13.y-c10.x*c11y2*c12x2*c13.y+c10.y*c11x2*c12y2*c13.x-c11.x*c11y2*c20.y*c13x2+3*c10x2*c10.y*c13.x*c13y2+c10x2*c11.x*c12.y*c13y2+2*c10x2*c11.y*c12.x*c13y2-2*c10y2*c11.x*c12.y*c13x2-c10y2*c11.y*c12.x*c13x2+c11x2*c20.x*c11.y*c13y2-3*c10.x*c20y2*c13x2*c13.y+3*c10.y*c20x2*c13.x*c13y2+c11.x*c20x2*c12.y*c13y2-2*c11.x*c20y2*c12.y*c13x2+c20.x*c11y2*c12x2*c13.y-c11.y*c12.x*c20y2*c13x2-c10x2*c12.x*c12y2*c13.y-3*c10x2*c20.y*c13.x*c13y2+3*c10y2*c20.x*c13x2*c13.y+c10y2*c12x2*c12.y*c13.x-c11x2*c20.y*c12y2*c13.x+2*c20x2*c11.y*c12.x*c13y2+3*c20.x*c20y2*c13x2*c13.y-c20x2*c12.x*c12y2*c13.y-3*c20x2*c20.y*c13.x*c13y2+c12x2*c20y2*c12.y*c13.x),roots=poly.getRootsInInterval(0,1);for(var i=0;i<roots.length;i++){var s=roots[i],xRoots=(new Polynomial(c13.x,c12.x,c11.x,c10.x-c20.x-s*c21.x-s*s*c22.x-s*s*s*c23.x)).getRoots(),yRoots=(new Polynomial(c13.y,c12.y,c11.y,c10.y-c20.y-s*c21.y-s*s*c22.y-s*s*s*c23.y)).getRoots();if(xRoots.length>0&&yRoots.length>0){var TOLERANCE=1e-4;checkRoots:for(var j=0;j<xRoots.length;j++){var xRoot=xRoots[j];if(0<=xRoot&&xRoot<=1)for(var k=0;k<yRoots.length;k++)if(Math.abs(xRoot-yRoots[k])<TOLERANCE){result.points.push(c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20))));break checkRoots}}}}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier3Circle=function(p1,p2,p3,p4,c,r){return Intersection.intersectBezier3Ellipse(p1,p2,p3,p4,c,r,r)},Intersection.intersectBezier3Ellipse=function(p1,p2,p3,p4,ec,rx,ry){var a,b,c,d,c3,c2,c1,c0,result=new Intersection("No Intersection");a=p1.multiply(-1),b=p2.multiply(3),c=p3.multiply(-3),d=a.add(b.add(c.add(p4))),c3=new Vector2D(d.x,d.y),a=p1.multiply(3),b=p2.multiply(-6),c=p3.multiply(3),d=a.add(b.add(c)),c2=new Vector2D(d.x,d.y),a=p1.multiply(-3),b=p2.multiply(3),c=a.add(b),c1=new Vector2D(c.x,c.y),c0=new Vector2D(p1.x,p1.y);var rxrx=rx*rx,ryry=ry*ry,poly=new Polynomial(c3.x*c3.x*ryry+c3.y*c3.y*rxrx,2*(c3.x*c2.x*ryry+c3.y*c2.y*rxrx),2*(c3.x*c1.x*ryry+c3.y*c1.y*rxrx)+c2.x*c2.x*ryry+c2.y*c2.y*rxrx,2*c3.x*ryry*(c0.x-ec.x)+2*c3.y*rxrx*(c0.y-ec.y)+2*(c2.x*c1.x*ryry+c2.y*c1.y*rxrx),2*c2.x*ryry*(c0.x-ec.x)+2*c2.y*rxrx*(c0.y-ec.y)+c1.x*c1.x*ryry+c1.y*c1.y*rxrx,2*c1.x*ryry*(c0.x-ec.x)+2*c1.y*rxrx*(c0.y-ec.y),c0.x*c0.x*ryry-2*c0.y*ec.y*rxrx-2*c0.x*ec.x*ryry+c0.y*c0.y*rxrx+ec.x*ec.x*ryry+ec.y*ec.y*rxrx-rxrx*ryry),roots=poly.getRootsInInterval(0,1);for(var i=0;i<roots.length;i++){var t=roots[i];result.points.push(c3.multiply(t*t*t).add(c2.multiply(t*t).add(c1.multiply(t).add(c0))))}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier3Line=function(p1,p2,p3,p4,a1,a2){var a,b,c,d,c3,c2,c1,c0,cl,n,min=a1.min(a2),max=a1.max(a2),result=new Intersection("No Intersection");a=p1.multiply(-1),b=p2.multiply(3),c=p3.multiply(-3),d=a.add(b.add(c.add(p4))),c3=new Vector2D(d.x,d.y),a=p1.multiply(3),b=p2.multiply(-6),c=p3.multiply(3),d=a.add(b.add(c)),c2=new Vector2D(d.x,d.y),a=p1.multiply(-3),b=p2.multiply(3),c=a.add(b),c1=new Vector2D(c.x,c.y),c0=new Vector2D(p1.x,p1.y),n=new Vector2D(a1.y-a2.y,a2.x-a1.x),cl=a1.x*a2.y-a2.x*a1.y,roots=(new Polynomial(n.dot(c3),n.dot(c2),n.dot(c1),n.dot(c0)+cl)).getRoots();for(var i=0;i<roots.length;i++){var t=roots[i];if(0<=t&&t<=1){var p5=p1.lerp(p2,t),p6=p2.lerp(p3,t),p7=p3.lerp(p4,t),p8=p5.lerp(p6,t),p9=p6.lerp(p7,t),p10=p8.lerp(p9,t);a1.x==a2.x?min.y<=p10.y&&p10.y<=max.y&&(result.status="Intersection",result.appendPoint(p10)):a1.y==a2.y?min.x<=p10.x&&p10.x<=max.x&&(result.status="Intersection",result.appendPoint(p10)):p10.gte(min)&&p10.lte(max)&&(result.status="Intersection",result.appendPoint(p10))}}return result},Intersection.intersectBezier3Polygon=function(p1,p2,p3,p4,points){var result=new Intersection("No Intersection"),length=points.length;for(var i=0;i<length;i++){var a1=points[i],a2=points[(i+1)%length],inter=Intersection.intersectBezier3Line(p1,p2,p3,p4,a1,a2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectBezier3Rectangle=function(p1,p2,p3,p4,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectBezier3Line(p1,p2,p3,p4,min,topRight),inter2=Intersection.intersectBezier3Line(p1,p2,p3,p4,topRight,max),inter3=Intersection.intersectBezier3Line(p1,p2,p3,p4,max,bottomLeft),inter4=Intersection.intersectBezier3Line(p1,p2,p3,p4,bottomLeft,min),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectCircleCircle=function(c1,r1,c2,r2){var result,r_max=r1+r2,r_min=Math.abs(r1-r2),c_dist=c1.distanceFrom(c2);if(c_dist>r_max)result=new Intersection("Outside");else if(c_dist<r_min)result=new Intersection("Inside");else{result=new Intersection("Intersection");var a=(r1*r1-r2*r2+c_dist*c_dist)/(2*c_dist),h=Math.sqrt(r1*r1-a*a),p=c1.lerp(c2,a/c_dist),b=h/c_dist;result.points.push(new Point2D(p.x-b*(c2.y-c1.y),p.y+b*(c2.x-c1.x))),result.points.push(new Point2D(p.x+b*(c2.y-c1.y),p.y-b*(c2.x-c1.x)))}return result},Intersection.intersectCircleEllipse=function(cc,r,ec,rx,ry){return Intersection.intersectEllipseEllipse(cc,r,r,ec,rx,ry)},Intersection.intersectCircleLine=function(c,r,a1,a2){var result,a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y),b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y)),cc=c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r,deter=b*b-4*a*cc;if(deter<0)result=new Intersection("Outside");else if(deter==0)result=new Intersection("Tangent");else{var e=Math.sqrt(deter),u1=(-b+e)/(2*a),u2=(-b-e)/(2*a);(u1<0||u1>1)&&(u2<0||u2>1)?u1<0&&u2<0||u1>1&&u2>1?result=new Intersection("Outside"):result=new Intersection("Inside"):(result=new Intersection("Intersection"),0<=u1&&u1<=1&&result.points.push(a1.lerp(a2,u1)),0<=u2&&u2<=1&&result.points.push(a1.lerp(a2,u2)))}return result},Intersection.intersectCirclePolygon=function(c,r,points){var result=new Intersection("No Intersection"),length=points.length,inter;for(var i=0;i<length;i++){var a1=points[i],a2=points[(i+1)%length];inter=Intersection.intersectCircleLine(c,r,a1,a2),result.appendPoints(inter.points)}return result.points.length>0?result.status="Intersection":result.status=inter.status,result},Intersection.intersectCircleRectangle=function(c,r,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectCircleLine(c,r,min,topRight),inter2=Intersection.intersectCircleLine(c,r,topRight,max),inter3=Intersection.intersectCircleLine(c,r,max,bottomLeft),inter4=Intersection.intersectCircleLine(c,r,bottomLeft,min),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0?result.status="Intersection":result.status=inter1.status,result},Intersection.intersectEllipseEllipse=function(c1,rx1,ry1,c2,rx2,ry2){var a=[ry1*ry1,0,rx1*rx1,-2*ry1*ry1*c1.x,-2*rx1*rx1*c1.y,ry1*ry1*c1.x*c1.x+rx1*rx1*c1.y*c1.y-rx1*rx1*ry1*ry1],b=[ry2*ry2,0,rx2*rx2,-2*ry2*ry2*c2.x,-2*rx2*rx2*c2.y,ry2*ry2*c2.x*c2.x+rx2*rx2*c2.y*c2.y-rx2*rx2*ry2*ry2],yPoly=Intersection.bezout(a,b),yRoots=yPoly.getRoots(),epsilon=.001,norm0=(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2])*epsilon,norm1=(b[0]*b[0]+2*b[1]*b[1]+b[2]*b[2])*epsilon,result=new Intersection("No Intersection");for(var y=0;y<yRoots.length;y++){var xPoly=new Polynomial(a[0],a[3]+yRoots[y]*a[1],a[5]+yRoots[y]*(a[4]+yRoots[y]*a[2])),xRoots=xPoly.getRoots();for(var x=0;x<xRoots.length;x++){var test=(a[0]*xRoots[x]+a[1]*yRoots[y]+a[3])*xRoots[x]+(a[2]*yRoots[y]+a[4])*yRoots[y]+a[5];Math.abs(test)<norm0&&(test=(b[0]*xRoots[x]+b[1]*yRoots[y]+b[3])*xRoots[x]+(b[2]*yRoots[y]+b[4])*yRoots[y]+b[5],Math.abs(test)<norm1&&result.appendPoint(new Point2D(xRoots[x],yRoots[y])))}}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectEllipseLine=function(c,rx,ry,a1,a2){var result,origin=new Vector2D(a1.x,a1.y),dir=Vector2D.fromPoints(a1,a2),center=new Vector2D(c.x,c.y),diff=origin.subtract(center),mDir=new Vector2D(dir.x/(rx*rx),dir.y/(ry*ry)),mDiff=new Vector2D(diff.x/(rx*rx),diff.y/(ry*ry)),a=dir.dot(mDir),b=dir.dot(mDiff),c=diff.dot(mDiff)-1,d=b*b-a*c;if(d<0)result=new Intersection("Outside");else if(d>0){var root=Math.sqrt(d),t_a=(-b-root)/a,t_b=(-b+root)/a;(t_a<0||1<t_a)&&(t_b<0||1<t_b)?t_a<0&&t_b<0||t_a>1&&t_b>1?result=new Intersection("Outside"):result=new Intersection("Inside"):(result=new Intersection("Intersection"),0<=t_a&&t_a<=1&&result.appendPoint(a1.lerp(a2,t_a)),0<=t_b&&t_b<=1&&result.appendPoint(a1.lerp(a2,t_b)))}else{var t=-b/a;0<=t&&t<=1?(result=new Intersection("Intersection"),result.appendPoint(a1.lerp(a2,t))):result=new Intersection("Outside")}return result},Intersection.intersectEllipsePolygon=function(c,rx,ry,points){var result=new Intersection("No Intersection"),length=points.length;for(var i=0;i<length;i++){var b1=points[i],b2=points[(i+1)%length],inter=Intersection.intersectEllipseLine(c,rx,ry,b1,b2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectEllipseRectangle=function(c,rx,ry,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectEllipseLine(c,rx,ry,min,topRight),inter2=Intersection.intersectEllipseLine(c,rx,ry,topRight,max),inter3=Intersection.intersectEllipseLine(c,rx,ry,max,bottomLeft),inter4=Intersection.intersectEllipseLine(c,rx,ry,bottomLeft,min),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(u_b!=0){var ua=ua_t/u_b,ub=ub_t/u_b;0<=ua&&ua<=1&&0<=ub&&ub<=1?(result=new Intersection("Intersection"),result.points.push({x:a1.x+ua*(a2.x-a1.x),y:a1.y+ua*(a2.y-a1.y)})):result=new Intersection("No Intersection")}else ua_t==0||ub_t==0?result=new Intersection("Coincident"):result=new Intersection("Parallel");return result},Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection("No Intersection"),length=points.length;for(var i=0;i<length;i++){var b1=points[i],b2=points[(i+1)%length],inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectLineRectangle=function(a1,a2,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectLineLine(min,topRight,a1,a2),inter2=Intersection.intersectLineLine(topRight,max,a1,a2),inter3=Intersection.intersectLineLine(max,bottomLeft,a1,a2),inter4=Intersection.intersectLineLine(bottomLeft,min,a1,a2),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection("No Intersection"),length=points1.length;for(var i=0;i<length;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points)}return result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectRayRay=function(a1,a2,b1,b2){var result,ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(u_b!=0){var ua=ua_t/u_b;result=new Intersection("Intersection"),result.points.push(new Point2D(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)))}else ua_t==0||ub_t==0?result=new Intersection("Coincident"):result=new Intersection("Parallel");return result},Intersection.intersectRectangleRectangle=function(a1,a2,b1,b2){var min=a1.min(a2),max=a1.max(a2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectLineRectangle(min,topRight,b1,b2),inter2=Intersection.intersectLineRectangle(topRight,max,b1,b2),inter3=Intersection.intersectLineRectangle(max,bottomLeft,b1,b2),inter4=Intersection.intersectLineRectangle(bottomLeft,min,b1,b2),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.bezout=function(e1,e2){var AB=e1[0]*e2[1]-e2[0]*e1[1],AC=e1[0]*e2[2]-e2[0]*e1[2],AD=e1[0]*e2[3]-e2[0]*e1[3],AE=e1[0]*e2[4]-e2[0]*e1[4],AF=e1[0]*e2[5]-e2[0]*e1[5],BC=e1[1]*e2[2]-e2[1]*e1[2],BE=e1[1]*e2[4]-e2[1]*e1[4],BF=e1[1]*e2[5]-e2[1]*e1[5],CD=e1[2]*e2[3]-e2[2]*e1[3],DE=e1[3]*e2[4]-e2[3]*e1[4],DF=e1[3]*e2[5]-e2[3]*e1[5],BFpDE=BF+DE,BEmCD=BE-CD;return new Polynomial(AB*BC-AC*AC,AB*BEmCD+AD*BC-2*AC*AE,AB*BFpDE+AD*BEmCD-AE*AE-2*AC*AF,AB*DF+AD*BFpDE-2*AE*AF,AD*DF-AF*AF)},define("intersection",function(){});var KeyCodes;(function(KeyCodes){var KeyDown;(function(KeyDown){KeyDown.Backspace=8,KeyDown.Tab=9,KeyDown.Enter=13,KeyDown.Shift=16,KeyDown.Ctrl=17,KeyDown.Alt=18,KeyDown.PauseBreak=19,KeyDown.CapsLock=20,KeyDown.Escape=27,KeyDown.Spacebar=32,KeyDown.PageUp=33,KeyDown.PageDown=34,KeyDown.End=35,KeyDown.Home=36,KeyDown.LeftArrow=37,KeyDown.UpArrow=38,KeyDown.RightArrow=39,KeyDown.DownArrow=40,KeyDown.PrintScrn=44,KeyDown.Insert=45,KeyDown.Delete=46,KeyDown.Zero=48,KeyDown.One=49,KeyDown.Two=50,KeyDown.Three=51,KeyDown.Four=52,KeyDown.Five=53,KeyDown.Six=54,KeyDown.Seven=55,KeyDown.Eight=56,KeyDown.Nine=57,KeyDown.a=65,KeyDown.b=66,KeyDown.c=67,KeyDown.d=68,KeyDown.e=69,KeyDown.f=70,KeyDown.g=71,KeyDown.h=72,KeyDown.i=73,KeyDown.j=74,KeyDown.k=75,KeyDown.l=76,KeyDown.m=77,KeyDown.n=78,KeyDown.o=79,KeyDown.p=80,KeyDown.q=81,KeyDown.r=82,KeyDown.s=83,KeyDown.t=84,KeyDown.u=85,KeyDown.v=86,KeyDown.w=87,KeyDown.x=88,KeyDown.y=89,KeyDown.z=90,KeyDown.LeftWindowKey=91,KeyDown.RightWindowKey=92,KeyDown.SelectKey=93,KeyDown.Numpad0=96,KeyDown.Numpad1=97,KeyDown.Numpad2=98,KeyDown.Numpad3=99,KeyDown.Numpad4=100,KeyDown.Numpad5=101,KeyDown.Numpad6=102,KeyDown.Numpad7=103,KeyDown.Numpad8=104,KeyDown.Numpad9=105,KeyDown.Multiply=106,KeyDown.NumpadPlus=107,KeyDown.NumpadMinus=109,KeyDown.DecimalPoint=110,KeyDown.Divide=111,KeyDown.F1=112,KeyDown.F2=113,KeyDown.F3=114,KeyDown.F4=115,KeyDown.F5=116,KeyDown.F6=117,KeyDown.F7=118,KeyDown.F8=119,KeyDown.F9=120,KeyDown.F10=121,KeyDown.F11=122,KeyDown.F12=123,KeyDown.NumLock=144,KeyDown.ScrollLock=145,KeyDown.Semicolon=186,KeyDown.Equals=187,KeyDown.Comma=188,KeyDown.LessThan=188,KeyDown.Dash=189,KeyDown.Period=190,KeyDown.GreaterThan=190,KeyDown.ForwardSlash=191,KeyDown.QuestionMark=191,KeyDown.GraveAccent=192,KeyDown.Tilde=192,KeyDown.OpenCurlyBracket=219,KeyDown.OpenSquareBracket=219,KeyDown.BackSlash=220,KeyDown.VerticalPipe=220,KeyDown.CloseCurlyBracket=221,KeyDown.CloseSquareBracket=221,KeyDown.Quote=222,KeyDown.CommandFF=224})(KeyDown=KeyCodes.KeyDown||(KeyCodes.KeyDown={}))})(KeyCodes||(KeyCodes={}));var KeyCodes;(function(KeyCodes){var KeyPress;(function(KeyPress){KeyPress.Backspace=8,KeyPress.Enter=13,KeyPress.Spacebar=32,KeyPress.Hash=35,KeyPress.GraveAccent=39,KeyPress.ForwardSlash=32,KeyPress.Asterisk=42,KeyPress.Plus=43,KeyPress.Comma=44,KeyPress.Minus=45,KeyPress.Period=46,KeyPress.ForwardSlash=47,KeyPress.Zero=48,KeyPress.One=49,KeyPress.Two=50,KeyPress.Three=51,KeyPress.Four=52,KeyPress.Five=53,KeyPress.Six=54,KeyPress.Seven=55,KeyPress.Eight=56,KeyPress.Nine=57,KeyPress.Colon=58,KeyPress.Semicolon=59,KeyPress.LessThan=60,KeyPress.Equals=61,KeyPress.GreaterThan=62,KeyPress.QuestionMark=63,KeyPress.At=64,KeyPress.OpenSquareBracket=91,KeyPress.BackSlash=92,KeyPress.CloseSquareBracket=93,KeyPress.a=97,KeyPress.b=98,KeyPress.c=99,KeyPress.d=100,KeyPress.e=101,KeyPress.f=102,KeyPress.g=103,KeyPress.h=104,KeyPress.i=105,KeyPress.j=106,KeyPress.k=107,KeyPress.l=108,KeyPress.m=109,KeyPress.n=110,KeyPress.o=111,KeyPress.p=112,KeyPress.q=113,KeyPress.r=114,KeyPress.s=115,KeyPress.t=116,KeyPress.u=117,KeyPress.v=118,KeyPress.w=119,KeyPress.x=120,KeyPress.y=121,KeyPress.z=122,KeyPress.OpenCurlyBracket=123,KeyPress.VerticalPipe=124,KeyPress.CloseCurlyBracket=125,KeyPress.Tilde=126})(KeyPress=KeyCodes.KeyPress||(KeyCodes.KeyPress={}))})(KeyCodes||(KeyCodes={})),define("keycodes",function(){}),typeof Worker=="undefined"||typeof location!="undefined"&&location.protocol==="file:"?typeof global!="undefined"&&typeof require!="undefined"?this.LZMA=function(lzma_path){return require(lzma_path||"./lzma_worker.js").LZMA}:typeof window!="undefined"&&window.document?function(){var that=this,global_var,req=function req(path){var script_tag=document.createElement("script");script_tag.type="text/javascript",script_tag.src=path,script_tag.onload=function(){that.LZMA=non_worker_lzma},document.getElementsByTagName("head")[0].appendChild(script_tag)};typeof window!="undefined"?global_var=window:global&&(global_var=global);function non_worker_lzma(path){var fake_lzma;return req(path),fake_lzma={compress:function compress(mixed,mode,on_finish,on_progress){global_var.LZMA_WORKER?global_var.LZMA_WORKER.compress(mixed,mode,on_finish,on_progress):setTimeout(function(){fake_lzma.compress(mixed,mode,on_finish,on_progress)},50)},decompress:function decompress(byte_arr,on_finish,on_progress){global_var.LZMA_WORKER?global_var.LZMA_WORKER.decompress(byte_arr,on_finish,on_progress):setTimeout(function(){fake_lzma.decompress(byte_arr,on_finish,on_progress)},50)},worker:function worker(){return null}},fake_lzma}that.LZMA=non_worker_lzma}():console.error("Can't load the worker. Sorry."):this.LZMA=function(lzma_path){var action_compress=1,action_decompress=2,action_progress=3,callback_obj={},lzma_worker=new Worker(lzma_path||"./lzma_worker-min.js");return lzma_worker.onmessage=function onmessage(e){e.data.action===action_progress?callback_obj[e.data.cbn]&&typeof callback_obj[e.data.cbn].on_progress=="function"&&callback_obj[e.data.cbn].on_progress(e.data.result):callback_obj[e.data.cbn]&&typeof callback_obj[e.data.cbn].on_finish=="function"&&(callback_obj[e.data.cbn].on_finish(e.data.result,e.data.error),delete callback_obj[e.data.cbn])},lzma_worker.onerror=function(event){var err=new Error(event.message+" ("+event.filename+":"+event.lineno+")");for(var cbn in callback_obj)callback_obj[cbn].on_finish(null,err);console.error("Uncaught error in lzma_worker",err)},function(){function send_to_worker(action,data,mode,on_finish,on_progress){var cbn;do cbn=Math.floor(Math.random()*1e7);while(typeof callback_obj[cbn]!="undefined");callback_obj[cbn]={on_finish:on_finish,on_progress:on_progress},lzma_worker.postMessage({action:action,cbn:cbn,data:data,mode:mode})}return{compress:function compress(mixed,mode,on_finish,on_progress){send_to_worker(action_compress,mixed,mode,on_finish,on_progress)},decompress:function decompress(byte_arr,on_finish,on_progress){send_to_worker(action_decompress,byte_arr,!1,on_finish,on_progress)},worker:function worker(){return lzma_worker}}}()},define("lzma",function(){}),function(window){var WORKER_PATH="recorderWorker.js",RecorderJS=function(source,cfg){var config=cfg||{},bufferLen=config.bufferLen||4096;this.context=source.context,this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(bufferLen,2,2):this.node=this.context.createJavaScriptNode(bufferLen,2,2);var worker=new Worker(config.workerPath||WORKER_PATH);worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var recording=!1,currCallback;this.node.onaudioprocess=function(e){if(!recording)return;worker.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]})},this.configure=function(cfg){for(var prop in cfg)cfg.hasOwnProperty(prop)&&(config[prop]=cfg[prop])},this.record=function(){recording=!0},this.stop=function(){recording=!1},this.clear=function(){worker.postMessage({command:"clear"})},this.getBuffers=function(cb){currCallback=cb||config.callback,worker.postMessage({command:"getBuffers"})},this.exportWAV=function(cb,type){currCallback=cb||config.callback,type=type||config.type||"audio/wav";if(!currCallback)throw new Error("Callback not set");worker.postMessage({command:"exportWAV",type:type})},this.exportMonoWAV=function(cb,type){currCallback=cb||config.callback,type=type||config.type||"audio/wav";if(!currCallback)throw new Error("Callback not set");worker.postMessage({command:"exportMonoWAV",type:type})},this.setupDownload=function(blob,filename){var url=(window.URL||window.webkitURL).createObjectURL(blob),link=window.document.createElement("a");link.href=url,link.download=filename||"output.wav";var click=document.createEvent("Event");click.initEvent("click",!0,!0),link.dispatchEvent(click)},worker.onmessage=function(e){var blob=e.data;currCallback(blob)},source.connect(this.node),this.node.connect(this.context.destination)};window.RecorderJS=RecorderJS}(window),define("Recorderjs/recorder",function(){}),define("Tone/signal/SignalBase",["Tone/core/Tone"],function(Tone){"use strict";return Tone.SignalBase=function(){},Tone.extend(Tone.SignalBase),Tone.SignalBase.prototype.connect=function(node,outputNumber,inputNumber){return Tone.Signal&&Tone.Signal===node.constructor||Tone.Param&&Tone.Param===node.constructor||Tone.TimelineSignal&&Tone.TimelineSignal===node.constructor?(node._param.cancelScheduledValues(0),node._param.value=0,node.overridden=!0):node instanceof AudioParam&&(node.cancelScheduledValues(0),node.value=0),Tone.prototype.connect.call(this,node,outputNumber,inputNumber),this},Tone.SignalBase}),define("Tone/signal/WaveShaper",["Tone/core/Tone","Tone/signal/SignalBase"],function(Tone){"use strict";return Tone.WaveShaper=function(mapping,bufferLen){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(mapping)?this.curve=mapping:isFinite(mapping)||this.isUndef(mapping)?this._curve=new Float32Array(this.defaultArg(mapping,1024)):this.isFunction(mapping)&&(this._curve=new Float32Array(this.defaultArg(bufferLen,1024)),this.setMap(mapping))},Tone.extend(Tone.WaveShaper,Tone.SignalBase),Tone.WaveShaper.prototype.setMap=function(mapping){for(var i=0,len=this._curve.length;i<len;i++){var normalized=i/len*2-1;this._curve[i]=mapping(normalized,i)}return this._shaper.curve=this._curve,this},Object.defineProperty(Tone.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(mapping){this._curve=new Float32Array(mapping),this._shaper.curve=this._curve}}),Object.defineProperty(Tone.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){if(["none","2x","4x"].indexOf(oversampling)===-1)throw new Error("invalid oversampling: "+oversampling);this._shaper.oversample=oversampling}}),Tone.WaveShaper.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},Tone.WaveShaper}),define("Tone/core/Type",["Tone/core/Tone"],function(Tone){"use strict";Tone.Type={Default:"number",Time:"time",Frequency:"frequency",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transportTime",Ticks:"tick",Note:"note",Milliseconds:"milliseconds",Notation:"notation"},Tone.prototype.isNowRelative=function(){var nowRelative=new RegExp(/^\s*\+(.)+/i);return function(note){return nowRelative.test(note)}}(),Tone.prototype.isTicks=function(){var tickFormat=new RegExp(/^\d+i$/i);return function(note){return tickFormat.test(note)}}(),Tone.prototype.isNotation=function(){var notationFormat=new RegExp(/^[0-9]+[mnt]$/i);return function(note){return notationFormat.test(note)}}(),Tone.prototype.isTransportTime=function(){var transportTimeFormat=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(transportTime){return transportTimeFormat.test(transportTime)}}(),Tone.prototype.isNote=function(){var noteFormat=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(note){return noteFormat.test(note)}}(),Tone.prototype.isFrequency=function(){var freqFormat=new RegExp(/^\d*\.?\d+hz$/i);return function(freq){return freqFormat.test(freq)}}();function getTransportBpm(){return Tone.Transport&&Tone.Transport.bpm?Tone.Transport.bpm.value:120}function getTransportTimeSignature(){return Tone.Transport&&Tone.Transport.timeSignature?Tone.Transport.timeSignature:4}Tone.prototype.notationToSeconds=function(notation,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm()),timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var beatTime=60/bpm;notation==="1n"&&(notation="1m");var subdivision=parseInt(notation,10),beats=0;subdivision===0&&(beats=0);var lastLetter=notation.slice(-1);return lastLetter==="t"?beats=4/subdivision*2/3:lastLetter==="n"?beats=4/subdivision:lastLetter==="m"?beats=subdivision*timeSignature:beats=0,beatTime*beats},Tone.prototype.transportTimeToSeconds=function(transportTime,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm()),timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var measures=0,quarters=0,sixteenths=0,split=transportTime.split(":");split.length===2?(measures=parseFloat(split[0]),quarters=parseFloat(split[1])):split.length===1?quarters=parseFloat(split[0]):split.length===3&&(measures=parseFloat(split[0]),quarters=parseFloat(split[1]),sixteenths=parseFloat(split[2]));var beats=measures*timeSignature+quarters+sixteenths/4;return beats*(60/bpm)},Tone.prototype.ticksToSeconds=function(ticks,bpm){if(this.isUndef(Tone.Transport))return 0;ticks=parseFloat(ticks),bpm=this.defaultArg(bpm,getTransportBpm());var tickTime=60/bpm/Tone.Transport.PPQ;return tickTime*ticks},Tone.prototype.frequencyToSeconds=function(freq){return 1/parseFloat(freq)},Tone.prototype.samplesToSeconds=function(samples){return samples/this.context.sampleRate},Tone.prototype.secondsToSamples=function(seconds){return seconds*this.context.sampleRate},Tone.prototype.secondsToTransportTime=function(seconds,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm()),timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var quarterTime=60/bpm,quarters=seconds/quarterTime,measures=Math.floor(quarters/timeSignature),sixteenths=quarters%1*4;quarters=Math.floor(quarters)%timeSignature;var progress=[measures,quarters,sixteenths];return progress.join(":")},Tone.prototype.secondsToFrequency=function(seconds){return 1/seconds},Tone.prototype.toTransportTime=function(time,bpm,timeSignature){var seconds=this.toSeconds(time);return this.secondsToTransportTime(seconds,bpm,timeSignature)},Tone.prototype.toFrequency=function(freq,now){return this.isFrequency(freq)?parseFloat(freq):this.isNotation(freq)||this.isTransportTime(freq)?this.secondsToFrequency(this.toSeconds(freq,now)):this.isNote(freq)?this.noteToFrequency(freq):freq},Tone.prototype.toTicks=function(time){if(this.isUndef(Tone.Transport))return 0;var bpm=Tone.Transport.bpm.value,plusNow=0;if(this.isNowRelative(time))time=time.replace("+",""),plusNow=Tone.Transport.ticks;else if(this.isUndef(time))return Tone.Transport.ticks;var seconds=this.toSeconds(time),quarter=60/bpm,quarters=seconds/quarter,tickNum=quarters*Tone.Transport.PPQ;return Math.round(tickNum+plusNow)},Tone.prototype.toSamples=function(time){var seconds=this.toSeconds(time);return Math.round(seconds*this.context.sampleRate)},Tone.prototype.toSeconds=function(time,now){now=this.defaultArg(now,this.now());if(this.isNumber(time))return time;if(this.isString(time)){var plusTime=0;this.isNowRelative(time)&&(time=time.replace("+",""),plusTime=now);var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens)for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,""),symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}if(time.indexOf("@")!==-1){var quantizationSplit=time.split("@");if(!!this.isUndef(Tone.Transport))throw new Error("quantization requires Tone.Transport");var toQuantize=quantizationSplit[0].trim();toQuantize===""&&(toQuantize=undefined),plusTime>0&&(toQuantize="+"+toQuantize,plusTime=0);var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){var originalTime=time;for(var i=0;i<components.length;i++){var symb=components[i].trim();if(symb!==""){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(e){throw new EvalError("cannot evaluate Time: "+originalTime)}}else this.isNotation(time)?time=this.notationToSeconds(time):this.isTransportTime(time)?time=this.transportTimeToSeconds(time):this.isFrequency(time)?time=this.frequencyToSeconds(time):this.isTicks(time)?time=this.ticksToSeconds(time):time=parseFloat(time)}return time+plusTime}return now},Tone.prototype.toNotation=function(time,bpm,timeSignature){var testNotations=["1m","2n","4n","8n","16n","32n","64n","128n"],retNotation=toNotationHelper.call(this,time,bpm,timeSignature,testNotations),testTripletNotations=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],retTripletNotation=toNotationHelper.call(this,time,bpm,timeSignature,testTripletNotations);return retTripletNotation.split("+").length<retNotation.split("+").length?retTripletNotation:retNotation};function toNotationHelper(time,bpm,timeSignature,testNotations){var seconds=this.toSeconds(time),threshold=this.notationToSeconds(testNotations[testNotations.length-1],bpm,timeSignature),retNotation="";for(var i=0;i<testNotations.length;i++){var notationTime=this.notationToSeconds(testNotations[i],bpm,timeSignature),multiple=seconds/notationTime,floatingPointError=1e-6;1-multiple%1<floatingPointError&&(multiple+=floatingPointError),multiple=Math.floor(multiple);if(multiple>0){multiple===1?retNotation+=testNotations[i]:retNotation+=multiple.toString()+"*"+testNotations[i],seconds-=multiple*notationTime;if(seconds<threshold)break;retNotation+=" + "}}return retNotation===""&&(retNotation="0"),retNotation}Tone.prototype.fromUnits=function(val,units){if(!this.convert&&!this.isUndef(this.convert))return val;switch(units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}},Tone.prototype.toUnits=function(val,units){if(!this.convert&&!this.isUndef(this.convert))return val;switch(units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}};var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.A4=440,Tone.prototype.noteToFrequency=function(note){var parts=note.split(/(-?\d+)/);if(parts.length===3){var index=noteToScaleIndex[parts[0].toLowerCase()],octave=parts[1],noteNumber=index+(parseInt(octave,10)+1)*12;return this.midiToFrequency(noteNumber)}return 0},Tone.prototype.frequencyToNote=function(freq){var log=Math.log(freq/Tone.A4)/Math.LN2,noteNumber=Math.round(12*log)+57,octave=Math.floor(noteNumber/12);octave<0&&(noteNumber+=-12*octave);var noteName=scaleIndexToNote[noteNumber%12];return noteName+octave.toString()},Tone.prototype.intervalToFrequencyRatio=function(interval){return Math.pow(2,interval/12)},Tone.prototype.midiToNote=function(midiNumber){var octave=Math.floor(midiNumber/12)-1,note=midiNumber%12;return scaleIndexToNote[note]+octave},Tone.prototype.noteToMidi=function(note){var parts=note.split(/(\d+)/);if(parts.length===3){var index=noteToScaleIndex[parts[0].toLowerCase()],octave=parts[1];return index+(parseInt(octave,10)+1)*12}return 0},Tone.prototype.midiToFrequency=function(midi){return Tone.A4*Math.pow(2,(midi-69)/12)},Tone}),define("Tone/core/Param",["Tone/core/Tone","Tone/core/Type"],function(Tone){"use strict";return Tone.Param=function(){var options=this.optionsObject(arguments,["param","units","convert"],Tone.Param.defaults);this._param=this.input=options.param,this.units=options.units,this.convert=options.convert,this.overridden=!1,this.isUndef(options.value)||(this.value=options.value)},Tone.extend(Tone.Param),Tone.Param.defaults={units:Tone.Type.Default,convert:!0,param:undefined},Object.defineProperty(Tone.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(value){var convertedVal=this._fromUnits(value);this._param.value=convertedVal}}),Tone.Param.prototype._fromUnits=function(val){if(!this.convert&&!this.isUndef(this.convert))return val;switch(this.units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}},Tone.Param.prototype._toUnits=function(val){if(!this.convert&&!this.isUndef(this.convert))return val;switch(this.units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}},Tone.Param.prototype._minOutput=1e-5,Tone.Param.prototype.setValueAtTime=function(value,time){return value=this._fromUnits(value),this._param.setValueAtTime(value,this.toSeconds(time)),this},Tone.Param.prototype.setRampPoint=function(now){now=this.defaultArg(now,this.now());var currentVal=this._param.value;return this._param.setValueAtTime(currentVal,now),this},Tone.Param.prototype.linearRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),this._param.linearRampToValueAtTime(value,this.toSeconds(endTime)),this},Tone.Param.prototype.exponentialRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),this._param.exponentialRampToValueAtTime(value,this.toSeconds(endTime)),this},Tone.Param.prototype.exponentialRampToValue=function(value,rampTime){var now=this.now(),currentVal=this.value;return this.setValueAtTime(Math.max(currentVal,this._minOutput),now),this.exponentialRampToValueAtTime(value,now+this.toSeconds(rampTime)),this},Tone.Param.prototype.linearRampToValue=function(value,rampTime){var now=this.now();return this.setRampPoint(now),this.linearRampToValueAtTime(value,now+this.toSeconds(rampTime)),this},Tone.Param.prototype.setTargetAtTime=function(value,startTime,timeConstant){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),timeConstant=Math.max(this._minOutput,timeConstant),this._param.setTargetAtTime(value,this.toSeconds(startTime),timeConstant),this},Tone.Param.prototype.setValueCurveAtTime=function(values,startTime,duration){for(var i=0;i<values.length;i++)values[i]=this._fromUnits(values[i]);return this._param.setValueCurveAtTime(values,this.toSeconds(startTime),this.toSeconds(duration)),this},Tone.Param.prototype.cancelScheduledValues=function(startTime){return this._param.cancelScheduledValues(this.toSeconds(startTime)),this},Tone.Param.prototype.rampTo=function(value,rampTime){return rampTime=this.defaultArg(rampTime,0),this.units===Tone.Type.Frequency||this.units===Tone.Type.BPM?this.exponentialRampToValue(value,rampTime):this.linearRampToValue(value,rampTime),this},Tone.Param.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._param=null,this},Tone.Param}),define("Tone/core/Gain",["Tone/core/Tone","Tone/core/Param","Tone/core/Type"],function(Tone){"use strict";return Tone.Gain=function(){var options=this.optionsObject(arguments,["gain","units"],Tone.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new Tone.Param({param:this._gainNode.gain,units:options.units,value:options.gain,convert:options.convert}),this._readOnly("gain")},Tone.extend(Tone.Gain),Tone.Gain.defaults={gain:1,convert:!0},Tone.Gain.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},Tone.Gain}),define("Tone/signal/Signal",["Tone/core/Tone","Tone/signal/WaveShaper","Tone/core/Type","Tone/core/Param","Tone/core/Gain"],function(Tone){"use strict";return Tone.Signal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);this.output=this._gain=this.context.createGain(),options.param=this._gain.gain,Tone.Param.call(this,options),this.input=this._param=this._gain.gain,Tone.Signal._constant.chain(this._gain)},Tone.extend(Tone.Signal,Tone.Param),Tone.Signal.defaults={value:0,units:Tone.Type.Default,convert:!0},Tone.Signal.prototype.connect=Tone.SignalBase.prototype.connect,Tone.Signal.prototype.dispose=function(){return Tone.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},Tone.Signal._constant=null,Tone._initAudioContext(function(audioContext){var buffer=audioContext.createBuffer(1,128,audioContext.sampleRate),arr=buffer.getChannelData(0);for(var i=0;i<arr.length;i++)arr[i]=1;Tone.Signal._constant=audioContext.createBufferSource(),Tone.Signal._constant.channelCount=1,Tone.Signal._constant.channelCountMode="explicit",Tone.Signal._constant.buffer=buffer,Tone.Signal._constant.loop=!0,Tone.Signal._constant.start(0),Tone.Signal._constant.noGC()}),Tone.Signal}),define("Tone/core/Timeline",["Tone/core/Tone","Tone/core/Type"],function(Tone){"use strict";return Tone.Timeline=function(){var options=this.optionsObject(arguments,["memory"],Tone.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=options.memory},Tone.extend(Tone.Timeline),Tone.Timeline.defaults={memory:Infinity},Object.defineProperty(Tone.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),Tone.Timeline.prototype.addEvent=function(event){if(this.isUndef(event.time))throw new Error("events must have a time attribute");event.time=this.toSeconds(event.time);if(this._timeline.length){var index=this._search(event.time);this._timeline.splice(index+1,0,event)}else this._timeline.push(event);if(this.length>this.memory){var diff=this.length-this.memory;this._timeline.splice(0,diff)}return this},Tone.Timeline.prototype.removeEvent=function(event){if(this._iterating)this._toRemove.push(event);else{var index=this._timeline.indexOf(event);index!==-1&&this._timeline.splice(index,1)}return this},Tone.Timeline.prototype.getEvent=function(time){time=this.toSeconds(time);var index=this._search(time);return index!==-1?this._timeline[index]:null},Tone.Timeline.prototype.getEventAfter=function(time){time=this.toSeconds(time);var index=this._search(time);return index+1<this._timeline.length?this._timeline[index+1]:null},Tone.Timeline.prototype.getEventBefore=function(time){time=this.toSeconds(time);var index=this._search(time);return index-1>=0?this._timeline[index-1]:null},Tone.Timeline.prototype.cancel=function(after){if(this._timeline.length>1){after=this.toSeconds(after);var index=this._search(after);index>=0?this._timeline=this._timeline.slice(0,index):this._timeline=[]}else this._timeline.length===1&&this._timeline[0].time>=after&&(this._timeline=[]);return this},Tone.Timeline.prototype.cancelBefore=function(time){if(this._timeline.length){time=this.toSeconds(time);var index=this._search(time);index>=0&&(this._timeline=this._timeline.slice(index+1))}return this},Tone.Timeline.prototype._search=function(time){var beginning=0,len=this._timeline.length,end=len;while(beginning<=end&&beginning<len){var midPoint=Math.floor(beginning+(end-beginning)/2),event=this._timeline[midPoint];if(event.time===time){for(var i=midPoint;i<this._timeline.length;i++){var testEvent=this._timeline[i];testEvent.time===time&&(midPoint=i)}return midPoint}event.time>time?end=midPoint-1:event.time<time&&(beginning=midPoint+1)}return beginning-1},Tone.Timeline.prototype._iterate=function(callback,lowerBound,upperBound){this._iterating=!0,lowerBound=this.defaultArg(lowerBound,0),upperBound=this.defaultArg(upperBound,this._timeline.length-1);for(var i=lowerBound;i<=upperBound;i++)callback(this._timeline[i]);this._iterating=!1;if(this._toRemove.length>0){for(var j=0;j<this._toRemove.length;j++){var index=this._timeline.indexOf(this._toRemove[j]);index!==-1&&this._timeline.splice(index,1)}this._toRemove=[]}},Tone.Timeline.prototype.forEach=function(callback){return this._iterate(callback),this},Tone.Timeline.prototype.forEachBefore=function(time,callback){time=this.toSeconds(time);var upperBound=this._search(time);return upperBound!==-1&&this._iterate(callback,0,upperBound),this},Tone.Timeline.prototype.forEachAfter=function(time,callback){time=this.toSeconds(time);var lowerBound=this._search(time);return this._iterate(callback,lowerBound+1),this},Tone.Timeline.prototype.forEachFrom=function(time,callback){time=this.toSeconds(time);var lowerBound=this._search(time);while(lowerBound>=0&&this._timeline[lowerBound].time>=time)lowerBound--;return this._iterate(callback,lowerBound+1),this},Tone.Timeline.prototype.forEachAtTime=function(time,callback){time=this.toSeconds(time);var upperBound=this._search(time);return upperBound!==-1&&this._iterate(function(event){event.time===time&&callback(event)},0,upperBound),this},Tone.Timeline.prototype.dispose=function(){Tone.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},Tone.Timeline}),define("Tone/signal/TimelineSignal",["Tone/core/Tone","Tone/signal/Signal","Tone/core/Timeline"],function(Tone){"use strict";return Tone.TimelineSignal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);Tone.Signal.apply(this,options),options.param=this._param,Tone.Param.call(this,options),this._events=new Tone.Timeline(10),this._initial=this._fromUnits(this._param.value)},Tone.extend(Tone.TimelineSignal,Tone.Param),Tone.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"},Object.defineProperty(Tone.TimelineSignal.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(value){var convertedVal=this._fromUnits(value);this._initial=convertedVal,this._param.value=convertedVal}}),Tone.TimelineSignal.prototype.setValueAtTime=function(value,startTime){return value=this._fromUnits(value),startTime=this.toSeconds(startTime),this._events.addEvent({type:Tone.TimelineSignal.Type.Set,value:value,time:startTime}),this._param.setValueAtTime(value,startTime),this},Tone.TimelineSignal.prototype.linearRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),endTime=this.toSeconds(endTime),this._events.addEvent({type:Tone.TimelineSignal.Type.Linear,value:value,time:endTime}),this._param.linearRampToValueAtTime(value,endTime),this},Tone.TimelineSignal.prototype.exponentialRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),endTime=this.toSeconds(endTime),this._events.addEvent({type:Tone.TimelineSignal.Type.Exponential,value:value,time:endTime}),this._param.exponentialRampToValueAtTime(value,endTime),this},Tone.TimelineSignal.prototype.setTargetAtTime=function(value,startTime,timeConstant){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),timeConstant=Math.max(this._minOutput,timeConstant),startTime=this.toSeconds(startTime),this._events.addEvent({type:Tone.TimelineSignal.Type.Target,value:value,time:startTime,constant:timeConstant}),this._param.setTargetAtTime(value,startTime,timeConstant),this},Tone.TimelineSignal.prototype.cancelScheduledValues=function(after){return this._events.cancel(after),this._param.cancelScheduledValues(this.toSeconds(after)),this},Tone.TimelineSignal.prototype.setRampPoint=function(time){time=this.toSeconds(time);var val=this.getValueAtTime(time),after=this._searchAfter(time);return after&&(this.cancelScheduledValues(time),after.type===Tone.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(val,time):after.type===Tone.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(val,time)),this.setValueAtTime(val,time),this},Tone.TimelineSignal.prototype.linearRampToValueBetween=function(value,start,finish){return this.setRampPoint(start),this.linearRampToValueAtTime(value,finish),this},Tone.TimelineSignal.prototype.exponentialRampToValueBetween=function(value,start,finish){return this.setRampPoint(start),this.exponentialRampToValueAtTime(value,finish),this},Tone.TimelineSignal.prototype._searchBefore=function(time){return this._events.getEvent(time)},Tone.TimelineSignal.prototype._searchAfter=function(time){return this._events.getEventAfter(time)},Tone.TimelineSignal.prototype.getValueAtTime=function(time){var after=this._searchAfter(time),before=this._searchBefore(time),value=this._initial;if(before===null)value=this._initial;else if(before.type===Tone.TimelineSignal.Type.Target){var previous=this._events.getEventBefore(before.time),previouVal;previous===null?previouVal=this._initial:previouVal=previous.value,value=this._exponentialApproach(before.time,previouVal,before.value,before.constant,time)}else after===null?value=before.value:after.type===Tone.TimelineSignal.Type.Linear?value=this._linearInterpolate(before.time,before.value,after.time,after.value,time):after.type===Tone.TimelineSignal.Type.Exponential?value=this._exponentialInterpolate(before.time,before.value,after.time,after.value,time):value=before.value;return value},Tone.TimelineSignal.prototype.connect=Tone.SignalBase.prototype.connect,Tone.TimelineSignal.prototype._exponentialApproach=function(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)},Tone.TimelineSignal.prototype._linearInterpolate=function(t0,v0,t1,v1,t){return v0+(v1-v0)*((t-t0)/(t1-t0))},Tone.TimelineSignal.prototype._exponentialInterpolate=function(t0,v0,t1,v1,t){return v0=Math.max(this._minOutput,v0),v0*Math.pow(v1/v0,(t-t0)/(t1-t0))},Tone.TimelineSignal.prototype.dispose=function(){Tone.Signal.prototype.dispose.call(this),Tone.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},Tone.TimelineSignal}),define("Tone/signal/Pow",["Tone/core/Tone","Tone/signal/WaveShaper"],function(Tone){"use strict";return Tone.Pow=function(exp){this._exp=this.defaultArg(exp,1),this._expScaler=this.input=this.output=new Tone.WaveShaper(this._expFunc(this._exp),8192)},Tone.extend(Tone.Pow,Tone.SignalBase),Object.defineProperty(Tone.Pow.prototype,"value",{get:function(){return this._exp},set:function(exp){this._exp=exp,this._expScaler.setMap(this._expFunc(this._exp))}}),Tone.Pow.prototype._expFunc=function(exp){return function(val){return Math.pow(Math.abs(val),exp)}},Tone.Pow.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},Tone.Pow}),define("Tone/component/Envelope",["Tone/core/Tone","Tone/signal/TimelineSignal","Tone/signal/Pow","Tone/core/Type"],function(Tone){"use strict";return Tone.Envelope=function(){var options=this.optionsObject(arguments,["attack","decay","sustain","release"],Tone.Envelope.defaults);this.attack=options.attack,this.decay=options.decay,this.sustain=options.sustain,this.release=options.release,this._attackCurve=Tone.Envelope.Type.Linear,this._releaseCurve=Tone.Envelope.Type.Exponential,this._minOutput=1e-5,this._sig=this.output=new Tone.TimelineSignal,this._sig.setValueAtTime(this._minOutput,0),this.attackCurve=options.attackCurve,this.releaseCurve=options.releaseCurve},Tone.extend(Tone.Envelope),Tone.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Tone.Envelope.prototype._timeMult=.25,Object.defineProperty(Tone.Envelope.prototype,"value",{get:function(){return this._sig.value}}),Object.defineProperty(Tone.Envelope.prototype,"attackCurve",{get:function(){return this._attackCurve},set:function(type){if(type!==Tone.Envelope.Type.Linear&&type!==Tone.Envelope.Type.Exponential)throw Error('attackCurve must be either "linear" or "exponential". Invalid type: ',type);this._attackCurve=type}}),Object.defineProperty(Tone.Envelope.prototype,"releaseCurve",{get:function(){return this._releaseCurve},set:function(type){if(type!==Tone.Envelope.Type.Linear&&type!==Tone.Envelope.Type.Exponential)throw Error('releaseCurve must be either "linear" or "exponential". Invalid type: ',type);this._releaseCurve=type}}),Tone.Envelope.prototype.triggerAttack=function(time,velocity){var now=this.now()+this.blockTime;time=this.toSeconds(time,now);var attack=this.toSeconds(this.attack)+time,decay=this.toSeconds(this.decay);return velocity=this.defaultArg(velocity,1),this._attackCurve===Tone.Envelope.Type.Linear?this._sig.linearRampToValueBetween(velocity,time,attack):this._sig.exponentialRampToValueBetween(velocity,time,attack),this._sig.setValueAtTime(velocity,attack),this._sig.exponentialRampToValueAtTime(this.sustain*velocity,attack+decay),this},Tone.Envelope.prototype.triggerRelease=function(time){var now=this.now()+this.blockTime;time=this.toSeconds(time,now);var release=this.toSeconds(this.release);return this._releaseCurve===Tone.Envelope.Type.Linear?this._sig.linearRampToValueBetween(this._minOutput,time,time+release):this._sig.exponentialRampToValueBetween(this._minOutput,time,release+time),this},Tone.Envelope.prototype.triggerAttackRelease=function(duration,time,velocity){return time=this.toSeconds(time),this.triggerAttack(time,velocity),this.triggerRelease(time+this.toSeconds(duration)),this},Tone.Envelope.prototype.connect=Tone.Signal.prototype.connect,Tone.Envelope.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this},Tone.Envelope.Phase={Attack:"attack",Decay:"decay",Sustain:"sustain",Release:"release",Standby:"standby"},Tone.Envelope.Type={Linear:"linear",Exponential:"exponential"},Tone.Envelope}),define("Tone/component/AmplitudeEnvelope",["Tone/core/Tone","Tone/component/Envelope","Tone/core/Gain"],function(Tone){"use strict";return Tone.AmplitudeEnvelope=function(){Tone.Envelope.apply(this,arguments),this.input=this.output=new Tone.Gain,this._sig.connect(this.output.gain)},Tone.extend(Tone.AmplitudeEnvelope,Tone.Envelope),Tone.AmplitudeEnvelope.prototype.dispose=function(){return this.input.dispose(),this.input=null,Tone.Envelope.prototype.dispose.call(this),this},Tone.AmplitudeEnvelope}),define("Tone/component/Filter",["Tone/core/Tone","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Filter=function(){Tone.call(this);var options=this.optionsObject(arguments,["frequency","type","rolloff"],Tone.Filter.defaults);this._filters=[],this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=new Tone.Signal(0,Tone.Type.Cents),this.gain=new Tone.Signal({value:options.gain,convert:!1}),this.Q=new Tone.Signal(options.Q),this._type=options.type,this._rolloff=options.rolloff,this.rolloff=options.rolloff,this._readOnly(["detune","frequency","gain","Q"])},Tone.extend(Tone.Filter),Tone.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(Tone.Filter.prototype,"type",{get:function(){return this._type},set:function(type){var types=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(types.indexOf(type)===-1)throw new Error("Tone.Filter does not have filter type "+type);this._type=type;for(var i=0;i<this._filters.length;i++)this._filters[i].type=type}}),Object.defineProperty(Tone.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(rolloff){rolloff=parseInt(rolloff,10);var possibilities=[-12,-24,-48,-96],cascadingCount=possibilities.indexOf(rolloff);if(cascadingCount===-1)throw new Error("Filter rolloff can only be -12, -24, -48 or -96");cascadingCount+=1,this._rolloff=rolloff,this.input.disconnect();for(var i=0;i<this._filters.length;i++)this._filters[i].disconnect(),this._filters[i]=null;this._filters=new Array(cascadingCount);for(var count=0;count<cascadingCount;count++){var filter=this.context.createBiquadFilter();filter.type=this._type,this.frequency.connect(filter.frequency),this.detune.connect(filter.detune),this.Q.connect(filter.Q),this.gain.connect(filter.gain),this._filters[count]=filter}var connectionChain=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,connectionChain)}}),Tone.Filter.prototype.dispose=function(){Tone.prototype.dispose.call(this);for(var i=0;i<this._filters.length;i++)this._filters[i].disconnect(),this._filters[i]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},Tone.Filter}),define("Tone/core/TimelineState",["Tone/core/Tone","Tone/core/Timeline","Tone/core/Type"],function(Tone){"use strict";return Tone.TimelineState=function(initial){Tone.Timeline.call(this),this._initial=initial},Tone.extend(Tone.TimelineState,Tone.Timeline),Tone.TimelineState.prototype.getStateAtTime=function(time){var event=this.getEvent(time);return event!==null?event.state:this._initial},Tone.TimelineState.prototype.setStateAtTime=function(state,time){this.addEvent({state:state,time:this.toSeconds(time)})},Tone.TimelineState}),define("Tone/core/Clock",["Tone/core/Tone","Tone/signal/TimelineSignal","Tone/core/TimelineState"],function(Tone){"use strict";return Tone.Clock=function(){var options=this.optionsObject(arguments,["callback","frequency"],Tone.Clock.defaults);this.callback=options.callback,this._lookAhead="auto",this._computedLookAhead=1/60,this._threshold=.5,this._nextTick=-1,this._lastUpdate=0,this._loopID=-1,this.frequency=new Tone.TimelineSignal(options.frequency,Tone.Type.Frequency),this.ticks=0,this._state=new Tone.TimelineState(Tone.State.Stopped),this._boundLoop=this._loop.bind(this),this._readOnly("frequency"),this._loop()},Tone.extend(Tone.Clock),Tone.Clock.defaults={callback:Tone.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(Tone.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),Object.defineProperty(Tone.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(val){val==="auto"?this._lookAhead="auto":this._lookAhead=this.toSeconds(val)}}),Tone.Clock.prototype.start=function(time,offset){return time=this.toSeconds(time),this._state.getStateAtTime(time)!==Tone.State.Started&&this._state.addEvent({state:Tone.State.Started,time:time,offset:offset}),this},Tone.Clock.prototype.stop=function(time){return time=this.toSeconds(time),this._state.getStateAtTime(time)!==Tone.State.Stopped&&this._state.setStateAtTime(Tone.State.Stopped,time),this},Tone.Clock.prototype.pause=function(time){return time=this.toSeconds(time),this._state.getStateAtTime(time)===Tone.State.Started&&this._state.setStateAtTime(Tone.State.Paused,time),this},Tone.Clock.prototype._loop=function(time){this._loopID=requestAnimationFrame(this._boundLoop);if(this._lookAhead==="auto"){if(!this.isUndef(time)){var diff=(time-this._lastUpdate)/1e3;this._lastUpdate=time,diff<this._threshold&&(this._computedLookAhead=(9*this._computedLookAhead+diff)/10)}}else this._computedLookAhead=this._lookAhead;var now=this.now(),lookAhead=this._computedLookAhead*2,event=this._state.getEvent(now+lookAhead),state=Tone.State.Stopped;event&&(state=event.state,this._nextTick===-1&&state===Tone.State.Started&&(this._nextTick=event.time,this.isUndef(event.offset)||(this.ticks=event.offset)));if(state===Tone.State.Started)while(now+lookAhead>this._nextTick){now>this._nextTick+this._threshold&&(this._nextTick=now);var tickTime=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),this.callback(tickTime),this.ticks++}else state===Tone.State.Stopped&&(this._nextTick=-1,this.ticks=0)},Tone.Clock.prototype.getStateAtTime=function(time){return this._state.getStateAtTime(time)},Tone.Clock.prototype.dispose=function(){cancelAnimationFrame(this._loopID),Tone.TimelineState.prototype.dispose.call(this),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=Tone.noOp,this._nextTick=Infinity,this.callback=null,this._state.dispose(),this._state=null},Tone.Clock}),define("Tone/core/Emitter",["Tone/core/Tone"],function(Tone){"use strict";return Tone.Emitter=function(){this._events={}},Tone.extend(Tone.Emitter),Tone.Emitter.prototype.on=function(event,callback){var events=event.split(/\W+/);for(var i=0;i<events.length;i++){var eventName=events[i];this._events.hasOwnProperty(eventName)||(this._events[eventName]=[]),this._events[eventName].push(callback)}return this},Tone.Emitter.prototype.off=function(event,callback){var events=event.split(/\W+/);for(var ev=0;ev<events.length;ev++){event=events[ev];if(this._events.hasOwnProperty(event))if(Tone.prototype.isUndef(callback))this._events[event]=[];else{var eventList=this._events[event];for(var i=0;i<eventList.length;i++)eventList[i]===callback&&eventList.splice(i,1)}}return this},Tone.Emitter.prototype.trigger=function(event){if(this._events){var args=Array.prototype.slice.call(arguments,1);if(this._events.hasOwnProperty(event)){var eventList=this._events[event];for(var i=0,len=eventList.length;i<len;i++)eventList[i].apply(this,args)}}return this},Tone.Emitter.mixin=function(object){var functions=["on","off","trigger"];object._events={};for(var i=0;i<functions.length;i++){var func=functions[i],emitterFunc=Tone.Emitter.prototype[func];object[func]=emitterFunc}},Tone.Emitter.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._events=null,this},Tone.Emitter}),define("Tone/core/IntervalTimeline",["Tone/core/Tone","Tone/core/Type"],function(Tone){"use strict";Tone.IntervalTimeline=function(){this._root=null,this._length=0},Tone.extend(Tone.IntervalTimeline),Tone.IntervalTimeline.prototype.addEvent=function(event){if(this.isUndef(event.time)||this.isUndef(event.duration))throw new Error("events must have time and duration parameters");var node=new IntervalNode(event.time,event.time+event.duration,event);this._root===null?this._root=node:this._root.insert(node),this._length++;while(node!==null)node.updateHeight(),node.updateMax(),this._rebalance(node),node=node.parent;return this},Tone.IntervalTimeline.prototype.removeEvent=function(event){if(this._root!==null){var results=[];this._root.search(event.time,results);for(var i=0;i<results.length;i++){var node=results[i];if(node.event===event){this._removeNode(node),this._length--;break}}}return this},Object.defineProperty(Tone.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),Tone.IntervalTimeline.prototype.cancel=function(after){return after=this.toSeconds(after),this.forEachAfter(after,function(event){this.removeEvent(event)}.bind(this)),this},Tone.IntervalTimeline.prototype._setRoot=function(node){this._root=node,this._root!==null&&(this._root.parent=null)},Tone.IntervalTimeline.prototype._replaceNodeInParent=function(node,replacement){node.parent!==null?(node.isLeftChild()?node.parent.left=replacement:node.parent.right=replacement,this._rebalance(node.parent)):this._setRoot(replacement)},Tone.IntervalTimeline.prototype._removeNode=function(node){if(node.left===null&&node.right===null)this._replaceNodeInParent(node,null);else if(node.right===null)this._replaceNodeInParent(node,node.left);else if(node.left===null)this._replaceNodeInParent(node,node.right);else{var balance=node.getBalance(),replacement,temp;if(balance>0)if(node.left.right===null)replacement=node.left,replacement.right=node.right,temp=replacement;else{replacement=node.left.right;while(replacement.right!==null)replacement=replacement.right;replacement.parent.right=replacement.left,temp=replacement.parent,replacement.left=node.left,replacement.right=node.right}else if(node.right.left===null)replacement=node.right,replacement.left=node.left,temp=replacement;else{replacement=node.right.left;while(replacement.left!==null)replacement=replacement.left;replacement.parent=replacement.parent,replacement.parent.left=replacement.right,temp=replacement.parent,replacement.left=node.left,replacement.right=node.right}node.parent!==null?node.isLeftChild()?node.parent.left=replacement:node.parent.right=replacement:this._setRoot(replacement),this._rebalance(temp)}node.dispose()},Tone.IntervalTimeline.prototype._rotateLeft=function(node){var parent=node.parent,isLeftChild=node.isLeftChild(),pivotNode=node.right;node.right=pivotNode.left,pivotNode.left=node,parent!==null?isLeftChild?parent.left=pivotNode:parent.right=pivotNode:this._setRoot(pivotNode)},Tone.IntervalTimeline.prototype._rotateRight=function(node){var parent=node.parent,isLeftChild=node.isLeftChild(),pivotNode=node.left;node.left=pivotNode.right,pivotNode.right=node,parent!==null?isLeftChild?parent.left=pivotNode:parent.right=pivotNode:this._setRoot(pivotNode)},Tone.IntervalTimeline.prototype._rebalance=function(node){var balance=node.getBalance();balance>1?node.left.getBalance()<0?this._rotateLeft(node.left):this._rotateRight(node):balance<-1&&(node.right.getBalance()>0?this._rotateRight(node.right):this._rotateLeft(node))},Tone.IntervalTimeline.prototype.getEvent=function(time){if(this._root!==null){var results=[];this._root.search(time,results);if(results.length>0){var max=results[0];for(var i=1;i<results.length;i++)results[i].low>max.low&&(max=results[i]);return max.event}}return null},Tone.IntervalTimeline.prototype.forEach=function(callback){if(this._root!==null){var allNodes=[];this._root!==null&&this._root.traverse(function(node){allNodes.push(node)});for(var i=0;i<allNodes.length;i++){var ev=allNodes[i].event;ev&&callback(ev)}}return this},Tone.IntervalTimeline.prototype.forEachOverlap=function(time,callback){time=this.toSeconds(time);if(this._root!==null){var results=[];this._root.search(time,results);for(var i=results.length-1;i>=0;i--){var ev=results[i].event;ev&&callback(ev)}}return this},Tone.IntervalTimeline.prototype.forEachAfter=function(time,callback){time=this.toSeconds(time);if(this._root!==null){var results=[];this._root.searchAfter(time,results);for(var i=results.length-1;i>=0;i--){var ev=results[i].event;ev&&callback(ev)}}return this},Tone.IntervalTimeline.prototype.dispose=function(){var allNodes=[];this._root!==null&&this._root.traverse(function(node){allNodes.push(node)});for(var i=0;i<allNodes.length;i++)allNodes[i].dispose();return allNodes=null,this._root=null,this};var IntervalNode=function(low,high,event){this.event=event,this.low=low,this.high=high,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return IntervalNode.prototype.insert=function(node){node.low<=this.low?this.left===null?this.left=node:this.left.insert(node):this.right===null?this.right=node:this.right.insert(node)},IntervalNode.prototype.search=function(point,results){if(point>this.max)return;this.left!==null&&this.left.search(point,results),this.low<=point&&this.high>=point&&results.push(this);if(this.low>point)return;this.right!==null&&this.right.search(point,results)},IntervalNode.prototype.searchAfter=function(point,results){this.low>=point&&(results.push(this),this.left!==null&&this.left.searchAfter(point,results)),this.right!==null&&this.right.searchAfter(point,results)},IntervalNode.prototype.traverse=function(callback){callback(this),this.left!==null&&this.left.traverse(callback),this.right!==null&&this.right.traverse(callback)},IntervalNode.prototype.updateHeight=function(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0},IntervalNode.prototype.updateMax=function(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))},IntervalNode.prototype.getBalance=function(){var balance=0;return this.left!==null&&this.right!==null?balance=this.left.height-this.right.height:this.left!==null?balance=this.left.height+1:this.right!==null&&(balance=-(this.right.height+1)),balance},IntervalNode.prototype.isLeftChild=function(){return this.parent!==null&&this.parent.left===this},Object.defineProperty(IntervalNode.prototype,"left",{get:function(){return this._left},set:function(node){this._left=node,node!==null&&(node.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(IntervalNode.prototype,"right",{get:function(){return this._right},set:function(node){this._right=node,node!==null&&(node.parent=this),this.updateHeight(),this.updateMax()}}),IntervalNode.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},Tone.IntervalTimeline}),define("Tone/core/Transport",["Tone/core/Tone","Tone/core/Clock","Tone/core/Type","Tone/core/Timeline","Tone/core/Emitter","Tone/core/Gain","Tone/core/IntervalTimeline"],function(Tone){"use strict";Tone.Transport=function(){Tone.Emitter.call(this),this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=TransportConstructor.defaults.PPQ,this._clock=new Tone.Clock({callback:this._processTick.bind(this),frequency:0}),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=Tone.Type.BPM,this.bpm.value=TransportConstructor.defaults.bpm,this._readOnly("bpm"),this._timeSignature=TransportConstructor.defaults.timeSignature,this._scheduledEvents={},this._eventID=0,this._timeline=new Tone.Timeline,this._repeatedEvents=new Tone.IntervalTimeline,this._onceEvents=new Tone.Timeline,this._syncedSignals=[];var swingSeconds=this.notationToSeconds(TransportConstructor.defaults.swingSubdivision,TransportConstructor.defaults.bpm,TransportConstructor.defaults.timeSignature);this._swingTicks=swingSeconds/(60/TransportConstructor.defaults.bpm)*this._ppq,this._swingAmount=0},Tone.extend(Tone.Transport,Tone.Emitter),Tone.Transport.defaults={bpm:120,swing:0,swingSubdivision:"16n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:48},Tone.Transport.prototype._processTick=function(tickTime){this._swingAmount>0&&this._clock.ticks%this._ppq!==0&&this._clock.ticks%this._swingTicks===0&&(tickTime+=this.ticksToSeconds(this._swingTicks)*this._swingAmount),this.loop&&this._clock.ticks===this._loopEnd&&(this.ticks=this._loopStart,this.trigger("loop",tickTime));var ticks=this._clock.ticks;this._timeline.forEachAtTime(ticks,function(event){event.callback(tickTime)}),this._repeatedEvents.forEachOverlap(ticks,function(event){(ticks-event.time)%event.interval===0&&event.callback(tickTime)}),this._onceEvents.forEachBefore(ticks,function(event){event.callback(tickTime)}),this._onceEvents.cancelBefore(ticks)},Tone.Transport.prototype.schedule=function(callback,time){var event={time:this.toTicks(time),callback:callback},id=this._eventID++;return this._scheduledEvents[id.toString()]={event:event,timeline:this._timeline},this._timeline.addEvent(event),id},Tone.Transport.prototype.scheduleRepeat=function(callback,interval,startTime,duration){if(interval<=0)throw new Error("repeat events must have an interval larger than 0");var event={time:this.toTicks(startTime),duration:this.toTicks(this.defaultArg(duration,Infinity)),interval:this.toTicks(interval),callback:callback},id=this._eventID++;return this._scheduledEvents[id.toString()]={event:event,timeline:this._repeatedEvents},this._repeatedEvents.addEvent(event),id},Tone.Transport.prototype.scheduleOnce=function(callback,time){var event={time:this.toTicks(time),callback:callback},id=this._eventID++;return this._scheduledEvents[id.toString()]={event:event,timeline:this._onceEvents},this._onceEvents.addEvent(event),id},Tone.Transport.prototype.clear=function(eventId){if(this._scheduledEvents.hasOwnProperty(eventId)){var item=this._scheduledEvents[eventId.toString()];item.timeline.removeEvent(item.event),delete this._scheduledEvents[eventId.toString()]}return this},Tone.Transport.prototype.cancel=function(after){return after=this.defaultArg(after,0),after=this.toTicks(after),this._timeline.cancel(after),this._onceEvents.cancel(after),this._repeatedEvents.cancel(after),this},Tone.Transport.prototype.quantize=function(time,subdivision){subdivision=this.defaultArg(subdivision,"4n");var tickTime=this.toTicks(time);subdivision=this.toTicks(subdivision);var remainingTicks=subdivision-tickTime%subdivision;remainingTicks===subdivision&&(remainingTicks=0);var now=this.now();return this.state===Tone.State.Started&&(now=this._clock._nextTick),this.toSeconds(time,now)+this.ticksToSeconds(remainingTicks)},Object.defineProperty(Tone.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),Tone.Transport.prototype.start=function(time,offset){return time=this.toSeconds(time),this.isUndef(offset)?offset=this.defaultArg(offset,this._clock.ticks):offset=this.toTicks(offset),this._clock.start(time,offset),this.trigger("start",time,this.ticksToSeconds(offset)),this},Tone.Transport.prototype.stop=function(time){return time=this.toSeconds(time),this._clock.stop(time),this.trigger("stop",time),this},Tone.Transport.prototype.pause=function(time){return time=this.toSeconds(time),this._clock.pause(time),this.trigger("pause",time),this},Object.defineProperty(Tone.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(timeSig){this.isArray(timeSig)&&(timeSig=timeSig[0]/timeSig[1]*4),this._timeSignature=timeSig}}),Object.defineProperty(Tone.Transport.prototype,"loopStart",{get:function(){return this.ticksToSeconds(this._loopStart)},set:function(startPosition){this._loopStart=this.toTicks(startPosition)}}),Object.defineProperty(Tone.Transport.prototype,"loopEnd",{get:function(){return this.ticksToSeconds(this._loopEnd)},set:function(endPosition){this._loopEnd=this.toTicks(endPosition)}}),Tone.Transport.prototype.setLoopPoints=function(startPosition,endPosition){return this.loopStart=startPosition,this.loopEnd=endPosition,this},Object.defineProperty(Tone.Transport.prototype,"swing",{get:function(){return this._swingAmount*2},set:function(amount){this._swingAmount=amount*.5}}),Object.defineProperty(Tone.Transport.prototype,"swingSubdivision",{get:function(){return this.toNotation(this._swingTicks+"i")},set:function(subdivision){this._swingTicks=this.toTicks(subdivision)}}),Object.defineProperty(Tone.Transport.prototype,"position",{get:function(){var quarters=this.ticks/this._ppq,measures=Math.floor(quarters/this._timeSignature),sixteenths=quarters%1*4;sixteenths%1>0&&(sixteenths=sixteenths.toFixed(3)),quarters=Math.floor(quarters)%this._timeSignature;var progress=[measures,quarters,sixteenths];return progress.join(":")},set:function(progress){var ticks=this.toTicks(progress);this.ticks=ticks}}),Object.defineProperty(Tone.Transport.prototype,"progress",{get:function(){return this.loop?(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart):0}}),Object.defineProperty(Tone.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(t){this._clock.ticks=t}}),Object.defineProperty(Tone.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(ppq){this._ppq=ppq,this.bpm.value=this.bpm.value}}),Tone.Transport.prototype._fromUnits=function(bpm){return 1/(60/bpm/this.PPQ)},Tone.Transport.prototype._toUnits=function(freq){return freq/this.PPQ*60},Tone.Transport.prototype.syncSignal=function(signal,ratio){ratio||(signal._param.value!==0?ratio=signal._param.value/this.bpm._param.value:ratio=0);var ratioSignal=new Tone.Gain(ratio);return this.bpm.chain(ratioSignal,signal._param),this._syncedSignals.push({ratio:ratioSignal,signal:signal,initial:signal._param.value}),signal._param.value=0,this},Tone.Transport.prototype.unsyncSignal=function(signal){for(var i=this._syncedSignals.length-1;i>=0;i--){var syncedSignal=this._syncedSignals[i];syncedSignal.signal===signal&&(syncedSignal.ratio.dispose(),syncedSignal.signal._param.value=syncedSignal.initial,this._syncedSignals.splice(i,1))}return this},Tone.Transport.prototype.dispose=function(){return Tone.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._onceEvents.dispose(),this._onceEvents=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this},Tone.Transport.prototype.setInterval=function(callback,interval){return console.warn("This method is deprecated. Use Tone.Transport.scheduleRepeat instead."),Tone.Transport.scheduleRepeat(callback,interval)},Tone.Transport.prototype.clearInterval=function(id){return console.warn("This method is deprecated. Use Tone.Transport.clear instead."),Tone.Transport.clear(id)},Tone.Transport.prototype.setTimeout=function(callback,timeout){return console.warn("This method is deprecated. Use Tone.Transport.scheduleOnce instead."),Tone.Transport.scheduleOnce(callback,timeout)},Tone.Transport.prototype.clearTimeout=function(id){return console.warn("This method is deprecated. Use Tone.Transport.clear instead."),Tone.Transport.clear(id)},Tone.Transport.prototype.setTimeline=function(callback,time){return console.warn("This method is deprecated. Use Tone.Transport.schedule instead."),Tone.Transport.schedule(callback,time)},Tone.Transport.prototype.clearTimeline=function(id){return console.warn("This method is deprecated. Use Tone.Transport.clear instead."),Tone.Transport.clear(id)};var TransportConstructor=Tone.Transport;return Tone._initAudioContext(function(){if(typeof Tone.Transport=="function")Tone.Transport=new Tone.Transport;else{Tone.Transport.stop();var prevSettings=Tone.Transport.get();Tone.Transport.dispose(),TransportConstructor.call(Tone.Transport),Tone.Transport.set(prevSettings)}}),Tone.Transport}),define("Tone/component/Volume",["Tone/core/Tone","Tone/signal/Signal","Tone/core/Gain"],function(Tone){"use strict";return Tone.Volume=function(){var options=this.optionsObject(arguments,["volume"],Tone.Volume.defaults);this.output=this.input=new Tone.Gain(options.volume,Tone.Type.Decibels),this.volume=this.output.gain,this._readOnly("volume")},Tone.extend(Tone.Volume),Tone.Volume.defaults={volume:0},Tone.Volume.prototype.dispose=function(){return this.input.dispose(),Tone.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},Tone.Volume}),define("Tone/source/Source",["Tone/core/Tone","Tone/core/Transport","Tone/component/Volume","Tone/core/Type","Tone/core/TimelineState","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Source=function(options){Tone.call(this),options=this.defaultArg(options,Tone.Source.defaults),this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new Tone.TimelineState(Tone.State.Stopped),this._syncStart=function(time,offset){time=this.toSeconds(time),time+=this.toSeconds(this._startDelay),this.start(time,offset)}.bind(this),this._syncStop=this.stop.bind(this),this._startDelay=0,this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit"},Tone.extend(Tone.Source),Tone.Source.defaults={volume:0},Object.defineProperty(Tone.Source.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),Tone.Source.prototype.start=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)!==Tone.State.Started||this.retrigger)this._state.setStateAtTime(Tone.State.Started,time),this._start&&this._start.apply(this,arguments);return this},Tone.Source.prototype.stop=function(time){return time=this.toSeconds(time),this._state.getStateAtTime(time)===Tone.State.Started&&(this._state.setStateAtTime(Tone.State.Stopped,time),this._stop&&this._stop.apply(this,arguments)),this},Tone.Source.prototype.sync=function(delay){return this._startDelay=this.defaultArg(delay,0),Tone.Transport.on("start",this._syncStart),Tone.Transport.on("stop pause",this._syncStop),this},Tone.Source.prototype.unsync=function(){return this._startDelay=0,Tone.Transport.off("start",this._syncStart),Tone.Transport.off("stop pause",this._syncStop),this},Tone.Source.prototype.dispose=function(){this.stop(),Tone.prototype.dispose.call(this),this.unsync(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null,this._syncStart=null,this._syncStart=null},Tone.Source}),define("Tone/source/Oscillator",["Tone/core/Tone","Tone/signal/Signal","Tone/source/Source","Tone/core/Transport"],function(Tone){"use strict";return Tone.Oscillator=function(){var options=this.optionsObject(arguments,["frequency","type"],Tone.Oscillator.defaults);Tone.Source.call(this,options),this._oscillator=null,this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this._wave=null,this._partials=this.defaultArg(options.partials,[1]),this._phase=options.phase,this._type=null,this.type=options.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},Tone.extend(Tone.Oscillator,Tone.Source),Tone.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},Tone.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},Tone.Oscillator.prototype._start=function(time){this._oscillator=this.context.createOscillator(),this._oscillator.setPeriodicWave(this._wave),this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(this.toSeconds(time))},Tone.Oscillator.prototype._stop=function(time){return this._oscillator&&(this._oscillator.stop(this.toSeconds(time)),this._oscillator=null),this},Tone.Oscillator.prototype.syncFrequency=function(){return Tone.Transport.syncSignal(this.frequency),this},Tone.Oscillator.prototype.unsyncFrequency=function(){return Tone.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(Tone.Oscillator.prototype,"type",{get:function(){return this._type},set:function(type){var coefs=this._getRealImaginary(type,this._phase),periodicWave=this.context.createPeriodicWave(coefs[0],coefs[1]);this._wave=periodicWave,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),this._type=type}}),Tone.Oscillator.prototype._getRealImaginary=function(type,phase){var fftSize=4096,periodicWaveSize=fftSize/2,real=new Float32Array(periodicWaveSize),imag=new Float32Array(periodicWaveSize),partialCount=1;if(type===Tone.Oscillator.Type.Custom)partialCount=this._partials.length+1,periodicWaveSize=partialCount;else{var partial=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(type);partial&&(partialCount=parseInt(partial[2])+1,type=partial[1],partialCount=Math.max(partialCount,2),periodicWaveSize=partialCount)}for(var n=1;n<periodicWaveSize;++n){var piFactor=2/(n*Math.PI),b;switch(type){case Tone.Oscillator.Type.Sine:b=n<=partialCount?1:0;break;case Tone.Oscillator.Type.Square:b=n&1?2*piFactor:0;break;case Tone.Oscillator.Type.Sawtooth:b=piFactor*(n&1?1:-1);break;case Tone.Oscillator.Type.Triangle:n&1?b=2*piFactor*piFactor*(n-1>>1&1?-1:1):b=0;break;case Tone.Oscillator.Type.Custom:b=this._partials[n-1];break;default:throw new Error("invalid oscillator type: "+type)}b!==0?(real[n]=-b*Math.sin(phase*n),imag[n]=b*Math.cos(phase*n)):(real[n]=0,imag[n]=0)}return[real,imag]},Tone.Oscillator.prototype._inverseFFT=function(real,imag,phase){var sum=0,len=real.length;for(var i=0;i<len;i++)sum+=real[i]*Math.cos(i*phase)+imag[i]*Math.sin(i*phase);return sum},Tone.Oscillator.prototype._getInitialValue=function(){var coefs=this._getRealImaginary(this._type,0),real=coefs[0],imag=coefs[1],maxValue=0,twoPi=Math.PI*2;for(var i=0;i<8;i++)maxValue=Math.max(this._inverseFFT(real,imag,i/8*twoPi),maxValue);return-this._inverseFFT(real,imag,this._phase)/maxValue},Object.defineProperty(Tone.Oscillator.prototype,"partials",{get:function(){return this._type!==Tone.Oscillator.Type.Custom?[]:this._partials},set:function(partials){this._partials=partials,this.type=Tone.Oscillator.Type.Custom}}),Object.defineProperty(Tone.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(phase){this._phase=phase*Math.PI/180,this.type=this._type}}),Tone.Oscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._oscillator!==null&&(this._oscillator.disconnect(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},Tone.Oscillator}),define("Tone/signal/Add",["Tone/core/Tone","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Add=function(value){Tone.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._param=this.input[1]=new Tone.Signal(value),this._param.connect(this._sum)},Tone.extend(Tone.Add,Tone.Signal),Tone.Add.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},Tone.Add}),define("Tone/signal/Multiply",["Tone/core/Tone","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Multiply=function(value){Tone.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(value,0)},Tone.extend(Tone.Multiply,Tone.Signal),Tone.Multiply.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._mult.disconnect(),this._mult=null,this._param=null,this},Tone.Multiply}),define("Tone/signal/Scale",["Tone/core/Tone","Tone/signal/Add","Tone/signal/Multiply","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Scale=function(outputMin,outputMax){this._outputMin=this.defaultArg(outputMin,0),this._outputMax=this.defaultArg(outputMax,1),this._scale=this.input=new Tone.Multiply(1),this._add=this.output=new Tone.Add(0),this._scale.connect(this._add),this._setRange()},Tone.extend(Tone.Scale,Tone.SignalBase),Object.defineProperty(Tone.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(min){this._outputMin=min,this._setRange()}}),Object.defineProperty(Tone.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(max){this._outputMax=max,this._setRange()}}),Tone.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},Tone.Scale.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},Tone.Scale}),define("Tone/signal/AudioToGain",["Tone/core/Tone","Tone/signal/WaveShaper","Tone/signal/Signal"],function(Tone){"use strict";return Tone.AudioToGain=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return(x+1)/2})},Tone.extend(Tone.AudioToGain,Tone.SignalBase),Tone.AudioToGain.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},Tone.AudioToGain}),define("Tone/component/LFO",["Tone/core/Tone","Tone/source/Oscillator","Tone/signal/Scale","Tone/signal/Signal","Tone/signal/AudioToGain","Tone/core/Type"],function(Tone){"use strict";return Tone.LFO=function(){var options=this.optionsObject(arguments,["frequency","min","max"],Tone.LFO.defaults);this._oscillator=new Tone.Oscillator({frequency:options.frequency,type:options.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=Tone.Type.NormalRange,this.amplitude.value=options.amplitude,this._stoppedSignal=new Tone.Signal(0,Tone.Type.AudioRange),this._stoppedValue=0,this._a2g=new Tone.AudioToGain,this._scaler=this.output=new Tone.Scale(options.min,options.max),this._units=Tone.Type.Default,this.units=options.units,this._oscillator.chain(this._a2g,this._scaler),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=options.phase},Tone.extend(Tone.LFO,Tone.Oscillator),Tone.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:Tone.Type.Default},Tone.LFO.prototype.start=function(time){return time=this.toSeconds(time),this._stoppedSignal.setValueAtTime(0,time),this._oscillator.start(time),this},Tone.LFO.prototype.stop=function(time){return time=this.toSeconds(time),this._stoppedSignal.setValueAtTime(this._stoppedValue,time),this._oscillator.stop(time),this},Tone.LFO.prototype.sync=function(delay){return this._oscillator.sync(delay),this._oscillator.syncFrequency(),this},Tone.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(Tone.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(min){min=this._fromUnits(min),this._scaler.min=min}}),Object.defineProperty(Tone.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(max){max=this._fromUnits(max),this._scaler.max=max}}),Object.defineProperty(Tone.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(type){this._oscillator.type=type,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(Tone.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(phase){this._oscillator.phase=phase,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(Tone.LFO.prototype,"units",{get:function(){return this._units},set:function(val){var currentMin=this.min,currentMax=this.max;this._units=val,this.min=currentMin,this.max=currentMax}}),Object.defineProperty(Tone.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),Tone.LFO.prototype.connect=function(node){if(node.constructor===Tone.Signal||node.constructor===Tone.Param||node.constructor===Tone.TimelineSignal)this.convert=node.convert,this.units=node.units;return Tone.Signal.prototype.connect.apply(this,arguments),this},Tone.LFO.prototype._fromUnits=Tone.Param.prototype._fromUnits,Tone.LFO.prototype._toUnits=Tone.Param.prototype._toUnits,Tone.LFO.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},Tone.LFO}),define("Tone/component/EQMultiband",["Tone/core/Tone","Tone/component/Filter"],function(Tone){"use strict";return Tone.EQMultiband=function(options){this._bands=[],this.numberOfBands=options.length;for(var i=0;i<this.numberOfBands;i++){var filter=new Tone.Filter({type:options[i].type,frequency:options[i].frequency,rolloff:options[i].rolloff,Q:options[i].Q,gain:options[i].gain});this._bands.push(filter)}this.input=this._bands[0],this.output=this._bands[this.numberOfBands-1];var currentUnit=this._bands[0];for(var j=1;j<this._bands.length;j++){var toUnit=this._bands[j];currentUnit.connect(toUnit),currentUnit=toUnit}},Tone.extend(Tone.EQMultiband),Tone.EQMultiband.defaults=[{type:"lowshelf",frequency:80,rolloff:-12,Q:1,gain:0},{type:"peaking",frequency:160,rolloff:-12,Q:1,gain:0},{type:"peaking",frequency:480,rolloff:-12,Q:1,gain:0},{type:"peaking",frequency:1200,rolloff:-12,Q:1,gain:0},{type:"peaking",frequency:3e3,rolloff:-12,Q:1,gain:5},{type:"highshelf",frequency:12e3,rolloff:-12,Q:1,gain:10}],Tone.EQMultiband.prototype.setType=function(type,band){this._bands[band-1].type=type},Tone.EQMultiband.prototype.getType=function(band){return this._bands[band-1].type},Tone.EQMultiband.prototype.setFrequency=function(freq,band){this._bands[band-1].frequency.value=freq},Tone.EQMultiband.prototype.getFrequency=function(band){return this._bands[band-1].frequency.value},Tone.EQMultiband.prototype.setQ=function(Q,band){this._bands[band-1].Q.value=Q},Tone.EQMultiband.prototype.getQ=function(band){return this._bands[band-1].Q.value},Tone.EQMultiband.prototype.setGain=function(gain,band){this._bands[band-1].gain.value=gain},Tone.EQMultiband.prototype.getGain=function(band){return this._bands[band-1].gain.value},Tone.EQMultiband.prototype.dispose=function(){Tone.prototype.dispose.call(this);for(var i=0;i<this._bands.length;i++)this._bands[i].dispose();this.numberOfBands=null,this._bands=null},Tone.EQMultiband}),define("Tone/core/Master",["Tone/core/Tone","Tone/component/Volume"],function(Tone){"use strict";Tone.Master=function(){Tone.call(this),this._unmutedVolume=1,this._muted=!1,this._volume=this.output=new Tone.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)},Tone.extend(Tone.Master),Tone.Master.defaults={volume:0,mute:!1},Object.defineProperty(Tone.Master.prototype,"mute",{get:function(){return this._muted},set:function(mute){!this._muted&&mute?(this._unmutedVolume=this.volume.value,this.volume.value=-Infinity):this._muted&&!mute&&(this.volume.value=this._unmutedVolume),this._muted=mute}}),Tone.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},Tone.Master.prototype.dispose=function(){Tone.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},Tone.prototype.toMaster=function(){return this.connect(Tone.Master),this},AudioNode.prototype.toMaster=function(){return this.connect(Tone.Master),this};var MasterConstructor=Tone.Master;return Tone._initAudioContext(function(){Tone.prototype.isUndef(Tone.Master)?(MasterConstructor.prototype.dispose.call(Tone.Master),MasterConstructor.call(Tone.Master)):Tone.Master=new MasterConstructor}),Tone.Master}),define("Tone/core/Note",["Tone/core/Tone","Tone/core/Transport"],function(Tone){"use strict";Tone.Note=function(channel,time,value){this.value=value,this._channel=channel,this._timelineID=Tone.Transport.setTimeline(this._trigger.bind(this),time)},Tone.Note.prototype._trigger=function(time){channelCallbacks(this._channel,time,this.value)},Tone.Note.prototype.dispose=function(){return Tone.Transport.clearTimeline(this._timelineID),this.value=null,this};var NoteChannels={};function channelCallbacks(channel,time,value){if(NoteChannels.hasOwnProperty(channel)){var callbacks=NoteChannels[channel];for(var i=0,len=callbacks.length;i<len;i++){var callback=callbacks[i];Array.isArray(value)?callback.apply(window,[time].concat(value)):callback(time,value)}}}return Tone.Note.route=function(channel,callback){NoteChannels.hasOwnProperty(channel)?NoteChannels[channel].push(callback):NoteChannels[channel]=[callback]},Tone.Note.unroute=function(channel,callback){if(NoteChannels.hasOwnProperty(channel)){var channelCallback=NoteChannels[channel],index=channelCallback.indexOf(callback);index!==-1&&NoteChannels[channel].splice(index,1)}},Tone.Note.parseScore=function(score){var notes=[];for(var inst in score){var part=score[inst];if(inst==="tempo")Tone.Transport.bpm.value=part;else if(inst==="timeSignature")Tone.Transport.timeSignature=part[0]/(part[1]/4);else{if(!Array.isArray(part))throw new TypeError("score parts must be Arrays");for(var i=0;i<part.length;i++){var noteDescription=part[i],note;if(Array.isArray(noteDescription)){var time=noteDescription[0],value=noteDescription.slice(1);note=new Tone.Note(inst,time,value)}else typeof noteDescription=="object"?note=new Tone.Note(inst,noteDescription.time,noteDescription):note=new Tone.Note(inst,noteDescription);notes.push(note)}}}return notes},Tone.Note}),define("Tone/signal/Negate",["Tone/core/Tone","Tone/signal/Multiply","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Negate=function(){this._multiply=this.input=this.output=new Tone.Multiply(-1)},Tone.extend(Tone.Negate,Tone.SignalBase),Tone.Negate.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},Tone.Negate}),define("Tone/signal/Subtract",["Tone/core/Tone","Tone/signal/Add","Tone/signal/Negate","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Subtract=function(value){Tone.call(this,2,0),this._sum=this.input[0]=this.output=this.context.createGain(),this._neg=new Tone.Negate,this._param=this.input[1]=new Tone.Signal(value),this._param.chain(this._neg,this._sum)},Tone.extend(Tone.Subtract,Tone.Signal),Tone.Subtract.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},Tone.Subtract}),define("Tone/signal/GreaterThanZero",["Tone/core/Tone","Tone/signal/Signal","Tone/signal/Multiply","Tone/signal/WaveShaper"],function(Tone){"use strict";return Tone.GreaterThanZero=function(){this._thresh=this.output=new Tone.WaveShaper(function(val){return val<=0?0:1}),this._scale=this.input=new Tone.Multiply(1e4),this._scale.connect(this._thresh)},Tone.extend(Tone.GreaterThanZero,Tone.SignalBase),Tone.GreaterThanZero.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},Tone.GreaterThanZero}),define("Tone/signal/EqualZero",["Tone/core/Tone","Tone/signal/Signal","Tone/signal/GreaterThanZero","Tone/signal/WaveShaper"],function(Tone){"use strict";return Tone.EqualZero=function(){this._scale=this.input=new Tone.Multiply(1e4),this._thresh=new Tone.WaveShaper(function(val){return val===0?1:0},128),this._gtz=this.output=new Tone.GreaterThanZero,this._scale.chain(this._thresh,this._gtz)},Tone.extend(Tone.EqualZero,Tone.SignalBase),Tone.EqualZero.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},Tone.EqualZero}),define("Tone/signal/Equal",["Tone/core/Tone","Tone/signal/EqualZero","Tone/signal/Subtract","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Equal=function(value){Tone.call(this,2,0),this._sub=this.input[0]=new Tone.Subtract(value),this._equals=this.output=new Tone.EqualZero,this._sub.connect(this._equals),this.input[1]=this._sub.input[1]},Tone.extend(Tone.Equal,Tone.SignalBase),Object.defineProperty(Tone.Equal.prototype,"value",{get:function(){return this._sub.value},set:function(value){this._sub.value=value}}),Tone.Equal.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._equals.dispose(),this._equals=null,this._sub.dispose(),this._sub=null,this},Tone.Equal}),define("Tone/signal/Select",["Tone/core/Tone","Tone/signal/Equal","Tone/signal/Signal"],function(Tone){"use strict";Tone.Select=function(sourceCount){sourceCount=this.defaultArg(sourceCount,2),Tone.call(this,sourceCount,1),this.gate=new Tone.Signal(0),this._readOnly("gate");for(var i=0;i<sourceCount;i++){var switchGate=new SelectGate(i);this.input[i]=switchGate,this.gate.connect(switchGate.selecter),switchGate.connect(this.output)}},Tone.extend(Tone.Select,Tone.SignalBase),Tone.Select.prototype.select=function(which,time){return which=Math.floor(which),this.gate.setValueAtTime(which,this.toSeconds(time)),this},Tone.Select.prototype.dispose=function(){this._writable("gate"),this.gate.dispose(),this.gate=null;for(var i=0;i<this.input.length;i++)this.input[i].dispose(),this.input[i]=null;return Tone.prototype.dispose.call(this),this};var SelectGate=function(num){this.selecter=new Tone.Equal(num),this.gate=this.input=this.output=this.context.createGain(),this.selecter.connect(this.gate.gain)};return Tone.extend(SelectGate),SelectGate.prototype.dispose=function(){Tone.prototype.dispose.call(this),this.selecter.dispose(),this.gate.disconnect(),this.selecter=null,this.gate=null},Tone.Select}),define("Tone/signal/IfThenElse",["Tone/core/Tone","Tone/signal/Select","Tone/signal/Equal"],function(Tone){"use strict";return Tone.IfThenElse=function(){Tone.call(this,3,0),this._selector=this.output=new Tone.Select(2),this.if=this.input[0]=this._selector.gate,this.then=this.input[1]=this._selector.input[1],this.else=this.input[2]=this._selector.input[0]},Tone.extend(Tone.IfThenElse,Tone.SignalBase),Tone.IfThenElse.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._selector.dispose(),this._selector=null,this.if=null,this.then=null,this.else=null,this},Tone.IfThenElse}),define("Tone/signal/OR",["Tone/core/Tone","Tone/signal/GreaterThanZero"],function(Tone){"use strict";return Tone.OR=function(inputCount){inputCount=this.defaultArg(inputCount,2),Tone.call(this,inputCount,0),this._sum=this.context.createGain(),this._gtz=this.output=new Tone.GreaterThanZero;for(var i=0;i<inputCount;i++)this.input[i]=this._sum;this._sum.connect(this._gtz)},Tone.extend(Tone.OR,Tone.SignalBase),Tone.OR.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this._sum.disconnect(),this._sum=null,this},Tone.OR}),define("Tone/signal/AND",["Tone/core/Tone","Tone/signal/Equal"],function(Tone){"use strict";return Tone.AND=function(inputCount){inputCount=this.defaultArg(inputCount,2),Tone.call(this,inputCount,0),this._equals=this.output=new Tone.Equal(inputCount);for(var i=0;i<inputCount;i++)this.input[i]=this._equals},Tone.extend(Tone.AND,Tone.SignalBase),Tone.AND.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._equals.dispose(),this._equals=null,this},Tone.AND}),define("Tone/signal/NOT",["Tone/core/Tone","Tone/signal/EqualZero"],function(Tone){"use strict";return Tone.NOT=Tone.EqualZero,Tone.NOT}),define("Tone/signal/GreaterThan",["Tone/core/Tone","Tone/signal/GreaterThanZero","Tone/signal/Subtract","Tone/signal/Signal"],function(Tone){"use strict";return Tone.GreaterThan=function(value){Tone.call(this,2,0),this._param=this.input[0]=new Tone.Subtract(value),this.input[1]=this._param.input[1],this._gtz=this.output=new Tone.GreaterThanZero,this._param.connect(this._gtz)},Tone.extend(Tone.GreaterThan,Tone.Signal),Tone.GreaterThan.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},Tone.GreaterThan}),define("Tone/signal/LessThan",["Tone/core/Tone","Tone/signal/GreaterThan","Tone/signal/Negate","Tone/signal/Signal"],function(Tone){"use strict";return Tone.LessThan=function(value){Tone.call(this,2,0),this._neg=this.input[0]=new Tone.Negate,this._gt=this.output=new Tone.GreaterThan,this._rhNeg=new Tone.Negate,this._param=this.input[1]=new Tone.Signal(value),this._neg.connect(this._gt),this._param.connect(this._rhNeg),this._rhNeg.connect(this._gt,0,1)},Tone.extend(Tone.LessThan,Tone.Signal),Tone.LessThan.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._gt.dispose(),this._gt=null,this._rhNeg.dispose(),this._rhNeg=null,this._param.dispose(),this._param=null,this},Tone.LessThan}),define("Tone/signal/Abs",["Tone/core/Tone","Tone/signal/Select","Tone/signal/Negate","Tone/signal/LessThan","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Abs=function(){Tone.call(this,1,0),this._ltz=new Tone.LessThan(0),this._switch=this.output=new Tone.Select(2),this._negate=new Tone.Negate,this.input.connect(this._switch,0,0),this.input.connect(this._negate),this._negate.connect(this._switch,0,1),this.input.chain(this._ltz,this._switch.gate)},Tone.extend(Tone.Abs,Tone.SignalBase),Tone.Abs.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._switch.dispose(),this._switch=null,this._ltz.dispose(),this._ltz=null,this._negate.dispose(),this._negate=null,this},Tone.Abs}),define("Tone/signal/Max",["Tone/core/Tone","Tone/signal/GreaterThan","Tone/signal/IfThenElse","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Max=function(max){Tone.call(this,2,0),this.input[0]=this.context.createGain(),this._param=this.input[1]=new Tone.Signal(max),this._ifThenElse=this.output=new Tone.IfThenElse,this._gt=new Tone.GreaterThan,this.input[0].chain(this._gt,this._ifThenElse.if),this.input[0].connect(this._ifThenElse.then),this._param.connect(this._ifThenElse.else),this._param.connect(this._gt,0,1)},Tone.extend(Tone.Max,Tone.Signal),Tone.Max.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._param.dispose(),this._ifThenElse.dispose(),this._gt.dispose(),this._param=null,this._ifThenElse=null,this._gt=null,this},Tone.Max}),define("Tone/signal/Min",["Tone/core/Tone","Tone/signal/LessThan","Tone/signal/IfThenElse","Tone/signal/Signal"],function(Tone){"use strict";return Tone.Min=function(min){Tone.call(this,2,0),this.input[0]=this.context.createGain(),this._ifThenElse=this.output=new Tone.IfThenElse,this._lt=new Tone.LessThan,this._param=this.input[1]=new Tone.Signal(min),this.input[0].chain(this._lt,this._ifThenElse.if),this.input[0].connect(this._ifThenElse.then),this._param.connect(this._ifThenElse.else),this._param.connect(this._lt,0,1)},Tone.extend(Tone.Min,Tone.Signal),Tone.Min.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._param.dispose(),this._ifThenElse.dispose(),this._lt.dispose(),this._param=null,this._ifThenElse=null,this._lt=null,this},Tone.Min}),define("Tone/signal/Modulo",["Tone/core/Tone","Tone/signal/WaveShaper","Tone/signal/Multiply","Tone/signal/Subtract"],function(Tone){"use strict";return Tone.Modulo=function(modulus){Tone.call(this,1,1),this._shaper=new Tone.WaveShaper(Math.pow(2,16)),this._multiply=new Tone.Multiply,this._subtract=this.output=new Tone.Subtract,this._modSignal=new Tone.Signal(modulus),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(modulus)},Tone.extend(Tone.Modulo,Tone.SignalBase),Tone.Modulo.prototype._setWaveShaper=function(mod){this._shaper.setMap(function(val){var multiple=Math.floor((val+1e-4)/mod);return multiple})},Object.defineProperty(Tone.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(mod){this._modSignal.value=mod,this._setWaveShaper(mod)}}),Tone.Modulo.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},Tone.Modulo}),define("Tone/signal/Expr",["Tone/core/Tone","Tone/signal/Add","Tone/signal/Subtract","Tone/signal/Multiply","Tone/signal/IfThenElse","Tone/signal/OR","Tone/signal/AND","Tone/signal/NOT","Tone/signal/GreaterThan","Tone/signal/LessThan","Tone/signal/Equal","Tone/signal/EqualZero","Tone/signal/GreaterThanZero","Tone/signal/Abs","Tone/signal/Negate","Tone/signal/Max","Tone/signal/Min","Tone/signal/Modulo","Tone/signal/Pow","Tone/signal/AudioToGain"],function(Tone){"use strict";Tone.Expr=function(){var expr=this._replacements(Array.prototype.slice.call(arguments)),inputCount=this._parseInputs(expr);this._nodes=[],this.input=new Array(inputCount);for(var i=0;i<inputCount;i++)this.input[i]=this.context.createGain();var tree=this._parseTree(expr),result;try{result=this._eval(tree)}catch(e){throw this._disposeNodes(),new Error("Could evaluate expression: "+expr)}this.output=result},Tone.extend(Tone.Expr,Tone.SignalBase);function applyBinary(Constructor,args,self){var op=new Constructor;return self._eval(args[0]).connect(op,0,0),self._eval(args[1]).connect(op,0,1),op}function applyUnary(Constructor,args,self){var op=new Constructor;return self._eval(args[0]).connect(op,0,0),op}function getNumber(arg){return arg?parseFloat(arg):undefined}function literalNumber(arg){return arg&&arg.args?parseFloat(arg.args):undefined}return Tone.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(arg){var sig=new Tone.Signal(getNumber(arg));return sig}},input:{regexp:/^\$\d/,method:function(arg,self){return self.input[getNumber(arg.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:applyUnary.bind(this,Tone.Abs)},min:{regexp:/^min/,method:applyBinary.bind(this,Tone.Min)},max:{regexp:/^max/,method:applyBinary.bind(this,Tone.Max)},"if":{regexp:/^if/,method:function(args,self){var op=new Tone.IfThenElse;return self._eval(args[0]).connect(op.if),self._eval(args[1]).connect(op.then),self._eval(args[2]).connect(op.else),op}},gt0:{regexp:/^gt0/,method:applyUnary.bind(this,Tone.GreaterThanZero)},eq0:{regexp:/^eq0/,method:applyUnary.bind(this,Tone.EqualZero)},mod:{regexp:/^mod/,method:function(args,self){var modulus=literalNumber(args[1]),op=new Tone.Modulo(modulus);return self._eval(args[0]).connect(op),op}},pow:{regexp:/^pow/,method:function(args,self){var exp=literalNumber(args[1]),op=new Tone.Pow(exp);return self._eval(args[0]).connect(op),op}},a2g:{regexp:/^a2g/,method:function(args,self){var op=new Tone.AudioToGain;return self._eval(args[0]).connect(op),op}}},binary:{"+":{regexp:/^\+/,precedence:1,method:applyBinary.bind(this,Tone.Add)},"-":{regexp:/^\-/,precedence:1,method:function(args,self){return args.length===1?applyUnary(Tone.Negate,args,self):applyBinary(Tone.Subtract,args,self)}},"*":{regexp:/^\*/,precedence:0,method:applyBinary.bind(this,Tone.Multiply)},">":{regexp:/^\>/,precedence:2,method:applyBinary.bind(this,Tone.GreaterThan)},"<":{regexp:/^</,precedence:2,method:applyBinary.bind(this,Tone.LessThan)},"==":{regexp:/^==/,precedence:3,method:applyBinary.bind(this,Tone.Equal)},"&&":{regexp:/^&&/,precedence:4,method:applyBinary.bind(this,Tone.AND)},"||":{regexp:/^\|\|/,precedence:5,method:applyBinary.bind(this,Tone.OR)}},unary:{"-":{regexp:/^\-/,method:applyUnary.bind(this,Tone.Negate)},"!":{regexp:/^\!/,method:applyUnary.bind(this,Tone.NOT)}}},Tone.Expr.prototype._parseInputs=function(expr){var inputArray=expr.match(/\$\d/g),inputMax=0;if(inputArray!==null)for(var i=0;i<inputArray.length;i++){var inputNum=parseInt(inputArray[i].substr(1))+1;inputMax=Math.max(inputMax,inputNum)}return inputMax},Tone.Expr.prototype._replacements=function(args){var expr=args.shift();for(var i=0;i<args.length;i++)expr=expr.replace(/\%/i,args[i]);return expr},Tone.Expr.prototype._tokenize=function(expr){var position=-1,tokens=[];while(expr.length>0){expr=expr.trim();var token=getNextToken(expr);tokens.push(token),expr=expr.substr(token.value.length)}function getNextToken(expr){for(var type in Tone.Expr._Expressions){var group=Tone.Expr._Expressions[type];for(var opName in group){var op=group[opName],reg=op.regexp,match=expr.match(reg);if(match!==null)return{type:type,value:match[0],method:op.method}}}throw new SyntaxError("Unexpected token "+expr)}return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}},Tone.Expr.prototype._parseTree=function(expr){var lexer=this._tokenize(expr),isUndef=this.isUndef.bind(this);function matchSyntax(token,syn){return!isUndef(token)&&token.type==="glue"&&token.value===syn}function matchGroup(token,groupName,prec){var ret=!1,group=Tone.Expr._Expressions[groupName];if(!isUndef(token))for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(!!isUndef(prec))return!0;if(op.precedence===prec)return!0}}return ret}function parseExpression(precedence){isUndef(precedence)&&(precedence=5);var expr;precedence<0?expr=parseUnary():expr=parseExpression(precedence-1);var token=lexer.peek();while(matchGroup(token,"binary",precedence))token=lexer.next(),expr={operator:token.value,method:token.method,args:[expr,parseExpression(precedence)]},token=lexer.peek();return expr}function parseUnary(){var token,expr;return token=lexer.peek(),matchGroup(token,"unary")?(token=lexer.next(),expr=parseUnary(),{operator:token.value,method:token.method,args:[expr]}):parsePrimary()}function parsePrimary(){var token,expr;token=lexer.peek();if(isUndef(token))throw new SyntaxError("Unexpected termination of expression");if(token.type==="func")return token=lexer.next(),parseFunctionCall(token);if(token.type==="value")return token=lexer.next(),{method:token.method,args:token.value};if(matchSyntax(token,"(")){lexer.next(),expr=parseExpression(),token=lexer.next();if(!matchSyntax(token,")"))throw new SyntaxError("Expected )");return expr}throw new SyntaxError("Parse error, cannot process token "+token.value)}function parseFunctionCall(func){var token,args=[];token=lexer.next();if(!matchSyntax(token,"("))throw new SyntaxError('Expected ( in a function call "'+func.value+'"');token=lexer.peek(),matchSyntax(token,")")||(args=parseArgumentList()),token=lexer.next();if(!matchSyntax(token,")"))throw new SyntaxError('Expected ) in a function call "'+func.value+'"');return{method:func.method,args:args,name:name}}function parseArgumentList(){var token,expr,args=[];for(;;){expr=parseExpression();if(isUndef(expr))break;args.push(expr),token=lexer.peek();if(!matchSyntax(token,","))break;lexer.next()}return args}return parseExpression()},Tone.Expr.prototype._eval=function(tree){if(!this.isUndef(tree)){var node=tree.method(tree.args,this);return this._nodes.push(node),node}},Tone.Expr.prototype._disposeNodes=function(){for(var i=0;i<this._nodes.length;i++){var node=this._nodes[i];this.isFunction(node.dispose)?node.dispose():this.isFunction(node.disconnect)&&node.disconnect(),node=null,this._nodes[i]=null}this._nodes=null},Tone.Expr.prototype.dispose=function(){Tone.prototype.dispose.call(this),this._disposeNodes()},Tone.Expr}),define("Tone/signal/EqualPowerGain",["Tone/core/Tone","Tone/signal/WaveShaper"],function(Tone){"use strict";return Tone.EqualPowerGain=function(){this._eqPower=this.input=this.output=new Tone.WaveShaper(function(val){return Math.abs(val)<.001?0:this.equalPowerScale(val)}.bind(this),4096)},Tone.extend(Tone.EqualPowerGain,Tone.SignalBase),Tone.EqualPowerGain.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},Tone.EqualPowerGain}),define("Tone/component/CrossFade",["Tone/core/Tone","Tone/signal/Signal","Tone/signal/Expr","Tone/signal/EqualPowerGain"],function(Tone){"use strict";return Tone.CrossFade=function(initialFade){Tone.call(this,2,1),this.a=this.input[0]=this.context.createGain(),this.b=this.input[1]=this.context.createGain(),this.fade=new Tone.Signal(this.defaultArg(initialFade,.5),Tone.Type.NormalRange),this._equalPowerA=new Tone.EqualPowerGain,this._equalPowerB=new Tone.EqualPowerGain,this._invert=new Tone.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},Tone.extend(Tone.CrossFade),Tone.CrossFade.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.disconnect(),this.a=null,this.b.disconnect(),this.b=null,this},Tone.CrossFade}),define("Tone/effect/Effect",["Tone/core/Tone","Tone/component/CrossFade"],function(Tone){"use strict";return Tone.Effect=function(){Tone.call(this);var options=this.optionsObject(arguments,["wet"],Tone.Effect.defaults);this._dryWet=new Tone.CrossFade(options.wet),this.wet=this._dryWet.fade,this.effectSend=this.context.createGain(),this.effectReturn=this.context.createGain(),this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},Tone.extend(Tone.Effect),Tone.Effect.defaults={wet:1},Tone.Effect.prototype.connectEffect=function(effect){return this.effectSend.chain(effect,this.effectReturn),this},Tone.Effect.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.disconnect(),this.effectSend=null,this.effectReturn.disconnect(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},Tone.Effect}),define("Tone/component/Merge",["Tone/core/Tone"],function(Tone){"use strict";return Tone.Merge=function(){Tone.call(this,2,0),this.left=this.input[0]=this.context.createGain(),this.right=this.input[1]=this.context.createGain(),this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},Tone.extend(Tone.Merge),Tone.Merge.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this.left.disconnect(),this.left=null,this.right.disconnect(),this.right=null,this._merger.disconnect(),this._merger=null,this},Tone.Merge}),define("Tone/component/Split",["Tone/core/Tone"],function(Tone){"use strict";return Tone.Split=function(){Tone.call(this,0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this.left=this.output[0]=this.context.createGain(),this.right=this.output[1]=this.context.createGain(),this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},Tone.extend(Tone.Split),Tone.Split.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._splitter.disconnect(),this.left.disconnect(),this.right.disconnect(),this.left=null,this.right=null,this._splitter=null,this},Tone.Split}),define("Tone/signal/GainToAudio",["Tone/core/Tone","Tone/signal/WaveShaper","Tone/signal/Signal"],function(Tone){"use strict";return Tone.GainToAudio=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return Math.abs(x)*2-1})},Tone.extend(Tone.GainToAudio,Tone.SignalBase),Tone.GainToAudio.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},Tone.GainToAudio}),define("Tone/component/Panner",["Tone/core/Tone","Tone/component/CrossFade","Tone/component/Merge","Tone/component/Split","Tone/signal/Signal","Tone/signal/GainToAudio"],function(Tone){"use strict";return Tone.Panner=function(initialPan){Tone.call(this),this._hasStereoPanner=this.isFunction(this.context.createStereoPanner),this._hasStereoPanner?(this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=new Tone.Signal(0,Tone.Type.NormalRange),this._scalePan=new Tone.GainToAudio,this.pan.chain(this._scalePan,this._panner.pan)):(this._crossFade=new Tone.CrossFade,this._merger=this.output=new Tone.Merge,this._splitter=this.input=new Tone.Split,this.pan=this._crossFade.fade,this._splitter.connect(this._crossFade,0,0),this._splitter.connect(this._crossFade,1,1),this._crossFade.a.connect(this._merger,0,0),this._crossFade.b.connect(this._merger,0,1)),this.pan.value=this.defaultArg(initialPan,.5),this._readOnly("pan")},Tone.extend(Tone.Panner),Tone.Panner.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._writable("pan"),this._hasStereoPanner?(this._panner.disconnect(),this._panner=null,this.pan.dispose(),this.pan=null,this._scalePan.dispose(),this._scalePan=null):(this._crossFade.dispose(),this._crossFade=null,this._splitter.dispose(),this._splitter=null,this._merger.dispose(),this._merger=null,this.pan=null),this},Tone.Panner}),define("Tone/effect/AutoPanner",["Tone/core/Tone","Tone/effect/Effect","Tone/component/LFO","Tone/component/Panner"],function(Tone){"use strict";return Tone.AutoPanner=function(){var options=this.optionsObject(arguments,["frequency"],Tone.AutoPanner.defaults);Tone.Effect.call(this,options),this._lfo=new Tone.LFO({frequency:options.frequency,amplitude:options.depth,min:0,max:1}),this.depth=this._lfo.amplitude,this._panner=new Tone.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=options.type,this._readOnly(["depth","frequency"])},Tone.extend(Tone.AutoPanner,Tone.Effect),Tone.AutoPanner.defaults={frequency:1,type:"sine",depth:1},Tone.AutoPanner.prototype.start=function(time){return this._lfo.start(time),this},Tone.AutoPanner.prototype.stop=function(time){return this._lfo.stop(time),this},Tone.AutoPanner.prototype.sync=function(delay){return this._lfo.sync(delay),this},Tone.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(Tone.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}}),Tone.AutoPanner.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},Tone.AutoPanner}),define("Tone/component/Follower",["Tone/core/Tone","Tone/signal/Abs","Tone/signal/Subtract","Tone/signal/Multiply","Tone/signal/Signal","Tone/signal/WaveShaper","Tone/core/Type"],function(Tone){"use strict";return Tone.Follower=function(){Tone.call(this);var options=this.optionsObject(arguments,["attack","release"],Tone.Follower.defaults);this._abs=new Tone.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new Tone.WaveShaper,this._sub=new Tone.Subtract,this._delay=this.context.createDelay(),this._delay.delayTime.value=this.blockTime,this._mult=new Tone.Multiply(1e4),this._attack=options.attack,this._release=options.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},Tone.extend(Tone.Follower),Tone.Follower.defaults={attack:.05,release:.5},Tone.Follower.prototype._setAttackRelease=function(attack,release){var minTime=this.blockTime;attack=this.secondsToFrequency(this.toSeconds(attack)),release=this.secondsToFrequency(this.toSeconds(release)),attack=Math.max(attack,minTime),release=Math.max(release,minTime),this._frequencyValues.setMap(function(val){return val<=0?attack:release})},Object.defineProperty(Tone.Follower.prototype,"attack",{get:function(){return this._attack},set:function(attack){this._attack=attack,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(Tone.Follower.prototype,"release",{get:function(){return this._release},set:function(release){this._release=release,this._setAttackRelease(this._attack,this._release)}}),Tone.Follower.prototype.connect=Tone.Signal.prototype.connect,Tone.Follower.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.disconnect(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},Tone.Follower}),define("Tone/signal/ScaleExp",["Tone/core/Tone","Tone/signal/Scale","Tone/signal/Pow"],function(Tone){return Tone.ScaleExp=function(outputMin,outputMax,exponent){this._scale=this.output=new Tone.Scale(outputMin,outputMax),this._exp=this.input=new Tone.Pow(this.defaultArg(exponent,2)),this._exp.connect(this._scale)},Tone.extend(Tone.ScaleExp,Tone.SignalBase),Object.defineProperty(Tone.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}}),Object.defineProperty(Tone.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(min){this._scale.min=min}}),Object.defineProperty(Tone.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(max){this._scale.max=max}}),Tone.ScaleExp.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},Tone.ScaleExp}),define("Tone/effect/AutoWah",["Tone/core/Tone","Tone/component/Follower","Tone/signal/ScaleExp","Tone/effect/Effect","Tone/component/Filter"],function(Tone){"use strict";return Tone.AutoWah=function(){var options=this.optionsObject(arguments,["baseFrequency","octaves","sensitivity"],Tone.AutoWah.defaults);Tone.Effect.call(this,options),this.follower=new Tone.Follower(options.follower),this._sweepRange=new Tone.ScaleExp(0,1,.5),this._baseFrequency=options.baseFrequency,this._octaves=options.octaves,this._inputBoost=this.context.createGain(),this._bandpass=new Tone.Filter({rolloff:-48,frequency:0,Q:options.Q}),this._peaking=new Tone.Filter(0,"peaking"),this._peaking.gain.value=options.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=options.sensitivity,this._readOnly(["gain","Q"])},Tone.extend(Tone.AutoWah,Tone.Effect),Tone.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(Tone.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves,this._setSweepRange()}}),Object.defineProperty(Tone.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(baseFreq){this._baseFrequency=baseFreq,this._setSweepRange()}}),Object.defineProperty(Tone.AutoWah.prototype,"sensitivity",{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(sensitivy){this._inputBoost.gain.value=1/this.dbToGain(sensitivy)}}),Tone.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},Tone.AutoWah.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.disconnect(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},Tone.AutoWah}),define("Tone/effect/BitCrusher",["Tone/core/Tone","Tone/effect/Effect","Tone/signal/Subtract","Tone/signal/Modulo"],function(Tone){"use strict";return Tone.BitCrusher=function(){var options=this.optionsObject(arguments,["bits"],Tone.BitCrusher.defaults);Tone.Effect.call(this,options);var invStepSize=1/Math.pow(2,options.bits-1);this._subtract=new Tone.Subtract,this._modulo=new Tone.Modulo(invStepSize),this._bits=options.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},Tone.extend(Tone.BitCrusher,Tone.Effect),Tone.BitCrusher.defaults={bits:4},Object.defineProperty(Tone.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(bits){this._bits=bits;var invStepSize=1/Math.pow(2,bits-1);this._modulo.value=invStepSize}}),Tone.BitCrusher.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},Tone.BitCrusher}),define("Tone/effect/StereoEffect",["Tone/core/Tone","Tone/effect/Effect","Tone/component/Split","Tone/component/Merge","Tone/component/CrossFade"],function(Tone){"use strict";return Tone.StereoEffect=function(){Tone.call(this);var options=this.optionsObject(arguments,["wet"],Tone.Effect.defaults);this._dryWet=new Tone.CrossFade(options.wet),this.wet=this._dryWet.fade,this._split=new Tone.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new Tone.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},Tone.extend(Tone.StereoEffect,Tone.Effect),Tone.StereoEffect.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},Tone.StereoEffect}),define("Tone/effect/FeedbackEffect",["Tone/core/Tone","Tone/effect/Effect","Tone/signal/Signal","Tone/signal/Multiply"],function(Tone){"use strict";return Tone.FeedbackEffect=function(){var options=this.optionsObject(arguments,["feedback"]);options=this.defaultArg(options,Tone.FeedbackEffect.defaults),Tone.Effect.call(this,options),this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange),this._feedbackGain=this.context.createGain(),this.effectReturn.chain(this._feedbackGain,this.effectSend),this.feedback.connect(this._feedbackGain.gain),this._readOnly(["feedback"])},Tone.extend(Tone.FeedbackEffect,Tone.Effect),Tone.FeedbackEffect.defaults={feedback:.125},Tone.FeedbackEffect.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackGain.disconnect(),this._feedbackGain=null,this},Tone.FeedbackEffect}),define("Tone/effect/StereoXFeedbackEffect",["Tone/core/Tone","Tone/effect/StereoEffect","Tone/effect/FeedbackEffect"],function(Tone){"use strict";return Tone.StereoXFeedbackEffect=function(){var options=this.optionsObject(arguments,["feedback"],Tone.FeedbackEffect.defaults);Tone.StereoEffect.call(this,options),this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange),this._feedbackLR=this.context.createGain(),this._feedbackRL=this.context.createGain(),this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},Tone.extend(Tone.StereoXFeedbackEffect,Tone.FeedbackEffect),Tone.StereoXFeedbackEffect.prototype.dispose=function(){return Tone.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.disconnect(),this._feedbackLR=null,this._feedbackRL.disconnect(),this._feedbackRL=null,this},Tone.StereoXFeedbackEffect}),define("Tone/effect/Chorus",["Tone/core/Tone","Tone/component/LFO","Tone/effect/StereoXFeedbackEffect"],function(Tone){"use strict";return Tone.Chorus=function(){var options=this.optionsObject(arguments,["frequency","delayTime","depth"],Tone.Chorus.defaults);Tone.StereoXFeedbackEffect.call(this,options),this._depth=options.depth,this._delayTime=options.delayTime/1e3,this._lfoL=new Tone.LFO({frequency:options.frequency,min:0,max:1}),this._lfoR=new Tone.LFO({frequency:options.frequency,min:0,max:1,phase:180}),this._delayNodeL=this.context.createDelay(),this._delayNodeR=this.context.createDelay(),this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=options.frequency,this.type=options.type,this._readOnly(["frequency"]),this.spread=options.spread},Tone.extend(Tone.Chorus,Tone.StereoXFeedbackEffect),Tone.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine",spread:180},Object.defineProperty(Tone.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(depth){this._depth=depth;var deviation=this._delayTime*depth;this._lfoL.min=Math.max(this._delayTime-deviation,0),this._lfoL.max=this._delayTime+deviation,this._lfoR.min=Math.max(this._delayTime-deviation,0),this._lfoR.max=this._delayTime+deviation}}),Object.defineProperty(Tone.Chorus.prototype,"delayTime",{get:function(){return this._delayTime*1e3},set:function(delayTime){this._delayTime=delayTime/1e3,this.depth=this._depth}}),Object.defineProperty(Tone.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type,this._lfoR.type=type}}),Object.defineProperty(Tone.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(spread){this._lfoL.phase=90-spread/2,this._lfoR.phase=spread/2+90}}),Tone.Chorus.prototype.dispose=function(){return Tone.StereoXFeedbackEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.disconnect(),this._delayNodeL=null,this._delayNodeR.disconnect(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},Tone.Chorus}),define("Tone/core/Buffer",["Tone/core/Tone","Tone/core/Emitter"],function(Tone){"use strict";return Tone.Buffer=function(){var options=this.optionsObject(arguments,["url","onload"],Tone.Buffer.defaults);this._buffer=null,this._reversed=options.reverse,this.url=undefined,this.loaded=!1,this.onload=options.onload.bind(this,this),options.url instanceof AudioBuffer||options.url instanceof Tone.Buffer?(this.set(options.url),this.onload(this)):this.isString(options.url)&&(this.url=options.url,Tone.Buffer._addToQueue(options.url,this))},Tone.extend(Tone.Buffer),Tone.Buffer.defaults={url:undefined,onload:Tone.noOp,reverse:!1},Tone.Buffer.prototype.set=function(buffer){return buffer instanceof Tone.Buffer?this._buffer=buffer.get():this._buffer=buffer,this.loaded=!0,this},Tone.Buffer.prototype.get=function(){return this._buffer},Tone.Buffer.prototype.load=function(url,callback){return this.url=url,this.onload=this.defaultArg(callback,this.onload),Tone.Buffer._addToQueue(url,this),this},Tone.Buffer.prototype.dispose=function(){return Tone.prototype.dispose.call(this),Tone.Buffer._removeFromQueue(this),this._buffer=null,this.onload=Tone.Buffer.defaults.onload,this},Object.defineProperty(Tone.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Tone.Buffer.prototype._reverse=function(){if(this.loaded)for(var i=0;i<this._buffer.numberOfChannels;i++)Array.prototype.reverse.call(this._buffer.getChannelData(i));return this},Object.defineProperty(Tone.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(rev){this._reversed!==rev&&(this._reversed=rev,this._reverse())}}),Tone.Emitter.mixin(Tone.Buffer),Tone.Buffer._queue=[],Tone.Buffer._currentDownloads=[],Tone.Buffer._totalDownloads=0,Tone.Buffer.MAX_SIMULTANEOUS_DOWNLOADS=6,Tone.Buffer._addToQueue=function(url,buffer){Tone.Buffer._queue.push({url:url,Buffer:buffer,progress:0,xhr:null}),this._totalDownloads++,Tone.Buffer._next()},Tone.Buffer._removeFromQueue=function(buffer){var i;for(i=0;i<Tone.Buffer._queue.length;i++){var q=Tone.Buffer._queue[i];q.Buffer===buffer&&Tone.Buffer._queue.splice(i,1)}for(i=0;i<Tone.Buffer._currentDownloads.length;i++){var dl=Tone.Buffer._currentDownloads[i];dl.Buffer===buffer&&(Tone.Buffer._currentDownloads.splice(i,1),dl.xhr.abort(),dl.xhr.onprogress=null,dl.xhr.onload=null,dl.xhr.onerror=null)}},Tone.Buffer._next=function(){if(Tone.Buffer._queue.length>0){if(Tone.Buffer._currentDownloads.length<Tone.Buffer.MAX_SIMULTANEOUS_DOWNLOADS){var next=Tone.Buffer._queue.shift();Tone.Buffer._currentDownloads.push(next),next.xhr=Tone.Buffer.load(next.url,function(buffer){var index=Tone.Buffer._currentDownloads.indexOf(next);Tone.Buffer._currentDownloads.splice(index,1),next.Buffer.set(buffer),next.Buffer._reversed&&next.Buffer._reverse(),next.Buffer.onload(next.Buffer),Tone.Buffer._onprogress(),Tone.Buffer._next()}),next.xhr.onprogress=function(event){next.progress=event.loaded/event.total,Tone.Buffer._onprogress()},next.xhr.onerror=function(e){Tone.Buffer.trigger("error",e)}}}else Tone.Buffer._currentDownloads.length===0&&(Tone.Buffer.trigger("load"),Tone.Buffer._totalDownloads=0)},Tone.Buffer._onprogress=function(){var curretDownloadsProgress=0,currentDLLen=Tone.Buffer._currentDownloads.length,inprogress=0;if(currentDLLen>0){for(var i=0;i<currentDLLen;i++){var dl=Tone.Buffer._currentDownloads[i];curretDownloadsProgress+=dl.progress}inprogress=curretDownloadsProgress}var currentDownloadProgress=currentDLLen-inprogress,completed=Tone.Buffer._totalDownloads-Tone.Buffer._queue.length-currentDownloadProgress;Tone.Buffer.trigger("progress",completed/Tone.Buffer._totalDownloads)},Tone.Buffer.load=function(url,callback){var request=new XMLHttpRequest;return request.open("GET",url,!0),request.responseType="arraybuffer",request.onload=function(){Tone.context.decodeAudioData(request.response,function(buff){if(!buff)throw new Error("could not decode audio data:"+url);callback(buff)})},request.send(),request},Object.defineProperty(Tone.Buffer,"onload",{set:function(cb){console.warn("Tone.Buffer.onload is deprecated, use Tone.Buffer.on('load', callback)"),Tone.Buffer.on("load",cb)}}),Object.defineProperty(Tone.Buffer,"onprogress",{set:function(cb){console.warn("Tone.Buffer.onprogress is deprecated, use Tone.Buffer.on('progress', callback)"),Tone.Buffer.on("progress",cb)}}),Object.defineProperty(Tone.Buffer,"onerror",{set:function(cb){console.warn("Tone.Buffer.onerror is deprecated, use Tone.Buffer.on('error', callback)"),Tone.Buffer.on("error",cb)}}),Tone.Buffer}),define("Tone/effect/Convolver",["Tone/core/Tone","Tone/core/Buffer","Tone/effect/Effect"],function(Tone){"use strict";return Tone.Convolver=function(){var options=this.optionsObject(arguments,["url"],Tone.Convolver.defaults);Tone.Effect.call(this,options),this._convolver=this.context.createConvolver(),this._buffer=new Tone.Buffer(options.url,function(buffer){this.buffer=buffer,options.onload()}.bind(this)),this.connectEffect(this._convolver)},Tone.extend(Tone.Convolver,Tone.Effect),Tone.Convolver.defaults={url:"",onload:Tone.noOp},Object.defineProperty(Tone.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(buffer){this._buffer.set(buffer),this._convolver.buffer=this._buffer.get()}}),Tone.Convolver.prototype.load=function(url,callback){return this._buffer.load(url,function(buff){this.buffer=buff,callback&&callback()}.bind(this)),this},Tone.Convolver.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},Tone.Convolver}),define("Tone/effect/Distortion",["Tone/core/Tone","Tone/effect/Effect","Tone/signal/WaveShaper"],function(Tone){"use strict";return Tone.Distortion=function(){var options=this.optionsObject(arguments,["distortion"],Tone.Distortion.defaults);Tone.Effect.call(this,options),this._shaper=new Tone.WaveShaper(4096),this._distortion=options.distortion,this.connectEffect(this._shaper),this.distortion=options.distortion,this.oversample=options.oversample},Tone.extend(Tone.Distortion,Tone.Effect),Tone.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(Tone.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(amount){this._distortion=amount;var k=amount*100,deg=Math.PI/180;this._shaper.setMap(function(x){return Math.abs(x)<.001?0:(3+k)*x*20*deg/(Math.PI+k*Math.abs(x))})}}),Object.defineProperty(Tone.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}}),Tone.Distortion.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},Tone.Distortion}),define("Tone/component/LowpassCombFilter",["Tone/core/Tone","Tone/signal/Signal","Tone/component/Filter","Tone/core/Param"],function(Tone){"use strict";return Tone.LowpassCombFilter=function(){Tone.call(this);var options=this.optionsObject(arguments,["delayTime","resonance","dampening"],Tone.LowpassCombFilter.defaults);this._delay=this.input=this.context.createDelay(1),this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time),this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=0,this._lowpass.type="lowpass",this.dampening=new Tone.Param({param:this._lowpass.frequency,units:Tone.Type.Frequency,value:options.dampening}),this._feedback=this.context.createGain(),this.resonance=new Tone.Param({param:this._feedback.gain,units:Tone.Type.NormalRange,value:options.resonance}),this._delay.chain(this._lowpass,this._feedback,this._delay),this.delayTime.connect(this._delay.delayTime),this._readOnly(["dampening","resonance","delayTime"])},Tone.extend(Tone.LowpassCombFilter),Tone.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},Tone.LowpassCombFilter.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.disconnect(),this._delay=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this.delayTime.dispose(),this.delayTime=null,this},Tone.LowpassCombFilter}),define("Tone/effect/Freeverb",["Tone/core/Tone","Tone/component/LowpassCombFilter","Tone/effect/StereoEffect","Tone/signal/Signal","Tone/component/Split","Tone/component/Merge","Tone/signal/ScaleExp"],function(Tone){"use strict";var combFilterTunings=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],allpassFilterFrequencies=[225,556,441,341];return Tone.Freeverb=function(){var options=this.optionsObject(arguments,["roomSize","dampening"],Tone.Freeverb.defaults);Tone.StereoEffect.call(this,options),this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange),this.dampening=new Tone.Signal(options.dampening,Tone.Type.Frequency),this._dampeningScale=new Tone.ScaleExp(100,8e3,.5),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var l=0;l<allpassFilterFrequencies.length;l++){var allpassL=this.context.createBiquadFilter();allpassL.type="allpass",allpassL.frequency.value=allpassFilterFrequencies[l],this._allpassFiltersL.push(allpassL)}for(var r=0;r<allpassFilterFrequencies.length;r++){var allpassR=this.context.createBiquadFilter();allpassR.type="allpass",allpassR.frequency.value=allpassFilterFrequencies[r],this._allpassFiltersR.push(allpassR)}for(var c=0;c<combFilterTunings.length;c++){var lfpf=new Tone.LowpassCombFilter(combFilterTunings[c]);c<combFilterTunings.length/2?this.effectSendL.chain(lfpf,this._allpassFiltersL[0]):this.effectSendR.chain(lfpf,this._allpassFiltersR[0]),this.roomSize.connect(lfpf.resonance),this._dampeningScale.connect(lfpf.dampening),this._combFilters.push(lfpf)}this.connectSeries.apply(this,this._allpassFiltersL),this.connectSeries.apply(this,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this.dampening.connect(this._dampeningScale),this._readOnly(["roomSize","dampening"])},Tone.extend(Tone.Freeverb,Tone.StereoEffect),Tone.Freeverb.defaults={roomSize:.7,dampening:.5},Tone.Freeverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var al=0;al<this._allpassFiltersL.length;al++)this._allpassFiltersL[al].disconnect(),this._allpassFiltersL[al]=null;this._allpassFiltersL=null;for(var ar=0;ar<this._allpassFiltersR.length;ar++)this._allpassFiltersR[ar].disconnect(),this._allpassFiltersR[ar]=null;this._allpassFiltersR=null;for(var cf=0;cf<this._combFilters.length;cf++)this._combFilters[cf].dispose(),this._combFilters[cf]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},Tone.Freeverb}),define("Tone/effect/Phaser",["Tone/core/Tone","Tone/component/LFO","Tone/component/Filter","Tone/effect/StereoEffect"],function(Tone){"use strict";return Tone.Phaser=function(){var options=this.optionsObject(arguments,["frequency","octaves","baseFrequency"],Tone.Phaser.defaults);Tone.StereoEffect.call(this,options),this._lfoL=new Tone.LFO(options.frequency,0,1),this._lfoR=new Tone.LFO(options.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=options.baseFrequency,this._octaves=options.octaves,this.Q=new Tone.Signal(options.Q,Tone.Type.Positive),this._filtersL=this._makeFilters(options.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(options.stages,this._lfoR,this.Q),this.frequency=this._lfoL.frequency,this.frequency.value=options.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[options.stages-1].connect(this.effectReturnL),this._filtersR[options.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=options.baseFrequency,this.octaves=options.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},Tone.extend(Tone.Phaser,Tone.StereoEffect),Tone.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},Tone.Phaser.prototype._makeFilters=function(stages,connectToFreq,Q){var filters=new Array(stages);for(var i=0;i<stages;i++){var filter=this.context.createBiquadFilter();filter.type="allpass",Q.connect(filter.Q),connectToFreq.connect(filter.frequency),filters[i]=filter}return this.connectSeries.apply(this,filters),filters},Object.defineProperty(Tone.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves;var max=this._baseFrequency*Math.pow(2,octaves);this._lfoL.max=max,this._lfoR.max=max}}),Object.defineProperty(Tone.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(freq){this._baseFrequency=freq,this._lfoL.min=freq,this._lfoR.min=freq,this.octaves=this._octaves}}),Tone.Phaser.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var i=0;i<this._filtersL.length;i++)this._filtersL[i].disconnect(),this._filtersL[i]=null;this._filtersL=null;for(var j=0;j<this._filtersR.length;j++)this._filtersR[j].disconnect(),this._filtersR[j]=null;return this._filtersR=null,this.frequency=null,this},Tone.Phaser}),define("Tone/effect/PingPongDelay",["Tone/core/Tone","Tone/effect/StereoXFeedbackEffect","Tone/signal/Signal"],function(Tone){"use strict";return Tone.PingPongDelay=function(){var options=this.optionsObject(arguments,["delayTime","feedback"],Tone.PingPongDelay.defaults);Tone.StereoXFeedbackEffect.call(this,options),this._leftDelay=this.context.createDelay(options.maxDelayTime),this._rightDelay=this.context.createDelay(options.maxDelayTime),this._rightPreDelay=this.context.createDelay(options.maxDelayTime),this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},Tone.extend(Tone.PingPongDelay,Tone.StereoXFeedbackEffect),Tone.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},Tone.PingPongDelay.prototype.dispose=function(){return Tone.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.disconnect(),this._leftDelay=null,this._rightDelay.disconnect(),this._rightDelay=null,this._rightPreDelay.disconnect(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},Tone.PingPongDelay}),define("Tone/effect/Tremolo",["Tone/core/Tone","Tone/component/LFO","Tone/effect/StereoEffect"],function(Tone){"use strict";return Tone.Tremolo=function(){var options=this.optionsObject(arguments,["frequency","depth"],Tone.Tremolo.defaults);Tone.StereoEffect.call(this,options),this._lfoL=new Tone.LFO({phase:options.spread,min:1,max:0}),this._lfoR=new Tone.LFO({phase:options.spread,min:1,max:0}),this._amplitudeL=new Tone.Gain,this._amplitudeR=new Tone.Gain,this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.depth=new Tone.Signal(options.depth,Tone.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=options.type,this.spread=options.spread},Tone.extend(Tone.Tremolo,Tone.StereoEffect),Tone.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},Tone.Tremolo.prototype.start=function(time){return this._lfoL.start(time),this._lfoR.start(time),this},Tone.Tremolo.prototype.stop=function(time){return this._lfoL.stop(time),this._lfoR.stop(time),this},Tone.Tremolo.prototype.sync=function(delay){return this._lfoL.sync(delay),this._lfoR.sync(delay),this},Tone.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),this},Object.defineProperty(Tone.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type,this._lfoR.type=type}}),Object.defineProperty(Tone.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(spread){this._lfoL.phase=90-spread/2,this._lfoR.phase=spread/2+90}}),Tone.Tremolo.prototype.dispose=function(){return Tone.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},Tone.Tremolo}),define("Tone/core/Delay",["Tone/core/Tone","Tone/core/Param"],function(Tone){"use strict";return Tone.Delay=function(){var options=this.optionsObject(arguments,["delayTime","maxDelay"],Tone.Delay.defaults);this._delayNode=this.input=this.output=this.context.createDelay(this.toSeconds(options.maxDelay)),this.delayTime=new Tone.Param({param:this._delayNode.delayTime,units:Tone.Type.Time,value:options.delayTime}),this._readOnly("delayTime")},Tone.extend(Tone.Delay),Tone.Delay.defaults={maxDelay:1,delayTime:0},Tone.Delay.prototype.dispose=function(){return Tone.Param.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},Tone.Delay}),define("Tone/effect/PitchShift",["Tone/core/Tone","Tone/component/LFO","Tone/component/CrossFade","Tone/signal/Signal","Tone/effect/FeedbackEffect","Tone/core/Delay"],function(Tone){"use strict";return Tone.PitchShift=function(){var options=this.optionsObject(arguments,["pitch"],Tone.PitchShift.defaults);Tone.FeedbackEffect.call(this,options),this._frequency=new Tone.Signal(0),this._delayA=new Tone.Delay(0,1),this._lfoA=(new Tone.LFO({min:0,max:.1,type:"sawtooth"})).connect(this._delayA.delayTime),this._delayB=new Tone.Delay(0,1),this._lfoB=(new Tone.LFO({min:0,max:.1,type:"sawtooth",phase:180})).connect(this._delayB.delayTime),this._crossFade=new Tone.CrossFade,this._crossFadeLFO=(new Tone.LFO({min:0,max:1,type:"triangle",phase:90})).connect(this._crossFade.fade),this._feedbackDelay=new Tone.Delay(options.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=options.pitch,this._windowSize=options.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var now=this.now();this._lfoA.start(now),this._lfoB.start(now),this._crossFadeLFO.start(now),this.windowSize=this._windowSize},Tone.extend(Tone.PitchShift,Tone.FeedbackEffect),Tone.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(Tone.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(interval){this._pitch=interval;var factor=0;interval<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,factor=this.intervalToFrequencyRatio(interval-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,factor=this.intervalToFrequencyRatio(interval)-1),this._frequency.value=factor*(1.2/this._windowSize)}}),Object.defineProperty(Tone.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(size){this._windowSize=this.toSeconds(size),this.pitch=this._pitch}}),Tone.PitchShift.prototype.dispose=function(){return Tone.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},Tone.PitchShift}),define("Tone/source/Player",["Tone/core/Tone","Tone/core/Buffer","Tone/source/Source"],function(Tone){"use strict";return Tone.Player=function(url){var options;url instanceof Tone.Buffer?(url=url.get(),options=Tone.Player.defaults):options=this.optionsObject(arguments,["url","onload"],Tone.Player.defaults),Tone.Source.call(this,options),this._source=null,this.autostart=options.autostart,this._buffer=new Tone.Buffer({url:options.url,onload:this._onload.bind(this,options.onload),reverse:options.reverse}),url instanceof AudioBuffer&&this._buffer.set(url),this._loop=options.loop,this._loopStart=options.loopStart,this._loopEnd=options.loopEnd,Tone.isSafari?this._playbackRate=options.playbackRate:(this.playbackRate=new Tone.Signal(options.playbackRate,Tone.Type.Positive),this._readOnly("playbackRate")),this.retrigger=options.retrigger},Tone.extend(Tone.Player,Tone.Source),Tone.Player.defaults={onload:Tone.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1},Tone.Player.prototype.load=function(url,callback){return this._buffer.load(url,this._onload.bind(this,callback)),this},Tone.Player.prototype._onload=function(callback){callback(this),this.autostart&&this.start()},Tone.Player.prototype._start=function(startTime,offset,duration){return this._buffer.loaded&&this._buffer._buffer?(this._loop?offset=this.defaultArg(offset,this._loopStart):offset=this.defaultArg(offset,0),offset=this.toSeconds(offset),duration=this.defaultArg(duration,this._buffer.duration-offset),startTime=this.toSeconds(startTime),duration=this.toSeconds(duration),this._source=this.context.createBufferSource(),this._source.buffer=this._buffer.get(),this._loop?(this._source.loop=this._loop,this._source.loopStart=this.toSeconds(this._loopStart),this._source.loopEnd=this.toSeconds(this._loopEnd),duration=65536):this._state.setStateAtTime(Tone.State.Stopped,startTime+duration),Tone.isSafari?this._source.playbackRate.value=this._playbackRate:this.playbackRate.connect(this._source.playbackRate),this._source.connect(this.output),this._loop?this._source.start(startTime,offset):this._source.start(startTime,offset,duration)):console.log("tried to start Player before the buffer was loaded"),this},Tone.Player.prototype._stop=function(time){return this._source&&(this._source.stop(this.toSeconds(time)),this._source=null),this},Tone.Player.prototype.setLoopPoints=function(loopStart,loopEnd){return this.loopStart=loopStart,this.loopEnd=loopEnd,this},Object.defineProperty(Tone.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(loopStart){this._loopStart=loopStart,this._source&&(this._source.loopStart=this.toSeconds(loopStart))}}),Object.defineProperty(Tone.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(loopEnd){this._loopEnd=loopEnd,this._source&&(this._source.loopEnd=this.toSeconds(loopEnd))}}),Object.defineProperty(Tone.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(buffer){this._buffer.set(buffer)}}),Object.defineProperty(Tone.Player.prototype,"loop",{get:function(){return this._loop},set:function(loop){this._loop=loop,this._source&&(this._source.loop=loop)}}),Tone.isSafari&&Object.defineProperty(Tone.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this._source&&(this._source.playbackRate.value=rate)}}),Object.defineProperty(Tone.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(rev){this._buffer.reverse=rev}}),Tone.Player.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._source!==null&&(this._source.disconnect(),this._source=null),this._buffer.dispose(),this._buffer=null,Tone.isSafari||(this._writable("playbackRate"),this.playbackRate.dispose(),this.playbackRate=null),this},Tone.Player}),define("Tone/instrument/Instrument",["Tone/core/Tone","Tone/core/Type"],function(Tone){"use strict";return Tone.Instrument=function(options){options=this.defaultArg(options,Tone.Instrument.defaults),this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._readOnly("volume")},Tone.extend(Tone.Instrument),Tone.Instrument.defaults={volume:0},Tone.Instrument.prototype.triggerAttack=Tone.noOp,Tone.Instrument.prototype.triggerRelease=Tone.noOp,Tone.Instrument.prototype.triggerAttackRelease=function(note,duration,time,velocity){return time=this.toSeconds(time),duration=this.toSeconds(duration),this.triggerAttack(note,time,velocity),this.triggerRelease(time+duration),this},Tone.Instrument.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this},Tone.Instrument}),define("Tone/instrument/Simpler",["Tone/core/Tone","Tone/source/Player","Tone/component/AmplitudeEnvelope","Tone/instrument/Instrument"],function(Tone){"use strict";return Tone.Simpler=function(urls,options){options=this.defaultArg(options,Tone.Simpler.defaults),Tone.Instrument.call(this,options),this.player=new Tone.Player(options.player),this._buffers={},this.envelope=new Tone.AmplitudeEnvelope(options.envelope),this._sample=options.sample,this._loadBuffers(urls),this.player.chain(this.envelope,this.output),this._readOnly(["player","envelope"])},Tone.extend(Tone.Simpler,Tone.Instrument),Tone.Simpler.defaults={sample:0,pitch:0,player:{loop:!1},envelope:{attack:.001,decay:0,sustain:1,release:.1}},Tone.Simpler.prototype._loadBuffers=function(urls){if(typeof urls=="string")this._buffers[0]=new Tone.Buffer(urls,function(){this.sample="0"}.bind(this));else{urls=this._flattenUrls(urls);for(var buffName in urls){this._sample=buffName;var urlString=urls[buffName];this._buffers[buffName]=new Tone.Buffer(urlString)}}},Tone.Simpler.prototype._flattenUrls=function(ob){var toReturn={};for(var i in ob){if(!ob.hasOwnProperty(i))continue;if(typeof ob[i]=="object"){var flatObject=this._flattenUrls(ob[i]);for(var x in flatObject){if(!flatObject.hasOwnProperty(x))continue;toReturn[i+"."+x]=flatObject[x]}}else toReturn[i]=ob[i]}return toReturn},Tone.Simpler.prototype.triggerAttack=function(time,offset,duration,velocity){return time=this.toSeconds(time),this.player.start(time,offset,duration),this.envelope.triggerAttack(time,velocity),this},Tone.Simpler.prototype.triggerRelease=function(time){return time=this.toSeconds(time),this.envelope.triggerRelease(time),this.player.stop(this.toSeconds(this.envelope.release)+time),this},Tone.Simpler.prototype.triggerAttackRelease=function(length,time,offset,duration,velocity){return time=this.toSeconds(time),length=this.toSeconds(length),this.triggerAttack(time,offset,duration,velocity),this.triggerRelease(time+length),this},Object.defineProperty(Tone.Simpler.prototype,"sample",{get:function(){return this._sample},set:function(name){if(!this._buffers.hasOwnProperty(name))throw new Error("Simpler does not have a sample named "+name);this._sample=name,this.player.buffer=this._buffers[name]}}),Object.defineProperty(Tone.Simpler.prototype,"reverse",{get:function(){for(var i in this._buffers)return this._buffers[i].reverse},set:function(rev){for(var i in this._buffers)this._buffers[i].reverse=rev}}),Tone.Simpler.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this),this._writable(["player","envelope"]),this.player.dispose(),this.envelope.dispose(),this.player=null,this.envelope=null;for(var sample in this._buffers)this._buffers[sample].dispose(),this._buffers[sample]=null;return this._buffers=null,this},Tone.Simpler}),define("Tone/source/ExternalInput",["Tone/core/Tone","Tone/source/Source","Tone/core/Gain"],function(Tone){"use strict";return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,Tone.ExternalInput=function(){var options=this.optionsObject(arguments,["inputNum"],Tone.ExternalInput.defaults);Tone.Source.call(this,options),this._mediaStream=null,this._stream=null,this._constraints={audio:!0},this._inputNum=options.inputNum,this._gate=(new Tone.Gain(0)).connect(this.output)},Tone.extend(Tone.ExternalInput,Tone.Source),Tone.ExternalInput.defaults={inputNum:0},Tone.ExternalInput.prototype._getUserMedia=function(callback){if(!Tone.ExternalInput.supported){console.error("browser does not support 'getUserMedia'");return}Tone.ExternalInput.sources[this._inputNum]&&(this._constraints={audio:{optional:[{sourceId:Tone.ExternalInput.sources[this._inputNum].id}]}}),navigator.getUserMedia(this._constraints,function(stream){this._onStream(stream),callback()}.bind(this),function(err){callback(err)})},Tone.ExternalInput.prototype._onStream=function(stream){if(!this.isFunction(this.context.createMediaStreamSource))throw new Error("browser does not support the 'MediaStreamSourceNode'");this._stream||(this._stream=stream,this._mediaStream=this.context.createMediaStreamSource(stream),this._mediaStream.connect(this._gate))},Tone.ExternalInput.prototype.open=function(callback){return callback=this.defaultArg(callback,Tone.noOp),Tone.ExternalInput.getSources(function(){this._getUserMedia(callback)}.bind(this)),this},Tone.ExternalInput.prototype.close=function(){if(this._stream){var track=this._stream.getTracks()[this._inputNum];this.isUndef(track)||track.stop(),this._stream=null}return this},Tone.ExternalInput.prototype._start=function(time){return time=this.toSeconds(time),this._gate.gain.setValueAtTime(1,time),this},Tone.ExternalInput.prototype._stop=function(time){return time=this.toSeconds(time),this._gate.gain.setValueAtTime(0,time),this},Tone.ExternalInput.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this.close(),this._mediaStream&&(this._mediaStream.disconnect(),this._mediaStream=null),this._constraints=null,this._gate.dispose(),this._gate=null,this},Tone.ExternalInput.sources=[],Tone.ExternalInput._canGetSources=!Tone.prototype.isUndef(window.MediaStreamTrack)&&Tone.prototype.isFunction(MediaStreamTrack.getSources),Object.defineProperty(Tone.ExternalInput,"supported",{get:function(){return Tone.prototype.isFunction(navigator.getUserMedia)}}),Tone.ExternalInput.getSources=function(callback){return Tone.ExternalInput.sources.length===0&&Tone.ExternalInput._canGetSources?MediaStreamTrack.getSources(function(media_sources){for(var i=0;i<media_sources.length;i++)media_sources[i].kind==="audio"&&(Tone.ExternalInput.sources[i]=media_sources[i]);callback(Tone.ExternalInput.sources)}):callback(Tone.ExternalInput.sources),this},Tone.ExternalInput}),define("Tone/source/Microphone",["Tone/core/Tone","Tone/source/ExternalInput"],function(Tone){"use strict";return Tone.Microphone=function(){Tone.ExternalInput.call(this,0)},Tone.extend(Tone.Microphone,Tone.ExternalInput),Object.defineProperty(Tone.Microphone,"supported",{get:function(){return Tone.ExternalInput.supported}}),Tone.Microphone}),define("Tone/source/Noise",["Tone/core/Tone","Tone/source/Source"],function(Tone){"use strict";Tone.Noise=function(){var options=this.optionsObject(arguments,["type"],Tone.Noise.defaults);Tone.Source.call(this,options),this._source=null,this._buffer=null,Tone.isSafari?this._playbackRate=options.playbackRate:(this.playbackRate=new Tone.Signal(options.playbackRate,Tone.Type.Positive),this._readOnly("playbackRate")),this.type=options.type},Tone.extend(Tone.Noise,Tone.Source),Tone.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(Tone.Noise.prototype,"type",{get:function(){if(this._buffer===_whiteNoise)return"white";if(this._buffer===_brownNoise)return"brown";if(this._buffer===_pinkNoise)return"pink"},set:function(type){if(this.type!==type){switch(type){case"white":this._buffer=_whiteNoise;break;case"pink":this._buffer=_pinkNoise;break;case"brown":this._buffer=_brownNoise;break;default:throw new Error("invalid noise type: "+type)}if(this.state===Tone.State.Started){var now=this.now()+this.blockTime;this._stop(now),this._start(now)}}}}),Tone.isSafari&&Object.defineProperty(Tone.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this._source&&(this._source.playbackRate.value=rate)}}),Tone.Noise.prototype._start=function(time){this._source=this.context.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this.playbackRate.connect(this._source.playbackRate),this._source.connect(this.output),this._source.start(this.toSeconds(time))},Tone.Noise.prototype._stop=function(time){this._source&&this._source.stop(this.toSeconds(time))},Tone.Noise.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._source!==null&&(this._source.disconnect(),this._source=null),this._buffer=null,Tone.isSafari||(this._writable("playbackRate"),this.playbackRate.dispose(),this.playbackRate=null),this};var _pinkNoise=null,_brownNoise=null,_whiteNoise=null;return Tone._initAudioContext(function(audioContext){var sampleRate=audioContext.sampleRate,bufferLength=sampleRate*4;_pinkNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum),b0,b1,b2,b3,b4,b5,b6;b0=b1=b2=b3=b4=b5=b6=0;for(var i=0;i<bufferLength;i++){var white=Math.random()*2-1;b0=.99886*b0+white*.0555179,b1=.99332*b1+white*.0750759,b2=.969*b2+white*.153852,b3=.8665*b3+white*.3104856,b4=.55*b4+white*.5329522,b5=-0.7616*b5-white*.016898,channel[i]=b0+b1+b2+b3+b4+b5+b6+white*.5362,channel[i]*=.11,b6=white*.115926}}return buffer}(),_brownNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum),lastOut=0;for(var i=0;i<bufferLength;i++){var white=Math.random()*2-1;channel[i]=(lastOut+.02*white)/1.02,lastOut=channel[i],channel[i]*=3.5}}return buffer}(),_whiteNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);for(var i=0;i<bufferLength;i++)channel[i]=Math.random()*2-1}return buffer}()}),Tone.Noise}),define("Tone/component/Meter",["Tone/core/Tone"],function(Tone){"use strict";return Tone.Meter=function(){var options=this.optionsObject(arguments,["channels","smoothing"],Tone.Meter.defaults);Tone.call(this),this._channels=options.channels,this.smoothing=options.smoothing,this.clipMemory=options.clipMemory,this.clipLevel=options.clipLevel,this._volume=new Array(this._channels),this._values=new Array(this._channels);for(var i=0;i<this._channels;i++)this._volume[i]=0,this._values[i]=0;this._lastClip=new Array(this._channels);for(var j=0;j<this._lastClip.length;j++)this._lastClip[j]=0;this._jsNode=this.context.createScriptProcessor(options.bufferSize,this._channels,1),this._jsNode.onaudioprocess=this._onprocess.bind(this),this._jsNode.noGC(),this.input.connect(this.output),this.input.connect(this._jsNode)},Tone.extend(Tone.Meter),Tone.Meter.defaults={smoothing:.8,bufferSize:1024,clipMemory:.5,clipLevel:.9,channels:1},Tone.Meter.prototype._onprocess=function(event){var bufferSize=this._jsNode.bufferSize,smoothing=this.smoothing;for(var channel=0;channel<this._channels;channel++){var input=event.inputBuffer.getChannelData(channel),sum=0,total=0,x;for(var i=0;i<bufferSize;i++)x=input[i],total+=x,sum+=x*x;var average=total/bufferSize,rms=Math.sqrt(sum/bufferSize);rms>.9&&(this._lastClip[channel]=Date.now()),this._volume[channel]=Math.max(rms,this._volume[channel]*smoothing),this._values[channel]=average}},Tone.Meter.prototype.getLevel=function(channel){channel=this.defaultArg(channel,0);var vol=this._volume[channel];return vol<1e-5?0:vol},Tone.Meter.prototype.getValue=function(channel){return channel=this.defaultArg(channel,0),this._values[channel]},Tone.Meter.prototype.getDb=function(channel){return this.gainToDb(this.getLevel(channel))},Tone.Meter.prototype.isClipped=function(channel){return channel=this.defaultArg(channel,0),Date.now()-this._lastClip[channel]<this._clipMemory*1e3},Tone.Meter.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._jsNode.disconnect(),this._jsNode.onaudioprocess=null,this._jsNode=null,this._volume=null,this._values=null,this._lastClip=null,this},Tone.Meter}),define("Tone/component/Mono",["Tone/core/Tone","Tone/component/Merge"],function(Tone){"use strict";return Tone.Mono=function(){Tone.call(this,1,0),this._merge=this.output=new Tone.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1),this.input.gain.value=this.dbToGain(-10)},Tone.extend(Tone.Mono),Tone.Mono.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},Tone.Mono}),function(){"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()};if("now"in window.performance==0){var offset=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-offset}}}();var TWEEN=TWEEN||function(){var _tweens=[];return{getAll:function(){return _tweens},removeAll:function(){_tweens=[]},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);i!==-1&&_tweens.splice(i,1)},update:function(time){if(_tweens.length===0)return!1;var i=0;time=time!==undefined?time:window.performance.now();while(i<_tweens.length)_tweens[i].update(time)?i++:_tweens.splice(i,1);return!0}}}();TWEEN.Tween=function(object){var _object=object,_valuesStart={},_valuesEnd={},_valuesStartRepeat={},_duration=1e3,_repeat=0,_yoyo=!1,_isPlaying=!1,_reversed=!1,_delayTime=0,_startTime=null,_easingFunction=TWEEN.Easing.Linear.None,_interpolationFunction=TWEEN.Interpolation.Linear,_chainedTweens=[],_onStartCallback=null,_onStartCallbackFired=!1,_onUpdateCallback=null,_onCompleteCallback=null,_onStopCallback=null;for(var field in object)_valuesStart[field]=parseFloat(object[field],10);this.to=function(properties,duration){return duration!==undefined&&(_duration=duration),_valuesEnd=properties,this},this.start=function(time){TWEEN.add(this),_isPlaying=!0,_onStartCallbackFired=!1,_startTime=time!==undefined?time:window.performance.now(),_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(_valuesEnd[property].length===0)continue;_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}if(_valuesStart[property]===undefined)continue;_valuesStart[property]=_object[property],_valuesStart[property]instanceof Array==0&&(_valuesStart[property]*=1),_valuesStartRepeat[property]=_valuesStart[property]||0}return this},this.stop=function(){return _isPlaying?(TWEEN.remove(this),_isPlaying=!1,_onStopCallback!==null&&_onStopCallback.call(_object),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++)_chainedTweens[i].stop()},this.delay=function(amount){return _delayTime=amount,this},this.repeat=function(times){return _repeat=times,this},this.yoyo=function(yoyo){return _yoyo=yoyo,this},this.easing=function(easing){return _easingFunction=easing,this},this.interpolation=function(interpolation){return _interpolationFunction=interpolation,this},this.chain=function(){return _chainedTweens=arguments,this},this.onStart=function(callback){return _onStartCallback=callback,this},this.onUpdate=function(callback){return _onUpdateCallback=callback,this},this.onComplete=function(callback){return _onCompleteCallback=callback,this},this.onStop=function(callback){return _onStopCallback=callback,this},this.update=function(time){var property,elapsed,value;if(time<_startTime)return!0;_onStartCallbackFired===!1&&(_onStartCallback!==null&&_onStartCallback.call(_object),_onStartCallbackFired=!0),elapsed=(time-_startTime)/_duration,elapsed=elapsed>1?1:elapsed,value=_easingFunction(elapsed);for(property in _valuesEnd){if(_valuesStart[property]===undefined)continue;var start=_valuesStart[property]||0,end=_valuesEnd[property];end instanceof Array?_object[property]=_interpolationFunction(end,value):(typeof end=="string"&&(end.startsWith("+")||end.startsWith("-")?end=start+parseFloat(end,10):end=parseFloat(end,10)),typeof end=="number"&&(_object[property]=start+(end-start)*value))}_onUpdateCallback!==null&&_onUpdateCallback.call(_object,value);if(elapsed===1){if(_repeat>0){isFinite(_repeat)&&_repeat--;for(property in _valuesStartRepeat){typeof _valuesEnd[property]=="string"&&(_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property],10));if(_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property],_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}return _yoyo&&(_reversed=!_reversed),_startTime=time+_delayTime,!0}_onCompleteCallback!==null&&_onCompleteCallback.call(_object);for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++)_chainedTweens[i].start(_startTime+_duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-0.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-0.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){return k===0?0:k===1?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-0.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=.1,p=.4;return k===0?0:k===1?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*2*Math.PI/p)))},Out:function(k){var s,a=.1,p=.4;return k===0?0:k===1?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*2*Math.PI/p)+1)},InOut:function(k){var s,a=.1,p=.4;return k===0?0:k===1?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?-0.5*a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*2*Math.PI/p):a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*2*Math.PI/p)*.5+1)}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?.5*k*k*((s+1)*k-s):.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?TWEEN.Easing.Bounce.In(k*2)*.5:TWEEN.Easing.Bounce.Out(k*2-1)*.5+.5}}},TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;return k<0?fn(v[0],v[1],f):k>1?fn(v[m],v[m-1],m-f):fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein;for(var i=0;i<=n;i++)b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i);return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;return v[0]===v[m]?(k<0&&(i=Math.floor(f=m*(1+k))),fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):k<0?v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var s=1;if(a[n])return a[n];for(var i=n;i>1;i--)s*=i;return a[n]=s,s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5,v1=(p3-p1)*.5,t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}},function(root){typeof define=="function"&&define.amd?define("tween",[],function(){return TWEEN}):typeof module!="undefined"&&typeof exports=="object"?module.exports=TWEEN:root!==undefined&&(root.TWEEN=TWEEN)}(this),require.config({baseUrl:"./",paths:{App:"App",etch:"lib/etch/dist/etch",exjs:"lib/exjs/dist/ex",extensions:"lib/extensions/dist/extensions",intersection:"lib/intersection/intersection",jquery:"lib/jquery/dist/jquery",keycodes:"lib/key-codes/dist/key-codes",lzma:"lib/lzma/src/lzma",PixelPalette:"lib/PixelPalette/dist/PixelPalette",Recorderjs:"lib/RecorderJS",text:"lib/text/text",Tone:"lib/tone/Tone",tween:"lib/tweenjs/src/Tween",utils:"lib/utils/dist/utils"},shim:{exjs:{exports:"exjs",path:"lib/exjs/dist/ex.min"},tween:{exports:"TWEEN",path:"lib/tween.ts/build/tween.min"},tone:{path:"lib/tone/build/Tone.js"},utils:{exports:"Utils"},pixelpalette:{},RecorderJS:{path:"lib/RecorderJS/recorder.js"},jquery:{}}}),require(["text","App","text!config.json","text!l10n.json","PixelPalette","Tone/core/Tone","jquery","etch","exjs","extensions","intersection","keycodes","lzma","Recorderjs/recorder","Tone/component/AmplitudeEnvelope","Tone/component/Envelope","Tone/component/Filter","Tone/component/LFO","Tone/component/EQMultiband","Tone/core/Master","Tone/core/Note","Tone/core/Transport","Tone/effect/AutoPanner","Tone/effect/AutoWah","Tone/effect/BitCrusher","Tone/effect/Chorus","Tone/effect/Convolver","Tone/effect/Distortion","Tone/effect/Freeverb","Tone/effect/Phaser","Tone/effect/PingPongDelay","Tone/effect/Tremolo","Tone/effect/PitchShift","Tone/instrument/Simpler","Tone/source/Microphone","Tone/source/Noise","Tone/source/Oscillator","Tone/source/Player","Tone/component/Meter","Tone/component/Mono","tween","utils"],function(text,App,config,l10n,PixelPalette,Tone,jquery){window.PixelPalette=PixelPalette,window.Tone=Tone,window.$=jquery,$(document).ready(function(){window.App=new App.default(config,l10n),window.App.Setup()})}),define("require-config",function(){});